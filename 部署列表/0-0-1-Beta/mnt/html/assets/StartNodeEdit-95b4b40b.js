import{r as e,i as t,j as r,S as s,a7 as i,B as o,D as l,a8 as a,m}from"./index-03adb9ee.js";import{l as n}from"./index-60bf4ee0.js";import{deptPageApi as p}from"./api-993dce33.js";import{serverToClientValue as d,clientToServerValueItem as u}from"./Bo-c1a8a5bb.js";import{getStartSetApi as j,updateStartSetApi as c}from"./processApi-c91a24f3.js";import h from"./formComponent-661a5f6d.js";import f from"./index-dc46b847.js";import{C as x}from"./index-3585a1a3.js";import"./Title-06decefc.js";import"./Input-51214805.js";import"./TextArea-24b2fc1a.js";import"./Password-e510335b.js";import"./QRCodeSVG-6b187ce2.js";import"./TaobaoOutlined-8cd58809.js";import"./FileZipFilled-01c99cd9.js";import"./BranchesOutlined-c52fb168.js";import"./RightSquareTwoTone-e5897024.js";import"./FileUnknownTwoTone-791de7ab.js";import"./MinusCircleOutlined-47af1d51.js";import"./MoreOutlined-49b0b054.js";import"./PlusCircleOutlined-a72eecfb.js";import"./PlusSquareTwoTone-f51424a0.js";import"./RetweetOutlined-9d2a328f.js";import"./SendOutlined-86da6479.js";import"./TableOutlined-67e609f9.js";import"./customerFieldNew-4c66ff92.js";import"./customerText-d905b3cb.js";import"./customerTextArea-b54e4aae.js";import"./customerSelect-ae4ebf75.js";import"./MinusCircleOutlined-ad177d4a.js";import"./PlusOutlined-b4032aa8.js";import"./customerMutSelect-fbe47964.js";import"./CustomerFile-75bdcaec.js";import"./CustomerDate-852678e3.js";import"./customerNumber-dffe68a9.js";import"./DeleteOutlined-2f949a39.js";import"./textSubmit-bd6c5b40.js";import"./textAreaSubmit-3b52d66b.js";import"./SelectSubmit-4c180fb2.js";import"./MutSelectSubmit-064a257d.js";import"./FileSubmit-a73b537e.js";import"./DateSubmit-95284b79.js";import"./NumberSubmit-77884c9b.js";const b=b=>{const[y]=n.Form.useForm(),[w,F]=e.useState("0"),[S,C]=e.useState([]),[T,g]=e.useState([]),[O,v]=e.useState([]),[k,E]=e.useState(!1),I=t.useRef(null),[P]=n.Form.useForm();e.useEffect((()=>{(async()=>{p({}).then((e=>{C(e.data)})),a().then((e=>{g(e.data)})),j({processPointId:b.processPointId}).then((e=>{y.setFieldsValue(e.data),F(e.data.flagSubmit),e.data.fieldList.forEach((e=>{d(e)})),v(e.data.fieldList)}))})()}),[]);return r.jsxs("div",{children:[r.jsx("h1",{style:{color:"blue"},children:"基础设置"}),r.jsxs("div",{children:[r.jsxs(n.Form,{form:y,children:[r.jsx(n.Form.Item,{label:"谁可以提交",name:"flagSubmit",rules:[{required:!0}],labelCol:{span:24},wrapperCol:{span:24},children:r.jsx(s,{placeholder:"请选择提交人范围",style:{width:"100%"},options:[{value:"0",label:"全部"},{value:"1",label:"指定部门"},{value:"2",label:"指定人员"}],onChange:e=>{F(e)}})}),"1"===w&&r.jsx(n.Form.Item,{label:"部门",name:"deptIds",rules:[{required:!0,message:"部门必填"}],labelCol:{span:24},wrapperCol:{span:24},children:r.jsx(i,{style:{width:"100%"},placeholder:"请选择部门",treeDefaultExpandAll:!0,fieldNames:{label:"name",value:"id"},treeData:S,multiple:!0})}),"2"===w&&r.jsx(n.Form.Item,{label:"人员",name:"userIds",rules:[{required:!0,message:"人员必填"}],labelCol:{span:24},wrapperCol:{span:24},children:r.jsx(s,{style:{width:"100%"},mode:"multiple",showSearch:!0,optionFilterProp:"label",placeholder:"请选择人员",options:T})})]}),r.jsx(x,{title:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"表单设计"}),r.jsx(o,{type:"primary",onClick:()=>E(!0),children:"设计表单"})]}),children:r.jsx(n.Form,{form:P,validateTrigger:"false",onValuesChange:(e,t)=>{O.forEach((t=>{e.hasOwnProperty(t.id)&&(t.value=e[t.id])})),v(O)},children:O.map((e=>r.jsx(f,{initFieldBo:e},e.id)))})}),r.jsx("div",{style:{marginTop:"20px",display:"flex",justifyContent:"center"},children:r.jsx(o,{type:"primary",onClick:async()=>{if(!(await y.validateFields().catch((()=>!1))))return;const e=await y.getFieldsValue();O.forEach((e=>{u(e)})),await c({...e,processPointId:b.processPointId,fieldList:O}),b.closeSelf?.()},children:"保存"})})]}),r.jsx(l,{title:"表单设计",open:k,onClose:()=>E(!1),extra:r.jsx(o,{onClick:()=>{const e=I.current?.getFieldList();if(!e)return;e.forEach((t=>{if(""===t.keyName)throw m.error("有字段的唯一标识为空"),new Error("有字段的唯一标识为空");const r=e.filter((e=>e.keyName===t.keyName));if(r.length>1)throw m.error(`有重复的唯一标识【${r[0].keyName}】`),new Error(`有重复的唯一标识【${r[0].keyName}】`)})),v(e);const t={};e.forEach((e=>{t[e.id]=e.value})),P.setFieldsValue(t),E(!1)},type:"primary",children:"确定"}),width:"100%",destroyOnClose:!0,keyboard:!1,children:r.jsx(h,{ref:I,initFormDesign:O})})]})};export{b as default};
