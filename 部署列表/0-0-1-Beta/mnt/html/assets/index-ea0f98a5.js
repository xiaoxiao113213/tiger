import{r as e,O as t,j as i,ab as l,D as o}from"./index-03adb9ee.js";import{isStage as s,getStageId as a,isStep as r,getStep as d,getStepId as n}from"./index-7ad95df9.js";import p from"./index-b36ffb98.js";import m from"./index-321d8600.js";import u,{LogTypeEnum as c}from"./index-62b2de95.js";import{pipelineNodeAllApi as j}from"./api-fd3812b8.js";import{otherAccountAllApi as x}from"./api-e992af87.js";import{pipelineBuildGetOneApi as f}from"./pipelineBuildApi-5c85f8f6.js";import{P as h}from"./PipelineBuildStatus-7922b5e5.js";import b from"./index-5c9d858f.js";import I from"./buildFlow-b17633dc.js";import{PipelineBuildContext as S}from"./context-b6a1069a.js";import{C as v}from"./index-3585a1a3.js";import{P as g}from"./index-88ad5331.js";import"./index-a2b78009.js";import"./EditOutlined-d7a61630.js";import"./TextArea-24b2fc1a.js";import"./Input-51214805.js";import"./Bo-c1a8a5bb.js";import"./index-19b1aa5f.js";/* empty css              */import"./uilts-8b8185ea.js";import"./dataUtil-e2413443.js";import"./CustomEdge-6ea755a4.js";import"./StartNode-bc5e087f.js";/* empty css             */import"./StageNode-1de82840.js";import"./StepNode-cd9fc784.js";const k=k=>{const[C,N]=e.useState(0),[y,L]=e.useState({}),[E,P]=e.useState({}),[F,D]=e.useState(t.close),[T,B]=e.useState({}),[O,w]=e.useState(t.close),[A,q]=e.useState(t.close),[H,J]=e.useState({}),[K,M]=e.useState({}),[Q,R]=e.useState([]);function U(e,t){if(!t||0===t.length)return null;for(let i of t){if(i.id===e)return i;let t=U(e,i.sonStageList);if(null!=t)return t}return null}const X=(e,i)=>{if("详情"===e)s(i)?L((e=>{let l=U(parseInt(a(i)),e.pipelineBuildStageList);return P(l),D(t.detail),e})):r(i)&&L((e=>{let l=d(parseInt(n(i)),e.pipelineBuildStageList);return B(l),w(t.detail),e}));else if("日志"===e)if(s(i));else if(r(i)){let e=parseInt(n(i));N(e),q(t.detail)}};return e.useEffect((()=>{f({id:k.buildDetailId}).then((e=>{L(e.data)})),(async()=>{j({}).then((e=>{let t={null:{text:"没有执行"}};e.data.forEach((e=>{t[e.id]={text:e.name}})),J(t)}));let e={};[{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}].forEach((t=>{e[t.id]={text:t.name}})),M(e),x({}).then((e=>{e.data.forEach((e=>e.id=e.id+"")),R(e.data)}))})();const e=setInterval((()=>{f({id:k.buildDetailId}).then((e=>{L(e.data)}))}),3e3);return()=>{clearInterval(e)}}),[]),i.jsx(S.Provider,{value:{nodeClickFn:X},children:i.jsx("div",{children:void 0!==y&&i.jsxs("div",{children:[i.jsx(I,{detail:y,nodeClickFn:X}),i.jsx(v,{children:i.jsxs(g,{column:2,title:"",tooltip:"",children:[i.jsx(g.Item,{label:"流水线名称",tooltip:"",valueType:"text",children:y.name},"name"),i.jsx(g.Item,{label:"构建状态",tooltip:"",valueType:"text",children:h.get(y.buildStatus)},"buildStatus"),i.jsx(g.Item,{label:"所属软件",tooltip:"",valueType:"text",valueEnum:K,children:y.softIds},"soft"),i.jsx(g.Item,{label:"执行机标签",tooltip:"",valueType:"text",children:y.pipelineNodeLabel},"pipelineNodeLabel"),i.jsx(g.Item,{label:"执行机",tooltip:"",valueEnum:H,children:y.pipelineNodeId},"pipelineNodeId"),i.jsx(g.Item,{label:"镜像",tooltip:"",valueEnum:{0:{text:"未使用镜像"},1:{text:"使用了镜像"}},children:y.dockerFlag},"dockerFlag"),1===y.dockerFlag&&i.jsx(g.Item,{label:"镜像名称",tooltip:"",valueType:"text",children:y.dockerName},"dockerName"),1===y.dockerFlag&&i.jsx(g.Item,{label:"镜像参数",tooltip:"",valueType:"textarea",children:y.dockerParam},"dockerParam")]})}),i.jsx(l,{children:"全局参数"}),y.globalParamList&&i.jsx(b,{initFieldBoList:y.globalParamList}),i.jsx(o,{title:"阶段详情",open:F!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>D(t.close),children:i.jsx(p,{stageDetail:E,pipelineNodeList:H})}),i.jsx(o,{title:"步骤详情",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>w(t.close),children:i.jsx(m,{stepDetail:T,pipelineNodeList:H,otherAccountList:Q})}),i.jsx(o,{title:"构建日志 ",open:A!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>q(t.close),footer:null,children:i.jsx("div",{children:i.jsx(u,{pipelineId:k.pipelineId,buildDetailId:k.buildDetailId,type:c.step,buildStepId:C})})})]})})})};export{k as default};
