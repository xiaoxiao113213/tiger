import{F as e,r as s,j as t,S as r,Q as i,ax as a,V as d,W as o,O as l,B as p,T as n,aw as c,D as u}from"./index-f2321b57.js";import{d as j}from"./Title-c989167c.js";import{p as x}from"./ProjectDic-f0370362.js";import{projectReleaseAllApi as m}from"./api-a90d72a1.js";import{projectIssueHeadUserListApi as I,projectIssueListForReleaseApi as h,projectIssueGetOneApi as f,projectIssueUpdateStatusSortApi as b}from"./api-960f9a69.js";import{I as y}from"./IssueTypeDic-247bf0a2.js";import g from"./detail-9972c757.js";import w from"./addOrUpdate-1e8d07b6.js";import{C as v}from"./index-e51db6e5.js";import{E as S}from"./EditOutlined-1e526840.js";import"./Input-f009b856.js";import"./TextArea-47627076.js";import"./api-3ad5779a.js";import"./dicApi-6905b9c5.js";import"./FileView-b3b24bb9.js";import"./index-26718f3e.js";import"./Bo-900708b2.js";import"./index-d54aef2b.js";import"./index-55f4da4c.js";import"./FileUploadCom-3c65d1d1.js";import"./PlusOutlined-0e19b652.js";import"./utils-5a18e36f.js";import"./submitNowform-f35e2701.js";import"./textSubmit-4229c5b2.js";import"./textAreaSubmit-14d30dcb.js";import"./SelectSubmit-d0c3571a.js";import"./MutSelectSubmit-d4556965.js";import"./DateSubmit-41050df2.js";import"./NumberSubmit-9c6b3724.js";import"./FileUploadSubmit-a4029aca.js";const k=d=>{const[o]=e.useForm(),{IssueTypeMap:l}=y(),[p,n]=s.useState([]),[c,u]=s.useState([]),[j,g]=s.useState([]),[w,S]=s.useState([]),{ProjectList:k,ProjectMap:M,ProjectValueEnum:P,refreshData:F}=x(),[T,D]=s.useState(),[E,R]=s.useState(),[L,U]=s.useState(),[V,O]=s.useState(),A=()=>{n([]),u([]),g([]),S([]),R([])};s.useEffect((()=>{k.length>0?(U(k[0].value),o.setFieldsValue({projectId:k[0].value})):(U(void 0),o.setFieldsValue({projectId:void 0}),A())}),[k]),s.useEffect((()=>{L?m({projectId:L,status:"1"}).then((e=>{D(e.data)})):D([])}),[L]),s.useEffect((()=>{T&&T.length>0?(O(T[0].value),o.setFieldsValue({projectReleaseId:T[0].value})):(O(void 0),o.setFieldsValue({projectReleaseId:void 0}))}),[T]);const B=e=>{h({projectId:L,projectReleaseId:V,headUserId:e}).then((e=>{const s=e.data;n(s.filter((e=>"0"===e.status))),u(s.filter((e=>"1"===e.status))),g(s.filter((e=>"2"===e.status))),S(s.filter((e=>"3"===e.status)))}))};if(s.useEffect((()=>{"1"==d.tab&&(V?(o.setFieldsValue({headUserId:void 0}),B(),I({projectReleaseId:V}).then((e=>{R(e.data)}))):A())}),[V,d.tab]),k.length<1)return t.jsx("div",{});const q=async e=>{const s=(await f({projectIssueId:e})).data;n((t=>t.map((t=>t.projectIssueId===e?s:t)))),u((t=>t.map((t=>t.projectIssueId===e?s:t)))),g((t=>t.map((t=>t.projectIssueId===e?s:t)))),S((t=>t.map((t=>t.projectIssueId===e?s:t))))};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflowY:"hidden"},children:[t.jsx(v,{style:{marginBottom:"20px"},children:t.jsxs(e,{layout:"inline",form:o,style:{gap:"10px"},children:[t.jsx(e.Item,{label:"项目",name:"projectId",required:!0,children:t.jsx(r,{style:{width:200},placeholder:"请选择项目",options:k,onChange:e=>U(e)})}),t.jsx(e.Item,{label:"版本",name:"projectReleaseId",required:!0,children:t.jsx(r,{style:{width:200},placeholder:"请选择版本",options:T,onChange:e=>O(e)})}),t.jsx(e.Item,{label:"责任人",name:"headUserId",children:t.jsx(r,{allowClear:!0,style:{width:200},placeholder:"请选择版本",options:E,onChange:e=>{B(e)}})})]})}),t.jsx("div",{style:{flexGrow:1,display:"flex",gap:"10px",overflowY:"auto"},children:t.jsxs(i,{onDragEnd:async e=>{const{source:s,destination:t}=e;if(!t)return;if(s.droppableId===t.droppableId&&s.index===t.index)return;let r,i,a,d;switch(s.droppableId){case"wait":r=[...p],a=n;break;case"sprint":r=[...c],a=u;break;case"complete":r=[...j],a=g;break;case"close":r=[...w],a=S;break;default:return}if(s.droppableId===t.droppableId){const[e]=r.splice(s.index,1);r.splice(t.index,0,e),await a(r);const i=0===t.index?null:r[t.index-1]?.projectIssueId;return await b({projectIssueId:e.projectIssueId,status:e.status,preProjectIssueId:i}),void(await q(e.projectIssueId))}switch(t.droppableId){case"wait":i=[...p],d=n;break;case"sprint":i=[...c],d=u;break;case"complete":i=[...j],d=g;break;case"close":i=[...w],d=S;break;default:return}const[o]=r.splice(s.index,1);i.splice(t.index,0,o),await a(r),await d(i);const l="wait"===t.droppableId?"0":"sprint"===t.droppableId?"1":"complete"===t.droppableId?"2":"3",x=0===t.index?null:i[t.index-1]?.projectIssueId;await b({projectIssueId:o.projectIssueId,status:l,preProjectIssueId:x}),await q(o.projectIssueId)},children:[t.jsx(C,{title:t.jsxs("span",{children:["待处理 ",t.jsx(a,{status:"default"})]}),list:p,droppableId:"wait",IssueTypeMap:l,updateList:q}),t.jsx(C,{title:t.jsxs("span",{children:["进行中 ",t.jsx(a,{status:"processing"})]}),list:c,droppableId:"sprint",IssueTypeMap:l,updateList:q}),t.jsx(C,{title:t.jsxs("span",{children:["已完成 ",t.jsx(a,{status:"success"})]}),list:j,droppableId:"complete",IssueTypeMap:l,updateList:q}),t.jsx(C,{title:t.jsxs("span",{children:["已关闭 ",t.jsx(a,{status:"error"})]}),list:w,droppableId:"close",IssueTypeMap:l,updateList:q})]})})]})},C=e=>{const{title:s,list:r,droppableId:i,IssueTypeMap:a,updateList:l}=e;return t.jsx(v,{style:{width:"25%",padding:"0 10px"},children:t.jsx(d,{droppableId:i,children:e=>t.jsxs("div",{...e.droppableProps,ref:e.innerRef,style:{minHeight:"300px"},children:[t.jsx(j,{level:4,style:{textAlign:"center",marginBottom:"20px"},children:s}),r.map(((e,s)=>t.jsx(o,{draggableId:e.projectIssueId.toString(),index:s,children:s=>t.jsx("div",{ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,style:{...s.draggableProps.style,marginBottom:"10px",backgroundColor:"#f9f9f9",padding:"10px",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:t.jsx(M,{item:e,typeMap:a,updateList:l},e.projectIssueId)})},e.projectIssueId))),e.placeholder]})})})},M=e=>{const{item:r,updateList:i}=e,[a,d]=s.useState(l.close),[o,j]=s.useState(l.close);return t.jsxs("div",{children:[t.jsxs(v,{title:t.jsx(p,{type:"link",onClick:()=>d(l.edit),children:e.item.name}),size:"small",extra:t.jsx(p,{type:"link",icon:t.jsx(S,{}),onClick:()=>j(l.edit)}),children:[t.jsxs("div",{children:["类型：",t.jsx(n,{color:e.typeMap[e.item.type]?.color,children:e.typeMap[e.item.type]?.label})]}),t.jsxs("div",{children:["描述：",e.item.remarks]}),t.jsxs("div",{children:["负责人：",e.item.headUserInfo?.nickName]}),t.jsxs("div",{children:["开始时间：",c(e.item.startDate)]}),t.jsxs("div",{children:["结束时间：",c(e.item.endDate)]}),t.jsxs("div",{children:["优先级：",P(e.item.priority)]})]}),t.jsx(u,{title:"配置详情",open:a!==l.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>d(l.close),footer:null,children:t.jsx("div",{children:t.jsx(g,{detailId:r.projectIssueId})})}),t.jsx(u,{title:o==l.edit?"配置编辑":"配置新增",open:o!==l.close,width:"50%",destroyOnClose:!0,maskClosable:!1,onClose:()=>j(l.close),footer:null,children:t.jsx("div",{children:t.jsx(w,{detailId:r.projectIssueId??0,operateEnum:o,setAddOrUpdateModalFn:j,reloadTable:()=>{j(l.close),i(r.projectIssueId)},defaultProjectId:r.projectId})})})]})},P=e=>{switch(e.toString()){case"0":return t.jsxs("span",{children:["一般 ",t.jsx(a,{status:"success"})]});case"1":return t.jsxs("span",{children:["重要 ",t.jsx(a,{status:"processing"})]});case"2":return t.jsxs("span",{children:["紧急 ",t.jsx(a,{status:"error"})]});default:return""}};export{k as default};
