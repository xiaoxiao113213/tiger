import{i as e,r as t,O as s,aJ as i,j as r,I as l,aa as o,B as a,ax as n,D as d,M as c,aK as h,c as j,m}from"./index-1fe6dff8.js";import"./index-219b3cf2.js";import p from"./chat-d8e5e581.js";import x from"./AddGroupChat-ef48cbd9.js";import{talkAllApi as u}from"./api-818bd5ab.js";import k from"./AddChat-0e33b0a2.js";import{I as f}from"./index-c8be8443.js";import{L as g}from"./index-7a58f6d7.js";import{L as y}from"./index-debe4a2e.js";import{S as v}from"./SearchOutlined-fb74abfc.js";import{P as C}from"./PlusCircleOutlined-1ccc4556.js";import{M as I}from"./MoreOutlined-bbcb7d9f.js";import"./GroupSetting-befbc648.js";import"./AddMoreUser-19b113f0.js";import"./SelectGroupUser-1f7cf2e4.js";import"./DeleteOutlined-916130f1.js";import"./RetweetOutlined-9d2a328f.js";import"./index-80d88ab0.js";import"./ApiBo-be5b8d9e.js";import"./index-d9bad433.js";import"./SendOutlined-86da6479.js";import"./SelectUser-699b844c.js";import"./PlusCircleOutlined-a72eecfb.js";import"./MoreOutlined-49b0b054.js";const w=()=>{const w=e.useRef(null),[S,O]=t.useState(s.close),[b,T]=t.useState(s.close),[A,M]=t.useState(""),[N,E]=t.useState(),[P,R]=t.useState([]),{userMsg:L,setChat:D}=i(),G=async e=>{u({search:A}).then((t=>{if(R(t.data),e)E(t.data.find((t=>t.talkId==e)));else if(t.data.length>0)if(N){const e=t.data.find((e=>e.talkId==N?.talkId));E(e||t.data[0])}else E(t.data[0])}))},U=e=>{G(e)};t.useEffect((()=>{G()}),[L]),t.useEffect((()=>{R(P.map((e=>(e.talkId===N?.talkId&&(e.unReadCount=0),e))))}),[N]);return t.useEffect((()=>{const e=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting?D(!0):D(!1)}))}));return w.current&&e.observe(w.current),()=>{e.disconnect(),D(!1)}}),[w]),r.jsxs("div",{style:{height:"100%"},ref:w,children:[r.jsxs(g,{style:{height:"100%"},hasSider:!0,children:[r.jsxs(g.Sider,{style:{backgroundColor:"#cccccc",height:"100%"},width:300,children:[r.jsxs("div",{style:{backgroundColor:"white",textAlign:"right",height:"48px"},children:[r.jsx(l,{style:{width:"265px"},suffix:r.jsx(v,{onClick:()=>{G()}}),onChange:e=>{M(e.target.value)},onPressEnter:e=>{G()},allowClear:!0}),r.jsx(o,{placement:"rightTop",trigger:"click",title:()=>r.jsxs("div",{children:[r.jsx("div",{children:r.jsx(a,{type:"link",onClick:()=>T(s.add),children:"发起聊天"})}),r.jsx("div",{children:r.jsx(a,{type:"link",onClick:()=>O(s.add),children:"发起群聊"})})]}),children:r.jsx(a,{type:"link",icon:r.jsx(C,{})})})]}),r.jsx("div",{style:{height:"calc(100% - 48px)",overflowY:"scroll"},className:"mmm-bgcolor",children:r.jsx(y,{itemLayout:"horizontal",dataSource:P,renderItem:(e,t)=>r.jsx(y.Item,{className:"mmm-hover-pointer",onClick:()=>{E(e)},style:{backgroundColor:N?.talkId===e.talkId?"#d7e4ef":"white",borderRadius:"10px"},children:r.jsx(y.Item.Meta,{avatar:r.jsx("div",{children:r.jsx(n,{count:N?.talkId===e.talkId?0:e.unReadCount,showZero:!1,children:r.jsx(f,{type:e.talkType,avatar:e.targetAvatar,nickName:e.title,targetId:e.targetId})})}),title:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("div",{style:{cursor:"pointer",width:"calc(100% - 20px)"},children:e.title}),r.jsx("div",{style:{width:"20px"},className:"mmm-hover-pointer",onClick:e=>{e.stopPropagation()},children:r.jsx(o,{trigger:"hover",placement:"rightTop",title:r.jsx("div",{children:r.jsx("div",{children:r.jsx(a,{type:"link",onClick:()=>{(async e=>{c.confirm({title:"确认删除",content:"确认删除该聊天吗？",icon:null,onOk:async()=>{let t=await h({talkId:e});j(t)||(m.success(t.msg),G())}})})(e.talkId)},children:"删除聊天"})})}),children:r.jsx(I,{})})})]}),description:r.jsx("div",{className:"mmm-ellipsis",children:e.text})})})})})]}),r.jsx(g.Content,{style:{height:"100%"},children:r.jsx("div",{style:{color:"black",height:"100%"},children:N&&r.jsx(p,{nowTalk:N,reloadTalkList:()=>{G()}},N.talkId)})})]}),r.jsx(d,{open:S!==s.close,width:"800px",onClose:()=>O(s.close),destroyOnClose:!0,children:r.jsx(x,{close:()=>O(s.close),setNowTalkId:U})}),r.jsx(d,{open:b!==s.close,width:"800px",onClose:()=>T(s.close),destroyOnClose:!0,children:r.jsx(k,{close:()=>T(s.close),setNowTalkId:U})})]})};export{w as default};
