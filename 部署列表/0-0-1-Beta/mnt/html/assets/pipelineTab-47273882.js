import{F as t,r as e,j as i,O as s,B as o,al as a,K as r,Y as p,m,aj as l}from"./index-52537ad8.js";import n from"./pipelineMainAdd-db9c59bc.js";import{pipelineNodeAllApi as d}from"./api-222992e2.js";import{otherAccountAllApi as j}from"./api-8573b5cc.js";import{clientToServerValueItem as u,serverToClientValue as c,FormFieldTypeEnum as y}from"./Bo-cc27e439.js";import{pipelineUpdateApi as f,pipelineSaveApi as x,pipelineGetOneApi as S}from"./pipeline-5a55b6de.js";import"./index-7ad95df9.js";import"./stageComponent-fe605383.js";import"./context-96d01b3e.js";import"./stepComponent-eac69a8d.js";import"./api-ed2ab3d9.js";import"./index-a6bd6bca.js";import"./submitNowform-370ac6e7.js";import"./textSubmit-f698ce92.js";import"./textAreaSubmit-9cc0fcd3.js";import"./SelectSubmit-a0546f42.js";import"./MutSelectSubmit-978c5f1c.js";import"./DateSubmit-7515399a.js";import"./NumberSubmit-d54ed6cf.js";import"./FileUploadSubmit-1e28b47f.js";import"./PlusOutlined-0403edcb.js";import"./index-8d66853c.js";import"./PipelineFlow-2f0bf3ee.js";import"./index-f591dfb2.js";/* empty css              */import"./uilts-69ee15ee.js";import"./StartNode-63179638.js";/* empty css             */import"./dataUtil-725c2a7d.js";import"./StageNode-52a71548.js";import"./StepNode-2cb45518.js";import"./CustomEdge-74ff2b7a.js";import"./index-f6caee0f.js";import"./FileSubmit-f1303890.js";import"./formComponent-546559ea.js";import"./Title-0f7b284b.js";import"./Input-33d09d13.js";import"./TextArea-0027e4e6.js";import"./customerFieldNew-1985dcb7.js";import"./customerText-7f38fb85.js";import"./customerTextArea-84d38379.js";import"./customerSelect-aabfe871.js";import"./MinusCircleOutlined-37395b9b.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-c1e3cf9e.js";import"./CustomerFile-7877d17f.js";import"./CustomerDate-9ed3e0ba.js";import"./customerNumber-33ced8f3.js";import"./DeleteOutlined-104cbf00.js";const b=b=>{const[F]=t.useForm(),[h,v]=e.useState(),[T,g]=e.useState([]),[C,L]=e.useState([]),[w,A]=e.useState([]),[E]=t.useForm(),[N,O]=e.useState([]),P=[{key:"1",label:"主配置",children:i.jsx("div",{children:void 0!==h&&i.jsx(n,{detail:h,setDetailFn:v,pipelineNodeList:T,detailFormRef:F,openType:b.openType,softList:C,otherAccountList:w,globalFieldList:N,setGlobalFieldList:O})})}],k=t=>{t.globalParamList?.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(",")),t.type,y.password})),l(t.pipelineStageList??[]).forEach((t=>{t?.paramList.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(","))}))}))},D=i.jsxs("div",{children:[b.openType!==s.detail&&i.jsx(o,{type:"primary",onClick:async()=>{if(b.openType===s.detail)return void b.setOpenTypeFn(s.close);if(!(await F.validateFields().catch((()=>!1))))return;const t=await(F?.getFieldsValue());p(t);if(!(await E.validateFields().catch((()=>!1))))return void m.warning("有必填项未填");const e=N.map((t=>{const e={...t};return u(e),e}));let i;if(h?.id){let t={...h,globalParamList:e};k(a(t)),i=await f(a(t))}else{let s={...h,...t,globalParamList:e};k(a(s)),i=await x(a(s))}1e3===i?.code&&(m.success(i?.msg),b.reloadTable(),b.setOpenTypeFn(s.close))},children:"确认"}),i.jsx(o,{type:"default",style:{marginLeft:10},onClick:()=>b.setOpenTypeFn(s.close),children:"取消"})]});return e.useEffect((()=>((async()=>{d({}).then((t=>{g(t.data)})),L([{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}]),j({}).then((t=>{t.data.forEach((t=>t.id=t.id+"")),A(t.data)}))})(),b.openType===s.add?v(a({parallel:0,timer:0,timerCron:0,email:0,pipelineStageList:[]})):b.openType!==s.edit&&b.openType!==s.detail||(async t=>{const e=await S({id:t});if(1e3!==e?.code)return;v({...e.data});const i=e.data.globalParamList??[];i.forEach((t=>{c(t)})),O(i),F?.setFieldsValue({...e.data}),e.data.permissionList})(b.detailId),()=>{})),[b.openType]),i.jsx("div",{children:i.jsx(r,{defaultActiveKey:"1",items:P,onChange:t=>{},tabBarExtraContent:D})})};export{b as default};
