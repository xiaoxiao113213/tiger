import{r as e,O as t,F as a,j as i,D as s,e as n,I as r,f as l,S as d}from"./index-f2321b57.js";import{u as o,H as m,d as p}from"./index-da2797ee.js";import{d as x}from"./Title-c989167c.js";import{C as c,V as u}from"./ApiBo-06fcdbd2.js";import{aiPipelinePointGetOneApi as h}from"./pointApi-9a147261.js";import{aiPipelinePointVarUpdateApi as j,aiPipelinePointVarSaveApi as y,aiPipelinePointVarDeleteApi as f}from"./varApi-9218bc07.js";import{D as g}from"./DeleteOutlined-10e7bcc5.js";import"./Input-f009b856.js";import"./TextArea-47627076.js";function I({id:r,isConnectable:d}){o();const[u,I]=e.useState(t.close),[w]=a.useForm(),[C,v]=e.useState(),[V,b]=e.useState();e.useEffect((()=>{const e={};for(let t in C)e[C[t].key+"_name"]=C[t].name,e[C[t].key+"_type"]=C[t].type,e[C[t].key+"_remarks"]=C[t].remarks,e[C[t].key+"_defaultValue"]=C[t].defaultValue;w.setFieldsValue(e)}),[C]),e.useEffect((()=>{V&&v(V.varList.filter((e=>"historyMsg"!=e.name)).map(((e,t)=>({key:e.aiPipelinePointVarId.toString(),name:e.name,type:e.type,remarks:e.remarks,defaultValue:e.defaultValue}))))}),[V]);const P=async()=>{const e=await h({aiPipelinePointId:r});b(e.data)},A=[{title:"变量名",dataIndex:"name",width:"180px",editable:!0},{title:"变量类型",dataIndex:"type",width:"130px",editable:!0},{title:"默认值",dataIndex:"defaultValue",editable:!0},{title:"描述",dataIndex:"remarks",editable:!0},{title:"",dataIndex:"operation",width:"30px",render:(e,t)=>"historyMsg"===t.name||"newMsg"===t.name?i.jsx(i.Fragment,{}):i.jsx("div",{children:i.jsx(g,{onClick:()=>(async e=>{"newMsg"!==e.name&&(await f({aiPipelinePointVarId:parseInt(e.key)}),P())})(t)})})}].map((e=>{if(!e.editable)return e;const t=t=>{let a=!0;return"newMsg"===t.name&&(a="defaultValue"===e.dataIndex||"remarks"===e.dataIndex),a};return{...e,onCell:a=>({record:a,inputType:"text",dataIndex:e.dataIndex,title:e.title,editing:t(a)})}}));return i.jsxs("div",{children:[i.jsx("div",{style:{width:"100px",height:"40px",display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",fontSize:"medium",cursor:"pointer",backgroundColor:"#f0f0f0"},onClick:()=>{P(),I(t.add)},children:i.jsx("span",{children:"开始"})}),i.jsx(m,{type:"source",position:p.Right,isConnectable:d}),i.jsx(s,{title:"设置",open:u!==t.close,width:"1200px",destroyOnClose:!0,maskClosable:!0,onClose:()=>I(t.close),footer:null,children:i.jsxs("div",{style:{},children:[i.jsx("div",{style:{},children:i.jsx(x,{level:4,children:"开始"})}),i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",marginBottom:"5px"},children:[i.jsx("div",{children:"输入参数设置："}),i.jsx("div",{style:{marginRight:"30px"},children:i.jsx("a",{onClick:()=>(async()=>{await y({aiPipelinePointId:r,name:l(),type:"string",remarks:"",defaultValue:void 0,category:c.Output}),P()})(),children:i.jsx("img",{src:"/icons/加号.svg",alt:"icon",style:{width:16,height:16,display:"inline",marginRight:"5px"}})})})]}),i.jsx(a,{form:w,component:!1,onValuesChange:(e,t)=>{for(let a in e){const t=a.split("_"),i=t[0],s=t[1],n=e[a],r={aiPipelinePointVarId:parseInt(i),[s]:n,keyName:s};j(r)}},children:i.jsx(n,{components:{body:{cell:k}},bordered:!0,dataSource:C,columns:A,rowClassName:"editable-row",pagination:!1})})]})]})})]})}const k=({editing:e,dataIndex:t,title:s,inputType:n,record:l,index:o,children:m,...p})=>{if("变量名"==s)return i.jsx("td",{...p,children:e?i.jsx(a.Item,{name:`${l.key}_${t}`,style:{margin:0},rules:[{required:!0,message:`请输入 ${s}！只能输入英文字符和数字，且以英文字符开头。`},{pattern:/^[a-zA-Z][a-zA-Z0-9]*$/,message:"只能输入英文字符和数字，且以英文字符开头。"}],children:i.jsx(r,{maxLength:20,showCount:!0})}):m});let x;return x="变量类型"==s?i.jsx(d,{options:u}):"描述"==s||"默认值"==s?i.jsx(r.TextArea,{autoSize:{minRows:1,maxRows:3}}):i.jsx(r,{maxLength:20,showCount:!0}),i.jsx("td",{...p,children:e?i.jsx(a.Item,{name:l.key+"_"+t,style:{margin:0},rules:[{required:!1,message:`Please Input ${s}!`}],children:x}):m})};export{I as default};
