import{r as e,O as t,j as i,P as s,B as o,a3 as a,D as l,ak as r,aD as n,M as d,m as p}from"./index-f2321b57.js";import m from"./BuildModal-71b0d489.js";import{pipelinePageApi as c,pipelineUpdateDisabledApi as u,pipelineDeleteApi as j}from"./pipeline-69e8b66b.js";import{dicValueApi as h}from"./dicApi-6905b9c5.js";import x from"./accountSetting-207364c6.js";import S from"./pipelineOtherAdd-59d60493.js";import y from"./pipelineMainAdd-ccc77f52.js";import{T as b}from"./index-79201193.js";import{P as C}from"./PlusOutlined-0e19b652.js";import"./api-557990cc.js";import"./Bo-900708b2.js";import"./pipelineBuildApi-6237b796.js";import"./submitNowform-f35e2701.js";import"./textSubmit-4229c5b2.js";import"./textAreaSubmit-14d30dcb.js";import"./SelectSubmit-d0c3571a.js";import"./MutSelectSubmit-d4556965.js";import"./DateSubmit-41050df2.js";import"./NumberSubmit-9c6b3724.js";import"./FileUploadSubmit-a4029aca.js";import"./index-e51db6e5.js";import"./index-20d3ffb0.js";import"./Title-c989167c.js";import"./Input-f009b856.js";import"./TextArea-47627076.js";import"./Password-38003184.js";import"./QRCodeSVG-f82b9ee5.js";import"./TaobaoOutlined-8cd58809.js";import"./FileZipFilled-c8d13b2f.js";import"./BranchesOutlined-c52fb168.js";import"./RightSquareTwoTone-e5897024.js";import"./FileUnknownTwoTone-791de7ab.js";import"./MinusCircleOutlined-47af1d51.js";import"./MoreOutlined-49b0b054.js";import"./PlusCircleOutlined-a72eecfb.js";import"./PlusSquareTwoTone-f51424a0.js";import"./RetweetOutlined-9d2a328f.js";import"./SendOutlined-86da6479.js";import"./TableOutlined-67e609f9.js";import"./api-df708061.js";import"./api-5c5bfeed.js";import"./index-7ad95df9.js";import"./stageComponent-8780fca7.js";import"./context-c3c65fe4.js";import"./stepComponent-e03081ad.js";import"./api-cbd9b73e.js";import"./index-b1386cd3.js";import"./PipelineFlow-b9d89384.js";import"./index-da2797ee.js";/* empty css              */import"./uilts-e16e3ac3.js";import"./StartNode-f0bf4205.js";/* empty css             */import"./dataUtil-d817c03a.js";import"./StageNode-16907dfe.js";import"./StepNode-07191e47.js";import"./CustomEdge-528ca68e.js";import"./index-1e1c35a0.js";import"./FileSubmit-975998bf.js";import"./formComponent-e31b7955.js";import"./customerFieldNew-4b477ff0.js";import"./customerText-29c51ee6.js";import"./customerTextArea-c929063a.js";import"./customerSelect-e147971d.js";import"./MinusCircleOutlined-ede52421.js";import"./customerMutSelect-b7b09c88.js";import"./CustomerFile-0ba717f3.js";import"./CustomerDate-a09fb913.js";import"./customerNumber-e3e13da1.js";import"./DeleteOutlined-10e7bcc5.js";import"./api-d0d1aa93.js";const w=()=>{const[t,i]=e.useState([]),[s,o]=e.useState(new Map),[a,l]=e.useState({});return e.useEffect((()=>{(async()=>{let e=await h({code:"pipeline_use_status"});e.data.forEach((e=>e.value=parseInt(e.value))),i(e.data);let t={},s=new Map;e.data.forEach((e=>{t[e.value]={text:e.label},s.set(e.value,e)})),o(s),l(t)})()}),[]),{PipelineUseStatusList:t,PipelineUseStatusMap:s,PipelineUseStatusValueEnum:a}},T=()=>{const h=e.useRef(),[T,f]=e.useState(t.close),[k,g]=e.useState(),[O,I]=e.useState(t.close);let{PipelineUseStatusValueEnum:F}=w();const[B,P]=e.useState(t.close),[M,v]=e.useState(t.close),z=(e,i)=>{switch(e){case"other":g(i.id),v(t.add);break;case"delete":(async e=>{d?.confirm({title:"是否删除该条数据",content:e.name,icon:null,onOk:async()=>{const t=await j({id:e?.id});1e3===t?.code&&(p.success(t?.msg),h?.current?.reload())}})})(i);break;case"permission":g(i.id),P(t.add)}},A=[{title:"ID",dataIndex:"id",width:"80px",valueType:"text",search:!1},{title:"名称",dataIndex:"name",render:(e,s)=>i.jsx("a",{style:{color:"#1668dc"},onClick:()=>(async e=>{g(e.id),f(t.detail)})(s),children:s.name})},{title:"状态",dataIndex:"disabled",search:!1,render:(e,{disabled:t,id:s})=>i.jsx(n,{defaultValue:0===t,onChange:e=>{((e,t)=>{u({id:e,disabled:t?0:1}).then((e=>{e.code}))})(s,e)}})},{title:"使用状态",search:!1,dataIndex:"useStatus",valueEnum:F},{title:"最后构建时长",search:!1,dataIndex:"lastBuildTotalTime"},{title:"最后构建结果",search:!1,dataIndex:"lastBuildStatus"},{title:"创建人",search:!1,dataIndex:"updateBy"},{title:"创建时间",search:!1,dataIndex:"createTime"},{title:"操作",valueType:"option",width:170,key:"operation",render:(e,s)=>[i.jsx(o,{onClick:()=>(async e=>{window.open("/pipelineBuild?pipelineId="+e.id,"_blank")})(s),size:"small",type:"link",children:"构建列表"},"buildList"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),I(t.add)})(s),size:"small",type:"link",children:"构建"},"build"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),f(t.edit)})(s),size:"small",type:"link",hidden:a("pipeline:edit"),children:"编辑"},"edit"),i.jsx(b,{onSelect:e=>z(e,s),menus:[{key:"permission",name:"权限",hidden:a("pipeline:permission")},{key:"other",name:"其他配置",hidden:a("pipeline:edit")},{key:"delete",name:"删除",danger:!0,hidden:a("pipeline:del")}]},"actionGroup")]}];return i.jsxs("div",{children:[i.jsx(s,{columns:A,actionRef:h,cardBordered:!0,params:{},request:async(e={},t,i)=>{let s={pageNum:e.current,pageSize:e.pageSize,pageSort:t},o=await c({...e,...s});return{data:o.data.list,success:1e3===o.code,total:o.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pipeline-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:{labelWidth:"auto"},options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[i.jsx(o,{icon:i.jsx(C,{}),onClick:()=>{(async()=>{g(void 0),f(t.add)})()},type:"primary",hidden:a("pipeline:add"),children:"新建"},"button")]}),i.jsx(l,{title:r(T),open:T!==t.close,width:"100%",destroyOnClose:!0,maskClosable:!1,onClose:()=>f(t.close),footer:null,keyboard:!1,children:i.jsx(y,{openType:T,pipelineId:k,reloadTable:()=>{f(t.close),h?.current?.reload()}})},"pipelineTab"),i.jsx(l,{title:"构建流水线",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>I(t.close),children:i.jsx(m,{setBuildModalFn:I,detailId:k,reloadTable:()=>{h?.current?.reload(),I(t.close)}})}),i.jsx(l,{title:"项目人员",open:B!==t.close,onClose:()=>P(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(x,{pipelineId:k,closeFn:()=>P(t.close)})},"accountSetting"),i.jsx(l,{title:"其他配置",open:M!==t.close,onClose:()=>v(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(S,{pipelineId:k,closeFn:()=>v(t.close)})},"otherSetting")]})};export{T as default};
