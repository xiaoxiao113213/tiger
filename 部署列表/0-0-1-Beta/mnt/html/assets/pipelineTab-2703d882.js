import{F as t,r as e,j as i,O as s,B as o,al as a,K as r,Y as p,m,aj as l}from"./index-03adb9ee.js";import n from"./pipelineMainAdd-e3cabbd5.js";import{pipelineNodeAllApi as d}from"./api-fd3812b8.js";import{otherAccountAllApi as j}from"./api-e992af87.js";import{clientToServerValueItem as u,serverToClientValue as c,FormFieldTypeEnum as y}from"./Bo-c1a8a5bb.js";import{pipelineUpdateApi as f,pipelineSaveApi as x,pipelineGetOneApi as S}from"./pipeline-ea2f224f.js";import"./index-7ad95df9.js";import"./stageComponent-66e485ae.js";import"./context-3c44e91e.js";import"./stepComponent-9efb724d.js";import"./api-8691a2b8.js";import"./index-173fa263.js";import"./submitNowform-fbdcf9ab.js";import"./textSubmit-bd6c5b40.js";import"./textAreaSubmit-3b52d66b.js";import"./SelectSubmit-4c180fb2.js";import"./MutSelectSubmit-064a257d.js";import"./DateSubmit-95284b79.js";import"./NumberSubmit-77884c9b.js";import"./FileUploadSubmit-e8f92bb2.js";import"./PlusOutlined-b4032aa8.js";import"./index-3585a1a3.js";import"./PipelineFlow-a4f586d2.js";import"./index-19b1aa5f.js";/* empty css              */import"./uilts-8b8185ea.js";import"./StartNode-c7411ad4.js";/* empty css             */import"./dataUtil-954be25d.js";import"./StageNode-e435ce7e.js";import"./StepNode-d82bcaf5.js";import"./CustomEdge-6ea755a4.js";import"./index-dc46b847.js";import"./FileSubmit-a73b537e.js";import"./formComponent-661a5f6d.js";import"./Title-06decefc.js";import"./Input-51214805.js";import"./TextArea-24b2fc1a.js";import"./customerFieldNew-4c66ff92.js";import"./customerText-d905b3cb.js";import"./customerTextArea-b54e4aae.js";import"./customerSelect-ae4ebf75.js";import"./MinusCircleOutlined-ad177d4a.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-fbe47964.js";import"./CustomerFile-75bdcaec.js";import"./CustomerDate-852678e3.js";import"./customerNumber-dffe68a9.js";import"./DeleteOutlined-2f949a39.js";const b=b=>{const[F]=t.useForm(),[h,v]=e.useState(),[T,g]=e.useState([]),[C,L]=e.useState([]),[w,A]=e.useState([]),[E]=t.useForm(),[N,O]=e.useState([]),P=[{key:"1",label:"主配置",children:i.jsx("div",{children:void 0!==h&&i.jsx(n,{detail:h,setDetailFn:v,pipelineNodeList:T,detailFormRef:F,openType:b.openType,softList:C,otherAccountList:w,globalFieldList:N,setGlobalFieldList:O})})}],k=t=>{t.globalParamList?.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(",")),t.type,y.password})),l(t.pipelineStageList??[]).forEach((t=>{t?.paramList.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(","))}))}))},D=i.jsxs("div",{children:[b.openType!==s.detail&&i.jsx(o,{type:"primary",onClick:async()=>{if(b.openType===s.detail)return void b.setOpenTypeFn(s.close);if(!(await F.validateFields().catch((()=>!1))))return;const t=await(F?.getFieldsValue());p(t);if(!(await E.validateFields().catch((()=>!1))))return void m.warning("有必填项未填");const e=N.map((t=>{const e={...t};return u(e),e}));let i;if(h?.id){let t={...h,globalParamList:e};k(a(t)),i=await f(a(t))}else{let s={...h,...t,globalParamList:e};k(a(s)),i=await x(a(s))}1e3===i?.code&&(m.success(i?.msg),b.reloadTable(),b.setOpenTypeFn(s.close))},children:"确认"}),i.jsx(o,{type:"default",style:{marginLeft:10},onClick:()=>b.setOpenTypeFn(s.close),children:"取消"})]});return e.useEffect((()=>((async()=>{d({}).then((t=>{g(t.data)})),L([{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}]),j({}).then((t=>{t.data.forEach((t=>t.id=t.id+"")),A(t.data)}))})(),b.openType===s.add?v(a({parallel:0,timer:0,timerCron:0,email:0,pipelineStageList:[]})):b.openType!==s.edit&&b.openType!==s.detail||(async t=>{const e=await S({id:t});if(1e3!==e?.code)return;v({...e.data});const i=e.data.globalParamList??[];i.forEach((t=>{c(t)})),O(i),F?.setFieldsValue({...e.data}),e.data.permissionList})(b.detailId),()=>{})),[b.openType]),i.jsx("div",{children:i.jsx(r,{defaultActiveKey:"1",items:P,onChange:t=>{},tabBarExtraContent:D})})};export{b as default};
