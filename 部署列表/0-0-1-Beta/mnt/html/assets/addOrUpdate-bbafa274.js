import{F as e,r as t,d as s,j as a,S as i,I as o,B as r,O as l,Y as d,m}from"./index-1fe6dff8.js";import{projectReleaseGetOneApi as u,projectReleaseUpdateApi as n,projectReleaseSaveApi as c}from"./api-12ed6815.js";import{F as p}from"./FileUploadCom-a72168c5.js";import j from"./submitNowform-3c073972.js";import{p as f}from"./ProjectDic-4254ddc1.js";import{serverToClientValue as x,serverToClientValue1 as h,clientToServerValue1 as b}from"./Bo-9e2098a1.js";import{projectCustomFieldAllApi as F}from"./api-7922a999.js";import{f as w,a as I}from"./utils-b346c468.js";import"./PlusOutlined-73232e7a.js";import"./textSubmit-0f3171ae.js";import"./textAreaSubmit-d1dfc909.js";import"./SelectSubmit-9d579393.js";import"./MutSelectSubmit-5dc3359d.js";import"./DateSubmit-c557ba41.js";import"./NumberSubmit-de5567a9.js";import"./FileUploadSubmit-add66fc2.js";const S=S=>{const[g]=e.useForm(),[y,C]=t.useState(s),{ProjectList:L}=f(),[V,O]=t.useState();if(t.useEffect((()=>((async()=>{const e=(await F({bizType:"1"})).data;if(e.forEach((e=>{const t=e.projectCustomFieldId,s=e;x(s),s.id=t+"_customField"})),O(e),S.operateEnum===l.edit){let t=await u({projectReleaseId:S.detailId});t.data.fileList=w(t.data.fileList);for(let s in t.data.customValues)if(t.data.customValues.hasOwnProperty(s)){const a=s.split("_");if(2===a.length){const i=a[0];t.data.customValues[s]=h(e.find((e=>e.projectCustomFieldId==i)),t.data.customValues[s])}}C(t.data),g.setFieldsValue({...t.data,...t.data.customValues})}else g.setFieldsValue({projectId:S.defaultProjectId})})(),()=>{})),[]),void 0===V)return a.jsx("div",{});return a.jsx("div",{children:a.jsxs(e,{form:g,labelCol:{flex:"120px"},children:[a.jsx(e.Item,{label:"项目",name:"projectId",rules:[{required:!0}],children:a.jsx(i,{options:L,disabled:!0})}),a.jsx(e.Item,{label:"版本",name:"version",rules:[{required:!0}],children:a.jsx(o,{placeholder:"请输入",maxLength:200,showCount:!0})}),a.jsx(e.Item,{label:"remarks",name:"remarks",rules:[{required:!1}],children:a.jsx(o.TextArea,{placeholder:"请输入",maxLength:1900,showCount:!0,autoSize:{minRows:2,maxRows:5}})}),a.jsx(p,{name:"fileList",label:"附件",required:!1}),V.map((e=>a.jsx(j,{initFieldBo:e},e.id))),a.jsxs(e.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[a.jsx(r,{type:"default",onClick:()=>{S.setAddOrUpdateModalFn(l.close)},style:{marginRight:20},children:"取消"}),a.jsx(r,{type:"primary",onClick:async()=>{if(!(await g.validateFields().catch((()=>!1))))return;const e=await(g?.getFieldsValue());d(e);for(let s in e)if(e.hasOwnProperty(s)){const t=s.split("_");if(2===t.length){const a=t[0];e[t[0]]=b(V.find((e=>e.projectCustomFieldId==a)),e[s]),delete e[s]}}let t;e.fileList=I(e.fileList),t=S.operateEnum===l.edit?await n({...e,projectReleaseId:S.detailId}):await c({...e}),1e3===t.code&&(m.success(t.msg),S.reloadTable(),S.setAddOrUpdateModalFn(l.close))},children:"确定"})]})]})})};export{S as default};
