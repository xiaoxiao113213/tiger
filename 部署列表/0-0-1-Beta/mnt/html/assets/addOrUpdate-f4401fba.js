import{r as e,F as a,j as s,X as l,I as t,b as i,R as r,K as n,B as d,c,O as o,Y as p,m,d as u}from"./index-1fe6dff8.js";import x from"./menuComponent-9a963298.js";import{menuApplicationTreeApi as h}from"./api-3ffa9e64.js";import{roleGetOneApi as j,roleUpdateApi as f,roleSaveApi as y}from"./api-b0087b33.js";const b=b=>{const[I,w]=e.useState(!1),[F]=a.useForm(),[g,k]=e.useState({applicationList:[],menu:[]}),[C,A]=e.useState([]),K=(e,a)=>{k((s=>(s.applicationList[a].checkedKeys=e,s)))};return e.useEffect((()=>((async()=>{})(),(async()=>{w(!0);const e=await h({});if(c(e))return;let a=e.data;if(b.operateEnum===o.edit){let e=await j({id:b.detailId});k({...e.data,applicationList:a}),F.setFieldsValue(e.data)}else k({applicationList:a}),F.setFieldsValue({sort:0,disabled:0});A(a),w(!1)})(),()=>{})),[]),s.jsx("div",{children:s.jsx(l,{spinning:I,delay:500,children:s.jsxs(a,{form:F,labelCol:{flex:"10%"},wrapperCol:{flex:"90%"},children:[s.jsx(a.Item,{label:"名称",name:"name",rules:[{required:!0}],children:s.jsx(t,{placeholder:"请输入"})}),s.jsx(a.Item,{label:"编码",name:"code",rules:[{required:!0}],children:s.jsx(t,{placeholder:"请输入"})}),s.jsx(a.Item,{label:"排序",name:"sort",rules:[{required:!0}],children:s.jsx(i,{})}),s.jsx(a.Item,{label:"状态",name:"disabled",rules:[{required:!0}],children:s.jsxs(r.Group,{children:[s.jsx(r,{value:0,children:" 启用 "}),s.jsx(r,{value:1,children:" 禁用 "})]})}),s.jsx(a.Item,{label:"备注",name:"remarks",children:s.jsx(t.TextArea,{allowClear:!0})}),s.jsx(n,{defaultActiveKey:"0",size:"large",children:C.map(((e,a)=>s.jsx(n.TabPane,{tab:e.name,children:s.jsx(x,{application:e,checkMenuIds:g?g.menu??[]:[],setDetailApplicationCheckKeysFn:K,applicationIndex:a,openType:b.operateEnum})},a)))}),s.jsxs(a.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[s.jsx(d,{type:"default",onClick:()=>{b.setAddOrUpdateModalFn(o.close)},style:{marginRight:20},children:"取消"}),s.jsx(d,{type:"primary",onClick:async()=>{if(!(await F.validateFields().catch((()=>!1))))return;w(!0);const e=await(F?.getFieldsValue());p(e);const a=[];for(let l of g.applicationList)l.checkedKeys&&a.push(...l.checkedKeys);e.menu=a;let s=u();s=g?.id?await f({...e,id:g?.id}):await y({...e}),1e3===s?.code&&(m.success(s?.msg),b.reloadTable(),b.setAddOrUpdateModalFn(o.close),w(!1))},children:"确定"})]})]})})})};export{b as default};
