import{ad as e,r as t,j as r,aS as s,c as a,f as n,a9 as o,aT as c}from"./index-52537ad8.js";import{d as i,C as d}from"./index-6e347210.js";import{I as l}from"./index-b65bf186.js";import{M as u}from"./MoreOutlined-d09fbb75.js";import"./MoreOutlined-49b0b054.js";const p=p=>{const{messages:x,prependMsgs:g,appendMsg:f,setTyping:m,resetList:y,updateMsg:h}=i.useMessages([]),k=e(),[v,j]=t.useState("加载更多"),I=t.useRef(void 0),T=async e=>{const t=await c({talkId:p.nowTalk.talkId,talkMsgId:e,pageSize:30});0===t.data.length&&j("没有更多了"),t.data.reverse().forEach((e=>{g([{_id:e.talkMsgId,type:"text",content:{text:e.text,sourceNickName:e.sourceNickName,sourceAvatar:e.sourceAvatar,sourceType:e.sourceType,sourceId:e.sourceId},position:e.targetId===e.sourceId?"right":"left",hasTime:!1,user:{},createdAt:o(e.createTime).valueOf()}])}))};return t.useEffect((()=>(j("加载更多"),y([]),T(),I.current=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting}))})),()=>{I.current?.disconnect()})),[p.nowTalk]),r.jsx("div",{style:{height:"100%"},children:r.jsx(d,{renderNavbar:()=>r.jsxs("div",{style:{backgroundColor:"#cedbe1",width:"calc(100% - 8px)",height:"48px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",fontSize:"16px",fontWeight:"bold"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"flex-start"},children:[r.jsx("span",{style:{display:"flex",alignItems:"center"},children:r.jsx(l,{type:p.nowTalk.talkType,targetId:p.nowTalk.targetId,avatar:p.nowTalk.targetAvatar,nickName:p.nowTalk.title,size:"default"})}),r.jsxs("div",{style:{marginLeft:"20px"},children:[" ",p.nowTalk.title]})]}),r.jsx("div",{style:{cursor:"pointer"},children:r.jsx(u,{})})]}),messages:x,renderMessageContent:e=>{const{content:s,position:a,createdAt:n}=e,[c,d]=t.useState(!1),u=t.useRef(null);return t.useEffect((()=>(I.current&&u.current&&I.current.observe(u.current),()=>{I.current&&u.current&&I.current.unobserve(u.current)})),[u.current]),r.jsxs("div",{ref:u,style:{display:"flex",alignItems:"center"},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),myid:e._id,children:["left"===a&&r.jsx(l,{type:s.sourceType,avatar:s.sourceAvatar,nickName:s.sourceNickName,targetId:s.sourceId}),"right"===a&&c&&r.jsx("div",{style:{backgroundColor:"rgba(255, 255, 255, 0)",color:"#b39696"},children:o(n).format("YYYY-MM-DD HH:mm:ss")}),r.jsx(i.Bubble,{style:{backgroundColor:"lightgreen"},children:r.jsx("div",{children:s.text})}),"left"===a&&c&&r.jsx("div",{style:{backgroundColor:"rgba(255, 255, 255, 0)",color:"#b39696"},children:o(n).format("YYYY-MM-DD HH:mm:ss")}),"right"===a&&r.jsx(l,{type:s.sourceType,avatar:s.sourceAvatar,nickName:s.sourceNickName,targetId:s.sourceId})]})},onSend:async(e,t)=>{if("text"===e&&t.trim()){const e=await s({talkId:p.nowTalk.talkId,text:t,type:"0"});if(a(e))return;const r=n();f({_id:r,type:"text",content:{text:t,sourceNickName:k?.nickName,sourceAvatar:k?.avatar,sourceType:"0",sourceId:k?.accountId},position:"right",hasTime:!1,createdAt:o().valueOf()})}},loadMoreText:r.jsx("a",{onClick:()=>{try{T(parseInt(x[0]?._id??"dsafd"))}catch(e){}},children:v}),onRefresh:async()=>{},onScroll:e=>{}})})};export{p as default};
