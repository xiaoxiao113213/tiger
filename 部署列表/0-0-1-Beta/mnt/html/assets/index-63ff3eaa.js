import{r as e,O as t,j as i,P as s,B as o,a3 as a,D as l,ak as r,aD as n,M as d,m as p}from"./index-1fe6dff8.js";import m from"./BuildModal-cd6d5943.js";import{pipelinePageApi as c,pipelineUpdateDisabledApi as u,pipelineDeleteApi as j}from"./pipeline-b29714ee.js";import{dicValueApi as h}from"./dicApi-b68549fb.js";import x from"./accountSetting-3e91492c.js";import S from"./pipelineOtherAdd-35e2e4ff.js";import y from"./pipelineMainAdd-1b7f2958.js";import{T as b}from"./index-85d047c3.js";import{P as C}from"./PlusOutlined-73232e7a.js";import"./api-f6cf4490.js";import"./Bo-9e2098a1.js";import"./pipelineBuildApi-244cc49e.js";import"./submitNowform-3c073972.js";import"./textSubmit-0f3171ae.js";import"./textAreaSubmit-d1dfc909.js";import"./SelectSubmit-9d579393.js";import"./MutSelectSubmit-5dc3359d.js";import"./DateSubmit-c557ba41.js";import"./NumberSubmit-de5567a9.js";import"./FileUploadSubmit-add66fc2.js";import"./index-80d88ab0.js";import"./index-953dfacc.js";import"./Title-952b03be.js";import"./Input-f98aea5e.js";import"./TextArea-08e23fd4.js";import"./Password-ff2218fe.js";import"./QRCodeSVG-710d84ab.js";import"./TaobaoOutlined-8cd58809.js";import"./FileZipFilled-3c93b810.js";import"./BranchesOutlined-c52fb168.js";import"./RightSquareTwoTone-e5897024.js";import"./FileUnknownTwoTone-791de7ab.js";import"./MinusCircleOutlined-47af1d51.js";import"./MoreOutlined-49b0b054.js";import"./PlusCircleOutlined-a72eecfb.js";import"./PlusSquareTwoTone-f51424a0.js";import"./RetweetOutlined-9d2a328f.js";import"./SendOutlined-86da6479.js";import"./TableOutlined-67e609f9.js";import"./api-0a5cfd87.js";import"./api-b0087b33.js";import"./index-7ad95df9.js";import"./stageComponent-c6290ef3.js";import"./context-cf6d3647.js";import"./stepComponent-c924f288.js";import"./api-5149c00d.js";import"./index-05ffbfcb.js";import"./PipelineFlow-d817273c.js";import"./index-9cc62199.js";/* empty css              */import"./uilts-d0a0e0a8.js";import"./StartNode-05ba3179.js";/* empty css             */import"./dataUtil-0d1579d9.js";import"./StageNode-796bf915.js";import"./StepNode-3983fa5c.js";import"./CustomEdge-26faa487.js";import"./index-b78e92bd.js";import"./FileSubmit-0542b294.js";import"./formComponent-27c8784f.js";import"./customerFieldNew-8ebcd271.js";import"./customerText-9afb4922.js";import"./customerTextArea-67b7b62e.js";import"./customerSelect-14199e01.js";import"./MinusCircleOutlined-7f40363e.js";import"./customerMutSelect-773b4206.js";import"./CustomerFile-4ea8258f.js";import"./CustomerDate-7ed6f47b.js";import"./customerNumber-a25d7bcc.js";import"./DeleteOutlined-916130f1.js";import"./api-de7774c8.js";const w=()=>{const[t,i]=e.useState([]),[s,o]=e.useState(new Map),[a,l]=e.useState({});return e.useEffect((()=>{(async()=>{let e=await h({code:"pipeline_use_status"});e.data.forEach((e=>e.value=parseInt(e.value))),i(e.data);let t={},s=new Map;e.data.forEach((e=>{t[e.value]={text:e.label},s.set(e.value,e)})),o(s),l(t)})()}),[]),{PipelineUseStatusList:t,PipelineUseStatusMap:s,PipelineUseStatusValueEnum:a}},T=()=>{const h=e.useRef(),[T,f]=e.useState(t.close),[k,g]=e.useState(),[O,I]=e.useState(t.close);let{PipelineUseStatusValueEnum:F}=w();const[B,P]=e.useState(t.close),[M,v]=e.useState(t.close),z=(e,i)=>{switch(e){case"other":g(i.id),v(t.add);break;case"delete":(async e=>{d?.confirm({title:"是否删除该条数据",content:e.name,icon:null,onOk:async()=>{const t=await j({id:e?.id});1e3===t?.code&&(p.success(t?.msg),h?.current?.reload())}})})(i);break;case"permission":g(i.id),P(t.add)}},A=[{title:"ID",dataIndex:"id",width:"80px",valueType:"text",search:!1},{title:"名称",dataIndex:"name",render:(e,s)=>i.jsx("a",{style:{color:"#1668dc"},onClick:()=>(async e=>{g(e.id),f(t.detail)})(s),children:s.name})},{title:"状态",dataIndex:"disabled",search:!1,render:(e,{disabled:t,id:s})=>i.jsx(n,{defaultValue:0===t,onChange:e=>{((e,t)=>{u({id:e,disabled:t?0:1}).then((e=>{e.code}))})(s,e)}})},{title:"使用状态",search:!1,dataIndex:"useStatus",valueEnum:F},{title:"最后构建时长",search:!1,dataIndex:"lastBuildTotalTime"},{title:"最后构建结果",search:!1,dataIndex:"lastBuildStatus"},{title:"创建人",search:!1,dataIndex:"updateBy"},{title:"创建时间",search:!1,dataIndex:"createTime"},{title:"操作",valueType:"option",width:170,key:"operation",render:(e,s)=>[i.jsx(o,{onClick:()=>(async e=>{window.open("/pipelineBuild?pipelineId="+e.id,"_blank")})(s),size:"small",type:"link",children:"构建列表"},"buildList"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),I(t.add)})(s),size:"small",type:"link",children:"构建"},"build"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),f(t.edit)})(s),size:"small",type:"link",hidden:a("pipeline:edit"),children:"编辑"},"edit"),i.jsx(b,{onSelect:e=>z(e,s),menus:[{key:"permission",name:"权限",hidden:a("pipeline:permission")},{key:"other",name:"其他配置",hidden:a("pipeline:edit")},{key:"delete",name:"删除",danger:!0,hidden:a("pipeline:del")}]},"actionGroup")]}];return i.jsxs("div",{children:[i.jsx(s,{columns:A,actionRef:h,cardBordered:!0,params:{},request:async(e={},t,i)=>{let s={pageNum:e.current,pageSize:e.pageSize,pageSort:t},o=await c({...e,...s});return{data:o.data.list,success:1e3===o.code,total:o.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pipeline-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:{labelWidth:"auto"},options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[i.jsx(o,{icon:i.jsx(C,{}),onClick:()=>{(async()=>{g(void 0),f(t.add)})()},type:"primary",hidden:a("pipeline:add"),children:"新建"},"button")]}),i.jsx(l,{title:r(T),open:T!==t.close,width:"100%",destroyOnClose:!0,maskClosable:!1,onClose:()=>f(t.close),footer:null,keyboard:!1,children:i.jsx(y,{openType:T,pipelineId:k,reloadTable:()=>{f(t.close),h?.current?.reload()}})},"pipelineTab"),i.jsx(l,{title:"构建流水线",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>I(t.close),children:i.jsx(m,{setBuildModalFn:I,detailId:k,reloadTable:()=>{h?.current?.reload(),I(t.close)}})}),i.jsx(l,{title:"项目人员",open:B!==t.close,onClose:()=>P(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(x,{pipelineId:k,closeFn:()=>P(t.close)})},"accountSetting"),i.jsx(l,{title:"其他配置",open:M!==t.close,onClose:()=>v(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(S,{pipelineId:k,closeFn:()=>v(t.close)})},"otherSetting")]})};export{T as default};
