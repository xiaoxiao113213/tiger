import{r as e,j as a,F as s,R as t,I as i,q as l,aG as r,T as d,aH as n,aI as c,ac as m,B as o,O as u,a9 as x,Y as p,m as h}from"./index-03adb9ee.js";import{riliGetOneApi as j,riliUpdateApi as f,riliSaveApi as g}from"./api-bc6bd50e.js";import{L as y}from"./index-405e7360.js";import{S as v}from"./SearchOutlined-f8f28aae.js";import{D as b}from"./DeleteOutlined-2f949a39.js";import{F as I}from"./FileUploadCom-56501644.js";import{f as k,a as C}from"./utils-20c57c3a.js";import"./PlusOutlined-b4032aa8.js";const N=e.forwardRef(((m,o)=>{const[u,x]=e.useState([]),[p,h]=e.useState(m.initSelectedUsers),[j,f]=e.useState(1),[g,I]=e.useState(1),[k,C]=e.useState(0),[N,w]=e.useState(""),S=async e=>{2===e.type&&delete e.type,c({...e,excludeUserIds:m.excludeUserIds}).then((e=>{x(e.data.list),I(e.data.pageNum),C(e.data.total)}))};return e.useImperativeHandle(o,(()=>({getSelectedUsers:()=>p}))),e.useEffect((()=>{S({type:j,pageNum:1,nickName:N})}),[]),a.jsxs("div",{style:{border:"1px solid #cccccc",borderRadius:"10px"},children:[a.jsx(s.Item,{label:"用户类型",children:a.jsxs(t.Group,{onChange:e=>{S({type:e.target.value,pageNum:1,nickName:N}),f(e.target.value)},value:j,children:[a.jsx(t,{value:1,children:"后台"}),a.jsx(t,{value:0,children:"前台"}),a.jsx(t,{value:2,children:"全部"})]})}),a.jsxs("div",{style:{display:"flex",height:"700px",borderRadius:"10px",border:"1px solid #cccccc"},children:[a.jsxs("div",{style:{flex:1,borderRight:"1px solid #cccccc",borderRadius:"10px",padding:"3px"},children:[a.jsx(i,{suffix:a.jsx(v,{onClick:()=>{S({type:j,pageNum:1,nickName:N})}}),style:{marginTop:"10px"},onChange:e=>{w(e.target.value)},onPressEnter:e=>{S({type:j,pageNum:1,nickName:N})},allowClear:!0}),a.jsx(y,{itemLayout:"horizontal",dataSource:u,renderItem:(e,s)=>a.jsx(y.Item,{className:"mmm-hover-pointer",children:a.jsx(y.Item.Meta,{avatar:a.jsxs("div",{style:{marginLeft:"5px"},children:[a.jsx(l,{style:{marginRight:"5px",marginTop:"10px"},checked:p.some((a=>a.id===e.id)),onChange:a=>{a.target.checked?h([...p,e]):h(p.filter((a=>a.id!==e.id)))}}),a.jsx(r,{style:{backgroundColor:"#2b87db",verticalAlign:"middle"},size:"large",src:e.avatar,children:e.nickName})]}),title:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{children:e.nickName}),0===e.type&&a.jsx(d,{color:"blue",children:"前"}),1===e.type&&a.jsx(d,{color:"blue",children:"后"})]}),description:a.jsx("div",{className:"mmm-ellipsis",children:e.remarks})})})}),a.jsx(n,{defaultCurrent:g,pageSize:8,total:k,onChange:e=>{S({type:j,pageNum:e,nickName:N})}})]}),a.jsx("div",{style:{flex:1,borderRadius:"10px",overflowY:"auto"},children:a.jsx(y,{itemLayout:"horizontal",dataSource:p,renderItem:(e,s)=>a.jsx(y.Item,{className:"mmm-hover-pointer",children:a.jsx(y.Item.Meta,{avatar:a.jsx("div",{style:{marginLeft:"5px"},children:a.jsx(r,{style:{backgroundColor:"#2b87db",verticalAlign:"middle"},size:"large",src:e.avatar,children:e.nickName})}),title:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{children:e.nickName}),a.jsxs("div",{children:[0===e.type&&a.jsx(d,{color:"blue",children:"前"}),1===e.type&&a.jsx(d,{color:"blue",children:"后"}),a.jsx(b,{style:{marginRight:"5px"},className:"mmm-hover-pointer",onClick:()=>{h(p.filter((a=>a.id!==e.id)))}})]})]}),description:a.jsx("div",{className:"mmm-ellipsis",children:e.remarks})})})})})]})]})})),w=l=>{if(!l.detail)return a.jsx("div",{});const[r]=s.useForm(),[d,n]=e.useState(),c=e.useRef(null);if(e.useEffect((()=>((async()=>{if(l.operateEnum===u.edit&&l.detail?.riliId){let e=await j({riliId:l.detail.riliId});if(1e3!==e.code)return;e.data.startTime=x(e.data.startTime),e.data.endTime=x(e.data.endTime),e.data.fileList=k(e.data.fileList),n(e.data),r.setFieldsValue(e.data)}else n({}),r.setFieldsValue({})})(),()=>{})),[]),!d)return a.jsx("div",{});return a.jsx("div",{children:a.jsxs(s,{form:r,labelCol:{flex:"10%"},wrapperCol:{flex:"90%"},children:[a.jsx(s.Item,{label:"类型",name:"type",rules:[{required:!0}],initialValue:l.detail.type,children:a.jsx(t.Group,{disabled:!0,children:a.jsx(t,{value:0,children:" 日程 "})})}),a.jsx(s.Item,{label:"标题",name:"name",rules:[{required:!0}],children:a.jsx(i,{placeholder:"请输入",showCount:!0,maxLength:200})}),a.jsx(s.Item,{label:"描述",name:"remarks",rules:[{required:!0}],children:a.jsx(i.TextArea,{placeholder:"请输入",autoSize:{minRows:3,maxRows:8},maxLength:1e3,showCount:!0})}),a.jsx(s.Item,{label:"开始时间",name:"startTime",rules:[{required:!0}],children:a.jsx(m,{format:"YYYY-MM-DD HH:mm",picker:"date",showTime:{format:"HH:mm"},onChange:(e,a)=>{},placeholder:"请选择开始时间"})}),a.jsx(s.Item,{label:"结束时间",name:"endTime",rules:[{required:!0}],children:a.jsx(m,{format:"YYYY-MM-DD HH:mm",picker:"date",showTime:{format:"HH:mm"},onChange:(e,a)=>{},placeholder:"请选择结束时间"})}),a.jsx(I,{name:"fileList",label:"附件",required:!1}),a.jsx(N,{initSelectedUsers:d?.userList??[],ref:c}),a.jsxs(s.Item,{style:{textAlign:"center",marginTop:"20px"},children:[a.jsx(o,{type:"default",onClick:()=>{l.setAddOrUpdateModalFn(u.close)},style:{marginRight:20},children:"取消"}),a.jsx(o,{type:"primary",onClick:async()=>{if(!(await r.validateFields().catch((()=>!1))))return;const e=c.current?.getSelectedUsers().map((e=>e.id)),a=await(r?.getFieldsValue());let s;p(a),a.fileList=C(a.fileList),s=l.operateEnum===u.edit&&l.detail?.riliId?await f({...a,riliId:l?.detail?.riliId,userIds:e}):await g({...a,userIds:e}),1e3===s.code&&(h.success(s.msg),l.reloadTable(),l.setAddOrUpdateModalFn(u.close))},children:"确定"})]})]})})};export{w as default};
