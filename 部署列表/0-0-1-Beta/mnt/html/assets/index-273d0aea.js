import{r as e,O as t,j as i,P as d,B as s,h as l,aD as r,D as n,T as a,M as o,c,m as p}from"./index-f2321b57.js";import j from"./index-c0ac6eb2.js";import h,{LogTypeEnum as x}from"./index-34f1d395.js";import{pipelineBuildPageApi as u,pipelineBuildStopApi as m}from"./pipelineBuildApi-6237b796.js";import{a as I,P as f,g}from"./PipelineBuildStatus-7922b5e5.js";import"./index-7ad95df9.js";import"./index-22f11d71.js";import"./index-55f4da4c.js";import"./index-e51db6e5.js";import"./index-d54aef2b.js";import"./EditOutlined-1e526840.js";import"./index-82d8a55f.js";import"./TextArea-47627076.js";import"./Input-f009b856.js";import"./index-26718f3e.js";import"./Bo-900708b2.js";import"./api-d0d1aa93.js";import"./api-557990cc.js";import"./buildFlow-f691a690.js";import"./index-da2797ee.js";/* empty css              */import"./uilts-e16e3ac3.js";import"./dataUtil-92029b97.js";import"./CustomEdge-528ca68e.js";import"./StartNode-897efea8.js";/* empty css             */import"./StageNode-ff3c80ef.js";import"./context-f250ab70.js";import"./StepNode-62b3eb45.js";const y=y=>{const E=e.useRef(),[b,S]=e.useState(t.close),[k,P]=e.useState(0),[C,D]=e.useState(t.close),[T,N]=e.useState(!0),_=()=>{N(!T)},O=e=>{let t=g(e.buildStatus),i=!0;return t!==I.stop&&t!==I.success&&t!==I.fail&&t!==I.fail_skip||(i=!1),i};e.useEffect((()=>{const e=setInterval((()=>{T&&E.current?.reload()}),3e3);return()=>{clearInterval(e)}}),[y.pipelineId,T]),e.useEffect((()=>{E.current?.reload()}),[y.refresh]);const v=[{title:"ID",dataIndex:"id",valueType:"text",width:48},{disable:!0,title:"状态",dataIndex:"buildStatus",search:!1,renderFormItem:(e,{defaultRender:t})=>t(e),render:(e,{buildStatus:t})=>{const d=g(t);return d===I.fail||d===I.fail_skip||d===I.stop?i.jsx(a,{color:"red",children:f.get(t)}):i.jsx(a,{color:"green",children:f.get(t)})}},{title:"构建人",dataIndex:"createBy",ellipsis:!0,render:(e,t)=>t.createByInfo?.account},{title:"创建时间",key:"showTime",dataIndex:"createTime",valueType:"dateTime",sorter:!1,hideInSearch:!0},{title:"开始构建时间",dataIndex:"buildStartTime",valueType:"dateTime",hideInTable:!1},{hideInTable:!1,title:"构建时长",dataIndex:"useTime"},{title:"操作",valueType:"option",key:"option",render:(e,d,s,l)=>[i.jsx("a",{onClick:()=>(e=>{P(e.id),S(t.detail)})(d),children:"详情"},"detail"),i.jsx("div",{children:O(d)&&i.jsx("a",{onClick:()=>(async e=>{o?.confirm({title:"是否确认终止构建",icon:null,onOk:async()=>{let t=await m({id:e.id});c(t)||(p.success(t.msg),E.current?.reload())}})})(d),style:{color:"red"},children:"终止构建"},"stop")},"stop"),i.jsx("a",{onClick:()=>(e=>{P(e.id),D(t.detail)})(d),children:"日志"},"log"),i.jsx("a",{onClick:()=>{},children:"再次构建"},"rebuild")]}],B=i.jsxs("div",{children:[i.jsx("h3",{children:"内置参数"}),i.jsxs("table",{className:".styled-table{width:100%;border-collapse:collapse}.styled-table td{border:1px solid #dddddd;text-align:left;padding:8px}.styled-table tr:nth-child(2n){background-color:#f2f2f2}.styled-table tr:hover{background-color:#ddd}\n"["styled-table"],children:[i.jsxs("tr",{children:[i.jsx("td",{children:"参数名"}),i.jsx("td",{children:"使用方式"}),i.jsx("td",{children:"描述"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"WORKSPACE"}),i.jsx("td",{children:"${WORKSPACE}"}),i.jsx("td",{children:"当前脚本执行的绝对目录"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"PIPELINE_ID"}),i.jsx("td",{children:"${PIPELINE_ID}"}),i.jsx("td",{children:"流水线的id"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"PIPELINE_BUILD_ID"}),i.jsx("td",{children:"${PIPELINE_BUILD_ID}"}),i.jsx("td",{children:"此次构建的唯一id"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"STEP_ID"}),i.jsx("td",{children:"${STEP_ID}"}),i.jsx("td",{children:"当前执行阶段的id"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"STEP_NAME"}),i.jsx("td",{children:"${STEP_NAME}"}),i.jsx("td",{children:"当前执行阶段的名称"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"NODE_LABEL"}),i.jsx("td",{children:"${NODE_LABEL}"}),i.jsx("td",{children:"执行机的标签"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"NODE_ID"}),i.jsx("td",{children:"${NODE_ID}"}),i.jsx("td",{children:"执行机的id"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"NODE_IP"}),i.jsx("td",{children:"${NODE_IP}"}),i.jsx("td",{children:"执行机的ip"})]})]}),i.jsx("h3",{children:"文件参数使用说明"})]});return i.jsxs("div",{children:[i.jsx(d,{columns:v,actionRef:E,cardBordered:!0,params:{pipelineId:y.pipelineId},request:async(e={},t,i)=>{let d={pipelineId:y.pipelineId,pageNum:e.current,pageSize:e.pageSize,pageSort:t},s=await u(d);return{data:s.data.list,success:1e3===s.code,total:s.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:!1,options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{pageSize:10,onChange:e=>{}},dateFormatter:"string",headerTitle:"构建列表",toolBarRender:()=>[i.jsx(s,{type:"link",onClick:()=>{window.open("/doc/globalFun.html")},children:"方法介绍"},"funP"),i.jsx(l,{content:B,title:"",trigger:"click",children:i.jsx(s,{type:"link",children:"参数说明"})},"PopoverParam"),i.jsx(r,{checkedChildren:"自动刷新",unCheckedChildren:"自动刷新",defaultChecked:!0,onChange:_},"autoCheck")]}),i.jsx(n,{title:"构建详情 ",open:b!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>S(t.close),footer:null,children:i.jsx("div",{children:i.jsx(j,{pipelineId:y.pipelineId,buildDetailId:k})})}),i.jsx(n,{title:"构建日志 ",open:C!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>D(t.close),footer:null,children:i.jsx("div",{children:i.jsx(h,{pipelineId:y.pipelineId,buildDetailId:k,type:x.pipeline,buildStepId:0})})})]})};export{y as default};
