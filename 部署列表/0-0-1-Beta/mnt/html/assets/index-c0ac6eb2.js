import{r as e,O as t,j as i,ab as l,D as o}from"./index-f2321b57.js";import{isStage as s,getStageId as a,isStep as r,getStep as d,getStepId as n}from"./index-7ad95df9.js";import p from"./index-22f11d71.js";import m from"./index-82d8a55f.js";import u,{LogTypeEnum as j}from"./index-34f1d395.js";import{pipelineNodeAllApi as c}from"./api-d0d1aa93.js";import{otherAccountAllApi as x}from"./api-557990cc.js";import{pipelineBuildGetOneApi as f}from"./pipelineBuildApi-6237b796.js";import{P as h}from"./PipelineBuildStatus-7922b5e5.js";import I from"./index-26718f3e.js";import b from"./buildFlow-f691a690.js";import{PipelineBuildContext as S}from"./context-f250ab70.js";import{C as v}from"./index-e51db6e5.js";import{P as k}from"./index-55f4da4c.js";import"./index-d54aef2b.js";import"./EditOutlined-1e526840.js";import"./TextArea-47627076.js";import"./Input-f009b856.js";import"./Bo-900708b2.js";import"./index-da2797ee.js";/* empty css              */import"./uilts-e16e3ac3.js";import"./dataUtil-92029b97.js";import"./CustomEdge-528ca68e.js";import"./StartNode-897efea8.js";/* empty css             */import"./StageNode-ff3c80ef.js";import"./StepNode-62b3eb45.js";const g=g=>{const[C,y]=e.useState(0),[L,N]=e.useState({}),[E,P]=e.useState({}),[F,D]=e.useState(t.close),[T,B]=e.useState({}),[O,w]=e.useState(t.close),[A,M]=e.useState(t.close),[q,z]=e.useState({}),[G,H]=e.useState({}),[J,Q]=e.useState([]);function R(e,t){if(!t||0===t.length)return null;for(let i of t){if(i.id===e)return i;let t=R(e,i.sonStageList);if(null!=t)return t}return null}const U=(e,i)=>{if("详情"===e)s(i)?N((e=>{let l=R(parseInt(a(i)),e.pipelineBuildStageList);return P(l),D(t.detail),e})):r(i)&&N((e=>{let l=d(parseInt(n(i)),e.pipelineBuildStageList);return B(l),w(t.detail),e}));else if("日志"===e)if(s(i));else if(r(i)){let e=parseInt(n(i));y(e),M(t.detail)}};return e.useEffect((()=>{f({id:g.buildDetailId}).then((e=>{N(e.data)})),(async()=>{c({}).then((e=>{let t={null:{text:"没有执行"}};e.data.forEach((e=>{t[e.id]={text:e.name}})),z(t)}));let e={};[{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}].forEach((t=>{e[t.id]={text:t.name}})),H(e),x({}).then((e=>{e.data.forEach((e=>e.id=e.id+"")),Q(e.data)}))})();const e=setInterval((()=>{f({id:g.buildDetailId}).then((e=>{N(e.data)}))}),3e3);return()=>{clearInterval(e)}}),[]),i.jsx(S.Provider,{value:{nodeClickFn:U},children:i.jsx("div",{children:void 0!==L&&i.jsxs("div",{children:[i.jsx(b,{detail:L,nodeClickFn:U}),i.jsx(v,{children:i.jsxs(k,{column:2,title:"",tooltip:"",children:[i.jsx(k.Item,{label:"流水线名称",tooltip:"",valueType:"text",children:L.name},"name"),i.jsx(k.Item,{label:"构建状态",tooltip:"",valueType:"text",children:h.get(L.buildStatus)},"buildStatus"),i.jsx(k.Item,{label:"所属软件",tooltip:"",valueType:"text",valueEnum:G,children:L.softIds},"soft"),i.jsx(k.Item,{label:"执行机标签",tooltip:"",valueType:"text",children:L.pipelineNodeLabel},"pipelineNodeLabel"),i.jsx(k.Item,{label:"执行机",tooltip:"",valueEnum:q,children:L.pipelineNodeId},"pipelineNodeId"),i.jsx(k.Item,{label:"镜像",tooltip:"",valueEnum:{0:{text:"未使用镜像"},1:{text:"使用了镜像"}},children:L.dockerFlag},"dockerFlag"),1===L.dockerFlag&&i.jsx(k.Item,{label:"镜像名称",tooltip:"",valueType:"text",children:L.dockerName},"dockerName"),1===L.dockerFlag&&i.jsx(k.Item,{label:"镜像参数",tooltip:"",valueType:"textarea",children:L.dockerParam},"dockerParam")]})}),i.jsx(l,{children:"全局参数"}),L.globalParamList&&i.jsx(I,{initFieldBoList:L.globalParamList}),i.jsx(o,{title:"阶段详情",open:F!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>D(t.close),children:i.jsx(p,{stageDetail:E,pipelineNodeList:q})}),i.jsx(o,{title:"步骤详情",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>w(t.close),children:i.jsx(m,{stepDetail:T,pipelineNodeList:q,otherAccountList:J})}),i.jsx(o,{title:"构建日志 ",open:A!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>M(t.close),footer:null,children:i.jsx("div",{children:i.jsx(u,{pipelineId:g.pipelineId,buildDetailId:g.buildDetailId,type:j.step,buildStepId:C})})})]})})})};export{g as default};
