import{F as t,r as e,j as i,O as s,B as o,al as a,K as r,Y as p,m,aj as l}from"./index-f2321b57.js";import n from"./pipelineMainAdd-ccc77f52.js";import{pipelineNodeAllApi as d}from"./api-d0d1aa93.js";import{otherAccountAllApi as j}from"./api-557990cc.js";import{clientToServerValueItem as u,serverToClientValue as c,FormFieldTypeEnum as y}from"./Bo-900708b2.js";import{pipelineUpdateApi as f,pipelineSaveApi as x,pipelineGetOneApi as S}from"./pipeline-69e8b66b.js";import"./index-7ad95df9.js";import"./stageComponent-8780fca7.js";import"./context-c3c65fe4.js";import"./stepComponent-e03081ad.js";import"./api-cbd9b73e.js";import"./index-b1386cd3.js";import"./submitNowform-f35e2701.js";import"./textSubmit-4229c5b2.js";import"./textAreaSubmit-14d30dcb.js";import"./SelectSubmit-d0c3571a.js";import"./MutSelectSubmit-d4556965.js";import"./DateSubmit-41050df2.js";import"./NumberSubmit-9c6b3724.js";import"./FileUploadSubmit-a4029aca.js";import"./PlusOutlined-0e19b652.js";import"./index-e51db6e5.js";import"./PipelineFlow-b9d89384.js";import"./index-da2797ee.js";/* empty css              */import"./uilts-e16e3ac3.js";import"./StartNode-f0bf4205.js";/* empty css             */import"./dataUtil-d817c03a.js";import"./StageNode-16907dfe.js";import"./StepNode-07191e47.js";import"./CustomEdge-528ca68e.js";import"./index-1e1c35a0.js";import"./FileSubmit-975998bf.js";import"./formComponent-e31b7955.js";import"./Title-c989167c.js";import"./Input-f009b856.js";import"./TextArea-47627076.js";import"./customerFieldNew-4b477ff0.js";import"./customerText-29c51ee6.js";import"./customerTextArea-c929063a.js";import"./customerSelect-e147971d.js";import"./MinusCircleOutlined-ede52421.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-b7b09c88.js";import"./CustomerFile-0ba717f3.js";import"./CustomerDate-a09fb913.js";import"./customerNumber-e3e13da1.js";import"./DeleteOutlined-10e7bcc5.js";const b=b=>{const[F]=t.useForm(),[h,v]=e.useState(),[T,g]=e.useState([]),[C,L]=e.useState([]),[w,A]=e.useState([]),[E]=t.useForm(),[N,O]=e.useState([]),P=[{key:"1",label:"主配置",children:i.jsx("div",{children:void 0!==h&&i.jsx(n,{detail:h,setDetailFn:v,pipelineNodeList:T,detailFormRef:F,openType:b.openType,softList:C,otherAccountList:w,globalFieldList:N,setGlobalFieldList:O})})}],k=t=>{t.globalParamList?.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(",")),t.type,y.password})),l(t.pipelineStageList??[]).forEach((t=>{t?.paramList.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(","))}))}))},D=i.jsxs("div",{children:[b.openType!==s.detail&&i.jsx(o,{type:"primary",onClick:async()=>{if(b.openType===s.detail)return void b.setOpenTypeFn(s.close);if(!(await F.validateFields().catch((()=>!1))))return;const t=await(F?.getFieldsValue());p(t);if(!(await E.validateFields().catch((()=>!1))))return void m.warning("有必填项未填");const e=N.map((t=>{const e={...t};return u(e),e}));let i;if(h?.id){let t={...h,globalParamList:e};k(a(t)),i=await f(a(t))}else{let s={...h,...t,globalParamList:e};k(a(s)),i=await x(a(s))}1e3===i?.code&&(m.success(i?.msg),b.reloadTable(),b.setOpenTypeFn(s.close))},children:"确认"}),i.jsx(o,{type:"default",style:{marginLeft:10},onClick:()=>b.setOpenTypeFn(s.close),children:"取消"})]});return e.useEffect((()=>((async()=>{d({}).then((t=>{g(t.data)})),L([{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}]),j({}).then((t=>{t.data.forEach((t=>t.id=t.id+"")),A(t.data)}))})(),b.openType===s.add?v(a({parallel:0,timer:0,timerCron:0,email:0,pipelineStageList:[]})):b.openType!==s.edit&&b.openType!==s.detail||(async t=>{const e=await S({id:t});if(1e3!==e?.code)return;v({...e.data});const i=e.data.globalParamList??[];i.forEach((t=>{c(t)})),O(i),F?.setFieldsValue({...e.data}),e.data.permissionList})(b.detailId),()=>{})),[b.openType]),i.jsx("div",{children:i.jsx(r,{defaultActiveKey:"1",items:P,onChange:t=>{},tabBarExtraContent:D})})};export{b as default};
