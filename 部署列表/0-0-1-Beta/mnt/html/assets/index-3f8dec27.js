import{r as e,O as t,j as i,P as s,B as o,a3 as a,D as l,ak as r,aD as n,M as d,m as p}from"./index-03adb9ee.js";import m from"./BuildModal-b19582d9.js";import{pipelinePageApi as c,pipelineUpdateDisabledApi as u,pipelineDeleteApi as j}from"./pipeline-ea2f224f.js";import{dicValueApi as h}from"./dicApi-3ecc5ba9.js";import x from"./accountSetting-d90a9371.js";import S from"./pipelineOtherAdd-508f611f.js";import y from"./pipelineMainAdd-e3cabbd5.js";import{T as b}from"./index-ecb2a4e6.js";import{P as C}from"./PlusOutlined-b4032aa8.js";import"./api-e992af87.js";import"./Bo-c1a8a5bb.js";import"./pipelineBuildApi-5c85f8f6.js";import"./submitNowform-fbdcf9ab.js";import"./textSubmit-bd6c5b40.js";import"./textAreaSubmit-3b52d66b.js";import"./SelectSubmit-4c180fb2.js";import"./MutSelectSubmit-064a257d.js";import"./DateSubmit-95284b79.js";import"./NumberSubmit-77884c9b.js";import"./FileUploadSubmit-e8f92bb2.js";import"./index-3585a1a3.js";import"./index-60bf4ee0.js";import"./Title-06decefc.js";import"./Input-51214805.js";import"./TextArea-24b2fc1a.js";import"./Password-e510335b.js";import"./QRCodeSVG-6b187ce2.js";import"./TaobaoOutlined-8cd58809.js";import"./FileZipFilled-01c99cd9.js";import"./BranchesOutlined-c52fb168.js";import"./RightSquareTwoTone-e5897024.js";import"./FileUnknownTwoTone-791de7ab.js";import"./MinusCircleOutlined-47af1d51.js";import"./MoreOutlined-49b0b054.js";import"./PlusCircleOutlined-a72eecfb.js";import"./PlusSquareTwoTone-f51424a0.js";import"./RetweetOutlined-9d2a328f.js";import"./SendOutlined-86da6479.js";import"./TableOutlined-67e609f9.js";import"./api-993dce33.js";import"./api-313fc500.js";import"./index-7ad95df9.js";import"./stageComponent-66e485ae.js";import"./context-3c44e91e.js";import"./stepComponent-9efb724d.js";import"./api-8691a2b8.js";import"./index-173fa263.js";import"./PipelineFlow-a4f586d2.js";import"./index-19b1aa5f.js";/* empty css              */import"./uilts-8b8185ea.js";import"./StartNode-c7411ad4.js";/* empty css             */import"./dataUtil-954be25d.js";import"./StageNode-e435ce7e.js";import"./StepNode-d82bcaf5.js";import"./CustomEdge-6ea755a4.js";import"./index-dc46b847.js";import"./FileSubmit-a73b537e.js";import"./formComponent-661a5f6d.js";import"./customerFieldNew-4c66ff92.js";import"./customerText-d905b3cb.js";import"./customerTextArea-b54e4aae.js";import"./customerSelect-ae4ebf75.js";import"./MinusCircleOutlined-ad177d4a.js";import"./customerMutSelect-fbe47964.js";import"./CustomerFile-75bdcaec.js";import"./CustomerDate-852678e3.js";import"./customerNumber-dffe68a9.js";import"./DeleteOutlined-2f949a39.js";import"./api-fd3812b8.js";const w=()=>{const[t,i]=e.useState([]),[s,o]=e.useState(new Map),[a,l]=e.useState({});return e.useEffect((()=>{(async()=>{let e=await h({code:"pipeline_use_status"});e.data.forEach((e=>e.value=parseInt(e.value))),i(e.data);let t={},s=new Map;e.data.forEach((e=>{t[e.value]={text:e.label},s.set(e.value,e)})),o(s),l(t)})()}),[]),{PipelineUseStatusList:t,PipelineUseStatusMap:s,PipelineUseStatusValueEnum:a}},T=()=>{const h=e.useRef(),[T,f]=e.useState(t.close),[k,g]=e.useState(),[O,I]=e.useState(t.close);let{PipelineUseStatusValueEnum:B}=w();const[F,M]=e.useState(t.close),[P,v]=e.useState(t.close),z=(e,i)=>{switch(e){case"other":g(i.id),v(t.add);break;case"delete":(async e=>{d?.confirm({title:"是否删除该条数据",content:e.name,icon:null,onOk:async()=>{const t=await j({id:e?.id});1e3===t?.code&&(p.success(t?.msg),h?.current?.reload())}})})(i);break;case"permission":g(i.id),M(t.add)}},A=[{title:"ID",dataIndex:"id",width:"80px",valueType:"text",search:!1},{title:"名称",dataIndex:"name",render:(e,s)=>i.jsx("a",{style:{color:"#1668dc"},onClick:()=>(async e=>{g(e.id),f(t.detail)})(s),children:s.name})},{title:"状态",dataIndex:"disabled",search:!1,render:(e,{disabled:t,id:s})=>i.jsx(n,{defaultValue:0===t,onChange:e=>{((e,t)=>{u({id:e,disabled:t?0:1}).then((e=>{e.code}))})(s,e)}})},{title:"使用状态",search:!1,dataIndex:"useStatus",valueEnum:B},{title:"最后构建时长",search:!1,dataIndex:"lastBuildTotalTime"},{title:"最后构建结果",search:!1,dataIndex:"lastBuildStatus"},{title:"创建人",search:!1,dataIndex:"updateBy"},{title:"创建时间",search:!1,dataIndex:"createTime"},{title:"操作",valueType:"option",width:170,key:"operation",render:(e,s)=>[i.jsx(o,{onClick:()=>(async e=>{window.open("/#/pipelineBuild?pipelineId="+e.id,"_blank")})(s),size:"small",type:"link",children:"构建列表"},"buildList"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),I(t.add)})(s),size:"small",type:"link",children:"构建"},"build"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),f(t.edit)})(s),size:"small",type:"link",hidden:a("pipeline:edit"),children:"编辑"},"edit"),i.jsx(b,{onSelect:e=>z(e,s),menus:[{key:"permission",name:"权限",hidden:a("pipeline:permission")},{key:"other",name:"其他配置",hidden:a("pipeline:edit")},{key:"delete",name:"删除",danger:!0,hidden:a("pipeline:del")}]},"actionGroup")]}];return i.jsxs("div",{children:[i.jsx(s,{columns:A,actionRef:h,cardBordered:!0,params:{},request:async(e={},t,i)=>{let s={pageNum:e.current,pageSize:e.pageSize,pageSort:t},o=await c({...e,...s});return{data:o.data.list,success:1e3===o.code,total:o.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pipeline-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:{labelWidth:"auto"},options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[i.jsx(o,{icon:i.jsx(C,{}),onClick:()=>{(async()=>{g(void 0),f(t.add)})()},type:"primary",hidden:a("pipeline:add"),children:"新建"},"button")]}),i.jsx(l,{title:r(T),open:T!==t.close,width:"100%",destroyOnClose:!0,maskClosable:!1,onClose:()=>f(t.close),footer:null,keyboard:!1,children:i.jsx(y,{openType:T,pipelineId:k,reloadTable:()=>{f(t.close),h?.current?.reload()}})},"pipelineTab"),i.jsx(l,{title:"构建流水线",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>I(t.close),children:i.jsx(m,{setBuildModalFn:I,detailId:k,reloadTable:()=>{h?.current?.reload(),I(t.close)}})}),i.jsx(l,{title:"项目人员",open:F!==t.close,onClose:()=>M(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(x,{pipelineId:k,closeFn:()=>M(t.close)})},"accountSetting"),i.jsx(l,{title:"其他配置",open:P!==t.close,onClose:()=>v(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(S,{pipelineId:k,closeFn:()=>v(t.close)})},"otherSetting")]})};export{T as default};
