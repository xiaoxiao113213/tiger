import{F as e,r as t,j as i,e as a,f as n,I as r,B as s,S as d}from"./index-10719960.js";import{C as l,a as o,V as p}from"./ApiBo-d6e5478a.js";import{aiPipelinePointVarUpdateApi as m,aiPipelinePointVarSaveApi as c,aiPipelinePointVarDeleteApi as x,aiPipelinePointVarAddSonApi as y}from"./varApi-6204ca1d.js";import{D as h}from"./DeleteOutlined-91444ec2.js";const g=g=>{const{point:u,inputVarList:I,getDetail:j}=g,[k]=e.useForm(),[f,w]=t.useState(),P=e=>{if(e)return e.map(((e,t)=>({place:"",key:e.aiPipelinePointVarId.toString(),name:e.name,type:e.type,remarks:e.remarks,parentId:e.parentId?e.parentId.toString():void 0,children:P(e.children)})))};t.useEffect((()=>{u&&w(u.varList.filter((e=>e.category==l.Output)).map(((e,t)=>({place:"",key:e.aiPipelinePointVarId.toString(),name:e.name,type:e.type,remarks:e.remarks,parentId:e.parentId?e.parentId.toString():void 0,children:P(e.children)}))))}),[u]);const v=(e,t)=>{if(!t)return e;for(let i=0;i<t.length;i++){const a=t[i];e[a.key+"_name"]=a.name,e[a.key+"_type"]=a.type,e[a.key+"_remarks"]=a.remarks,v(e,a.children)}return e};t.useEffect((()=>{const e={};for(let t in f)e[f[t].key+"_name"]=f[t].name,e[f[t].key+"_type"]=f[t].type,e[f[t].key+"_remarks"]=f[t].remarks,v(e,f[t].children);k.setFieldsValue(e)}),[f]);const b=[{title:"序号",dataIndex:"place",editable:!1,render:(e,t,a)=>i.jsxs("div",{children:[a,i.jsx(s,{icon:i.jsx("img",{src:"/icons/添加子级.svg",alt:"icon",style:{width:16,height:16,display:"inline",marginRight:"5px"}}),type:"link",onClick:()=>(async e=>{await y({aiPipelinePointVarId:parseInt(e.key)}),g.getDetail()})(t),hidden:t.type!=o.Object&&t.type!=o.ArrayObject})]})},{title:"变量名",dataIndex:"name",width:"180px",editable:!0},{title:"变量类型",dataIndex:"type",width:"130px",editable:!0},{title:"描述",dataIndex:"remarks",editable:!0},{title:"",dataIndex:"operation",width:"50px",render:(e,t)=>i.jsx("div",{children:i.jsx(s,{icon:i.jsx(h,{}),type:"link",onClick:()=>(async e=>{await x({aiPipelinePointVarId:parseInt(e.key)}),g.getDetail()})(t),hidden:f&&f.length<=1})})}].map((e=>{if(!e.editable)return e;let t="text";"type"===e.dataIndex&&(t="select"),"remarks"===e.dataIndex&&(t="textArea");return{...e,onCell:i=>({record:i,inputType:t,dataIndex:e.dataIndex,title:e.title,editing:!0})}})),C=(e,t,i)=>{"type"==t&&g.getDetail()};return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",marginBottom:"5px"},children:[i.jsx("div",{children:"输出参数设置："}),i.jsx("div",{style:{marginRight:"30px"},children:i.jsx("a",{onClick:()=>(async()=>{await c({aiPipelinePointId:u.aiPipelinePointId,name:n(),type:"string",remarks:"",category:l.Output}),g.getDetail()})(),children:i.jsx("img",{src:"/icons/加号.svg",alt:"icon",style:{width:16,height:16,display:"inline",marginRight:"5px"}})})})]}),i.jsx(e,{form:k,component:!1,onValuesChange:async(e,t)=>{for(let i in e){const t=i.split("_"),a=t[0],n=t[1],r=e[i],s={aiPipelinePointVarId:parseInt(a),[n]:r,keyName:n};await m(s),C(0,n)}},children:i.jsx(a,{components:{body:{cell:({editing:t,dataIndex:a,title:n,inputType:s,record:l,index:o,children:m,...c})=>{if("变量名"==n)return i.jsx("td",{...c,children:t?i.jsx(e.Item,{name:`${l.key}_${a}`,style:{margin:0},rules:[{required:!0,message:`请输入 ${n}！只能输入英文字符和数字，且以英文字符开头。`},{pattern:/^[a-zA-Z][a-zA-Z0-9]*$/,message:"只能输入英文字符和数字，且以英文字符开头。"}],children:i.jsx(r,{maxLength:20,showCount:!0})}):m});let x;return x="变量类型"==n?i.jsx(d,{options:p}):"描述"==n?i.jsx(r.TextArea,{autoSize:{minRows:1,maxRows:3}}):i.jsx(r,{maxLength:20,showCount:!0}),i.jsx("td",{...c,children:t?i.jsx(e.Item,{name:l.key+"_"+a,style:{margin:0},rules:[{required:!1,message:`Please Input ${n}!`}],children:x}):m})}}},bordered:!0,dataSource:f,columns:b,rowClassName:"editable-row",pagination:!1})})]})};export{g as default};
