import{j as e,r as t,F as s,Q as i,V as r,W as l,B as d,N as n}from"./index-52537ad8.js";import{M as a}from"./MysqlTypeDic-ba97f24c.js";/* empty css                 */import o from"./fieldRow-aa8b1712.js";import{P as c}from"./PlusOutlined-0403edcb.js";import"./dicApi-f974ede5.js";import"./DeleteOutlined-104cbf00.js";const h=h=>{const{data:f,form:p,setData:j}=h,{MysqlTypeList:x}=a();if(!(null!==x))return e.jsx("div",{children:"Loading..."});const[y,m]=t.useState(null);t.useEffect((()=>{if("5"!==h.tagNum)return;const e=async e=>{if(/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?e.metaKey:e.ctrlKey)switch(e.key){case"c":{let e=(await u()).filter((e=>e.selected));if(e?.length<=0)break;navigator.clipboard.writeText(JSON.stringify({fields:e})).then((()=>{})).catch((e=>{}));break}case"v":navigator.clipboard.readText().then((async e=>{if(!e)return;let t=JSON.parse(e);if(!t.fields)return;let s=JSON.parse(JSON.stringify(f));for(let i of t.fields){s.find((e=>e.code===i.code))||s.push(i)}j(s)})).catch((e=>{}))}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[h.tagNum]);const u=async()=>{const e=await p.getFieldsValue(),t=[];return e&&Object.keys(e).forEach((s=>{const[i,r]=s.split("-"),l=parseInt(r),d=t.find((e=>e.tableFieldId==l));d?d[i]=e[s]:t.push({tableFieldId:l,[i]:e[s]})})),t};return e.jsx("div",{style:{},children:e.jsxs(s,{form:p,component:!1,children:[e.jsx(i,{onDragEnd:e=>{if(!e.destination)return;const t=[...f],[s]=t.splice(e.source.index,1);t.splice(e.destination.index,0,s),j(t)},children:e.jsx(r,{droppableId:"my-droppable1",children:t=>e.jsxs("table",{className:"my-table",ref:t.innerRef,...t.droppableProps,style:{width:"100%",tableLayout:"auto"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0",height:"40px"},children:[e.jsx("th",{}),e.jsx("th",{children:"字段名"}),e.jsx("th",{children:"类型"}),e.jsx("th",{children:"长度"}),e.jsx("th",{children:"小数点"}),e.jsx("th",{children:"不空"}),e.jsx("th",{children:"主键"}),e.jsx("th",{children:"默认值"}),e.jsx("th",{children:"描述"}),e.jsx("th",{children:"自增"}),e.jsx("th",{children:"无符号"}),e.jsx("th",{children:"操作"})]})}),e.jsxs("tbody",{children:[f.map(((t,s)=>e.jsx(l,{draggableId:t.tableFieldId.toString(),index:s,children:(s,i)=>e.jsx("tr",{ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,onClick:()=>m(t.tableFieldId),onDoubleClick:()=>{},className:"my-row "+(i.isDragging?"my-dragging":""),children:e.jsx(o,{field:t,mysqlType:x??[],form:p},t.tableFieldId)})},t.tableFieldId))),t.placeholder]})]})})}),e.jsxs(d,{style:{width:"100%"},type:"dashed",onClick:()=>j([...f,{code:"",tableFieldId:parseInt(n(11)),flagNotNull:0,flagKey:0,type:"varchar",length:255}]),children:[e.jsx(c,{}),"添加字段"]})]},"fields")})};export{h as default};
