import{aV as t,r as e,a_ as n,cz as o,i as r,cA as i}from"./index-52537ad8.js";function s(t){this.content=t}function l(t,e,n){for(let o=0;;o++){if(o==t.childCount||o==e.childCount)return t.childCount==e.childCount?null:n;let r=t.child(o),i=e.child(o);if(r!=i){if(!r.sameMarkup(i))return n;if(r.isText&&r.text!=i.text){for(let t=0;r.text[t]==i.text[t];t++)n++;return n}if(r.content.size||i.content.size){let t=l(r.content,i.content,n+1);if(null!=t)return t}n+=r.nodeSize}else n+=r.nodeSize}}function a(t,e,n,o){for(let r=t.childCount,i=e.childCount;;){if(0==r||0==i)return r==i?null:{a:n,b:o};let s=t.child(--r),l=e.child(--i),c=s.nodeSize;if(s!=l){if(!s.sameMarkup(l))return{a:n,b:o};if(s.isText&&s.text!=l.text){let t=0,e=Math.min(s.text.length,l.text.length);for(;t<e&&s.text[s.text.length-t-1]==l.text[l.text.length-t-1];)t++,n--,o--;return{a:n,b:o}}if(s.content.size||l.content.size){let t=a(s.content,l.content,n-1,o-1);if(t)return t}n-=c,o-=c}else n-=c,o-=c}}s.prototype={constructor:s,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var o=n&&n!=t?this.remove(n):this,r=o.find(t),i=o.content.slice();return-1==r?i.push(n||t,e):(i[r+1]=e,n&&(i[r]=n)),new s(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new s(n)},addToStart:function(t,e){return new s([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new s(n)},addBefore:function(t,e,n){var o=this.remove(e),r=o.content.slice(),i=o.find(t);return r.splice(-1==i?r.length:i,0,e,n),new s(r)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=s.from(t)).size?new s(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=s.from(t)).size?new s(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=s.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach((function(e,n){t[e]=n})),t},get size(){return this.content.length>>1}},s.from=function(t){if(t instanceof s)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new s(e)};class c{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,o=0,r){for(let i=0,s=0;s<e;i++){let l=this.content[i],a=s+l.nodeSize;if(a>t&&!1!==n(l,o+s,r||null,i)&&l.content.size){let r=s+1;l.nodesBetween(Math.max(0,t-r),Math.min(l.content.size,e-r),n,o+r)}s=a}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,o){let r="",i=!0;return this.nodesBetween(t,e,((s,l)=>{let a=s.isText?s.text.slice(Math.max(t,l)-l,e-l):s.isLeaf?o?"function"==typeof o?o(s):o:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&a||s.isTextblock)&&n&&(i?i=!1:r+=n),r+=a}),0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,o=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(n)&&(o[o.length-1]=e.withText(e.text+n.text),r=1);r<t.content.length;r++)o.push(t.content[r]);return new c(o,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],o=0;if(e>t)for(let r=0,i=0;i<e;r++){let s=this.content[r],l=i+s.nodeSize;l>t&&((i<t||l>e)&&(s=s.isText?s.cut(Math.max(0,t-i),Math.min(s.text.length,e-i)):s.cut(Math.max(0,t-i-1),Math.min(s.content.size,e-i-1))),n.push(s),o+=s.nodeSize),i=l}return new c(n,o)}cutByIndex(t,e){return t==e?c.empty:0==t&&e==this.content.length?this:new c(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let o=this.content.slice(),r=this.size+e.nodeSize-n.nodeSize;return o[t]=e,new c(o,r)}addToStart(t){return new c([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new c(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let o=this.content[e];t(o,n,e),n+=o.nodeSize}}findDiffStart(t,e=0){return l(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return a(this,t,e,n)}findIndex(t,e=-1){if(0==t)return h(0,t);if(t==this.size)return h(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,o=0;;n++){let r=o+this.child(n).nodeSize;if(r>=t)return r==t||e>0?h(n+1,r):h(n,o);o=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return c.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new c(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return c.empty;let e,n=0;for(let o=0;o<t.length;o++){let r=t[o];n+=r.nodeSize,o&&r.isText&&t[o-1].sameMarkup(r)?(e||(e=t.slice(0,o)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new c(e||t,n)}static from(t){if(!t)return c.empty;if(t instanceof c)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new c([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}c.empty=new c([],0);const d={index:0,offset:0};function h(t,e){return d.index=t,d.offset=e,d}function u(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!u(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!u(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let p=class t{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let o=0;o<t.length;o++){let r=t[o];if(this.eq(r))return t;if(this.type.excludes(r.type))e||(e=t.slice(0,o));else{if(r.type.excludes(this.type))return t;!n&&r.type.rank>this.type.rank&&(e||(e=t.slice(0,o)),e.push(this),n=!0),e&&e.push(r)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&u(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let o=n.create(e.attrs);return n.checkAttrs(o.attrs),o}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return t.none;if(e instanceof t)return[e];let n=e.slice();return n.sort(((t,e)=>t.type.rank-e.type.rank)),n}};p.none=[];class f extends Error{}class m{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=y(this.content,t+this.openStart,e);return n&&new m(n,this.openStart,this.openEnd)}removeBetween(t,e){return new m(g(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return m.empty;let n=e.openStart||0,o=e.openEnd||0;if("number"!=typeof n||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new m(c.fromJSON(t,e.content),n,o)}static maxOpen(t,e=!0){let n=0,o=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)o++;return new m(t,n,o)}}function g(t,e,n){let{index:o,offset:r}=t.findIndex(e),i=t.maybeChild(o),{index:s,offset:l}=t.findIndex(n);if(r==e||i.isText){if(l!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(o,i.copy(g(i.content,e-r-1,n-r-1)))}function y(t,e,n,o){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r);if(i==e||s.isText)return o&&!o.canReplace(r,r,n)?null:t.cut(0,e).append(n).append(t.cut(e));let l=y(s.content,e-i-1,n);return l&&t.replaceChild(r,s.copy(l))}function b(t,e,n){if(n.openStart>t.depth)throw new f("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new f("Inconsistent open depths");return w(t,e,n,0)}function w(t,e,n,o){let r=t.index(o),i=t.node(o);if(r==e.index(o)&&o<t.depth-n.openStart){let s=w(t,e,n,o+1);return i.copy(i.content.replaceChild(r,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=o||e.depth!=o){let{start:r,end:s}=function(t,e){let n=e.depth-t.openStart,o=e.node(n).copy(t.content);for(let r=n-1;r>=0;r--)o=e.node(r).copy(c.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}(n,t);return S(i,M(t,r,s,e,o))}{let o=t.parent,r=o.content;return S(o,r.cut(0,t.parentOffset).append(n.content).append(r.cut(e.parentOffset)))}}return S(i,E(t,e,o))}function v(t,e){if(!e.type.compatibleContent(t.type))throw new f("Cannot join "+e.type.name+" onto "+t.type.name)}function k(t,e,n){let o=t.node(n);return v(o,e.node(n)),o}function x(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function C(t,e,n,o){let r=(e||t).node(n),i=0,s=e?e.index(n):r.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(x(t.nodeAfter,o),i++));for(let l=i;l<s;l++)x(r.child(l),o);e&&e.depth==n&&e.textOffset&&x(e.nodeBefore,o)}function S(t,e){return t.type.checkContent(e),t.copy(e)}function M(t,e,n,o,r){let i=t.depth>r&&k(t,e,r+1),s=o.depth>r&&k(n,o,r+1),l=[];return C(null,t,r,l),i&&s&&e.index(r)==n.index(r)?(v(i,s),x(S(i,M(t,e,n,o,r+1)),l)):(i&&x(S(i,E(t,e,r+1)),l),C(e,n,r,l),s&&x(S(s,E(n,o,r+1)),l)),C(o,null,r,l),new c(l)}function E(t,e,n){let o=[];if(C(null,t,n,o),t.depth>n){x(S(k(t,e,n+1),E(t,e,n+1)),o)}return C(e,null,n,o),new c(o)}m.empty=new m(c.empty,0,0);class T{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],o=t.child(e);return n?t.child(e).cut(n):o}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],o=0==e?0:this.path[3*e-1]+1;for(let r=0;r<t;r++)o+=n.child(r).nodeSize;return o}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return p.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),o=t.maybeChild(e);if(!n){let t=n;n=o,o=t}let r=n.marks;for(var i=0;i<r.length;i++)!1!==r[i].type.spec.inclusive||o&&r[i].isInSet(o.marks)||(r=r[i--].removeFromSet(r));return r}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,o=t.parent.maybeChild(t.index());for(var r=0;r<n.length;r++)!1!==n[r].type.spec.inclusive||o&&n[r].isInSet(o.marks)||(n=n[r--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new _(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],o=0,r=e;for(let i=t;;){let{index:t,offset:e}=i.content.findIndex(r),s=r-e;if(n.push(i,t,o+e),!s)break;if(i=i.child(t),i.isText)break;r=s-1,o+=e+1}return new T(e,n,r)}static resolveCached(t,e){let n=N.get(t);if(n)for(let r=0;r<n.elts.length;r++){let t=n.elts[r];if(t.pos==e)return t}else N.set(t,n=new O);let o=n.elts[n.i]=T.resolve(t,e);return n.i=(n.i+1)%A,o}}class O{constructor(){this.elts=[],this.i=0}}const A=12,N=new WeakMap;class _{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const L=Object.create(null);let D=class t{constructor(t,e,n,o=p.none){this.type=t,this.attrs=e,this.marks=o,this.content=n||c.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,o=0){this.content.nodesBetween(t,e,n,o,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,o){return this.content.textBetween(t,e,n,o)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&u(this.attrs,e||t.defaultAttrs||L)&&p.sameSet(this.marks,n||p.none)}copy(e=null){return e==this.content?this:new t(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new t(this.type,this.attrs,this.content,e)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return m.empty;let o=this.resolve(t),r=this.resolve(e),i=n?0:o.sharedDepth(e),s=o.start(i),l=o.node(i).content.cut(o.pos-s,r.pos-s);return new m(l,o.depth-i,r.depth-i)}replace(t,e,n){return b(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:o}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(o==t||e.isText)return e;t-=o+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let o=this.content.child(e-1);return{node:o,index:e-1,offset:n-o.nodeSize}}resolve(t){return T.resolveCached(this,t)}resolveNoCache(t){return T.resolve(this,t)}rangeHasMark(t,e,n){let o=!1;return e>t&&this.nodesBetween(t,e,(t=>(n.isInSet(t.marks)&&(o=!0),!o))),o}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),I(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=c.empty,o=0,r=n.childCount){let i=this.contentMatchAt(t).matchFragment(n,o,r),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(let l=o;l<r;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(t,e,n,o){if(o&&!this.type.allowsMarks(o))return!1;let r=this.contentMatchAt(t).matchType(n),i=r&&r.matchFragment(this.content,e);return!!i&&i.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=p.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!p.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((t=>t.toJSON()))),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let o=c.fromJSON(t,e.content),r=t.nodeType(e.type).create(e.attrs,o,n);return r.type.checkAttrs(r.attrs),r}};D.prototype.text=void 0;class R extends D{constructor(t,e,n,o){if(super(t,e,null,o),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):I(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new R(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new R(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return 0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function I(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class P{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new H(t,e);if(null==n.next)return P.empty;let o=V(n);n.next&&n.err("Unexpected trailing text");let r=function(t){let e=Object.create(null);return n(U(t,0));function n(o){let r=[];o.forEach((e=>{t[e].forEach((({term:e,to:n})=>{if(!e)return;let o;for(let t=0;t<r.length;t++)r[t][0]==e&&(o=r[t][1]);U(t,n).forEach((t=>{o||r.push([e,o=[]]),-1==o.indexOf(t)&&o.push(t)}))}))}));let i=e[o.join(",")]=new P(o.indexOf(t.length-1)>-1);for(let t=0;t<r.length;t++){let o=r[t][1].sort($);i.next.push({type:r[t][0],next:e[o.join(",")]||n(o)})}return i}}(function(t){let e=[[]];return r(i(t,0),n()),e;function n(){return e.push([])-1}function o(t,n,o){let r={term:o,to:n};return e[t].push(r),r}function r(t,e){t.forEach((t=>t.to=e))}function i(t,e){if("choice"==t.type)return t.exprs.reduce(((t,n)=>t.concat(i(n,e))),[]);if("seq"!=t.type){if("star"==t.type){let s=n();return o(e,s),r(i(t.expr,s),s),[o(s)]}if("plus"==t.type){let s=n();return r(i(t.expr,e),s),r(i(t.expr,s),s),[o(s)]}if("opt"==t.type)return[o(e)].concat(i(t.expr,e));if("range"==t.type){let s=e;for(let e=0;e<t.min;e++){let e=n();r(i(t.expr,s),e),s=e}if(-1==t.max)r(i(t.expr,s),s);else for(let e=t.min;e<t.max;e++){let e=n();o(s,e),r(i(t.expr,s),e),s=e}return[o(s)]}if("name"==t.type)return[o(e,void 0,t.value)];throw new Error("Unknown expr type")}for(let o=0;;o++){let s=i(t.exprs[o],e);if(o==t.exprs.length-1)return s;r(s,e=n())}}}(o));return function(t,e){for(let n=0,o=[t];n<o.length;n++){let t=o[n],r=!t.validEnd,i=[];for(let e=0;e<t.next.length;e++){let{type:n,next:s}=t.next[e];i.push(n.name),!r||n.isText||n.hasRequiredAttrs()||(r=!1),-1==o.indexOf(s)&&o.push(s)}r&&e.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(r,n),r}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let o=this;for(let r=e;o&&r<n;r++)o=o.matchType(t.child(r).type);return o}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let o=[this];return function r(i,s){let l=i.matchFragment(t,n);if(l&&(!e||l.validEnd))return c.from(s.map((t=>t.createAndFill())));for(let t=0;t<i.next.length;t++){let{type:e,next:n}=i.next[t];if(!e.isText&&!e.hasRequiredAttrs()&&-1==o.indexOf(n)){o.push(n);let t=r(n,s.concat(e));if(t)return t}}return null}(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let o=n.shift(),r=o.match;if(r.matchType(t)){let t=[];for(let e=o;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<r.next.length;t++){let{type:i,next:s}=r.next[t];i.isLeaf||i.hasRequiredAttrs()||i.name in e||o.type&&!s.validEnd||(n.push({match:i.contentMatch,type:i,via:o}),e[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];return function e(n){t.push(n);for(let o=0;o<n.next.length;o++)-1==t.indexOf(n.next[o].next)&&e(n.next[o].next)}(this),t.map(((e,n)=>{let o=n+(e.validEnd?"*":" ")+" ";for(let r=0;r<e.next.length;r++)o+=(r?", ":"")+e.next[r].type.name+"->"+t.indexOf(e.next[r].next);return o})).join("\n")}}P.empty=new P(!0);class H{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function V(t){let e=[];do{e.push(B(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function B(t){let e=[];do{e.push(j(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function j(t){let e=function(t){if(t.eat("(")){let e=V(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){let e=function(t,e){let n=t.nodeTypes,o=n[e];if(o)return[o];let r=[];for(let i in n){let t=n[i];t.groups.indexOf(e)>-1&&r.push(t)}0==r.length&&t.err("No node type or group '"+e+"' found");return r}(t,t.next).map((e=>(null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e})));return t.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}t.err("Unexpected token '"+t.next+"'")}(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=F(t,e)}return e}function z(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function F(t,e){let n=z(t),o=n;return t.eat(",")&&(o="}"!=t.next?z(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:o,expr:e}}function $(t,e){return e-t}function U(t,e){let n=[];return function e(o){let r=t[o];if(1==r.length&&!r[0].term)return e(r[0].to);n.push(o);for(let t=0;t<r.length;t++){let{term:o,to:i}=r[t];o||-1!=n.indexOf(i)||e(i)}}(e),n.sort($)}function W(t){let e=Object.create(null);for(let n in t){let o=t[n];if(!o.hasDefault)return null;e[n]=o.default}return e}function q(t,e){let n=Object.create(null);for(let o in t){let r=e&&e[o];if(void 0===r){let e=t[o];if(!e.hasDefault)throw new RangeError("No value supplied for attribute "+o);r=e.default}n[o]=r}return n}function J(t,e,n,o){for(let r in e)if(!(r in t))throw new RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let r in t){let n=t[r];n.validate&&n.validate(e[r])}}function K(t,e){let n=Object.create(null);if(e)for(let o in e)n[o]=new G(t,o,e[o]);return n}let Z=class t{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=K(t,n.attrs),this.defaultAttrs=W(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==P.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:q(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new D(this,this.computeAttrs(t),c.from(e),p.setFrom(n))}createChecked(t=null,e,n){return e=c.from(e),this.checkContent(e),new D(this,this.computeAttrs(t),e,p.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),(e=c.from(e)).size){let t=this.contentMatch.fillBefore(e);if(!t)return null;e=t.append(e)}let o=this.contentMatch.matchFragment(e),r=o&&o.fillBefore(c.empty,!0);return r?new D(this,t,e.append(r),p.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){J(this.attrs,t,"node",this.name)}allowsMarkType(t){return null==this.markSet||this.markSet.indexOf(t)>-1}allowsMarks(t){if(null==this.markSet)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(null==this.markSet)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:p.none:t}static compile(e,n){let o=Object.create(null);e.forEach(((e,r)=>o[e]=new t(e,n,r)));let r=n.spec.topNode||"doc";if(!o[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(let t in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o}};class G{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(t,e,n){let o=n.split("|");return n=>{let r=null===n?"null":typeof n;if(o.indexOf(r)<0)throw new RangeError(`Expected value of type ${o} for attribute ${e} on type ${t}, got ${r}`)}}(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class X{constructor(t,e,n,o){this.name=t,this.rank=e,this.schema=n,this.spec=o,this.attrs=K(t,o.attrs),this.excluded=null;let r=W(this.attrs);this.instance=r?new p(this,r):null}create(t=null){return!t&&this.instance?this.instance:new p(this,q(this.attrs,t))}static compile(t,e){let n=Object.create(null),o=0;return t.forEach(((t,r)=>n[t]=new X(t,o++,e,r))),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){J(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class Y{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let o in t)e[o]=t[o];e.nodes=s.from(t.nodes),e.marks=s.from(t.marks||{}),this.nodes=Z.compile(this.spec.nodes,this),this.marks=X.compile(this.spec.marks,this);let n=Object.create(null);for(let o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");let t=this.nodes[o],e=t.spec.content||"",r=t.spec.marks;if(t.contentMatch=n[e]||(n[e]=P.parse(e,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!t.isInline||!t.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=t}t.markSet="_"==r?null:r?Q(this,r.split(" ")):""!=r&&t.inlineContent?null:[]}for(let o in this.marks){let t=this.marks[o],e=t.spec.excludes;t.excluded=null==e?[t]:""==e?[]:Q(this,e.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,o){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof Z))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,o)}text(t,e){let n=this.nodes.text;return new R(n,n.defaultAttrs,t,p.setFrom(e))}mark(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return D.fromJSON(this,t)}markFromJSON(t){return p.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function Q(t,e){let n=[];for(let o=0;o<e.length;o++){let r=e[o],i=t.marks[r],s=i;if(i)n.push(i);else for(let e in t.marks){let o=t.marks[e];("_"==r||o.spec.group&&o.spec.group.split(" ").indexOf(r)>-1)&&n.push(s=o)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[o]+"'")}return n}let tt=class t{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let n=this.matchedStyles=[];e.forEach((t=>{if(function(t){return null!=t.tag}(t))this.tags.push(t);else if(function(t){return null!=t.style}(t)){let e=/[^=]*/.exec(t.style)[0];n.indexOf(e)<0&&n.push(e),this.styles.push(t)}})),this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)}))}parse(t,e={}){let n=new st(this,e,!1);return n.addAll(t,p.none,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new st(this,e,!0);return n.addAll(t,p.none,e.from,e.to),m.maxOpen(n.finish())}matchTag(t,e,n){for(let o=n?this.tags.indexOf(n)+1:0;o<this.tags.length;o++){let n=this.tags[o];if(lt(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,o){for(let r=o?this.styles.indexOf(o)+1:0;r<this.styles.length;r++){let o=this.styles[r],i=o.style;if(!(0!=i.indexOf(t)||o.context&&!n.matchesContext(o.context)||i.length>t.length&&(61!=i.charCodeAt(t.length)||i.slice(t.length+1)!=e))){if(o.getAttrs){let t=o.getAttrs(e);if(!1===t)continue;o.attrs=t||void 0}return o}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,o=0;for(;o<e.length;o++){let t=e[o];if((null==t.priority?50:t.priority)<n)break}e.splice(o,0,t)}for(let o in t.marks){let e=t.marks[o].spec.parseDOM;e&&e.forEach((t=>{n(t=at(t)),t.mark||t.ignore||t.clearMark||(t.mark=o)}))}for(let o in t.nodes){let e=t.nodes[o].spec.parseDOM;e&&e.forEach((t=>{n(t=at(t)),t.node||t.ignore||t.mark||(t.node=o)}))}return e}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new t(e,t.schemaRules(e)))}};const et={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},nt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ot={ol:!0,ul:!0};function rt(t,e,n){return null!=e?(e?1:0)|("full"===e?2:0):t&&"pre"==t.whitespace?3:-5&n}class it{constructor(t,e,n,o,r,i){this.type=t,this.attrs=e,this.marks=n,this.solid=o,this.options=i,this.content=[],this.activeMarks=p.none,this.match=r||(4&i?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(c.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(1&this.options)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=c.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(c.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!et.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class st{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let o,r=e.topNode,i=rt(null,e.preserveWhitespace,0)|(n?4:0);o=r?new it(r.type,r.attrs,p.none,!0,e.topMatch||r.type.contentMatch,i):new it(n?null:t.schema.topNodeType,null,p.none,!0,null,i),this.nodes=[o],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){3==t.nodeType?this.addTextNode(t,e):1==t.nodeType&&this.addElement(t,e)}addTextNode(t,e){let n=t.nodeValue,o=this.top;if(2&o.options||o.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(1&o.options)n=2&o.options?n.replace(/\r\n?/g,"\n"):n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let e=o.content[o.content.length-1],r=t.previousSibling;(!e||r&&"BR"==r.nodeName||e.isText&&/[ \t\r\n\u000c]$/.test(e.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e),this.findInText(t)}else this.findInside(t)}addElement(t,e,n){let o,r=t.nodeName.toLowerCase();ot.hasOwnProperty(r)&&this.parser.normalizeLists&&function(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&ot.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(o=this.parser.matchTag(t,this,n));if(i?i.ignore:nt.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t,e);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let n,o=this.top,s=this.needsBlock;if(et.hasOwnProperty(r))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),n=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t,e);let l=i&&i.skip?e:this.readStyles(t,e);l&&this.addAll(t,l),n&&this.sync(o),this.needsBlock=s}else{let n=this.readStyles(t,e);n&&this.addElementByRule(t,i,n,!1===i.consuming?o:void 0)}}leafFallback(t,e){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"),e)}ignoreFallback(t,e){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),e)}readStyles(t,e){let n=t.style;if(n&&n.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let t=this.parser.matchedStyles[o],r=n.getPropertyValue(t);if(r)for(let n;;){let o=this.parser.matchStyle(t,r,this,n);if(!o)break;if(o.ignore)return null;if(e=o.clearMark?e.filter((t=>!o.clearMark(t))):e.concat(this.parser.schema.marks[o.mark].create(o.attrs)),!1!==o.consuming)break;n=o}}return e}addElementByRule(t,e,n,o){let r,i;if(e.node)if(i=this.parser.schema.nodes[e.node],i.isLeaf)this.insertNode(i.create(e.attrs),n)||this.leafFallback(t,n);else{let t=this.enter(i,e.attrs||null,n,e.preserveWhitespace);t&&(r=!0,n=t)}else{let t=this.parser.schema.marks[e.mark];n=n.concat(t.create(e.attrs))}let s=this.top;if(i&&i.isLeaf)this.findInside(t);else if(o)this.addElement(t,n,o);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t,n)));else{let o=t;"string"==typeof e.contentElement?o=t.querySelector(e.contentElement):"function"==typeof e.contentElement?o=e.contentElement(t):e.contentElement&&(o=e.contentElement),this.findAround(t,o,!0),this.addAll(o,n)}r&&this.sync(s)&&this.open--}addAll(t,e,n,o){let r=n||0;for(let i=n?t.childNodes[n]:t.firstChild,s=null==o?null:t.childNodes[o];i!=s;i=i.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(i,e);this.findAtPoint(t,r)}findPlace(t,e){let n,o;for(let r=this.open;r>=0;r--){let e=this.nodes[r],i=e.findWrapping(t);if(i&&(!n||n.length>i.length)&&(n=i,o=e,!i.length))break;if(e.solid)break}if(!n)return null;this.sync(o);for(let r=0;r<n.length;r++)e=this.enterInner(n[r],null,e,!1);return e}insertNode(t,e){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&(e=this.enterInner(t,null,e))}let n=this.findPlace(t,e);if(n){this.closeExtra();let e=this.top;e.match&&(e.match=e.match.matchType(t.type));let o=p.none;for(let r of n.concat(t.marks))(e.type?e.type.allowsMarkType(r.type):ct(r.type,t.type))&&(o=r.addToSet(o));return e.content.push(t.mark(o)),!0}return!1}enter(t,e,n,o){let r=this.findPlace(t.create(e),n);return r&&(r=this.enterInner(t,e,n,!0,o)),r}enterInner(t,e,n,o=!1,r){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(t);let s=rt(t,r,i.options);4&i.options&&0==i.content.length&&(s|=4);let l=p.none;return n=n.filter((e=>!(i.type?i.type.allowsMarkType(e.type):ct(e.type,t))||(l=e.addToSet(l),!1))),this.nodes.push(new it(t,e,l,o,null,s)),this.open++,n}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let o=0;o<this.find.length;o++)if(null==this.find[o].pos&&1==t.nodeType&&t.contains(this.find[o].node)){e.compareDocumentPosition(this.find[o].node)&(n?2:4)&&(this.find[o].pos=this.currentPos)}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,o=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),r=-(n?n.depth+1:0)+(o?0:1),i=(t,s)=>{for(;t>=0;t--){let l=e[t];if(""==l){if(t==e.length-1||0==t)continue;for(;s>=r;s--)if(i(t-1,s))return!0;return!1}{let t=s>0||0==s&&o?this.nodes[s].type:n&&s>=r?n.node(s-r).type:null;if(!t||t.name!=l&&-1==t.groups.indexOf(l))return!1;s--}}return!0};return i(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}}function lt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function at(t){let e={};for(let n in t)e[n]=t[n];return e}function ct(t,e){let n=e.schema.nodes;for(let o in n){let r=n[o];if(!r.allowsMarkType(t))continue;let i=[],s=t=>{i.push(t);for(let n=0;n<t.edgeCount;n++){let{type:o,next:r}=t.edge(n);if(o==e)return!0;if(i.indexOf(r)<0&&s(r))return!0}};if(s(r.contentMatch))return!0}}class dt{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=ut(e).createDocumentFragment());let o=n,r=[];return t.forEach((t=>{if(r.length||t.marks.length){let n=0,i=0;for(;n<r.length&&i<t.marks.length;){let e=t.marks[i];if(this.marks[e.type.name]){if(!e.eq(r[n][0])||!1===e.type.spec.spanning)break;n++,i++}else i++}for(;n<r.length;)o=r.pop()[1];for(;i<t.marks.length;){let n=t.marks[i++],s=this.serializeMark(n,t.isInline,e);s&&(r.push([n,o]),o.appendChild(s.dom),o=s.contentDOM||s.dom)}}o.appendChild(this.serializeNodeInner(t,e))})),n}serializeNodeInner(t,e){let{dom:n,contentDOM:o}=mt(ut(e),this.nodes[t.type.name](t),null,t.attrs);if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,o)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let o=t.marks.length-1;o>=0;o--){let r=this.serializeMark(t.marks[o],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(t,e,n={}){let o=this.marks[t.type.name];return o&&mt(ut(n),o(t,e),null,t.attrs)}static renderSpec(t,e,n=null,o){return mt(t,e,n,o)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new dt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=ht(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return ht(t.marks)}}function ht(t){let e={};for(let n in t){let o=t[n].spec.toDOM;o&&(e[n]=o)}return e}function ut(t){return t.document||window.document}const pt=new WeakMap;function ft(t){let e=pt.get(t);return void 0===e&&pt.set(t,e=function(t){let e=null;function n(t){if(t&&"object"==typeof t)if(Array.isArray(t))if("string"==typeof t[0])e||(e=[]),e.push(t);else for(let e=0;e<t.length;e++)n(t[e]);else for(let e in t)n(t[e])}return n(t),e}(t)),e}function mt(t,e,n,o){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let r,i=e[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(o&&(r=ft(o))&&r.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s,l=i.indexOf(" ");l>0&&(n=i.slice(0,l),i=i.slice(l+1));let a=n?t.createElementNS(n,i):t.createElement(i),c=e[1],d=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){d=2;for(let t in c)if(null!=c[t]){let e=t.indexOf(" ");e>0?a.setAttributeNS(t.slice(0,e),t.slice(e+1),c[t]):a.setAttribute(t,c[t])}}for(let h=d;h<e.length;h++){let r=e[h];if(0===r){if(h<e.length-1||h>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}{let{dom:e,contentDOM:i}=mt(t,r,n,o);if(a.appendChild(e),i){if(s)throw new RangeError("Multiple content holes");s=i}}}return{dom:a,contentDOM:s}}const gt=Math.pow(2,16);function yt(t,e){return t+e*gt}function bt(t){return 65535&t}class wt{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class vt{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&vt.empty)return vt.empty}recover(t){let e=0,n=bt(t);if(!this.inverted)for(let o=0;o<n;o++)e+=this.ranges[3*o+2]-this.ranges[3*o+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/gt}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let o=0,r=this.inverted?2:1,i=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let l=this.ranges[s]-(this.inverted?o:0);if(l>t)break;let a=this.ranges[s+r],c=this.ranges[s+i],d=l+a;if(t<=d){let r=l+o+((a?t==l?-1:t==d?1:e:e)<0?0:c);if(n)return r;let i=t==(e<0?l:d)?null:yt(s/3,t-l),h=t==l?2:t==d?1:4;return(e<0?t!=l:t!=d)&&(h|=8),new wt(r,h,i)}o+=c-a}return n?t+o:new wt(t+o,0,null)}touches(t,e){let n=0,o=bt(e),r=this.inverted?2:1,i=this.inverted?1:2;for(let s=0;s<this.ranges.length;s+=3){let e=this.ranges[s]-(this.inverted?n:0);if(e>t)break;let l=this.ranges[s+r];if(t<=e+l&&s==3*o)return!0;n+=this.ranges[s+i]-l}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let o=0,r=0;o<this.ranges.length;o+=3){let i=this.ranges[o],s=i-(this.inverted?r:0),l=i+(this.inverted?0:r),a=this.ranges[o+e],c=this.ranges[o+n];t(s,s+a,l,l+c),r+=c-a}}invert(){return new vt(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?vt.empty:new vt(t<0?[0,-t,0]:[0,0,t])}}vt.empty=new vt([]);class kt{constructor(t=[],e,n=0,o=t.length){this.maps=t,this.mirror=e,this.from=n,this.to=o}slice(t=0,e=this.maps.length){return new kt(this.maps,this.mirror,t,e)}copy(){return new kt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,n=this.maps.length;e<t.maps.length;e++){let o=t.getMirror(e);this.appendMap(t.maps[e],null!=o&&o<e?n+o:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){let o=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=o&&o>e?n-o-1:void 0)}}invert(){let t=new kt;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let o=0;for(let r=this.from;r<this.to;r++){let n=this.maps[r].mapResult(t,e);if(null!=n.recover){let e=this.getMirror(r);if(null!=e&&e>r&&e<this.to){r=e,t=this.maps[e].recover(n.recover);continue}}o|=n.delInfo,t=n.pos}return n?t:new wt(t,o,null)}}const xt=Object.create(null);class Ct{getMap(){return vt.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=xt[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in xt)throw new RangeError("Duplicate use of step JSON ID "+t);return xt[t]=e,e.prototype.jsonID=t,e}}class St{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new St(t,null)}static fail(t){return new St(null,t)}static fromReplace(t,e,n,o){try{return St.ok(t.replace(e,n,o))}catch(r){if(r instanceof f)return St.fail(r.message);throw r}}}function Mt(t,e,n){let o=[];for(let r=0;r<t.childCount;r++){let i=t.child(r);i.content.size&&(i=i.copy(Mt(i.content,e,i))),i.isInline&&(i=e(i,n,r)),o.push(i)}return c.fromArray(o)}class Et extends Ct{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),o=n.node(n.sharedDepth(this.to)),r=new m(Mt(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),o),e.openStart,e.openEnd);return St.fromReplace(t,this.from,this.to,r)}invert(){return new Tt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Et(e.pos,n.pos,this.mark)}merge(t){return t instanceof Et&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Et(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Et(e.from,e.to,t.markFromJSON(e.mark))}}Ct.jsonID("addMark",Et);class Tt extends Ct{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new m(Mt(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return St.fromReplace(t,this.from,this.to,n)}invert(){return new Et(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new Tt(e.pos,n.pos,this.mark)}merge(t){return t instanceof Tt&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Tt(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Tt(e.from,e.to,t.markFromJSON(e.mark))}}Ct.jsonID("removeMark",Tt);class Ot extends Ct{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return St.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return St.fromReplace(t,this.pos,this.pos+1,new m(c.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new Ot(this.pos,e.marks[n]);return new Ot(this.pos,this.mark)}}return new At(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Ot(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ot(e.pos,t.markFromJSON(e.mark))}}Ct.jsonID("addNodeMark",Ot);class At extends Ct{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return St.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return St.fromReplace(t,this.pos,this.pos+1,new m(c.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new Ot(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new At(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new At(e.pos,t.markFromJSON(e.mark))}}Ct.jsonID("removeNodeMark",At);class Nt extends Ct{constructor(t,e,n,o=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=o}apply(t){return this.structure&&Lt(t,this.from,this.to)?St.fail("Structure replace would overwrite content"):St.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new vt([this.from,this.to-this.from,this.slice.size])}invert(t){return new Nt(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new Nt(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof Nt)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?m.empty:new m(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new Nt(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?m.empty:new m(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new Nt(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Nt(e.from,e.to,m.fromJSON(t,e.slice),!!e.structure)}}Ct.jsonID("replace",Nt);class _t extends Ct{constructor(t,e,n,o,r,i,s=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=o,this.slice=r,this.insert=i,this.structure=s}apply(t){if(this.structure&&(Lt(t,this.from,this.gapFrom)||Lt(t,this.gapTo,this.to)))return St.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return St.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?St.fromReplace(t,this.from,this.to,n):St.fail("Content does not fit in gap")}getMap(){return new vt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new _t(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),o=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),r=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||o<e.pos||r>n.pos?null:new _t(e.pos,n.pos,o,r,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new _t(e.from,e.to,e.gapFrom,e.gapTo,m.fromJSON(t,e.slice),e.insert,!!e.structure)}}function Lt(t,e,n){let o=t.resolve(e),r=n-e,i=o.depth;for(;r>0&&i>0&&o.indexAfter(i)==o.node(i).childCount;)i--,r--;if(r>0){let t=o.node(i).maybeChild(o.indexAfter(i));for(;r>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,r--}}return!1}function Dt(t,e,n,o=n.contentMatch,r=!0){let i=t.doc.nodeAt(e),s=[],l=e+1;for(let a=0;a<i.childCount;a++){let e=i.child(a),d=l+e.nodeSize,h=o.matchType(e.type);if(h){o=h;for(let o=0;o<e.marks.length;o++)n.allowsMarkType(e.marks[o].type)||t.step(new Tt(l,d,e.marks[o]));if(r&&e.isText&&"pre"!=n.whitespace){let t,o,r=/\r?\n|\r/g;for(;t=r.exec(e.text);)o||(o=new m(c.from(n.schema.text(" ",n.allowedMarks(e.marks))),0,0)),s.push(new Nt(l+t.index,l+t.index+t[0].length,o))}}else s.push(new Nt(l,d,m.empty));l=d}if(!o.validEnd){let e=o.fillBefore(c.empty,!0);t.replace(l,l,new m(e,0,0))}for(let a=s.length-1;a>=0;a--)t.step(s[a])}function Rt(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function It(t){let e=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth;;--n){let o=t.$from.node(n),r=t.$from.index(n),i=t.$to.indexAfter(n);if(n<t.depth&&o.canReplace(r,i,e))return n;if(0==n||o.type.spec.isolating||!Rt(o,r,i))break}return null}function Pt(t,e,n=null,o=t){let r=function(t,e){let{parent:n,startIndex:o,endIndex:r}=t,i=n.contentMatchAt(o).findWrapping(e);if(!i)return null;let s=i.length?i[0]:e;return n.canReplaceWith(o,r,s)?i:null}(t,e),i=r&&function(t,e){let{parent:n,startIndex:o,endIndex:r}=t,i=n.child(o),s=e.contentMatch.findWrapping(i.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let a=o;l&&a<r;a++)l=l.matchType(n.child(a).type);return l&&l.validEnd?s:null}(o,e);return i?r.map(Ht).concat({type:e,attrs:n}).concat(i.map(Ht)):null}function Ht(t){return{type:t,attrs:null}}function Vt(t,e,n=1,o){let r=t.resolve(e),i=r.depth-n,s=o&&o[o.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!s.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,d=n-2;c>i;c--,d--){let t=r.node(c),e=r.index(c);if(t.type.spec.isolating)return!1;let n=t.content.cutByIndex(e,t.childCount),i=o&&o[d+1];i&&(n=n.replaceChild(0,i.type.create(i.attrs)));let s=o&&o[d]||t;if(!t.canReplace(e+1,t.childCount)||!s.type.validContent(n))return!1}let l=r.indexAfter(i),a=o&&o[0];return r.node(i).canReplaceWith(l,l,a?a.type:r.node(i+1).type)}function Bt(t,e){let n=t.resolve(e),o=n.index();return jt(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(o,o+1)}function jt(t,e){return!(!t||!e||t.isLeaf||!t.canAppend(e))}function zt(t,e,n=-1){let o=t.resolve(e);for(let r=o.depth;;r--){let t,i,s=o.index(r);if(r==o.depth?(t=o.nodeBefore,i=o.nodeAfter):n>0?(t=o.node(r+1),s++,i=o.node(r).maybeChild(s)):(t=o.node(r).maybeChild(s-1),i=o.node(r+1)),t&&!t.isTextblock&&jt(t,i)&&o.node(r).canReplace(s,s+1))return e;if(0==r)break;e=n<0?o.before(r):o.after(r)}}function Ft(t,e,n){let o=t.resolve(e);if(!n.content.size)return e;let r=n.content;for(let i=0;i<n.openStart;i++)r=r.firstChild.content;for(let i=1;i<=(0==n.openStart&&n.size?2:1);i++)for(let t=o.depth;t>=0;t--){let e=t==o.depth?0:o.pos<=(o.start(t+1)+o.end(t+1))/2?-1:1,n=o.index(t)+(e>0?1:0),s=o.node(t),l=!1;if(1==i)l=s.canReplace(n,n,r);else{let t=s.contentMatchAt(n).findWrapping(r.firstChild.type);l=t&&s.canReplaceWith(n,n,t[0])}if(l)return 0==e?o.pos:e<0?o.before(t+1):o.after(t+1)}return null}function $t(t,e,n=e,o=m.empty){if(e==n&&!o.size)return null;let r=t.resolve(e),i=t.resolve(n);return Ut(r,i,o)?new Nt(e,n,o):new Wt(r,i,o).fit()}function Ut(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}Ct.jsonID("replaceAround",_t);class Wt{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=c.empty;for(let o=0;o<=t.depth;o++){let e=t.node(o);this.frontier.push({type:e.type,match:e.contentMatchAt(t.indexAfter(o))})}for(let o=t.depth;o>0;o--)this.placed=c.from(t.node(o).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,o=this.close(t<0?this.$to:n.doc.resolve(t));if(!o)return null;let r=this.placed,i=n.depth,s=o.depth;for(;i&&s&&1==r.childCount;)r=r.firstChild.content,i--,s--;let l=new m(r,i,s);return t>-1?new _t(n.pos,t,this.$to.pos,this.$to.end(),l,e):l.size||n.pos!=this.$to.pos?new Nt(n.pos,o.pos,l):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,o=this.unplaced.openEnd;n<t;n++){let r=e.firstChild;if(e.childCount>1&&(o=0),r.type.spec.isolating&&o<=n){t=n;break}e=r.content}for(let e=1;e<=2;e++)for(let n=1==e?t:this.unplaced.openStart;n>=0;n--){let t,o=null;n?(o=Kt(this.unplaced.content,n-1).firstChild,t=o.content):t=this.unplaced.content;let r=t.firstChild;for(let i=this.depth;i>=0;i--){let t,{type:s,match:l}=this.frontier[i],a=null;if(1==e&&(r?l.matchType(r.type)||(a=l.fillBefore(c.from(r),!1)):o&&s.compatibleContent(o.type)))return{sliceDepth:n,frontierDepth:i,parent:o,inject:a};if(2==e&&r&&(t=l.findWrapping(r.type)))return{sliceDepth:n,frontierDepth:i,parent:o,wrap:t};if(o&&l.matchType(o.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,o=Kt(t,e);return!(!o.childCount||o.firstChild.isLeaf)&&(this.unplaced=new m(t,e+1,Math.max(n,o.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,o=Kt(t,e);if(o.childCount<=1&&e>0){let r=t.size-e<=e+o.size;this.unplaced=new m(qt(t,e-1,1),e-1,r?e-1:n)}else this.unplaced=new m(qt(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:o,wrap:r}){for(;this.depth>e;)this.closeFrontierNode();if(r)for(let c=0;c<r.length;c++)this.openFrontierNode(r[c]);let i=this.unplaced,s=n?n.content:i.content,l=i.openStart-t,a=0,d=[],{match:h,type:u}=this.frontier[e];if(o){for(let t=0;t<o.childCount;t++)d.push(o.child(t));h=h.matchFragment(o)}let p=s.size+t-(i.content.size-i.openEnd);for(;a<s.childCount;){let t=s.child(a),e=h.matchType(t.type);if(!e)break;a++,(a>1||0==l||t.content.size)&&(h=e,d.push(Zt(t.mark(u.allowedMarks(t.marks)),1==a?l:0,a==s.childCount?p:-1)))}let f=a==s.childCount;f||(p=-1),this.placed=Jt(this.placed,e,c.from(d)),this.frontier[e].match=h,f&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let c=0,m=s;c<p;c++){let t=m.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),m=t.content}this.unplaced=f?0==t?m.empty:new m(qt(i.content,t-1,1),t-1,p<0?i.openEnd:t-1):new m(qt(i.content,t,a),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!Gt(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,o=this.$to.after(n);for(;n>1&&o==this.$to.end(--n);)++o;return o}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:o}=this.frontier[e],r=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),i=Gt(t,e,o,n,r);if(i){for(let n=e-1;n>=0;n--){let{match:e,type:o}=this.frontier[n],r=Gt(t,n,o,e,!0);if(!r||r.childCount)continue t}return{depth:e,fit:i,move:r?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Jt(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let e=t.node(n),o=e.type.contentMatch.fillBefore(e.content,!0,t.index(n));this.openFrontierNode(e.type,e.attrs,o)}return t}openFrontierNode(t,e=null,n){let o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=Jt(this.placed,this.depth,c.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(c.empty,!0);t.childCount&&(this.placed=Jt(this.placed,this.frontier.length,t))}}function qt(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(qt(t.firstChild.content,e-1,n)))}function Jt(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Jt(t.lastChild.content,e-1,n)))}function Kt(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function Zt(t,e,n){if(e<=0)return t;let o=t.content;return e>1&&(o=o.replaceChild(0,Zt(o.firstChild,e-1,1==o.childCount?n-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),n<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(c.empty,!0)))),t.copy(o)}function Gt(t,e,n,o,r){let i=t.node(e),s=r?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;let l=o.fillBefore(i.content,!0,s);return l&&!function(t,e,n){for(let o=n;o<e.childCount;o++)if(!t.allowsMarks(e.child(o).marks))return!0;return!1}(n,i.content,s)?l:null}function Xt(t,e,n,o,r){if(e<n){let r=t.firstChild;t=t.replaceChild(0,r.copy(Xt(r.content,e+1,n,o,r)))}if(e>o){let e=r.contentMatchAt(0),n=e.fillBefore(t).append(t);t=n.append(e.matchFragment(n).fillBefore(c.empty,!0))}return t}function Yt(t,e){let n=[];for(let o=Math.min(t.depth,e.depth);o>=0;o--){let r=t.start(o);if(r<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;(r==e.start(o)||o==t.depth&&o==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&o&&e.start(o-1)==r-1)&&n.push(o)}return n}class Qt extends Ct{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return St.fail("No node at attribute step's position");let n=Object.create(null);for(let r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;let o=e.type.create(n,null,e.marks);return St.fromReplace(t,this.pos,this.pos+1,new m(c.from(o),0,e.isLeaf?0:1))}getMap(){return vt.empty}invert(t){return new Qt(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new Qt(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Qt(e.pos,e.attr,e.value)}}Ct.jsonID("attr",Qt);class te extends Ct{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let o in t.attrs)e[o]=t.attrs[o];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return St.ok(n)}getMap(){return vt.empty}invert(t){return new te(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if("string"!=typeof e.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new te(e.attr,e.value)}}Ct.jsonID("docAttr",te);let ee=class extends Error{};ee=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(ee.prototype=Object.create(Error.prototype)).constructor=ee,ee.prototype.name="TransformError";class ne{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new kt}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new ee(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=m.empty){let o=$t(this.doc,t,e,n);return o&&this.step(o),this}replaceWith(t,e,n){return this.replace(t,e,new m(c.from(n),0,0))}delete(t,e){return this.replace(t,e,m.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return function(t,e,n,o){if(!o.size)return t.deleteRange(e,n);let r=t.doc.resolve(e),i=t.doc.resolve(n);if(Ut(r,i,o))return t.step(new Nt(e,n,o));let s=Yt(r,t.doc.resolve(n));0==s[s.length-1]&&s.pop();let l=-(r.depth+1);s.unshift(l);for(let p=r.depth,f=r.pos-1;p>0;p--,f--){let t=r.node(p).type.spec;if(t.defining||t.definingAsContext||t.isolating)break;s.indexOf(p)>-1?l=p:r.before(p)==f&&s.splice(1,0,-p)}let a=s.indexOf(l),c=[],d=o.openStart;for(let p=o.content,f=0;;f++){let t=p.firstChild;if(c.push(t),f==o.openStart)break;p=t.content}for(let p=d-1;p>=0;p--){let t=c[p],e=(h=t.type).spec.defining||h.spec.definingForContent;if(e&&!t.sameMarkup(r.node(Math.abs(l)-1)))d=p;else if(e||!t.type.isTextblock)break}var h;for(let p=o.openStart;p>=0;p--){let e=(p+d+1)%(o.openStart+1),l=c[e];if(l)for(let c=0;c<s.length;c++){let d=s[(c+a)%s.length],h=!0;d<0&&(h=!1,d=-d);let u=r.node(d-1),p=r.index(d-1);if(u.canReplaceWith(p,p,l.type,l.marks))return t.replace(r.before(d),h?i.after(d):n,new m(Xt(o.content,0,o.openStart,e),e,o.openEnd))}}let u=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,n,o),!(t.steps.length>u));p--){let t=s[p];t<0||(e=r.before(t),n=i.after(t))}}(this,t,e,n),this}replaceRangeWith(t,e,n){return function(t,e,n,o){if(!o.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let r=function(t,e,n){let o=t.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),n))return e;if(0==o.parentOffset)for(let r=o.depth-1;r>=0;r--){let t=o.index(r);if(o.node(r).canReplaceWith(t,t,n))return o.before(r+1);if(t>0)return null}if(o.parentOffset==o.parent.content.size)for(let r=o.depth-1;r>=0;r--){let t=o.indexAfter(r);if(o.node(r).canReplaceWith(t,t,n))return o.after(r+1);if(t<o.node(r).childCount)return null}return null}(t.doc,e,o.type);null!=r&&(e=n=r)}t.replaceRange(e,n,new m(c.from(o),0,0))}(this,t,e,n),this}deleteRange(t,e){return function(t,e,n){let o=t.doc.resolve(e),r=t.doc.resolve(n),i=Yt(o,r);for(let s=0;s<i.length;s++){let e=i[s],n=s==i.length-1;if(n&&0==e||o.node(e).type.contentMatch.validEnd)return t.delete(o.start(e),r.end(e));if(e>0&&(n||o.node(e-1).canReplace(o.index(e-1),r.indexAfter(e-1))))return t.delete(o.before(e),r.after(e))}for(let s=1;s<=o.depth&&s<=r.depth;s++)if(e-o.start(s)==o.depth-s&&n>o.end(s)&&r.end(s)-n!=r.depth-s)return t.delete(o.before(s),n);t.delete(e,n)}(this,t,e),this}lift(t,e){return function(t,e,n){let{$from:o,$to:r,depth:i}=e,s=o.before(i+1),l=r.after(i+1),a=s,d=l,h=c.empty,u=0;for(let m=i,g=!1;m>n;m--)g||o.index(m)>0?(g=!0,h=c.from(o.node(m).copy(h)),u++):a--;let p=c.empty,f=0;for(let m=i,g=!1;m>n;m--)g||r.after(m+1)<r.end(m)?(g=!0,p=c.from(r.node(m).copy(p)),f++):d++;t.step(new _t(a,d,s,l,new m(h.append(p),u,f),h.size-u,!0))}(this,t,e),this}join(t,e=1){return function(t,e,n){let o=new Nt(e-n,e+n,m.empty,!0);t.step(o)}(this,t,e),this}wrap(t,e){return function(t,e,n){let o=c.empty;for(let s=n.length-1;s>=0;s--){if(o.size){let t=n[s].type.contentMatch.matchFragment(o);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}o=c.from(n[s].type.create(n[s].attrs,o))}let r=e.start,i=e.end;t.step(new _t(r,i,r,i,new m(o,0,0),n.length,!0))}(this,t,e),this}setBlockType(t,e=t,n,o=null){return function(t,e,n,o,r){if(!o.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,((e,n)=>{let s="function"==typeof r?r(e):r;if(e.isTextblock&&!e.hasMarkup(o,s)&&function(t,e,n){let o=t.resolve(e),r=o.index();return o.parent.canReplaceWith(r,r+1,n)}(t.doc,t.mapping.slice(i).map(n),o)){let r=null;if(o.schema.linebreakReplacement){let t="pre"==o.whitespace,e=!!o.contentMatch.matchType(o.schema.linebreakReplacement);t&&!e?r=!1:!t&&e&&(r=!0)}!1===r&&function(t,e,n,o){e.forEach(((r,i)=>{if(r.type==r.type.schema.linebreakReplacement){let r=t.mapping.slice(o).map(n+1+i);t.replaceWith(r,r+1,e.type.schema.text("\n"))}}))}(t,e,n,i),Dt(t,t.mapping.slice(i).map(n,1),o,void 0,null===r);let l=t.mapping.slice(i),a=l.map(n,1),d=l.map(n+e.nodeSize,1);return t.step(new _t(a,d,a+1,d-1,new m(c.from(o.create(s,null,e.marks)),0,0),1,!0)),!0===r&&function(t,e,n,o){e.forEach(((r,i)=>{if(r.isText){let s,l=/\r?\n|\r/g;for(;s=l.exec(r.text);){let r=t.mapping.slice(o).map(n+1+i+s.index);t.replaceWith(r,r+1,e.type.schema.linebreakReplacement.create())}}}))}(t,e,n,i),!1}}))}(this,t,e,n,o),this}setNodeMarkup(t,e,n=null,o){return function(t,e,n,o,r){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let s=n.create(o,null,r||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,s);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new _t(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new m(c.from(s),0,0),1,!0))}(this,t,e,n,o),this}setNodeAttribute(t,e,n){return this.step(new Qt(t,e,n)),this}setDocAttribute(t,e){return this.step(new te(t,e)),this}addNodeMark(t,e){return this.step(new Ot(t,e)),this}removeNodeMark(t,e){if(!(e instanceof p)){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(!(e=e.isInSet(n.marks)))return this}return this.step(new At(t,e)),this}split(t,e=1,n){return function(t,e,n=1,o){let r=t.doc.resolve(e),i=c.empty,s=c.empty;for(let l=r.depth,a=r.depth-n,d=n-1;l>a;l--,d--){i=c.from(r.node(l).copy(i));let t=o&&o[d];s=c.from(t?t.type.create(t.attrs,s):r.node(l).copy(s))}t.step(new Nt(e,e,new m(i.append(s),n,n),!0))}(this,t,e,n),this}addMark(t,e,n){return function(t,e,n,o){let r,i,s=[],l=[];t.doc.nodesBetween(e,n,((t,a,c)=>{if(!t.isInline)return;let d=t.marks;if(!o.isInSet(d)&&c.type.allowsMarkType(o.type)){let c=Math.max(a,e),h=Math.min(a+t.nodeSize,n),u=o.addToSet(d);for(let t=0;t<d.length;t++)d[t].isInSet(u)||(r&&r.to==c&&r.mark.eq(d[t])?r.to=h:s.push(r=new Tt(c,h,d[t])));i&&i.to==c?i.to=h:l.push(i=new Et(c,h,o))}})),s.forEach((e=>t.step(e))),l.forEach((e=>t.step(e)))}(this,t,e,n),this}removeMark(t,e,n){return function(t,e,n,o){let r=[],i=0;t.doc.nodesBetween(e,n,((t,s)=>{if(!t.isInline)return;i++;let l=null;if(o instanceof X){let e,n=t.marks;for(;e=o.isInSet(n);)(l||(l=[])).push(e),n=e.removeFromSet(n)}else o?o.isInSet(t.marks)&&(l=[o]):l=t.marks;if(l&&l.length){let o=Math.min(s+t.nodeSize,n);for(let t=0;t<l.length;t++){let n,a=l[t];for(let t=0;t<r.length;t++){let e=r[t];e.step==i-1&&a.eq(r[t].style)&&(n=e)}n?(n.to=o,n.step=i):r.push({style:a,from:Math.max(s,e),to:o,step:i})}}})),r.forEach((e=>t.step(new Tt(e.from,e.to,e.style))))}(this,t,e,n),this}clearIncompatible(t,e,n){return Dt(this,t,e,n),this}}const oe=Object.create(null);class re{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ie(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=m.empty){let n=e.content.lastChild,o=null;for(let s=0;s<e.openEnd;s++)o=n,n=n.lastChild;let r=t.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:l,$to:a}=i[s],c=t.mapping.slice(r);t.replaceRange(c.map(l.pos),c.map(a.pos),s?m.empty:e),0==s&&me(t,r,(n?n.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,o=this.ranges;for(let r=0;r<o.length;r++){let{$from:i,$to:s}=o[r],l=t.mapping.slice(n),a=l.map(i.pos),c=l.map(s.pos);r?t.deleteRange(a,c):(t.replaceRangeWith(a,c,e),me(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let o=t.parent.inlineContent?new ae(t):fe(t.node(0),t.parent,t.pos,t.index(),e,n);if(o)return o;for(let r=t.depth-1;r>=0;r--){let o=e<0?fe(t.node(0),t.node(r),t.before(r+1),t.index(r),e,n):fe(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,n);if(o)return o}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new ue(t.node(0))}static atStart(t){return fe(t,t,0,0,1)||new ue(t)}static atEnd(t){return fe(t,t,t.content.size,t.childCount,-1)||new ue(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=oe[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in oe)throw new RangeError("Duplicate use of selection JSON ID "+t);return oe[t]=e,e.prototype.jsonID=t,e}getBookmark(){return ae.between(this.$anchor,this.$head).getBookmark()}}re.prototype.visible=!0;class ie{constructor(t,e){this.$from=t,this.$to=e}}let se=!1;function le(t){se||t.parent.inlineContent||(se=!0)}class ae extends re{constructor(t,e=t){le(t),le(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return re.near(n);let o=t.resolve(e.map(this.anchor));return new ae(o.parent.inlineContent?o:n,n)}replace(t,e=m.empty){if(super.replace(t,e),e==m.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof ae&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new ce(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new ae(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let o=t.resolve(e);return new this(o,n==e?o:t.resolve(n))}static between(t,e,n){let o=t.pos-e.pos;if(n&&!o||(n=o>=0?1:-1),!e.parent.inlineContent){let t=re.findFrom(e,n,!0)||re.findFrom(e,-n,!0);if(!t)return re.near(e,n);e=t.$head}return t.parent.inlineContent||(0==o||(t=(re.findFrom(t,-n,!0)||re.findFrom(t,n,!0)).$anchor).pos<e.pos!=o<0)&&(t=e),new ae(t,e)}}re.jsonID("text",ae);class ce{constructor(t,e){this.anchor=t,this.head=e}map(t){return new ce(t.map(this.anchor),t.map(this.head))}resolve(t){return ae.between(t.resolve(this.anchor),t.resolve(this.head))}}class de extends re{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:o}=e.mapResult(this.anchor),r=t.resolve(o);return n?re.near(r):new de(r)}content(){return new m(c.from(this.node),0,0)}eq(t){return t instanceof de&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new he(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new de(t.resolve(e.anchor))}static create(t,e){return new de(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}de.prototype.visible=!1,re.jsonID("node",de);class he{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new ce(n,n):new he(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&de.isSelectable(n)?new de(e):re.near(e)}}class ue extends re{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=m.empty){if(e==m.empty){t.delete(0,t.doc.content.size);let e=re.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new ue(t)}map(t){return new ue(t)}eq(t){return t instanceof ue}getBookmark(){return pe}}re.jsonID("all",ue);const pe={map(){return this},resolve:t=>new ue(t)};function fe(t,e,n,o,r,i=!1){if(e.inlineContent)return ae.create(t,n);for(let s=o-(r>0?0:1);r>0?s<e.childCount:s>=0;s+=r){let o=e.child(s);if(o.isAtom){if(!i&&de.isSelectable(o))return de.create(t,n-(r<0?o.nodeSize:0))}else{let e=fe(t,o,n+r,r<0?o.childCount:0,r,i);if(e)return e}n+=o.nodeSize*r}return null}function me(t,e,n){let o=t.steps.length-1;if(o<e)return;let r,i=t.steps[o];(i instanceof Nt||i instanceof _t)&&(t.mapping.maps[o].forEach(((t,e,n,o)=>{null==r&&(r=o)})),t.setSelection(re.near(t.doc.resolve(r),n)))}let ge=class extends ne{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=2,this}ensureMarks(t){return p.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(t,e){super.addStep(t,e),this.updated=-3&this.updated,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||p.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let o=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(o.text(t),!0):this.deleteSelection();{if(null==n&&(n=e),n=null==n?e:n,!t)return this.deleteRange(e,n);let r=this.storedMarks;if(!r){let t=this.doc.resolve(e);r=n==e?t.marks():t.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,o.text(t,r)),this.selection.empty||this.setSelection(re.near(this.selection.$to)),this}}setMeta(t,e){return this.meta["string"==typeof t?t:t.key]=e,this}getMeta(t){return this.meta["string"==typeof t?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}};function ye(t,e){return e&&t?t.bind(e):t}class be{constructor(t,e,n){this.name=t,this.init=ye(e.init,n),this.apply=ye(e.apply,n)}}const we=[new be("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new be("selection",{init:(t,e)=>t.selection||re.atStart(e.doc),apply:t=>t.selection}),new be("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,o)=>o.selection.$cursor?t.storedMarks:null}),new be("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e})];class ve{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=we.slice(),e&&e.forEach((t=>{if(this.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");this.plugins.push(t),this.pluginsByKey[t.key]=t,t.spec.state&&this.fields.push(new be(t.key,t.spec.state,t))}))}}class ke{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let e=this.config.plugins[n];if(e.spec.filterTransaction&&!e.spec.filterTransaction.call(e,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),o=null;for(;;){let r=!1;for(let i=0;i<this.config.plugins.length;i++){let s=this.config.plugins[i];if(s.spec.appendTransaction){let l=o?o[i].n:0,a=o?o[i].state:this,c=l<e.length&&s.spec.appendTransaction.call(s,l?e.slice(l):e,a,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",t),!o){o=[];for(let t=0;t<this.config.plugins.length;t++)o.push(t<i?{state:n,n:e.length}:{state:this,n:0})}e.push(c),n=n.applyInner(c),r=!0}o&&(o[i]={state:n,n:e.length})}}if(!r)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new ke(this.config),n=this.config.fields;for(let o=0;o<n.length;o++){let r=n[o];e[r.name]=r.apply(t,this[r.name],this,e)}return e}get tr(){return new ge(this)}static create(t){let e=new ve(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new ke(e);for(let o=0;o<e.fields.length;o++)n[e.fields[o].name]=e.fields[o].init(t,n);return n}reconfigure(t){let e=new ve(this.schema,t.plugins),n=e.fields,o=new ke(e);for(let r=0;r<n.length;r++){let e=n[r].name;o[e]=this.hasOwnProperty(e)?this[e]:n[r].init(t,o)}return o}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((t=>t.toJSON()))),t&&"object"==typeof t)for(let n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let o=t[n],r=o.spec.state;r&&r.toJSON&&(e[n]=r.toJSON.call(o,this[o.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let o=new ve(t.schema,t.plugins),r=new ke(o);return o.fields.forEach((o=>{if("doc"==o.name)r.doc=D.fromJSON(t.schema,e.doc);else if("selection"==o.name)r.selection=re.fromJSON(r.doc,e.selection);else if("storedMarks"==o.name)e.storedMarks&&(r.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let i in n){let s=n[i],l=s.spec.state;if(s.key==o.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(e,i))return void(r[o.name]=l.fromJSON.call(s,t,e[i],r))}r[o.name]=o.init(t,r)}})),r}}function xe(t,e,n){for(let o in t){let r=t[o];r instanceof Function?r=r.bind(e):"handleDOMEvents"==o&&(r=xe(r,e,{})),n[o]=r}return n}class Ce{constructor(t){this.spec=t,this.props={},t.props&&xe(t.props,this,this.props),this.key=t.key?t.key.key:Me("plugin")}getState(t){return t[this.key]}}const Se=Object.create(null);function Me(t){return t in Se?t+"$"+ ++Se[t]:(Se[t]=0,t+"$")}class Ee{constructor(t="key"){this.key=Me(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const Te=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},Oe=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let Ae=null;const Ne=function(t,e,n){let o=Ae||(Ae=document.createRange());return o.setEnd(t,null==n?t.nodeValue.length:n),o.setStart(t,e||0),o},_e=function(t,e,n,o){return n&&(De(t,e,n,o,-1)||De(t,e,n,o,1))},Le=/^(img|br|input|textarea|hr)$/i;function De(t,e,n,o,r){for(;;){if(t==n&&e==o)return!0;if(e==(r<0?0:Re(t))){let n=t.parentNode;if(!n||1!=n.nodeType||Ie(t)||Le.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Te(t)+(r<0?0:1),t=n}else{if(1!=t.nodeType)return!1;if("false"==(t=t.childNodes[e+(r<0?-1:0)]).contentEditable)return!1;e=r<0?Re(t):0}}}function Re(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function Ie(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Pe=function(t){return t.focusNode&&_e(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function He(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const Ve="undefined"!=typeof navigator?navigator:null,Be="undefined"!=typeof document?document:null,je=Ve&&Ve.userAgent||"",ze=/Edge\/(\d+)/.exec(je),Fe=/MSIE \d/.exec(je),$e=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(je),Ue=!!(Fe||$e||ze),We=Fe?document.documentMode:$e?+$e[1]:ze?+ze[1]:0,qe=!Ue&&/gecko\/(\d+)/i.test(je);qe&&(/Firefox\/(\d+)/.exec(je)||[0,0])[1];const Je=!Ue&&/Chrome\/(\d+)/.exec(je),Ke=!!Je,Ze=Je?+Je[1]:0,Ge=!Ue&&!!Ve&&/Apple Computer/.test(Ve.vendor),Xe=Ge&&(/Mobile\/\w+/.test(je)||!!Ve&&Ve.maxTouchPoints>2),Ye=Xe||!!Ve&&/Mac/.test(Ve.platform),Qe=!!Ve&&/Win/.test(Ve.platform),tn=/Android \d/.test(je),en=!!Be&&"webkitFontSmoothing"in Be.documentElement.style,nn=en?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function on(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function rn(t,e){return"number"==typeof t?t:t[e]}function sn(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,o=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*o}}function ln(t,e,n){let o=t.someProp("scrollThreshold")||0,r=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let s=n||t.dom;s;s=Oe(s)){if(1!=s.nodeType)continue;let t=s,n=t==i.body,l=n?on(i):sn(t),a=0,c=0;if(e.top<l.top+rn(o,"top")?c=-(l.top-e.top+rn(r,"top")):e.bottom>l.bottom-rn(o,"bottom")&&(c=e.bottom-e.top>l.bottom-l.top?e.top+rn(r,"top")-l.top:e.bottom-l.bottom+rn(r,"bottom")),e.left<l.left+rn(o,"left")?a=-(l.left-e.left+rn(r,"left")):e.right>l.right-rn(o,"right")&&(a=e.right-l.right+rn(r,"right")),a||c)if(n)i.defaultView.scrollBy(a,c);else{let n=t.scrollLeft,o=t.scrollTop;c&&(t.scrollTop+=c),a&&(t.scrollLeft+=a);let r=t.scrollLeft-n,i=t.scrollTop-o;e={left:e.left-r,top:e.top-i,right:e.right-r,bottom:e.bottom-i}}if(n||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}function an(t){let e=[],n=t.ownerDocument;for(let o=t;o&&(e.push({dom:o,top:o.scrollTop,left:o.scrollLeft}),t!=n);o=Oe(o));return e}function cn(t,e){for(let n=0;n<t.length;n++){let{dom:o,top:r,left:i}=t[n];o.scrollTop!=r+e&&(o.scrollTop=r+e),o.scrollLeft!=i&&(o.scrollLeft=i)}}let dn=null;function hn(t,e){let n,o,r,i,s=2e8,l=0,a=e.top,c=e.top;for(let d=t.firstChild,h=0;d;d=d.nextSibling,h++){let t;if(1==d.nodeType)t=d.getClientRects();else{if(3!=d.nodeType)continue;t=Ne(d).getClientRects()}for(let u=0;u<t.length;u++){let p=t[u];if(p.top<=a&&p.bottom>=c){a=Math.max(p.bottom,a),c=Math.min(p.top,c);let t=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(t<s){n=d,s=t,o=t&&3==n.nodeType?{left:p.right<e.left?p.right:p.left,top:e.top}:e,1==d.nodeType&&t&&(l=h+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!r&&p.left<=e.left&&p.right>=e.left&&(r=d,i={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(l=h+1)}}return!n&&r&&(n=r,o=i,s=0),n&&3==n.nodeType?function(t,e){let n=t.nodeValue.length,o=document.createRange();for(let r=0;r<n;r++){o.setEnd(t,r+1),o.setStart(t,r);let n=gn(o,1);if(n.top!=n.bottom&&un(e,n))return{node:t,offset:r+(e.left>=(n.left+n.right)/2?1:0)}}return{node:t,offset:0}}(n,o):!n||s&&1==n.nodeType?{node:t,offset:l}:hn(n,o)}function un(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function pn(t,e,n){let o=t.childNodes.length;if(o&&n.top<n.bottom)for(let r=Math.max(0,Math.min(o-1,Math.floor(o*(e.top-n.top)/(n.bottom-n.top))-2)),i=r;;){let n=t.childNodes[i];if(1==n.nodeType){let t=n.getClientRects();for(let o=0;o<t.length;o++){let r=t[o];if(un(e,r))return pn(n,e,r)}}if((i=(i+1)%o)==r)break}return t}function fn(t,e){let n,o=t.dom.ownerDocument,r=0,i=function(t,e,n){if(t.caretPositionFromPoint)try{let o=t.caretPositionFromPoint(e,n);if(o)return{node:o.offsetNode,offset:Math.min(Re(o.offsetNode),o.offset)}}catch(Tg){}if(t.caretRangeFromPoint){let o=t.caretRangeFromPoint(e,n);if(o)return{node:o.startContainer,offset:Math.min(Re(o.startContainer),o.startOffset)}}}(o,e.left,e.top);i&&({node:n,offset:r}=i);let s,l=(t.root.elementFromPoint?t.root:o).elementFromPoint(e.left,e.top);if(!l||!t.dom.contains(1!=l.nodeType?l.parentNode:l)){let n=t.dom.getBoundingClientRect();if(!un(e,n))return null;if(l=pn(t.dom,e,n),!l)return null}if(Ge)for(let c=l;n&&c;c=Oe(c))c.draggable&&(n=void 0);if(l=function(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(l,e),n){if(qe&&1==n.nodeType&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let t,o=n.childNodes[r];"IMG"==o.nodeName&&(t=o.getBoundingClientRect()).right<=e.left&&t.bottom>e.top&&r++}let o;en&&r&&1==n.nodeType&&1==(o=n.childNodes[r-1]).nodeType&&"false"==o.contentEditable&&o.getBoundingClientRect().top>=e.top&&r--,n==t.dom&&r==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:0!=r&&1==n.nodeType&&"BR"==n.childNodes[r-1].nodeName||(s=function(t,e,n,o){let r=-1;for(let i=e,s=!1;i!=t.dom;){let e=t.docView.nearestDesc(i,!0);if(!e)return null;if(1==e.dom.nodeType&&(e.node.isBlock&&e.parent||!e.contentDOM)){let t=e.dom.getBoundingClientRect();if(e.node.isBlock&&e.parent&&(!s&&t.left>o.left||t.top>o.top?r=e.posBefore:(!s&&t.right<o.left||t.bottom<o.top)&&(r=e.posAfter),s=!0),!e.contentDOM&&r<0&&!e.node.isText)return(e.node.isBlock?o.top<(t.top+t.bottom)/2:o.left<(t.left+t.right)/2)?e.posBefore:e.posAfter}i=e.dom.parentNode}return r>-1?r:t.docView.posFromDOM(e,n,-1)}(t,n,r,e))}null==s&&(s=function(t,e,n){let{node:o,offset:r}=hn(e,n),i=-1;if(1==o.nodeType&&!o.firstChild){let t=o.getBoundingClientRect();i=t.left!=t.right&&n.left>(t.left+t.right)/2?1:-1}return t.docView.posFromDOM(o,r,i)}(t,l,e));let a=t.docView.nearestDesc(l,!0);return{pos:s,inside:a?a.posAtStart-a.border:-1}}function mn(t){return t.top<t.bottom||t.left<t.right}function gn(t,e){let n=t.getClientRects();if(n.length){let t=n[e<0?0:n.length-1];if(mn(t))return t}return Array.prototype.find.call(n,mn)||t.getBoundingClientRect()}const yn=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function bn(t,e,n){let{node:o,offset:r,atom:i}=t.docView.domFromPos(e,n<0?-1:1),s=en||qe;if(3==o.nodeType){if(!s||!yn.test(o.nodeValue)&&(n<0?r:r!=o.nodeValue.length)){let t=r,e=r,i=n<0?1:-1;return n<0&&!r?(e++,i=-1):n>=0&&r==o.nodeValue.length?(t--,i=1):n<0?t--:e++,wn(gn(Ne(o,t,e),i),i<0)}{let t=gn(Ne(o,r,r),n);if(qe&&r&&/\s/.test(o.nodeValue[r-1])&&r<o.nodeValue.length){let e=gn(Ne(o,r-1,r-1),-1);if(e.top==t.top){let n=gn(Ne(o,r,r+1),-1);if(n.top!=t.top)return wn(n,n.left<e.left)}}return t}}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(null==i&&r&&(n<0||r==Re(o))){let t=o.childNodes[r-1];if(1==t.nodeType)return vn(t.getBoundingClientRect(),!1)}if(null==i&&r<Re(o)){let t=o.childNodes[r];if(1==t.nodeType)return vn(t.getBoundingClientRect(),!0)}return vn(o.getBoundingClientRect(),n>=0)}if(null==i&&r&&(n<0||r==Re(o))){let t=o.childNodes[r-1],e=3==t.nodeType?Ne(t,Re(t)-(s?0:1)):1!=t.nodeType||"BR"==t.nodeName&&t.nextSibling?null:t;if(e)return wn(gn(e,1),!1)}if(null==i&&r<Re(o)){let t=o.childNodes[r];for(;t.pmViewDesc&&t.pmViewDesc.ignoreForCoords;)t=t.nextSibling;let e=t?3==t.nodeType?Ne(t,0,s?0:1):1==t.nodeType?t:null:null;if(e)return wn(gn(e,-1),!0)}return wn(gn(3==o.nodeType?Ne(o):o,-n),n>=0)}function wn(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function vn(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function kn(t,e,n){let o=t.state,r=t.root.activeElement;o!=e&&t.updateState(e),r!=t.dom&&t.focus();try{return n()}finally{o!=e&&t.updateState(o),r!=t.dom&&r&&r.focus()}}const xn=/[\u0590-\u08ac]/;let Cn=null,Sn=null,Mn=!1;function En(t,e,n){return Cn==e&&Sn==n?Mn:(Cn=e,Sn=n,Mn="up"==n||"down"==n?function(t,e,n){let o=e.selection,r="up"==n?o.$from:o.$to;return kn(t,e,(()=>{let{node:e}=t.docView.domFromPos(r.pos,"up"==n?-1:1);for(;;){let n=t.docView.nearestDesc(e,!0);if(!n)break;if(n.node.isBlock){e=n.contentDOM||n.dom;break}e=n.dom.parentNode}let o=bn(t,r.pos,1);for(let t=e.firstChild;t;t=t.nextSibling){let e;if(1==t.nodeType)e=t.getClientRects();else{if(3!=t.nodeType)continue;e=Ne(t,0,t.nodeValue.length).getClientRects()}for(let t=0;t<e.length;t++){let r=e[t];if(r.bottom>r.top+1&&("up"==n?o.top-r.top>2*(r.bottom-o.top):r.bottom-o.bottom>2*(o.bottom-r.top)))return!1}}return!0}))}(t,e,n):function(t,e,n){let{$head:o}=e.selection;if(!o.parent.isTextblock)return!1;let r=o.parentOffset,i=!r,s=r==o.parent.content.size,l=t.domSelection();return l?xn.test(o.parent.textContent)&&l.modify?kn(t,e,(()=>{let{focusNode:e,focusOffset:r,anchorNode:i,anchorOffset:s}=t.domSelectionRange(),a=l.caretBidiLevel;l.modify("move",n,"character");let c=o.depth?t.docView.domAfterPos(o.before()):t.dom,{focusNode:d,focusOffset:h}=t.domSelectionRange(),u=d&&!c.contains(1==d.nodeType?d:d.parentNode)||e==d&&r==h;try{l.collapse(i,s),e&&(e!=i||r!=s)&&l.extend&&l.extend(e,r)}catch(Tg){}return null!=a&&(l.caretBidiLevel=a),u})):"left"==n||"backward"==n?i:s:o.pos==o.start()||o.pos==o.end()}(t,e,n))}class Tn{constructor(t,e,n,o){this.parent=t,this.children=e,this.dom=n,this.contentDOM=o,this.dirty=0,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let o=this.children[e];if(o==t)return n;n+=o.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){let n,o;if(t==this.contentDOM)n=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.previousSibling}for(;n&&(!(o=n.pmViewDesc)||o.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(o)+o.size:this.posAtStart}{let n,o;if(t==this.contentDOM)n=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.nextSibling}for(;n&&(!(o=n.pmViewDesc)||o.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(o):this.posAtEnd}}let o;if(t==this.dom&&this.contentDOM)o=e>Te(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))o=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(let e=t;;e=e.parentNode){if(e==this.dom){o=!1;break}if(e.previousSibling)break}if(null==o&&e==t.childNodes.length)for(let e=t;;e=e.parentNode){if(e==this.dom){o=!0;break}if(e.nextSibling)break}}return(null==o?n>0:o)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,o=t;o;o=o.parentNode){let r,i=this.getDesc(o);if(i&&(!e||i.node)){if(!n||!(r=i.nodeDOM)||(1==r.nodeType?r.contains(1==t.nodeType?t:t.parentNode):r==t))return i;n=!1}}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let o=t;o;o=o.parentNode){let r=this.getDesc(o);if(r)return r.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let o=this.children[e],r=n+o.size;if(n==t&&r!=n){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(t<r)return o.descAt(t-n-o.border);n=r}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,o=0;for(let r=0;n<this.children.length;n++){let e=this.children[n],i=r+e.size;if(i>t||e instanceof Rn){o=t-r;break}r=i}if(o)return this.children[n].domFromPos(o-this.children[n].border,e);for(let r;n&&!(r=this.children[n-1]).size&&r instanceof On&&r.side>=0;n--);if(e<=0){let t,o=!0;for(;t=n?this.children[n-1]:null,t&&t.dom.parentNode!=this.contentDOM;n--,o=!1);return t&&e&&o&&!t.border&&!t.domAtom?t.domFromPos(t.size,e):{node:this.contentDOM,offset:t?Te(t.dom)+1:0}}{let t,o=!0;for(;t=n<this.children.length?this.children[n]:null,t&&t.dom.parentNode!=this.contentDOM;n++,o=!1);return t&&o&&!t.border&&!t.domAtom?t.domFromPos(0,e):{node:this.contentDOM,offset:t?Te(t.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let o=-1,r=-1;for(let i=n,s=0;;s++){let n=this.children[s],l=i+n.size;if(-1==o&&t<=l){let r=i+n.border;if(t>=r&&e<=l-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(t,e,r);t=i;for(let e=s;e>0;e--){let n=this.children[e-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){o=Te(n.dom)+1;break}t-=n.size}-1==o&&(o=0)}if(o>-1&&(l>e||s==this.children.length-1)){e=l;for(let t=s+1;t<this.children.length;t++){let n=this.children[t];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){r=Te(n.dom);break}e+=n.size}-1==r&&(r=this.contentDOM.childNodes.length);break}i=l}return{node:this.contentDOM,from:t,to:e,fromOffset:o,toOffset:r}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(1!=e.nodeType||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,o=!1){let r=Math.min(t,e),i=Math.max(t,e);for(let h=0,u=0;h<this.children.length;h++){let s=this.children[h],l=u+s.size;if(r>u&&i<l)return s.setSelection(t-u-s.border,e-u-s.border,n,o);u=l}let s=this.domFromPos(t,t?-1:1),l=e==t?s:this.domFromPos(e,e?-1:1),a=n.getSelection(),c=!1;if((qe||Ge)&&t==e){let{node:t,offset:e}=s;if(3==t.nodeType){if(c=!(!e||"\n"!=t.nodeValue[e-1]),c&&e==t.nodeValue.length)for(let n,o=t;o;o=o.parentNode){if(n=o.nextSibling){"BR"==n.nodeName&&(s=l={node:n.parentNode,offset:Te(n)+1});break}let t=o.pmViewDesc;if(t&&t.node&&t.node.isBlock)break}}else{let n=t.childNodes[e-1];c=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(qe&&a.focusNode&&a.focusNode!=l.node&&1==a.focusNode.nodeType){let t=a.focusNode.childNodes[a.focusOffset];t&&"false"==t.contentEditable&&(o=!0)}if(!(o||c&&Ge)&&_e(s.node,s.offset,a.anchorNode,a.anchorOffset)&&_e(l.node,l.offset,a.focusNode,a.focusOffset))return;let d=!1;if((a.extend||t==e)&&!c){a.collapse(s.node,s.offset);try{t!=e&&a.extend(l.node,l.offset),d=!0}catch(Tg){}}if(!d){if(t>e){let t=s;s=l,l=t}let n=document.createRange();n.setEnd(l.node,l.offset),n.setStart(s.node,s.offset),a.removeAllRanges(),a.addRange(n)}}ignoreMutation(t){return!this.contentDOM&&"selection"!=t.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,o=0;o<this.children.length;o++){let r=this.children[o],i=n+r.size;if(n==i?t<=i&&e>=n:t<i&&e>n){let o=n+r.border,s=i-r.border;if(t>=o&&e<=s)return this.dirty=t==n||e==i?2:1,void(t!=o||e!=s||!r.contentLost&&r.dom.parentNode==this.contentDOM?r.markDirty(t-o,e-o):r.dirty=3);r.dirty=r.dom!=r.contentDOM||r.dom.parentNode!=this.contentDOM||r.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=1==t?2:1;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(t){return!1}}class On extends Tn{constructor(t,e,n,o){let r,i=e.type.toDOM;if("function"==typeof i&&(i=i(n,(()=>r?r.parent?r.parent.posBeforeChild(r):void 0:o))),!e.type.spec.raw){if(1!=i.nodeType){let t=document.createElement("span");t.appendChild(i),i=t}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(t,[],i,null),this.widget=e,this.widget=e,r=this}matchesWidget(t){return 0==this.dirty&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return!!e&&e(t)}ignoreMutation(t){return"selection"!=t.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class An extends Tn{constructor(t,e,n,o){super(t,[],e,null),this.textDOM=n,this.text=o}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue}}class Nn extends Tn{constructor(t,e,n,o){super(t,[],n,o),this.mark=e}static create(t,e,n,o){let r=o.nodeViews[e.type.name],i=r&&r(e,o,n);return i&&i.dom||(i=dt.renderSpec(document,e.type.spec.toDOM(e,n),null,e.attrs)),new Nn(t,e,i.dom,i.contentDOM||i.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return 3!=this.dirty&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),0!=this.dirty){let t=this.parent;for(;!t.node;)t=t.parent;t.dirty<this.dirty&&(t.dirty=this.dirty),this.dirty=0}}slice(t,e,n){let o=Nn.create(this.parent,this.mark,!0,n),r=this.children,i=this.size;e<i&&(r=Jn(r,e,i,n)),t>0&&(r=Jn(r,0,t,n));for(let s=0;s<r.length;s++)r[s].parent=o;return o.children=r,o}}class _n extends Tn{constructor(t,e,n,o,r,i,s,l,a){super(t,[],r,i),this.node=e,this.outerDeco=n,this.innerDeco=o,this.nodeDOM=s}static create(t,e,n,o,r,i){let s,l=r.nodeViews[e.type.name],a=l&&l(e,r,(()=>s?s.parent?s.parent.posBeforeChild(s):void 0:i),n,o),c=a&&a.dom,d=a&&a.contentDOM;if(e.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(e.text);else if(!c){let t=dt.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs);({dom:c,contentDOM:d}=t)}d||e.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),e.type.spec.draggable&&(c.draggable=!0));let h=c;return c=Fn(c,n,e),a?s=new In(t,e,n,o,c,d||null,h,a,r,i+1):e.isText?new Dn(t,e,n,o,c,h,r):new _n(t,e,n,o,c,d||null,h,r,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(t.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>c.empty)}else t.contentElement=this.contentDOM;else t.getContent=()=>this.node.content;return t}matchesNode(t,e,n){return 0==this.dirty&&t.eq(this.node)&&$n(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,o=e,r=t.composing?this.localCompositionInfo(t,e):null,i=r&&r.pos>-1?r:null,s=r&&r.pos<0,l=new Wn(this,i&&i.node,t);!function(t,e,n,o){let r=e.locals(t),i=0;if(0==r.length){for(let n=0;n<t.childCount;n++){let s=t.child(n);o(s,r,e.forChild(i,s),n),i+=s.nodeSize}return}let s=0,l=[],a=null;for(let c=0;;){let d,h,u,p;for(;s<r.length&&r[s].to==i;){let t=r[s++];t.widget&&(d?(h||(h=[d])).push(t):d=t)}if(d)if(h){h.sort(qn);for(let t=0;t<h.length;t++)n(h[t],c,!!a)}else n(d,c,!!a);if(a)p=-1,u=a,a=null;else{if(!(c<t.childCount))break;p=c,u=t.child(c++)}for(let t=0;t<l.length;t++)l[t].to<=i&&l.splice(t--,1);for(;s<r.length&&r[s].from<=i&&r[s].to>i;)l.push(r[s++]);let f=i+u.nodeSize;if(u.isText){let t=f;s<r.length&&r[s].from<t&&(t=r[s].from);for(let e=0;e<l.length;e++)l[e].to<t&&(t=l[e].to);t<f&&(a=u.cut(t-i),u=u.cut(0,t-i),f=t,p=-1)}else for(;s<r.length&&r[s].to<f;)s++;o(u,u.isInline&&!u.isLeaf?l.filter((t=>!t.inline)):l.slice(),e.forChild(i,u),p),i=f}}(this.node,this.innerDeco,((e,r,i)=>{e.spec.marks?l.syncToMarks(e.spec.marks,n,t):e.type.side>=0&&!i&&l.syncToMarks(r==this.node.childCount?p.none:this.node.child(r).marks,n,t),l.placeWidget(e,t,o)}),((e,i,a,c)=>{let d;l.syncToMarks(e.marks,n,t),l.findNodeMatch(e,i,a,c)||s&&t.state.selection.from>o&&t.state.selection.to<o+e.nodeSize&&(d=l.findIndexWithChild(r.node))>-1&&l.updateNodeAt(e,i,a,d,t)||l.updateNextNode(e,i,a,t,c,o)||l.addNode(e,i,a,t,o),o+=e.nodeSize})),l.syncToMarks([],n,t),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||2==this.dirty)&&(i&&this.protectLocalComposition(t,i),Pn(this.contentDOM,this.children,t),Xe&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom))}localCompositionInfo(t,e){let{from:n,to:o}=t.state.selection;if(!(t.state.selection instanceof ae)||n<e||o>e+this.node.content.size)return null;let r=t.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let t=r.nodeValue,i=function(t,e,n,o){for(let r=0,i=0;r<t.childCount&&i<=o;){let s=t.child(r++),l=i;if(i+=s.nodeSize,!s.isText)continue;let a=s.text;for(;r<t.childCount;){let e=t.child(r++);if(i+=e.nodeSize,!e.isText)break;a+=e.text}if(i>=n){if(i>=o&&a.slice(o-e.length-l,o-l)==e)return o-e.length;let t=l<o?a.lastIndexOf(e,o-l-1):-1;if(t>=0&&t+e.length+l>=n)return l+t;if(n==o&&a.length>=o+e.length-l&&a.slice(o-l,o-l+e.length)==e)return o}}return-1}(this.node.content,t,n-e,o-e);return i<0?null:{node:r,pos:i,text:t}}return{node:r,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:o}){if(this.getDesc(e))return;let r=e;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let i=new An(this,r,e,o);t.input.compositionNodes.push(i),this.children=Jn(this.children,n,n+o.length,t,i)}update(t,e,n,o){return!(3==this.dirty||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,o),!0)}updateInner(t,e,n,o){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(o,this.posAtStart),this.dirty=0}updateOuterDeco(t){if($n(t,this.outerDeco))return;let e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=jn(this.dom,this.nodeDOM,Bn(this.outerDeco,this.node,e),Bn(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Ln(t,e,n,o,r){Fn(o,e,t);let i=new _n(void 0,t,e,n,o,o,o,r,0);return i.contentDOM&&i.updateChildren(r,0),i}class Dn extends _n{constructor(t,e,n,o,r,i,s){super(t,e,n,o,r,null,i,s,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,o){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,o.trackWrites==this.nodeDOM&&(o.trackWrites=null)),this.node=t,this.dirty=0,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return"characterData"!=t.type&&"selection"!=t.type}slice(t,e,n){let o=this.node.cut(t,e),r=document.createTextNode(o.text);return new Dn(this.parent,o,this.outerDeco,this.innerDeco,r,r,n)}markDirty(t,e){super.markDirty(t,e),this.dom==this.nodeDOM||0!=t&&e!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(t){return this.node.text==t}}class Rn extends Tn{parseRule(){return{ignore:!0}}matchesHack(t){return 0==this.dirty&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class In extends _n{constructor(t,e,n,o,r,i,s,l,a,c){super(t,e,n,o,r,i,s,a,c),this.spec=l}update(t,e,n,o){if(3==this.dirty)return!1;if(this.spec.update){let r=this.spec.update(t,e,n);return r&&this.updateInner(t,e,n,o),r}return!(!this.contentDOM&&!t.isLeaf)&&super.update(t,e,n,o)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,o){this.spec.setSelection?this.spec.setSelection(t,e,n):super.setSelection(t,e,n,o)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function Pn(t,e,n){let o=t.firstChild,r=!1;for(let i=0;i<e.length;i++){let s=e[i],l=s.dom;if(l.parentNode==t){for(;l!=o;)o=Un(o),r=!0;o=o.nextSibling}else r=!0,t.insertBefore(l,o);if(s instanceof Nn){let e=o?o.previousSibling:t.lastChild;Pn(s.contentDOM,s.children,n),o=e?e.nextSibling:t.firstChild}}for(;o;)o=Un(o),r=!0;r&&n.trackWrites==t&&(n.trackWrites=null)}const Hn=function(t){t&&(this.nodeName=t)};Hn.prototype=Object.create(null);const Vn=[new Hn];function Bn(t,e,n){if(0==t.length)return Vn;let o=n?Vn[0]:new Hn,r=[o];for(let i=0;i<t.length;i++){let s=t[i].type.attrs;if(s){s.nodeName&&r.push(o=new Hn(s.nodeName));for(let t in s){let i=s[t];null!=i&&(n&&1==r.length&&r.push(o=new Hn(e.isInline?"span":"div")),"class"==t?o.class=(o.class?o.class+" ":"")+i:"style"==t?o.style=(o.style?o.style+";":"")+i:"nodeName"!=t&&(o[t]=i))}}}return r}function jn(t,e,n,o){if(n==Vn&&o==Vn)return e;let r=e;for(let i=0;i<o.length;i++){let e=o[i],s=n[i];if(i){let n;s&&s.nodeName==e.nodeName&&r!=t&&(n=r.parentNode)&&n.nodeName.toLowerCase()==e.nodeName||(n=document.createElement(e.nodeName),n.pmIsDeco=!0,n.appendChild(r),s=Vn[0]),r=n}zn(r,s||Vn[0],e)}return r}function zn(t,e,n){for(let o in e)"class"==o||"style"==o||"nodeName"==o||o in n||t.removeAttribute(o);for(let o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){let o=e.class?e.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let e=0;e<o.length;e++)-1==r.indexOf(o[e])&&t.classList.remove(o[e]);for(let e=0;e<r.length;e++)-1==o.indexOf(r[e])&&t.classList.add(r[e]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let n,o=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=o.exec(e.style);)t.style.removeProperty(n[1])}n.style&&(t.style.cssText+=n.style)}}function Fn(t,e,n){return jn(t,t,Vn,Bn(e,n,1!=t.nodeType))}function $n(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Un(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Wn{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=function(t,e){let n=e,o=n.children.length,r=t.childCount,i=new Map,s=[];t:for(;r>0;){let l;for(;;)if(o){let t=n.children[o-1];if(!(t instanceof Nn)){l=t,o--;break}n=t,o=t.children.length}else{if(n==e)break t;o=n.parent.children.indexOf(n),n=n.parent}let a=l.node;if(a){if(a!=t.child(r-1))break;--r,i.set(l,r),s.push(l)}}return{index:r,matched:i,matches:s.reverse()}}(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let o=0,r=this.stack.length>>1,i=Math.min(r,t.length);for(;o<i&&(o==r-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&!1!==t[o].type.spec.spanning;)o++;for(;o<r;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),r--;for(;r<t.length;){this.stack.push(this.top,this.index+1);let o=-1;for(let e=this.index;e<Math.min(this.index+3,this.top.children.length);e++){let n=this.top.children[e];if(n.matchesMark(t[r])&&!this.isLocked(n.dom)){o=e;break}}if(o>-1)o>this.index&&(this.changed=!0,this.destroyBetween(this.index,o)),this.top=this.top.children[this.index];else{let o=Nn.create(this.top,t[r],e,n);this.top.children.splice(this.index,0,o),this.top=o,this.changed=!0}this.index=0,r++}}findNodeMatch(t,e,n,o){let r,i=-1;if(o>=this.preMatch.index&&(r=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&r.matchesNode(t,e,n))i=this.top.children.indexOf(r,this.index);else for(let s=this.index,l=Math.min(this.top.children.length,s+5);s<l;s++){let o=this.top.children[s];if(o.matchesNode(t,e,n)&&!this.preMatch.matched.has(o)){i=s;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(t,e,n,o,r){let i=this.top.children[o];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(t,e,n,r)&&(this.destroyBetween(this.index,o),this.index++,!0)}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let e=t.pmViewDesc;if(e)for(let t=this.index;t<this.top.children.length;t++)if(this.top.children[t]==e)return t;return-1}t=e}}updateNextNode(t,e,n,o,r,i){for(let s=this.index;s<this.top.children.length;s++){let l=this.top.children[s];if(l instanceof _n){let a=this.preMatch.matched.get(l);if(null!=a&&a!=r)return!1;let c,d=l.dom,h=this.isLocked(d)&&!(t.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==t.text&&3!=l.dirty&&$n(e,l.outerDeco));if(!h&&l.update(t,e,n,o))return this.destroyBetween(this.index,s),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(c=this.recreateWrapper(l,t,e,n,o,i)))return this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(o,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,o,r,i){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content))return null;let s=_n.create(this.top,e,n,o,r,i);if(s.contentDOM){s.children=t.children,t.children=[];for(let t of s.children)t.parent=s}return t.destroy(),s}addNode(t,e,n,o,r){let i=_n.create(this.top,t,e,n,o,r);i.contentDOM&&i.updateChildren(o,r+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(t,e,n){let o=this.index<this.top.children.length?this.top.children[this.index]:null;if(!o||!o.matchesWidget(t)||t!=o.widget&&o.widget.type.toDOM.parentNode){let o=new On(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof Nn;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof Dn)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Ge||Ke)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");let o=new Rn(this.top,[],n,null);e!=this.top?e.children.push(o):e.children.splice(this.index++,0,o),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))}}function qn(t,e){return t.type.side-e.type.side}function Jn(t,e,n,o,r){let i=[];for(let s=0,l=0;s<t.length;s++){let a=t[s],c=l,d=l+=a.size;c>=n||d<=e?i.push(a):(c<e&&i.push(a.slice(0,e-c,o)),r&&(i.push(r),r=void 0),d>n&&i.push(a.slice(n-c,a.size,o)))}return i}function Kn(t,e=null){let n=t.domSelectionRange(),o=t.state.doc;if(!n.focusNode)return null;let r=t.docView.nearestDesc(n.focusNode),i=r&&0==r.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let l,a,c=o.resolve(s);if(Pe(n)){for(l=c;r&&!r.node;)r=r.parent;let t=r.node;if(r&&t.isAtom&&de.isSelectable(t)&&r.parent&&(!t.isInline||!function(t,e,n){for(let o=0==e,r=e==Re(t);o||r;){if(t==n)return!0;let e=Te(t);if(!(t=t.parentNode))return!1;o=o&&0==e,r=r&&e==Re(t)}}(n.focusNode,n.focusOffset,r.dom))){let t=r.posBefore;a=new de(s==t?c:o.resolve(t))}}else{let e=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(e<0)return null;l=o.resolve(e)}if(!a){a=oo(t,l,c,"pointer"==e||t.state.selection.head<c.pos&&!i?1:-1)}return a}function Zn(t){return t.editable?t.hasFocus():io(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Gn(t,e=!1){let n=t.state.selection;if(eo(t,n),Zn(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Ke){let e=t.domSelectionRange(),n=t.domObserver.currentSelection;if(e.anchorNode&&n.anchorNode&&_e(e.anchorNode,e.anchorOffset,n.anchorNode,n.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let o=t.cursorWrapper.dom,r="IMG"==o.nodeName;r?n.setStart(o.parentNode,Te(o)+1):n.setStart(o,0);n.collapse(!0),e.removeAllRanges(),e.addRange(n),!r&&!t.state.selection.visible&&Ue&&We<=11&&(o.disabled=!0,o.disabled=!1)}(t);else{let o,r,{anchor:i,head:s}=n;!Xn||n instanceof ae||(n.$from.parent.inlineContent||(o=Yn(t,n.from)),n.empty||n.$from.parent.inlineContent||(r=Yn(t,n.to))),t.docView.setSelection(i,s,t.root,e),Xn&&(o&&to(o),r&&to(r)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),o=n.anchorNode,r=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{n.anchorNode==o&&n.anchorOffset==r||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout((()=>{Zn(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")}),20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Xn=Ge||Ke&&Ze<63;function Yn(t,e){let{node:n,offset:o}=t.docView.domFromPos(e,0),r=o<n.childNodes.length?n.childNodes[o]:null,i=o?n.childNodes[o-1]:null;if(Ge&&r&&"false"==r.contentEditable)return Qn(r);if(!(r&&"false"!=r.contentEditable||i&&"false"!=i.contentEditable)){if(r)return Qn(r);if(i)return Qn(i)}}function Qn(t){return t.contentEditable="true",Ge&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function to(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function eo(t,e){if(e instanceof de){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(no(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else no(t)}function no(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function oo(t,e,n,o){return t.someProp("createSelectionBetween",(o=>o(t,e,n)))||ae.between(e,n,o)}function ro(t){return!(t.editable&&!t.hasFocus())&&io(t)}function io(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(Tg){return!1}}function so(t,e){let{$anchor:n,$head:o}=t.selection,r=e>0?n.max(o):n.min(o),i=r.parent.inlineContent?r.depth?t.doc.resolve(e>0?r.after():r.before()):null:r;return i&&re.findFrom(i,e)}function lo(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ao(t,e,n){let o=t.state.selection;if(!(o instanceof ae)){if(o instanceof de&&o.node.isInline)return lo(t,new ae(e>0?o.$to:o.$from));{let n=so(t.state,e);return!!n&&lo(t,n)}}if(n.indexOf("s")>-1){let{$head:n}=o,r=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let i=t.state.doc.resolve(n.pos+r.nodeSize*(e<0?-1:1));return lo(t,new ae(o.$anchor,i))}if(!o.empty)return!1;if(t.endOfTextblock(e>0?"forward":"backward")){let n=so(t.state,e);return!!(n&&n instanceof de)&&lo(t,n)}if(!(Ye&&n.indexOf("m")>-1)){let n,r=o.$head,i=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter;if(!i||i.isText)return!1;let s=e<0?r.pos-i.nodeSize:r.pos;return!!(i.isAtom||(n=t.docView.descAt(s))&&!n.contentDOM)&&(de.isSelectable(i)?lo(t,new de(e<0?t.state.doc.resolve(r.pos-i.nodeSize):r)):!!en&&lo(t,new ae(t.state.doc.resolve(e<0?s:s+i.nodeSize))))}}function co(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function ho(t,e){let n=t.pmViewDesc;return n&&0==n.size&&(e<0||t.nextSibling||"BR"!=t.nodeName)}function uo(t,e){return e<0?function(t){let e=t.domSelectionRange(),n=e.focusNode,o=e.focusOffset;if(!n)return;let r,i,s=!1;qe&&1==n.nodeType&&o<co(n)&&ho(n.childNodes[o],-1)&&(s=!0);for(;;)if(o>0){if(1!=n.nodeType)break;{let t=n.childNodes[o-1];if(ho(t,-1))r=n,i=--o;else{if(3!=t.nodeType)break;n=t,o=n.nodeValue.length}}}else{if(po(n))break;{let e=n.previousSibling;for(;e&&ho(e,-1);)r=n.parentNode,i=Te(e),e=e.previousSibling;if(e)n=e,o=co(n);else{if(n=n.parentNode,n==t.dom)break;o=0}}}s?fo(t,n,o):r&&fo(t,r,i)}(t):function(t){let e=t.domSelectionRange(),n=e.focusNode,o=e.focusOffset;if(!n)return;let r,i,s=co(n);for(;;)if(o<s){if(1!=n.nodeType)break;if(!ho(n.childNodes[o],1))break;r=n,i=++o}else{if(po(n))break;{let e=n.nextSibling;for(;e&&ho(e,1);)r=e.parentNode,i=Te(e)+1,e=e.nextSibling;if(e)n=e,o=0,s=co(n);else{if(n=n.parentNode,n==t.dom)break;o=s=0}}}r&&fo(t,r,i)}(t)}function po(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function fo(t,e,n){if(3!=e.nodeType){let t,o;(o=function(t,e){for(;t&&e==t.childNodes.length&&!Ie(t);)e=Te(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=n,e=0}}(e,n))?(e=o,n=0):(t=function(t,e){for(;t&&!e&&!Ie(t);)e=Te(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=(t=n).childNodes.length}}(e,n))&&(e=t,n=t.nodeValue.length)}let o=t.domSelection();if(!o)return;if(Pe(o)){let t=document.createRange();t.setEnd(e,n),t.setStart(e,n),o.removeAllRanges(),o.addRange(t)}else o.extend&&o.extend(e,n);t.domObserver.setCurSelection();let{state:r}=t;setTimeout((()=>{t.state==r&&Gn(t)}),50)}function mo(t,e){let n=t.state.doc.resolve(e);if(!Ke&&!Qe&&n.parent.inlineContent){let o=t.coordsAtPos(e);if(e>n.start()){let n=t.coordsAtPos(e-1),r=(n.top+n.bottom)/2;if(r>o.top&&r<o.bottom&&Math.abs(n.left-o.left)>1)return n.left<o.left?"ltr":"rtl"}if(e<n.end()){let n=t.coordsAtPos(e+1),r=(n.top+n.bottom)/2;if(r>o.top&&r<o.bottom&&Math.abs(n.left-o.left)>1)return n.left>o.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(t.dom).direction?"rtl":"ltr"}function go(t,e,n){let o=t.state.selection;if(o instanceof ae&&!o.empty||n.indexOf("s")>-1)return!1;if(Ye&&n.indexOf("m")>-1)return!1;let{$from:r,$to:i}=o;if(!r.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let n=so(t.state,e);if(n&&n instanceof de)return lo(t,n)}if(!r.parent.inlineContent){let n=e<0?r:i,s=o instanceof ue?re.near(n,e):re.findFrom(n,e);return!!s&&lo(t,s)}return!1}function yo(t,e){if(!(t.state.selection instanceof ae))return!0;let{$head:n,$anchor:o,empty:r}=t.state.selection;if(!n.sameParent(o))return!0;if(!r)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function bo(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function wo(t,e){let n=e.keyCode,o=function(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);if(8==n||Ye&&72==n&&"c"==o)return yo(t,-1)||uo(t,-1);if(46==n&&!e.shiftKey||Ye&&68==n&&"c"==o)return yo(t,1)||uo(t,1);if(13==n||27==n)return!0;if(37==n||Ye&&66==n&&"c"==o){let e=37==n?"ltr"==mo(t,t.state.selection.from)?-1:1:-1;return ao(t,e,o)||uo(t,e)}if(39==n||Ye&&70==n&&"c"==o){let e=39==n?"ltr"==mo(t,t.state.selection.from)?1:-1:1;return ao(t,e,o)||uo(t,e)}return 38==n||Ye&&80==n&&"c"==o?go(t,-1,o)||uo(t,-1):40==n||Ye&&78==n&&"c"==o?function(t){if(!Ge||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let n=e.firstChild;bo(t,n,"true"),setTimeout((()=>bo(t,n,"false")),20)}return!1}(t)||go(t,1,o)||uo(t,1):o==(Ye?"m":"c")&&(66==n||73==n||89==n||90==n)}function vo(t,e){t.someProp("transformCopied",(n=>{e=n(e,t)}));let n=[],{content:o,openStart:r,openEnd:i}=e;for(;r>1&&i>1&&1==o.childCount&&1==o.firstChild.childCount;){r--,i--;let t=o.firstChild;n.push(t.type.name,t.attrs!=t.type.defaultAttrs?t.attrs:null),o=t.content}let s=t.someProp("clipboardSerializer")||dt.fromSchema(t.state.schema),l=No(),a=l.createElement("div");a.appendChild(s.serializeFragment(o,{document:l}));let c,d=a.firstChild,h=0;for(;d&&1==d.nodeType&&(c=Oo[d.nodeName.toLowerCase()]);){for(let t=c.length-1;t>=0;t--){let e=l.createElement(c[t]);for(;a.firstChild;)e.appendChild(a.firstChild);a.appendChild(e),h++}d=a.firstChild}return d&&1==d.nodeType&&d.setAttribute("data-pm-slice",`${r} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`),{dom:a,text:t.someProp("clipboardTextSerializer",(n=>n(e,t)))||e.content.textBetween(0,e.content.size,"\n\n"),slice:e}}function ko(t,e,n,o,r){let i,s,l=r.parent.type.spec.code;if(!n&&!e)return null;let a=e&&(o||l||!n);if(a){if(t.someProp("transformPastedText",(n=>{e=n(e,l||o,t)})),l)return e?new m(c.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):m.empty;let n=t.someProp("clipboardTextParser",(n=>n(e,r,o,t)));if(n)s=n;else{let n=r.marks(),{schema:o}=t.state,s=dt.fromSchema(o);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach((t=>{let e=i.appendChild(document.createElement("p"));t&&e.appendChild(s.serializeNode(o.text(t,n)))}))}}else t.someProp("transformPastedHTML",(e=>{n=e(n,t)})),i=function(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n,o=No().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t);(n=r&&Oo[r[1].toLowerCase()])&&(t=n.map((t=>"<"+t+">")).join("")+t+n.map((t=>"</"+t+">")).reverse().join(""));if(o.innerHTML=t,n)for(let i=0;i<n.length;i++)o=o.querySelector(n[i])||o;return o}(n),en&&function(t){let e=t.querySelectorAll(Ke?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let o=e[n];1==o.childNodes.length&&""==o.textContent&&o.parentNode&&o.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),o)}}(i);let d=i&&i.querySelector("[data-pm-slice]"),h=d&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(d.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let c=+h[3];c>0;c--){let t=i.firstChild;for(;t&&1!=t.nodeType;)t=t.nextSibling;if(!t)break;i=t}if(!s){let e=t.someProp("clipboardParser")||t.someProp("domParser")||tt.fromSchema(t.state.schema);s=e.parseSlice(i,{preserveWhitespace:!(!a&&!h),context:r,ruleFromNode:t=>"BR"!=t.nodeName||t.nextSibling||!t.parentNode||xo.test(t.parentNode.nodeName)?null:{ignore:!0}})}if(h)s=function(t,e){if(!t.size)return t;let n,o=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(l){return t}let{content:r,openStart:i,openEnd:s}=t;for(let a=n.length-2;a>=0;a-=2){let t=o.nodes[n[a]];if(!t||t.hasRequiredAttrs())break;r=c.from(t.create(n[a+1],r)),i++,s++}return new m(r,i,s)}(To(s,+h[1],+h[2]),h[4]);else if(s=m.maxOpen(function(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let o,r=e.node(n).contentMatchAt(e.index(n)),i=[];if(t.forEach((t=>{if(!i)return;let e,n=r.findWrapping(t.type);if(!n)return i=null;if(e=i.length&&o.length&&So(n,o,t,i[i.length-1],0))i[i.length-1]=e;else{i.length&&(i[i.length-1]=Mo(i[i.length-1],o.length));let e=Co(t,n);i.push(e),r=r.matchType(e.type),o=n}})),i)return c.from(i)}return t}(s.content,r),!0),s.openStart||s.openEnd){let t=0,e=0;for(let n=s.content.firstChild;t<s.openStart&&!n.type.spec.isolating;t++,n=n.firstChild);for(let n=s.content.lastChild;e<s.openEnd&&!n.type.spec.isolating;e++,n=n.lastChild);s=To(s,t,e)}return t.someProp("transformPasted",(e=>{s=e(s,t)})),s}const xo=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Co(t,e,n=0){for(let o=e.length-1;o>=n;o--)t=e[o].create(null,c.from(t));return t}function So(t,e,n,o,r){if(r<t.length&&r<e.length&&t[r]==e[r]){let i=So(t,e,n,o.lastChild,r+1);if(i)return o.copy(o.content.replaceChild(o.childCount-1,i));if(o.contentMatchAt(o.childCount).matchType(r==t.length-1?n.type:t[r+1]))return o.copy(o.content.append(c.from(Co(n,t,r+1))))}}function Mo(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,Mo(t.lastChild,e-1)),o=t.contentMatchAt(t.childCount).fillBefore(c.empty,!0);return t.copy(n.append(o))}function Eo(t,e,n,o,r,i){let s=e<0?t.firstChild:t.lastChild,l=s.content;return t.childCount>1&&(i=0),r<o-1&&(l=Eo(l,e,n,o,r+1,i)),r>=n&&(l=e<0?s.contentMatchAt(0).fillBefore(l,i<=r).append(l):l.append(s.contentMatchAt(s.childCount).fillBefore(c.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(l))}function To(t,e,n){return e<t.openStart&&(t=new m(Eo(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new m(Eo(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Oo={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ao=null;function No(){return Ao||(Ao=document.implementation.createHTMLDocument("title"))}const _o={},Lo={},Do={touchstart:!0,touchmove:!0};class Ro{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Io(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Po(t){t.someProp("handleDOMEvents",(e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=e=>Ho(t,e))}))}function Ho(t,e){return t.someProp("handleDOMEvents",(n=>{let o=n[e.type];return!!o&&(o(t,e)||e.defaultPrevented)}))}function Vo(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Bo(t){return{left:t.clientX,top:t.clientY}}function jo(t,e,n,o,r){if(-1==o)return!1;let i=t.state.doc.resolve(o);for(let s=i.depth+1;s>0;s--)if(t.someProp(e,(e=>s>i.depth?e(t,n,i.nodeAfter,i.before(s),r,!0):e(t,n,i.node(s),i.before(s),r,!1))))return!0;return!1}function zo(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let o=t.state.tr.setSelection(e);"pointer"==n&&o.setMeta("pointer",!0),t.dispatch(o)}function Fo(t,e,n,o,r){return jo(t,"handleClickOn",e,n,o)||t.someProp("handleClick",(n=>n(t,e,o)))||(r?function(t,e){if(-1==e)return!1;let n,o,r=t.state.selection;r instanceof de&&(n=r.node);let i=t.state.doc.resolve(e);for(let s=i.depth+1;s>0;s--){let t=s>i.depth?i.nodeAfter:i.node(s);if(de.isSelectable(t)){o=n&&r.$from.depth>0&&s>=r.$from.depth&&i.before(r.$from.depth+1)==r.$from.pos?i.before(r.$from.depth):i.before(s);break}}return null!=o&&(zo(t,de.create(t.state.doc,o),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),o=n.nodeAfter;return!!(o&&o.isAtom&&de.isSelectable(o))&&(zo(t,new de(n),"pointer"),!0)}(t,n))}function $o(t,e,n,o){return jo(t,"handleDoubleClickOn",e,n,o)||t.someProp("handleDoubleClick",(n=>n(t,e,o)))}function Uo(t,e,n,o){return jo(t,"handleTripleClickOn",e,n,o)||t.someProp("handleTripleClick",(n=>n(t,e,o)))||function(t,e,n){if(0!=n.button)return!1;let o=t.state.doc;if(-1==e)return!!o.inlineContent&&(zo(t,ae.create(o,0,o.content.size),"pointer"),!0);let r=o.resolve(e);for(let i=r.depth+1;i>0;i--){let e=i>r.depth?r.nodeAfter:r.node(i),n=r.before(i);if(e.inlineContent)zo(t,ae.create(o,n+1,n+1+e.content.size),"pointer");else{if(!de.isSelectable(e))continue;zo(t,de.create(o,n),"pointer")}return!0}}(t,n,o)}function Wo(t){return Qo(t)}Lo.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!Ko(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!tn||!Ke||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!Xe||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",(e=>e(t,n)))||wo(t,n)?n.preventDefault():Io(t,"key");else{let e=Date.now();t.input.lastIOSEnter=e,t.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{t.input.lastIOSEnter==e&&(t.someProp("handleKeyDown",(e=>e(t,He(13,"Enter")))),t.input.lastIOSEnter=0)}),200)}},Lo.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},Lo.keypress=(t,e)=>{let n=e;if(Ko(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ye&&n.metaKey)return;if(t.someProp("handleKeyPress",(e=>e(t,n))))return void n.preventDefault();let o=t.state.selection;if(!(o instanceof ae&&o.$from.sameParent(o.$to))){let e=String.fromCharCode(n.charCode);/[\r\n]/.test(e)||t.someProp("handleTextInput",(n=>n(t,o.$from.pos,o.$to.pos,e)))||t.dispatch(t.state.tr.insertText(e).scrollIntoView()),n.preventDefault()}};const qo=Ye?"metaKey":"ctrlKey";_o.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let o=Wo(t),r=Date.now(),i="singleClick";r-t.input.lastClick.time<500&&function(t,e){let n=e.x-t.clientX,o=e.y-t.clientY;return n*n+o*o<100}(n,t.input.lastClick)&&!n[qo]&&("singleClick"==t.input.lastClick.type?i="doubleClick":"doubleClick"==t.input.lastClick.type&&(i="tripleClick")),t.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:i};let s=t.posAtCoords(Bo(n));s&&("singleClick"==i?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new Jo(t,s,n,!!o)):("doubleClick"==i?$o:Uo)(t,s.pos,s.inside,n)?n.preventDefault():Io(t,"pointer"))};class Jo{constructor(t,e,n,o){let r,i;if(this.view=t,this.pos=e,this.event=n,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[qo],this.allowDefault=n.shiftKey,e.inside>-1)r=t.state.doc.nodeAt(e.inside),i=e.inside;else{let n=t.state.doc.resolve(e.pos);r=n.parent,i=n.depth?n.before():0}const s=o?null:n.target,l=s?t.docView.nearestDesc(s,!0):null;this.target=l&&1==l.dom.nodeType?l.dom:null;let{selection:a}=t.state;(0==n.button&&r.type.spec.draggable&&!1!==r.type.spec.selectable||a instanceof de&&a.from<=i&&a.to>i)&&(this.mightDrag={node:r,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!qe||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Io(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>Gn(this.view))),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Bo(t))),this.updateAllowDefault(t),this.allowDefault||!e?Io(this.view,"pointer"):Fo(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||Ge&&this.mightDrag&&!this.mightDrag.node.isAtom||Ke&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(zo(this.view,re.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):Io(this.view,"pointer")}move(t){this.updateAllowDefault(t),Io(this.view,"pointer"),0==t.buttons&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}function Ko(t,e){return!!t.composing||!!(Ge&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}_o.touchstart=t=>{t.input.lastTouch=Date.now(),Wo(t),Io(t,"pointer")},_o.touchmove=t=>{t.input.lastTouch=Date.now(),Io(t,"pointer")},_o.contextmenu=t=>Wo(t);const Zo=tn?5e3:-1;function Go(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout((()=>Qo(t)),e))}function Xo(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Yo(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=function(t,e){for(;;){if(3==t.nodeType&&e)return t;if(1==t.nodeType&&e>0){if("false"==t.contentEditable)return null;e=Re(t=t.childNodes[e-1])}else{if(!t.parentNode||Ie(t))return null;e=Te(t),t=t.parentNode}}}(e.focusNode,e.focusOffset),o=function(t,e){for(;;){if(3==t.nodeType&&e<t.nodeValue.length)return t;if(1==t.nodeType&&e<t.childNodes.length){if("false"==t.contentEditable)return null;t=t.childNodes[e],e=0}else{if(!t.parentNode||Ie(t))return null;e=Te(t)+1,t=t.parentNode}}}(e.focusNode,e.focusOffset);if(n&&o&&n!=o){let e=o.pmViewDesc,r=t.domObserver.lastChangedTextNode;if(n==r||o==r)return r;if(!e||!e.isText(o.nodeValue))return o;if(t.input.compositionNode==o){let t=n.pmViewDesc;if(t&&t.isText(n.nodeValue))return o}}return n||o}function Qo(t,e=!1){if(!(tn&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Xo(t),e||t.docView&&t.docView.dirty){let n=Kn(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):!t.markCursor&&!e||t.state.selection.empty?t.updateState(t.state):t.dispatch(t.state.tr.deleteSelection()),!0}return!1}}Lo.compositionstart=Lo.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof ae&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((t=>!1===t.type.spec.inclusive))))t.markCursor=t.state.storedMarks||n.marks(),Qo(t,!0),t.markCursor=null;else if(Qo(t,!e.selection.empty),qe&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let e=t.domSelectionRange();for(let n=e.focusNode,o=e.focusOffset;n&&1==n.nodeType&&0!=o;){let e=o<0?n.lastChild:n.childNodes[o-1];if(!e)break;if(3==e.nodeType){let n=t.domSelection();n&&n.collapse(e,e.nodeValue.length);break}n=e,o=-1}}t.input.composing=!0}Go(t,Zo)},Lo.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then((()=>t.domObserver.flush())),t.input.compositionID++,Go(t,20))};const tr=Ue&&We<15||Xe&&nn<604;function er(t,e,n,o,r){let i=ko(t,e,n,o,t.state.selection.$from);if(t.someProp("handlePaste",(e=>e(t,r,i||m.empty))))return!0;if(!i)return!1;let s=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(i),l=s?t.state.tr.replaceSelectionWith(s,o):t.state.tr.replaceSelection(i);return t.dispatch(l.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function nr(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}_o.copy=Lo.cut=(t,e)=>{let n=e,o=t.state.selection,r="cut"==n.type;if(o.empty)return;let i=tr?null:n.clipboardData,s=o.content(),{dom:l,text:a}=vo(t,s);i?(n.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",a)):function(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let o=getSelection(),r=document.createRange();r.selectNodeContents(e),t.dom.blur(),o.removeAllRanges(),o.addRange(r),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}(t,l),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Lo.paste=(t,e)=>{let n=e;if(t.composing&&!tn)return;let o=tr?null:n.clipboardData,r=t.input.shiftKey&&45!=t.input.lastKeyCode;o&&er(t,nr(o),o.getData("text/html"),r,n)?n.preventDefault():function(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,o=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus();let r=t.input.shiftKey&&45!=t.input.lastKeyCode;setTimeout((()=>{t.focus(),o.parentNode&&o.parentNode.removeChild(o),n?er(t,o.value,null,r,e):er(t,o.textContent,o.innerHTML,r,e)}),50)}(t,n)};class or{constructor(t,e,n){this.slice=t,this.move=e,this.node=n}}const rr=Ye?"altKey":"ctrlKey";_o.dragstart=(t,e)=>{let n=e,o=t.input.mouseDown;if(o&&o.done(),!n.dataTransfer)return;let r,i=t.state.selection,s=i.empty?null:t.posAtCoords(Bo(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof de?i.to-1:i.to));else if(o&&o.mightDrag)r=de.create(t.state.doc,o.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let e=t.docView.nearestDesc(n.target,!0);e&&e.node.type.spec.draggable&&e!=t.docView&&(r=de.create(t.state.doc,e.posBefore))}let l=(r||t.state.selection).content(),{dom:a,text:c,slice:d}=vo(t,l);(!n.dataTransfer.files.length||!Ke||Ze>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(tr?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",tr||n.dataTransfer.setData("text/plain",c),t.dragging=new or(d,!n[rr],r)},_o.dragend=t=>{let e=t.dragging;window.setTimeout((()=>{t.dragging==e&&(t.dragging=null)}),50)},Lo.dragover=Lo.dragenter=(t,e)=>e.preventDefault(),Lo.drop=(t,e)=>{let n=e,o=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let r=t.posAtCoords(Bo(n));if(!r)return;let i=t.state.doc.resolve(r.pos),s=o&&o.slice;s?t.someProp("transformPasted",(e=>{s=e(s,t)})):s=ko(t,nr(n.dataTransfer),tr?null:n.dataTransfer.getData("text/html"),!1,i);let l=!(!o||n[rr]);if(t.someProp("handleDrop",(e=>e(t,n,s||m.empty,l))))return void n.preventDefault();if(!s)return;n.preventDefault();let a=s?Ft(t.state.doc,i.pos,s):i.pos;null==a&&(a=i.pos);let c=t.state.tr;if(l){let{node:t}=o;t?t.replace(c):c.deleteSelection()}let d=c.mapping.map(a),h=0==s.openStart&&0==s.openEnd&&1==s.content.childCount,u=c.doc;if(h?c.replaceRangeWith(d,d,s.content.firstChild):c.replaceRange(d,d,s),c.doc.eq(u))return;let p=c.doc.resolve(d);if(h&&de.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new de(p));else{let e=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach(((t,n,o,r)=>e=r)),c.setSelection(oo(t,p,c.doc.resolve(e)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))},_o.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Gn(t)}),20))},_o.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},_o.beforeinput=(t,e)=>{if(Ke&&tn&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:e}=t.input;setTimeout((()=>{if(t.input.domChangeCount!=e)return;if(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",(e=>e(t,He(8,"Backspace")))))return;let{$cursor:n}=t.state.selection;n&&n.pos>0&&t.dispatch(t.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let os in Lo)_o[os]=Lo[os];function ir(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class sr{constructor(t,e){this.toDOM=t,this.spec=e||hr,this.side=this.spec.side||0}map(t,e,n,o){let{pos:r,deleted:i}=t.mapResult(e.from+o,this.side<0?-1:1);return i?null:new cr(r-n,r-n,this)}valid(){return!0}eq(t){return this==t||t instanceof sr&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ir(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class lr{constructor(t,e){this.attrs=t,this.spec=e||hr}map(t,e,n,o){let r=t.map(e.from+o,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+o,this.spec.inclusiveEnd?1:-1)-n;return r>=i?null:new cr(r,i,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof lr&&ir(this.attrs,t.attrs)&&ir(this.spec,t.spec)}static is(t){return t.type instanceof lr}destroy(){}}class ar{constructor(t,e){this.attrs=t,this.spec=e||hr}map(t,e,n,o){let r=t.mapResult(e.from+o,1);if(r.deleted)return null;let i=t.mapResult(e.to+o,-1);return i.deleted||i.pos<=r.pos?null:new cr(r.pos-n,i.pos-n,this)}valid(t,e){let n,{index:o,offset:r}=t.content.findIndex(e.from);return r==e.from&&!(n=t.child(o)).isText&&r+n.nodeSize==e.to}eq(t){return this==t||t instanceof ar&&ir(this.attrs,t.attrs)&&ir(this.spec,t.spec)}destroy(){}}class cr{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new cr(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new cr(t,t,new sr(e,n))}static inline(t,e,n,o){return new cr(t,e,new lr(n,o))}static node(t,e,n,o){return new cr(t,e,new ar(n,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof lr}get widget(){return this.type instanceof sr}}const dr=[],hr={};class ur{constructor(t,e){this.local=t.length?t:dr,this.children=e.length?e:dr}static create(t,e){return e.length?br(e,t,0,hr):pr}find(t,e,n){let o=[];return this.findInner(null==t?0:t,null==e?1e9:e,o,0,n),o}findInner(t,e,n,o,r){for(let i=0;i<this.local.length;i++){let s=this.local[i];s.from<=e&&s.to>=t&&(!r||r(s.spec))&&n.push(s.copy(s.from+o,s.to+o))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<e&&this.children[i+1]>t){let s=this.children[i]+1;this.children[i+2].findInner(t-s,e-s,n,o+s,r)}}map(t,e,n){return this==pr||0==t.maps.length?this:this.mapInner(t,e,0,0,n||hr)}mapInner(t,e,n,o,r){let i;for(let s=0;s<this.local.length;s++){let l=this.local[s].map(t,n,o);l&&l.type.valid(e,l)?(i||(i=[])).push(l):r.onRemove&&r.onRemove(this.local[s].spec)}return this.children.length?function(t,e,n,o,r,i,s){let l=t.slice();for(let c=0,d=i;c<n.maps.length;c++){let t=0;n.maps[c].forEach(((e,n,o,r)=>{let i=r-o-(n-e);for(let s=0;s<l.length;s+=3){let o=l[s+1];if(o<0||e>o+d-t)continue;let r=l[s]+d-t;n>=r?l[s+1]=e<=r?-2:-1:e>=d&&i&&(l[s]+=i,l[s+1]+=i)}t+=i})),d=n.maps[c].map(d,-1)}let a=!1;for(let c=0;c<l.length;c+=3)if(l[c+1]<0){if(-2==l[c+1]){a=!0,l[c+1]=-1;continue}let e=n.map(t[c]+i),d=e-r;if(d<0||d>=o.content.size){a=!0;continue}let h=n.map(t[c+1]+i,-1)-r,{index:u,offset:p}=o.content.findIndex(d),f=o.maybeChild(u);if(f&&p==d&&p+f.nodeSize==h){let o=l[c+2].mapInner(n,f,e+1,t[c]+i+1,s);o!=pr?(l[c]=d,l[c+1]=h,l[c+2]=o):(l[c+1]=-2,a=!0)}else a=!0}if(a){let a=function(t,e,n,o,r,i,s){function l(t,e){for(let i=0;i<t.local.length;i++){let l=t.local[i].map(o,r,e);l?n.push(l):s.onRemove&&s.onRemove(t.local[i].spec)}for(let n=0;n<t.children.length;n+=3)l(t.children[n+2],t.children[n]+e+1)}for(let a=0;a<t.length;a+=3)-1==t[a+1]&&l(t[a+2],e[a]+i+1);return n}(l,t,e,n,r,i,s),c=br(a,o,0,s);e=c.local;for(let t=0;t<l.length;t+=3)l[t+1]<0&&(l.splice(t,3),t-=3);for(let t=0,e=0;t<c.children.length;t+=3){let n=c.children[t];for(;e<l.length&&l[e]<n;)e+=3;l.splice(e,0,c.children[t],c.children[t+1],c.children[t+2])}}return new ur(e.sort(wr),l)}(this.children,i||[],t,e,n,o,r):i?new ur(i.sort(wr),dr):pr}add(t,e){return e.length?this==pr?ur.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let o,r=0;t.forEach(((t,i)=>{let s,l=i+n;if(s=gr(e,t,l)){for(o||(o=this.children.slice());r<o.length&&o[r]<i;)r+=3;o[r]==i?o[r+2]=o[r+2].addInner(t,s,l+1):o.splice(r,0,i,i+t.nodeSize,br(s,t,l+1,hr)),r+=3}}));let i=mr(r?yr(e):e,-n);for(let s=0;s<i.length;s++)i[s].type.valid(t,i[s])||i.splice(s--,1);return new ur(i.length?this.local.concat(i).sort(wr):this.local,o||this.children)}remove(t){return 0==t.length||this==pr?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,o=this.local;for(let r=0;r<n.length;r+=3){let o,i=n[r]+e,s=n[r+1]+e;for(let e,n=0;n<t.length;n++)(e=t[n])&&e.from>i&&e.to<s&&(t[n]=null,(o||(o=[])).push(e));if(!o)continue;n==this.children&&(n=this.children.slice());let l=n[r+2].removeInner(o,i+1);l!=pr?n[r+2]=l:(n.splice(r,3),r-=3)}if(o.length)for(let r,i=0;i<t.length;i++)if(r=t[i])for(let t=0;t<o.length;t++)o[t].eq(r,e)&&(o==this.local&&(o=this.local.slice()),o.splice(t--,1));return n==this.children&&o==this.local?this:o.length||n.length?new ur(o,n):pr}forChild(t,e){if(this==pr)return this;if(e.isLeaf)return ur.empty;let n,o;for(let s=0;s<this.children.length;s+=3)if(this.children[s]>=t){this.children[s]==t&&(n=this.children[s+2]);break}let r=t+1,i=r+e.content.size;for(let s=0;s<this.local.length;s++){let t=this.local[s];if(t.from<i&&t.to>r&&t.type instanceof lr){let e=Math.max(r,t.from)-r,n=Math.min(i,t.to)-r;e<n&&(o||(o=[])).push(t.copy(e,n))}}if(o){let t=new ur(o.sort(wr),dr);return n?new fr([t,n]):t}return n||pr}eq(t){if(this==t)return!0;if(!(t instanceof ur)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return vr(this.localsInner(t))}localsInner(t){if(this==pr)return dr;if(t.inlineContent||!this.local.some(lr.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof lr||e.push(this.local[n]);return e}forEachSet(t){t(this)}}ur.empty=new ur([],[]),ur.removeOverlap=vr;const pr=ur.empty;class fr{constructor(t){this.members=t}map(t,e){const n=this.members.map((n=>n.map(t,e,hr)));return fr.from(n)}forChild(t,e){if(e.isLeaf)return ur.empty;let n=[];for(let o=0;o<this.members.length;o++){let r=this.members[o].forChild(t,e);r!=pr&&(r instanceof fr?n=n.concat(r.members):n.push(r))}return fr.from(n)}eq(t){if(!(t instanceof fr)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let o=0;o<this.members.length;o++){let r=this.members[o].localsInner(t);if(r.length)if(e){n&&(e=e.slice(),n=!1);for(let t=0;t<r.length;t++)e.push(r[t])}else e=r}return e?vr(n?e:e.sort(wr)):dr}static from(t){switch(t.length){case 0:return pr;case 1:return t[0];default:return new fr(t.every((t=>t instanceof ur))?t:t.reduce(((t,e)=>t.concat(e instanceof ur?e:e.members)),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}function mr(t,e){if(!e||!t.length)return t;let n=[];for(let o=0;o<t.length;o++){let r=t[o];n.push(new cr(r.from+e,r.to+e,r.type))}return n}function gr(t,e,n){if(e.isLeaf)return null;let o=n+e.nodeSize,r=null;for(let i,s=0;s<t.length;s++)(i=t[s])&&i.from>n&&i.to<o&&((r||(r=[])).push(i),t[s]=null);return r}function yr(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function br(t,e,n,o){let r=[],i=!1;e.forEach(((e,s)=>{let l=gr(t,e,s+n);if(l){i=!0;let t=br(l,e,n+s+1,o);t!=pr&&r.push(s,s+e.nodeSize,t)}}));let s=mr(i?yr(t):t,-n).sort(wr);for(let l=0;l<s.length;l++)s[l].type.valid(e,s[l])||(o.onRemove&&o.onRemove(s[l].spec),s.splice(l--,1));return s.length||r.length?new ur(s,r):pr}function wr(t,e){return t.from-e.from||t.to-e.to}function vr(t){let e=t;for(let n=0;n<e.length-1;n++){let o=e[n];if(o.from!=o.to)for(let r=n+1;r<e.length;r++){let i=e[r];if(i.from!=o.from){i.from<o.to&&(e==t&&(e=t.slice()),e[n]=o.copy(o.from,i.from),kr(e,r,o.copy(i.from,o.to)));break}i.to!=o.to&&(e==t&&(e=t.slice()),e[r]=i.copy(i.from,o.to),kr(e,r+1,i.copy(o.to,i.to)))}}return e}function kr(t,e,n){for(;e<t.length&&wr(n,t[e])>0;)e++;t.splice(e,0,n)}function xr(t){let e=[];return t.someProp("decorations",(n=>{let o=n(t.state);o&&o!=pr&&e.push(o)})),t.cursorWrapper&&e.push(ur.create(t.state.doc,[t.cursorWrapper.deco])),fr.from(e)}const Cr={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Sr=Ue&&We<=11;class Mr{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class Er{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Mr,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver((t=>{for(let e=0;e<t.length;e++)this.queue.push(t[e]);Ue&&We<=11&&t.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),Sr&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Cr)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(ro(this.view)){if(this.suppressingSelectionUpdates)return Gn(this.view);if(Ue&&We<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&_e(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e,n=new Set;for(let r=t.focusNode;r;r=Oe(r))n.add(r);for(let r=t.anchorNode;r;r=Oe(r))if(n.has(r)){e=r;break}let o=e&&this.view.docView.nearestDesc(e);return o&&o.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&ro(t)&&!this.ignoreSelectionChange(n),r=-1,i=-1,s=!1,l=[];if(t.editable)for(let c=0;c<e.length;c++){let t=this.registerMutation(e[c],l);t&&(r=r<0?t.from:Math.min(t.from,r),i=i<0?t.to:Math.max(t.to,i),t.typeOver&&(s=!0))}if(qe&&l.length){let e=l.filter((t=>"BR"==t.nodeName));if(2==e.length){let[t,n]=e;t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}else{let{focusNode:n}=this.currentSelection;for(let o of e){let e=o.parentNode;!e||"LI"!=e.nodeName||n&&Nr(t,n)==e||o.remove()}}}let a=null;r<0&&o&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&Pe(n)&&(a=Kn(t))&&a.eq(re.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Gn(t),this.currentSelection.set(n),t.scrollToSelection()):(r>-1||o)&&(r>-1&&(t.docView.markDirty(r,i),function(t){if(Tr.has(t))return;if(Tr.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)){if(t.requiresGeckoHackNode=qe,Or)return;Or=!0}}(t)),this.handleDOMChange(r,i,s,l),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||Gn(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(let n=0;n<t.addedNodes.length;n++){let o=t.addedNodes[n];e.push(o),3==o.nodeType&&(this.lastChangedTextNode=o)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let o=t.previousSibling,r=t.nextSibling;if(Ue&&We<=11&&t.addedNodes.length)for(let e=0;e<t.addedNodes.length;e++){let{previousSibling:n,nextSibling:i}=t.addedNodes[e];(!n||Array.prototype.indexOf.call(t.addedNodes,n)<0)&&(o=n),(!i||Array.prototype.indexOf.call(t.addedNodes,i)<0)&&(r=i)}let i=o&&o.parentNode==t.target?Te(o)+1:0,s=n.localPosFromDOM(t.target,i,-1),l=r&&r.parentNode==t.target?Te(r):t.target.childNodes.length;return{from:s,to:n.localPosFromDOM(t.target,l,1)}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let Tr=new WeakMap,Or=!1;function Ar(t,e){let n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return _e(s.node,s.offset,r,i)&&([n,o,r,i]=[r,i,n,o]),{anchorNode:n,anchorOffset:o,focusNode:r,focusOffset:i}}function Nr(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let e=t.docView.nearestDesc(n,!0);if(e&&e.node.isBlock)return n}return null}function _r(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Ge&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}if(t.parentNode.lastChild==t||Ge&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Lr=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Dr(t,e,n,o,r){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let e=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,n=Kn(t,e);if(n&&!t.state.selection.eq(n)){if(Ke&&tn&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",(e=>e(t,He(13,"Enter")))))return;let o=t.state.tr.setSelection(n);"pointer"==e?o.setMeta("pointer",!0):"key"==e&&o.scrollIntoView(),i&&o.setMeta("composition",i),t.dispatch(o)}return}let s=t.state.doc.resolve(e),l=s.sharedDepth(n);e=s.before(l+1),n=t.state.doc.resolve(n).after(l+1);let a,d,h=t.state.selection,u=function(t,e,n){let o,{node:r,fromOffset:i,toOffset:s,from:l,to:a}=t.docView.parseRange(e,n),c=t.domSelectionRange(),d=c.anchorNode;if(d&&t.dom.contains(1==d.nodeType?d:d.parentNode)&&(o=[{node:d,offset:c.anchorOffset}],Pe(c)||o.push({node:c.focusNode,offset:c.focusOffset})),Ke&&8===t.input.lastKeyCode)for(let g=s;g>i;g--){let t=r.childNodes[g-1],e=t.pmViewDesc;if("BR"==t.nodeName&&!e){s=g;break}if(!e||e.size)break}let h=t.state.doc,u=t.someProp("domParser")||tt.fromSchema(t.state.schema),p=h.resolve(l),f=null,m=u.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:i,to:s,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:o,ruleFromNode:_r,context:p});if(o&&null!=o[0].pos){let t=o[0].pos,e=o[1]&&o[1].pos;null==e&&(e=t),f={anchor:t+l,head:e+l}}return{doc:m,sel:f,from:l,to:a}}(t,e,n),p=t.state.doc,f=p.slice(u.from,u.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(a=t.state.selection.to,d="end"):(a=t.state.selection.from,d="start"),t.input.lastKeyCode=null;let m=function(t,e,n,o,r){let i=t.findDiffStart(e,n);if(null==i)return null;let{a:s,b:l}=t.findDiffEnd(e,n+t.size,n+e.size);if("end"==r){o-=s+Math.max(0,i-Math.min(s,l))-i}if(s<i&&t.size<e.size){let t=o<=i&&o>=s?i-o:0;i-=t,i&&i<e.size&&Pr(e.textBetween(i-1,i+1))&&(i+=t?1:-1),l=i+(l-s),s=i}else if(l<i){let e=o<=i&&o>=l?i-o:0;i-=e,i&&i<t.size&&Pr(t.textBetween(i-1,i+1))&&(i+=e?1:-1),s=i+(s-l),l=i}return{start:i,endA:s,endB:l}}(f.content,u.doc.content,u.from,a,d);if(m&&t.input.domChangeCount++,(Xe&&t.input.lastIOSEnter>Date.now()-225||tn)&&r.some((t=>1==t.nodeType&&!Lr.test(t.nodeName)))&&(!m||m.endA>=m.endB)&&t.someProp("handleKeyDown",(e=>e(t,He(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(!m){if(!(o&&h instanceof ae&&!h.empty&&h.$head.sameParent(h.$anchor))||t.composing||u.sel&&u.sel.anchor!=u.sel.head){if(u.sel){let e=Rr(t,t.state.doc,u.sel);if(e&&!e.eq(t.state.selection)){let n=t.state.tr.setSelection(e);i&&n.setMeta("composition",i),t.dispatch(n)}}return}m={start:h.from,endA:h.to,endB:h.to}}t.state.selection.from<t.state.selection.to&&m.start==m.endB&&t.state.selection instanceof ae&&(m.start>t.state.selection.from&&m.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?m.start=t.state.selection.from:m.endA<t.state.selection.to&&m.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(m.endB+=t.state.selection.to-m.endA,m.endA=t.state.selection.to)),Ue&&We<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>u.from&&" "==u.doc.textBetween(m.start-u.from-1,m.start-u.from+1)&&(m.start--,m.endA--,m.endB--);let g,y=u.doc.resolveNoCache(m.start-u.from),b=u.doc.resolveNoCache(m.endB-u.from),w=p.resolve(m.start),v=y.sameParent(b)&&y.parent.inlineContent&&w.end()>=m.endA;if((Xe&&t.input.lastIOSEnter>Date.now()-225&&(!v||r.some((t=>"DIV"==t.nodeName||"P"==t.nodeName)))||!v&&y.pos<u.doc.content.size&&!y.sameParent(b)&&(g=re.findFrom(u.doc.resolve(y.pos+1),1,!0))&&g.head==b.pos)&&t.someProp("handleKeyDown",(e=>e(t,He(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>m.start&&function(t,e,n,o,r){if(n-e<=r.pos-o.pos||Ir(o,!0,!1)<r.pos)return!1;let i=t.resolve(e);if(!o.parent.isTextblock){let t=i.nodeAfter;return null!=t&&n==e+t.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let s=t.resolve(Ir(i,!0,!0));return!(!s.parent.isTextblock||s.pos>n||Ir(s,!0,!1)<n)&&o.parent.content.cut(o.parentOffset).eq(s.parent.content)}(p,m.start,m.endA,y,b)&&t.someProp("handleKeyDown",(e=>e(t,He(8,"Backspace")))))return void(tn&&Ke&&t.domObserver.suppressSelectionUpdates());Ke&&tn&&m.endB==m.start&&(t.input.lastAndroidDelete=Date.now()),tn&&!v&&y.start()!=b.start()&&0==b.parentOffset&&y.depth==b.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==m.endA&&(m.endB-=2,b=u.doc.resolveNoCache(m.endB-u.from),setTimeout((()=>{t.someProp("handleKeyDown",(function(e){return e(t,He(13,"Enter"))}))}),20));let k,x,C,S=m.start,M=m.endA;if(v)if(y.pos==b.pos)Ue&&We<=11&&0==y.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((()=>Gn(t)),20)),k=t.state.tr.delete(S,M),x=p.resolve(m.start).marksAcross(p.resolve(m.endA));else if(m.endA==m.endB&&(C=function(t,e){let n,o,r,i=t.firstChild.marks,s=e.firstChild.marks,l=i,a=s;for(let c=0;c<s.length;c++)l=s[c].removeFromSet(l);for(let c=0;c<i.length;c++)a=i[c].removeFromSet(a);if(1==l.length&&0==a.length)o=l[0],n="add",r=t=>t.mark(o.addToSet(t.marks));else{if(0!=l.length||1!=a.length)return null;o=a[0],n="remove",r=t=>t.mark(o.removeFromSet(t.marks))}let d=[];for(let c=0;c<e.childCount;c++)d.push(r(e.child(c)));if(c.from(d).eq(t))return{mark:o,type:n}}(y.parent.content.cut(y.parentOffset,b.parentOffset),w.parent.content.cut(w.parentOffset,m.endA-w.start()))))k=t.state.tr,"add"==C.type?k.addMark(S,M,C.mark):k.removeMark(S,M,C.mark);else if(y.parent.child(y.index()).isText&&y.index()==b.index()-(b.textOffset?0:1)){let e=y.parent.textBetween(y.parentOffset,b.parentOffset);if(t.someProp("handleTextInput",(n=>n(t,S,M,e))))return;k=t.state.tr.insertText(e,S,M)}if(k||(k=t.state.tr.replace(S,M,u.doc.slice(m.start-u.from,m.endB-u.from))),u.sel){let e=Rr(t,k.doc,u.sel);e&&!(Ke&&tn&&t.composing&&e.empty&&(m.start!=m.endB||t.input.lastAndroidDelete<Date.now()-100)&&(e.head==S||e.head==k.mapping.map(M)-1)||Ue&&e.empty&&e.head==S)&&k.setSelection(e)}x&&k.ensureMarks(x),i&&k.setMeta("composition",i),t.dispatch(k.scrollIntoView())}function Rr(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:oo(t,e.resolve(n.anchor),e.resolve(n.head))}function Ir(t,e,n){let o=t.depth,r=e?t.end():t.pos;for(;o>0&&(e||t.indexAfter(o)==t.node(o).childCount);)o--,r++,e=!1;if(n){let e=t.node(o).maybeChild(t.indexAfter(o));for(;e&&!e.isLeaf;)e=e.firstChild,r++}return r}function Pr(t){if(2!=t.length)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class Hr{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Ro,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(Fr),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):"function"==typeof t?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=jr(this),Br(this),this.nodeViews=zr(this),this.docView=Ln(this.state.doc,Vr(this),xr(this),this.dom,this),this.domObserver=new Er(this,((t,e,n,o)=>Dr(this,t,e,n,o))),this.domObserver.start(),function(t){for(let e in _o){let n=_o[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=e=>{!Vo(t,e)||Ho(t,e)||!t.editable&&e.type in Lo||n(t,e)},Do[e]?{passive:!0}:void 0)}Ge&&t.dom.addEventListener("input",(()=>null)),Po(t)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Po(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(Fr),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var n;let o=this.state,r=!1,i=!1;t.storedMarks&&this.composing&&(Xo(this),i=!0),this.state=t;let s=o.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let t=zr(this);(function(t,e){let n=0,o=0;for(let r in t){if(t[r]!=e[r])return!0;n++}for(let r in e)o++;return n!=o})(t,this.nodeViews)&&(this.nodeViews=t,r=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&Po(this),this.editable=jr(this),Br(this);let l=xr(this),a=Vr(this),c=o.plugins==t.plugins||o.doc.eq(t.doc)?t.scrollToSelection>o.scrollToSelection?"to selection":"preserve":"reset",d=r||!this.docView.matchesNode(t.doc,a,l);!d&&t.selection.eq(o.selection)||(i=!0);let h="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(t){let e,n,o=t.dom.getBoundingClientRect(),r=Math.max(0,o.top);for(let i=(o.left+o.right)/2,s=r+1;s<Math.min(innerHeight,o.bottom);s+=5){let o=t.root.elementFromPoint(i,s);if(!o||o==t.dom||!t.dom.contains(o))continue;let l=o.getBoundingClientRect();if(l.top>=r-20){e=o,n=l.top;break}}return{refDOM:e,refTop:n,stack:an(t.dom)}}(this);if(i){this.domObserver.stop();let e=d&&(Ue||Ke)&&!this.composing&&!o.selection.empty&&!t.selection.empty&&function(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}(o.selection,t.selection);if(d){let n=Ke?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Yo(this)),!r&&this.docView.update(t.doc,a,l,this)||(this.docView.updateOuterDeco(a),this.docView.destroy(),this.docView=Ln(t.doc,a,l,this.dom,this)),n&&!this.trackWrites&&(e=!0)}e||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return _e(e.node,e.offset,n.anchorNode,n.anchorOffset)}(this))?Gn(this,e):(eo(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(o),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!o.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,o),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():h&&function({refDOM:t,refTop:e,stack:n}){let o=t?t.getBoundingClientRect().top:0;cn(n,0==o?0:o-e)}(h)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(t=>t(this))));else if(this.state.selection instanceof de){let e=this.docView.domAfterPos(this.state.selection.from);1==e.nodeType&&ln(this,e.getBoundingClientRect(),t)}else ln(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let e=this.directPlugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let e=this.state.plugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}}}updateDraggedNode(t,e){let n=t.node,o=-1;if(this.state.doc.nodeAt(n.from)==n.node)o=n.from;else{let t=n.from+(this.state.doc.content.size-e.doc.content.size);(t>0&&this.state.doc.nodeAt(t))==n.node&&(o=t)}this.dragging=new or(t.slice,t.move,o<0?void 0:de.create(this.state.doc,o))}someProp(t,e){let n,o=this._props&&this._props[t];if(null!=o&&(n=e?e(o):o))return n;for(let i=0;i<this.directPlugins.length;i++){let o=this.directPlugins[i].props[t];if(null!=o&&(n=e?e(o):o))return n}let r=this.state.plugins;if(r)for(let i=0;i<r.length;i++){let o=r[i].props[t];if(null!=o&&(n=e?e(o):o))return n}}hasFocus(){if(Ue){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(t){if(t.setActive)return t.setActive();if(dn)return t.focus(dn);let e=an(t);t.focus(null==dn?{get preventScroll(){return dn={preventScroll:!0},!0}}:void 0),dn||(dn=!1,cn(e,0))}(this.dom),Gn(this),this.domObserver.start()}get root(){let t=this._root;if(null==t)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return t||document}updateRoot(){this._root=null}posAtCoords(t){return fn(this,t)}coordsAtPos(t,e=1){return bn(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let o=this.docView.posFromDOM(t,e,n);if(null==o)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(t,e){return En(this,e||this.state,t)}pasteHTML(t,e){return er(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return er(this,t,null,!0,e||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],xr(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Ae=null)}get isDestroyed(){return null==this.docView}dispatchEvent(t){return function(t,e){Ho(t,e)||!_o[e.type]||!t.editable&&e.type in Lo||_o[e.type](t,e)}(this,t)}dispatch(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))}domSelectionRange(){let t=this.domSelection();return t?Ge&&11===this.root.nodeType&&function(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom&&function(t,e){if(e.getComposedRanges){let n=e.getComposedRanges(t.root)[0];if(n)return Ar(t,n)}let n;function o(t){t.preventDefault(),t.stopImmediatePropagation(),n=t.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",o,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",o,!0),n?Ar(t,n):null}(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Vr(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let t in n)"class"==t?e.class+=" "+n[t]:"style"==t?e.style=(e.style?e.style+";":"")+n[t]:e[t]||"contenteditable"==t||"nodeName"==t||(e[t]=String(n[t]))})),e.translate||(e.translate="no"),[cr.node(0,t.state.doc.content.size,e)]}function Br(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:cr.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function jr(t){return!t.someProp("editable",(e=>!1===e(t.state)))}function zr(t){let e=Object.create(null);function n(t){for(let n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Fr(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var $r={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ur={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Wr="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),qr="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Jr=0;Jr<10;Jr++)$r[48+Jr]=$r[96+Jr]=String(Jr);for(Jr=1;Jr<=24;Jr++)$r[Jr+111]="F"+Jr;for(Jr=65;Jr<=90;Jr++)$r[Jr]=String.fromCharCode(Jr+32),Ur[Jr]=String.fromCharCode(Jr);for(var Kr in $r)Ur.hasOwnProperty(Kr)||(Ur[Kr]=$r[Kr]);const Zr="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function Gr(t){let e,n,o,r,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(let l=0;l<i.length-1;l++){let t=i[l];if(/^(cmd|meta|m)$/i.test(t))r=!0;else if(/^a(lt)?$/i.test(t))e=!0;else if(/^(c|ctrl|control)$/i.test(t))n=!0;else if(/^s(hift)?$/i.test(t))o=!0;else{if(!/^mod$/i.test(t))throw new Error("Unrecognized modifier name: "+t);Zr?r=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),r&&(s="Meta-"+s),o&&(s="Shift-"+s),s}function Xr(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Yr(t){let e=function(t){let e=Object.create(null);for(let n in t)e[Gr(n)]=t[n];return e}(t);return function(t,n){let o,r=function(t){var e=!(Wr&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||qr&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?Ur:$r)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(n),i=e[Xr(r,n)];if(i&&i(t.state,t.dispatch,t))return!0;if(1==r.length&&" "!=r){if(n.shiftKey){let o=e[Xr(r,n,!1)];if(o&&o(t.state,t.dispatch,t))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(o=$r[n.keyCode])&&o!=r){let r=e[Xr(o,n)];if(r&&r(t.state,t.dispatch,t))return!0}}return!1}}function Qr(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}function ti(t,e,n){let o=e.nodeBefore,r=e.pos-1;for(;!o.isTextblock;r--){if(o.type.spec.isolating)return!1;let t=o.lastChild;if(!t)return!1;o=t}let i=e.nodeAfter,s=e.pos+1;for(;!i.isTextblock;s++){if(i.type.spec.isolating)return!1;let t=i.firstChild;if(!t)return!1;i=t}let l=$t(t.doc,r,s,m.empty);if(!l||l.from!=r||l instanceof Nt&&l.slice.size>=s-r)return!1;if(n){let e=t.tr.step(l);e.setSelection(ae.create(e.doc,r)),n(e.scrollIntoView())}return!0}function ei(t,e,n=!1){for(let o=t;o;o="start"==e?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(n&&1!=o.childCount)return!1}return!1}function ni(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function oi(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}function ri(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}function ii(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function si(t,e,n,o){let r,i,s=e.nodeBefore,l=e.nodeAfter,a=s.type.spec.isolating||l.type.spec.isolating;if(!a&&function(t,e,n){let o=e.nodeBefore,r=e.nodeAfter,i=e.index();return!(!(o&&r&&o.type.compatibleContent(r.type))||(!o.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-o.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(i,i+1)||!r.isTextblock&&!Bt(t.doc,e.pos)||(n&&n(t.tr.clearIncompatible(e.pos,o.type,o.contentMatchAt(o.childCount)).join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;let d=!a&&e.parent.canReplace(e.index(),e.index()+1);if(d&&(r=(i=s.contentMatchAt(s.childCount)).findWrapping(l.type))&&i.matchType(r[0]||l.type).validEnd){if(n){let o=e.pos+l.nodeSize,i=c.empty;for(let t=r.length-1;t>=0;t--)i=c.from(r[t].create(null,i));i=c.from(s.copy(i));let a=t.tr.step(new _t(e.pos-1,o,e.pos,o,new m(i,1,0),r.length,!0)),d=o+2*r.length;Bt(a.doc,d)&&a.join(d),n(a.scrollIntoView())}return!0}let h=l.type.spec.isolating||o>0&&a?null:re.findFrom(e,1),u=h&&h.$from.blockRange(h.$to),p=u&&It(u);if(null!=p&&p>=e.depth)return n&&n(t.tr.lift(u,p).scrollIntoView()),!0;if(d&&ei(l,"start",!0)&&ei(s,"end")){let o=s,r=[];for(;r.push(o),!o.isTextblock;)o=o.lastChild;let i=l,a=1;for(;!i.isTextblock;i=i.firstChild)a++;if(o.canReplace(o.childCount,o.childCount,i.content)){if(n){let o=c.empty;for(let t=r.length-1;t>=0;t--)o=c.from(r[t].copy(o));n(t.tr.step(new _t(e.pos-r.length,e.pos+l.nodeSize,e.pos+a,e.pos+l.nodeSize-a,new m(o,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function li(t){return function(e,n){let o=e.selection,r=t<0?o.$from:o.$to,i=r.depth;for(;r.node(i).isInline;){if(!i)return!1;i--}return!!r.node(i).isTextblock&&(n&&n(e.tr.setSelection(ae.create(e.doc,t<0?r.start(i):r.end(i)))),!0)}}const ai=li(-1),ci=li(1);function di(t,e=null){return function(n,o){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:o},$to:{pos:s}}=n.selection.ranges[i];n.doc.nodesBetween(o,s,((o,i)=>{if(r)return!1;if(o.isTextblock&&!o.hasMarkup(t,e))if(o.type==t)r=!0;else{let e=n.doc.resolve(i),o=e.index();r=e.parent.canReplaceWith(o,o+1,t)}}))}if(!r)return!1;if(o){let r=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:i},$to:{pos:s}}=n.selection.ranges[o];r.setBlockType(i,s,t,e)}o(r.scrollIntoView())}return!0}}function hi(t,e=null){return function(n,o){let{$from:r,$to:i}=n.selection,s=r.blockRange(i),l=!1,a=s;if(!s)return!1;if(s.depth>=2&&r.node(s.depth-1).type.compatibleContent(t)&&0==s.startIndex){if(0==r.index(s.depth-1))return!1;let t=n.doc.resolve(s.start-2);a=new _(t,t,s.depth),s.endIndex<s.parent.childCount&&(s=new _(r,n.doc.resolve(i.end(s.depth)),s.depth)),l=!0}let d=Pt(a,t,e,s);return!!d&&(o&&o(function(t,e,n,o,r){let i=c.empty;for(let h=n.length-1;h>=0;h--)i=c.from(n[h].type.create(n[h].attrs,i));t.step(new _t(e.start-(o?2:0),e.end,e.start,e.end,new m(i,0,0),n.length,!0));let s=0;for(let c=0;c<n.length;c++)n[c].type==r&&(s=c+1);let l=n.length-s,a=e.start+n.length-(o?2:0),d=e.parent;for(let c=e.startIndex,h=e.endIndex,u=!0;c<h;c++,u=!1)!u&&Vt(t.doc,a,l)&&(t.split(a,l),a+=2*l),a+=d.child(c).nodeSize;return t}(n.tr,s,d,l,t).scrollIntoView()),!0)}}function ui(t){return function(e,n){let{$from:o,$to:r}=e.selection,i=o.blockRange(r,(e=>e.childCount>0&&e.firstChild.type==t));return!!i&&(!n||(o.node(i.depth-1).type==t?function(t,e,n,o){let r=t.tr,i=o.end,s=o.$to.end(o.depth);i<s&&(r.step(new _t(i-1,s,i,s,new m(c.from(n.create(null,o.parent.copy())),1,0),1,!0)),o=new _(r.doc.resolve(o.$from.pos),r.doc.resolve(s),o.depth));const l=It(o);if(null==l)return!1;r.lift(o,l);let a=r.mapping.map(i,-1)-1;Bt(r.doc,a)&&r.join(a);return e(r.scrollIntoView()),!0}(e,n,t,i):function(t,e,n){let o=t.tr,r=n.parent;for(let c=n.end,f=n.endIndex-1,m=n.startIndex;f>m;f--)c-=r.child(f).nodeSize,o.delete(c-1,c+1);let i=o.doc.resolve(n.start),s=i.nodeAfter;if(o.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let l=0==n.startIndex,a=n.endIndex==r.childCount,d=i.node(-1),h=i.index(-1);if(!d.canReplace(h+(l?0:1),h+1,s.content.append(a?c.empty:c.from(r))))return!1;let u=i.pos,p=u+s.nodeSize;return o.step(new _t(u-(l?1:0),p+(a?1:0),u+1,p-1,new m((l?c.empty:c.from(r.copy(c.empty))).append(a?c.empty:c.from(r.copy(c.empty))),l?0:1,a?0:1),l?0:1)),e(o.scrollIntoView()),!0}(e,n,i)))}}function pi(t){const{state:e,transaction:n}=t;let{selection:o}=n,{doc:r}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return o},get doc(){return r},get tr(){return o=n.selection,r=n.doc,i=n.storedMarks,n}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();class fi{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:o}=e,{tr:r}=n,i=this.buildProps(r);return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,(...t)=>{const n=e(...t)(i);return r.getMeta("preventDispatch")||this.hasCustomState||o.dispatch(r),n}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:o,state:r}=this,{view:i}=o,s=[],l=!!t,a=t||r.tr,c={...Object.fromEntries(Object.entries(n).map((([t,n])=>[t,(...t)=>{const o=this.buildProps(a,e),r=n(...t)(o);return s.push(r),c}]))),run:()=>(l||!e||a.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(a),s.every((t=>!0===t)))};return c}createCan(t){const{rawCommands:e,state:n}=this,o=!1,r=t||n.tr,i=this.buildProps(r,o),s=Object.fromEntries(Object.entries(e).map((([t,e])=>[t,(...t)=>e(...t)({...i,dispatch:void 0})])));return{...s,chain:()=>this.createChain(r,o)}}buildProps(t,e=!0){const{rawCommands:n,editor:o,state:r}=this,{view:i}=o,s={tr:t,editor:o,view:i,state:pi({state:r,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map((([t,e])=>[t,(...t)=>e(...t)(s)])))}};return s}}class mi{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach((t=>t.apply(this,e))),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter((t=>t!==e)):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}function gi(t,e,n){if(void 0===t.config[e]&&t.parent)return gi(t.parent,e,n);if("function"==typeof t.config[e]){return t.config[e].bind({...n,parent:t.parent?gi(t.parent,e,n):null})}return t.config[e]}function yi(t){return{baseExtensions:t.filter((t=>"extension"===t.type)),nodeExtensions:t.filter((t=>"node"===t.type)),markExtensions:t.filter((t=>"mark"===t.type))}}function bi(t){const e=[],{nodeExtensions:n,markExtensions:o}=yi(t),r=[...n,...o],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach((t=>{const n=gi(t,"addGlobalAttributes",{name:t.name,options:t.options,storage:t.storage,extensions:r});if(!n)return;n().forEach((t=>{t.types.forEach((n=>{Object.entries(t.attributes).forEach((([t,o])=>{e.push({type:n,name:t,attribute:{...i,...o}})}))}))}))})),r.forEach((t=>{const n={name:t.name,options:t.options,storage:t.storage},o=gi(t,"addAttributes",n);if(!o)return;const r=o();Object.entries(r).forEach((([n,o])=>{const r={...i,...o};"function"==typeof(null==r?void 0:r.default)&&(r.default=r.default()),(null==r?void 0:r.isRequired)&&void 0===(null==r?void 0:r.default)&&delete r.default,e.push({type:t.name,name:n,attribute:r})}))})),e}function wi(t,e){if("string"==typeof t){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function vi(...t){return t.filter((t=>!!t)).reduce(((t,e)=>{const n={...t};return Object.entries(e).forEach((([t,e])=>{if(n[t])if("class"===t){const o=e?e.split(" "):[],r=n[t]?n[t].split(" "):[],i=o.filter((t=>!r.includes(t)));n[t]=[...r,...i].join(" ")}else n[t]="style"===t?[n[t],e].join("; "):e;else n[t]=e})),n}),{})}function ki(t,e){return e.filter((t=>t.attribute.rendered)).map((e=>e.attribute.renderHTML?e.attribute.renderHTML(t.attrs)||{}:{[e.name]:t.attrs[e.name]})).reduce(((t,e)=>vi(t,e)),{})}function xi(t){return"function"==typeof t}function Ci(t,e=void 0,...n){return xi(t)?e?t.bind(e)(...n):t(...n):t}function Si(t,e){return"style"in t?t:{...t,getAttrs:n=>{const o=t.getAttrs?t.getAttrs(n):t.attrs;if(!1===o)return!1;const r=e.reduce(((t,e)=>{const o=e.attribute.parseHTML?e.attribute.parseHTML(n):function(t){return"string"!=typeof t?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):"true"===t||"false"!==t&&t}(n.getAttribute(e.name));return null==o?t:{...t,[e.name]:o}}),{});return{...o,...r}}}}function Mi(t){return Object.fromEntries(Object.entries(t).filter((([t,e])=>("attrs"!==t||!function(t={}){return 0===Object.keys(t).length&&t.constructor===Object}(e))&&null!=e)))}function Ei(t,e){var n;const o=bi(t),{nodeExtensions:r,markExtensions:i}=yi(t),s=null===(n=r.find((t=>gi(t,"topNode"))))||void 0===n?void 0:n.name,l=Object.fromEntries(r.map((n=>{const r=o.filter((t=>t.type===n.name)),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=Mi({...t.reduce(((t,e)=>{const o=gi(e,"extendNodeSchema",i);return{...t,...o?o(n):{}}}),{}),content:Ci(gi(n,"content",i)),marks:Ci(gi(n,"marks",i)),group:Ci(gi(n,"group",i)),inline:Ci(gi(n,"inline",i)),atom:Ci(gi(n,"atom",i)),selectable:Ci(gi(n,"selectable",i)),draggable:Ci(gi(n,"draggable",i)),code:Ci(gi(n,"code",i)),whitespace:Ci(gi(n,"whitespace",i)),defining:Ci(gi(n,"defining",i)),isolating:Ci(gi(n,"isolating",i)),attrs:Object.fromEntries(r.map((t=>{var e;return[t.name,{default:null===(e=null==t?void 0:t.attribute)||void 0===e?void 0:e.default}]})))}),l=Ci(gi(n,"parseHTML",i));l&&(s.parseDOM=l.map((t=>Si(t,r))));const a=gi(n,"renderHTML",i);a&&(s.toDOM=t=>a({node:t,HTMLAttributes:ki(t,r)}));const c=gi(n,"renderText",i);return c&&(s.toText=c),[n.name,s]}))),a=Object.fromEntries(i.map((n=>{const r=o.filter((t=>t.type===n.name)),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=Mi({...t.reduce(((t,e)=>{const o=gi(e,"extendMarkSchema",i);return{...t,...o?o(n):{}}}),{}),inclusive:Ci(gi(n,"inclusive",i)),excludes:Ci(gi(n,"excludes",i)),group:Ci(gi(n,"group",i)),spanning:Ci(gi(n,"spanning",i)),code:Ci(gi(n,"code",i)),attrs:Object.fromEntries(r.map((t=>{var e;return[t.name,{default:null===(e=null==t?void 0:t.attribute)||void 0===e?void 0:e.default}]})))}),l=Ci(gi(n,"parseHTML",i));l&&(s.parseDOM=l.map((t=>Si(t,r))));const a=gi(n,"renderHTML",i);return a&&(s.toDOM=t=>a({mark:t,HTMLAttributes:ki(t,r)})),[n.name,s]})));return new Y({topNode:s,nodes:l,marks:a})}function Ti(t,e){return e.nodes[t]||e.marks[t]||null}function Oi(t,e){return Array.isArray(e)?e.some((e=>("string"==typeof e?e:e.name)===t.name)):e}const Ai=(t,e=500)=>{let n="";const o=t.parentOffset;return t.parent.nodesBetween(Math.max(0,o-e),o,((t,e,r,i)=>{var s,l;const a=(null===(l=(s=t.type.spec).toText)||void 0===l?void 0:l.call(s,{node:t,pos:e,parent:r,index:i}))||t.textContent||"%leaf%";n+=t.isAtom&&!t.isText?a:a.slice(0,Math.max(0,o-e))})),n};function Ni(t){return"[object RegExp]"===Object.prototype.toString.call(t)}class _i{constructor(t){this.find=t.find,this.handler=t.handler}}const Li=(t,e)=>{if(Ni(e))return e.exec(t);const n=e(t);if(!n)return null;const o=[n.text];return o.index=n.index,o.input=t,o.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith),o.push(n.replaceWith)),o};function Di(t){var e;const{editor:n,from:o,to:r,text:i,rules:s,plugin:l}=t,{view:a}=n;if(a.composing)return!1;const c=a.state.doc.resolve(o);if(c.parent.type.spec.code||(null===(e=c.nodeBefore||c.nodeAfter)||void 0===e?void 0:e.marks.find((t=>t.type.spec.code))))return!1;let d=!1;const h=Ai(c)+i;return s.forEach((t=>{if(d)return;const e=Li(h,t.find);if(!e)return;const s=a.state.tr,c=pi({state:a.state,transaction:s}),u={from:o-(e[0].length-i.length),to:r},{commands:p,chain:f,can:m}=new fi({editor:n,state:c});null!==t.handler({state:c,range:u,match:e,commands:p,chain:f,can:m})&&s.steps.length&&(s.setMeta(l,{transform:s,from:o,to:r,text:i}),a.dispatch(s),d=!0)})),d}function Ri(t){const{editor:e,rules:n}=t,o=new Ce({state:{init:()=>null,apply(t,r){const i=t.getMeta(o);if(i)return i;const s=t.getMeta("applyInputRules");return!!s&&setTimeout((()=>{const{from:t,text:r}=s,i=t+r.length;Di({editor:e,from:t,to:i,text:r,rules:n,plugin:o})})),t.selectionSet||t.docChanged?null:r}},props:{handleTextInput:(t,r,i,s)=>Di({editor:e,from:r,to:i,text:s,rules:n,plugin:o}),handleDOMEvents:{compositionend:t=>(setTimeout((()=>{const{$cursor:r}=t.state.selection;r&&Di({editor:e,from:r.pos,to:r.pos,text:"",rules:n,plugin:o})})),!1)},handleKeyDown(t,r){if("Enter"!==r.key)return!1;const{$cursor:i}=t.state.selection;return!!i&&Di({editor:e,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:o})}},isInputRules:!0});return o}class Ii{constructor(t){this.find=t.find,this.handler=t.handler}}const Pi=(t,e,n)=>{if(Ni(e))return[...t.matchAll(e)];const o=e(t,n);return o?o.map((e=>{const n=[e.text];return n.index=e.index,n.input=t,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith),n.push(e.replaceWith)),n})):[]};function Hi(t){const{editor:e,rules:n}=t;let o=null,r=!1,i=!1,s="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l="undefined"!=typeof DragEvent?new DragEvent("drop"):null;const a=({state:t,from:n,to:o,rule:r,pasteEvt:i})=>{const a=t.tr,c=pi({state:t,transaction:a}),d=function(t){const{editor:e,state:n,from:o,to:r,rule:i,pasteEvent:s,dropEvent:l}=t,{commands:a,chain:c,can:d}=new fi({editor:e,state:n}),h=[];return n.doc.nodesBetween(o,r,((t,e)=>{if(!t.isTextblock||t.type.spec.code)return;const u=Math.max(o,e),p=Math.min(r,e+t.content.size),f=t.textBetween(u-e,p-e,void 0,"");Pi(f,i.find,s).forEach((t=>{if(void 0===t.index)return;const e=u+t.index+1,o=e+t[0].length,r={from:n.tr.mapping.map(e),to:n.tr.mapping.map(o)},p=i.handler({state:n,range:r,match:t,commands:a,chain:c,can:d,pasteEvent:s,dropEvent:l});h.push(p)}))})),h.every((t=>null!==t))}({editor:e,state:c,from:Math.max(n-1,0),to:o.b-1,rule:r,pasteEvent:i,dropEvent:l});if(d&&a.steps.length)return l="undefined"!=typeof DragEvent?new DragEvent("drop"):null,s="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,a},c=n.map((t=>new Ce({view(t){const e=e=>{var n;o=(null===(n=t.dom.parentElement)||void 0===n?void 0:n.contains(e.target))?t.dom.parentElement:null};return window.addEventListener("dragstart",e),{destroy(){window.removeEventListener("dragstart",e)}}},props:{handleDOMEvents:{drop:(t,e)=>(i=o===t.dom.parentElement,l=e,!1),paste:(t,e)=>{var n;const o=null===(n=e.clipboardData)||void 0===n?void 0:n.getData("text/html");return s=e,r=!!(null==o?void 0:o.includes("data-pm-slice")),!1}}},appendTransaction:(e,n,o)=>{const l=e[0],c="paste"===l.getMeta("uiEvent")&&!r,d="drop"===l.getMeta("uiEvent")&&!i,h=l.getMeta("applyPasteRules"),u=!!h;if(!c&&!d&&!u)return;if(u){const{from:e,text:n}=h,r=e+n.length,i=(t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null===(e=n.clipboardData)||void 0===e||e.setData("text/html",t),n})(n);return a({rule:t,state:o,from:e,to:{b:r},pasteEvt:i})}const p=n.doc.content.findDiffStart(o.doc.content),f=n.doc.content.findDiffEnd(o.doc.content);return"number"==typeof p&&f&&p!==f.b?a({rule:t,state:o,from:p,to:f,pasteEvt:s}):void 0}})));return c}class Vi{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=Vi.resolve(t),this.schema=Ei(this.extensions,e),this.setupExtensions()}static resolve(t){const e=Vi.sort(Vi.flatten(t)),n=function(t){const e=t.filter(((e,n)=>t.indexOf(e)!==n));return Array.from(new Set(e))}(e.map((t=>t.name)));return n.length,e}static flatten(t){return t.map((t=>{const e=gi(t,"addExtensions",{name:t.name,options:t.options,storage:t.storage});return e?[t,...this.flatten(e())]:t})).flat(10)}static sort(t){return t.sort(((t,e)=>{const n=gi(t,"priority")||100,o=gi(e,"priority")||100;return n>o?-1:n<o?1:0}))}get commands(){return this.extensions.reduce(((t,e)=>{const n=gi(e,"addCommands",{name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Ti(e.name,this.schema)});return n?{...t,...n()}:t}),{})}get plugins(){const{editor:t}=this,e=Vi.sort([...this.extensions].reverse()),n=[],o=[],r=e.map((e=>{const r={name:e.name,options:e.options,storage:e.storage,editor:t,type:Ti(e.name,this.schema)},i=[],s=gi(e,"addKeyboardShortcuts",r);let l={};if("mark"===e.type&&gi(e,"exitable",r)&&(l.ArrowRight=()=>Hs.handleExit({editor:t,mark:e})),s){const e=Object.fromEntries(Object.entries(s()).map((([e,n])=>[e,()=>n({editor:t})])));l={...l,...e}}const a=new Ce({props:{handleKeyDown:Yr(l)}});i.push(a);const c=gi(e,"addInputRules",r);Oi(e,t.options.enableInputRules)&&c&&n.push(...c());const d=gi(e,"addPasteRules",r);Oi(e,t.options.enablePasteRules)&&d&&o.push(...d());const h=gi(e,"addProseMirrorPlugins",r);if(h){const t=h();i.push(...t)}return i})).flat();return[Ri({editor:t,rules:n}),...Hi({editor:t,rules:o}),...r]}get attributes(){return bi(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=yi(this.extensions);return Object.fromEntries(e.filter((t=>!!gi(t,"addNodeView"))).map((e=>{const n=this.attributes.filter((t=>t.type===e.name)),o={name:e.name,options:e.options,storage:e.storage,editor:t,type:wi(e.name,this.schema)},r=gi(e,"addNodeView",o);if(!r)return[];return[e.name,(o,i,s,l)=>{const a=ki(o,n);return r()({editor:t,node:o,getPos:s,decorations:l,HTMLAttributes:a,extension:e})}]})))}setupExtensions(){this.extensions.forEach((t=>{var e;this.editor.extensionStorage[t.name]=t.storage;const n={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Ti(t.name,this.schema)};if("mark"===t.type){(null===(e=Ci(gi(t,"keepOnSplit",n)))||void 0===e||e)&&this.splittableMarks.push(t.name)}const o=gi(t,"onBeforeCreate",n),r=gi(t,"onCreate",n),i=gi(t,"onUpdate",n),s=gi(t,"onSelectionUpdate",n),l=gi(t,"onTransaction",n),a=gi(t,"onFocus",n),c=gi(t,"onBlur",n),d=gi(t,"onDestroy",n);o&&this.editor.on("beforeCreate",o),r&&this.editor.on("create",r),i&&this.editor.on("update",i),s&&this.editor.on("selectionUpdate",s),l&&this.editor.on("transaction",l),a&&this.editor.on("focus",a),c&&this.editor.on("blur",c),d&&this.editor.on("destroy",d)}))}}function Bi(t){return"Object"===function(t){return Object.prototype.toString.call(t).slice(8,-1)}(t)&&(t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype)}function ji(t,e){const n={...t};return Bi(t)&&Bi(e)&&Object.keys(e).forEach((o=>{Bi(e[o])&&Bi(t[o])?n[o]=ji(t[o],e[o]):n[o]=e[o]})),n}class zi{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ci(gi(this,"addOptions",{name:this.name}))),this.storage=Ci(gi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new zi(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>ji(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new zi({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length,e.options=Ci(gi(e,"addOptions",{name:e.name})),e.storage=Ci(gi(e,"addStorage",{name:e.name,options:e.options})),e}}function Fi(t,e,n){const{from:o,to:r}=e,{blockSeparator:i="\n\n",textSerializers:s={}}=n||{};let l="";return t.nodesBetween(o,r,((t,n,a,c)=>{var d;t.isBlock&&n>o&&(l+=i);const h=null==s?void 0:s[t.type.name];if(h)return a&&(l+=h({node:t,pos:n,parent:a,index:c,range:e})),!1;t.isText&&(l+=null===(d=null==t?void 0:t.text)||void 0===d?void 0:d.slice(Math.max(o,n)-n,r-n))})),l}function $i(t){return Object.fromEntries(Object.entries(t.nodes).filter((([,t])=>t.spec.toText)).map((([t,e])=>[t,e.spec.toText])))}const Ui=zi.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new Ce({key:new Ee("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:o,selection:r}=e,{ranges:i}=r,s=Math.min(...i.map((t=>t.$from.pos))),l=Math.max(...i.map((t=>t.$to.pos))),a=$i(n);return Fi(o,{from:s,to:l},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:a})}}})]}});function Wi(t,e,n={strict:!0}){const o=Object.keys(e);return!o.length||o.every((o=>n.strict?e[o]===t[o]:Ni(e[o])?e[o].test(t[o]):e[o]===t[o]))}function qi(t,e,n={}){return t.find((t=>t.type===e&&Wi(t.attrs,n)))}function Ji(t,e,n={}){return!!qi(t,e,n)}function Ki(t,e,n={}){if(!t||!e)return;let o=t.parent.childAfter(t.parentOffset);if(t.parentOffset===o.offset&&0!==o.offset&&(o=t.parent.childBefore(t.parentOffset)),!o.node)return;const r=qi([...o.node.marks],e,n);if(!r)return;let i=o.index,s=t.start()+o.offset,l=i+1,a=s+o.node.nodeSize;for(qi([...o.node.marks],e,n);i>0&&r.isInSet(t.parent.child(i-1).marks);)i-=1,s-=t.parent.child(i).nodeSize;for(;l<t.parent.childCount&&Ji([...t.parent.child(l).marks],e,n);)a+=t.parent.child(l).nodeSize,l+=1;return{from:s,to:a}}function Zi(t,e){if("string"==typeof t){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}function Gi(t){return t instanceof ae}function Xi(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Yi(t,e=null){if(!e)return null;const n=re.atStart(t),o=re.atEnd(t);if("start"===e||!0===e)return n;if("end"===e)return o;const r=n.from,i=o.to;return"all"===e?ae.create(t,Xi(0,r,i),Xi(t.content.size,r,i)):ae.create(t,Xi(e,r,i),Xi(e,r,i))}function Qi(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const ts=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const o=e[n];3===o.nodeType&&o.nodeValue&&/^(\n\s\s|\n)$/.test(o.nodeValue)?t.removeChild(o):1===o.nodeType&&ts(o)}return t};function es(t){const e=`<body>${t}</body>`,n=(new window.DOMParser).parseFromString(e,"text/html").body;return ts(n)}function ns(t,e,n){n={slice:!0,parseOptions:{},...n};const o="string"==typeof t;if("object"==typeof t&&null!==t)try{if(Array.isArray(t)&&t.length>0)return c.fromArray(t.map((t=>e.nodeFromJSON(t))));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return ns("",e,n)}if(o){if(n.errorOnInvalidContent){let o=!1,r="";const i=new Y({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:t=>(o=!0,r="string"==typeof t?t:t.outerHTML,null)}]}})});if(n.slice?tt.fromSchema(i).parseSlice(es(t),n.parseOptions):tt.fromSchema(i).parse(es(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${r}`)})}const o=tt.fromSchema(e);return n.slice?o.parseSlice(es(t),n.parseOptions).content:o.parse(es(t),n.parseOptions)}return ns("",e,n)}function rs(t,e,n){const o=t.steps.length-1;if(o<e)return;const r=t.steps[o];if(!(r instanceof Nt||r instanceof _t))return;const i=t.mapping.maps[o];let s=0;i.forEach(((t,e,n,o)=>{0===s&&(s=o)})),t.setSelection(re.near(t.doc.resolve(s),n))}function is(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function ss(t,e,n={}){const{from:o,to:r,empty:i}=t.selection,s=e?wi(e,t.schema):null,l=[];t.doc.nodesBetween(o,r,((t,e)=>{if(t.isText)return;const n=Math.max(o,e),i=Math.min(r,e+t.nodeSize);l.push({node:t,from:n,to:i})}));const a=r-o,c=l.filter((t=>!s||s.name===t.node.type.name)).filter((t=>Wi(t.node.attrs,n,{strict:!1})));if(i)return!!c.length;return c.reduce(((t,e)=>t+e.to-e.from),0)>=a}function ls(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function as(t,e){const n="string"==typeof e?[e]:e;return Object.keys(t).reduce(((e,o)=>(n.includes(o)||(e[o]=t[o]),e)),{})}function cs(t,e,n={},o={}){return ns(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:o.errorOnInvalidContent})}function ds(t,e){const n=Zi(e,t.schema),{from:o,to:r,empty:i}=t.selection,s=[];i?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(o,r,(t=>{s.push(...t.marks)}));const l=s.find((t=>t.type.name===n.name));return l?{...l.attrs}:{}}function hs(t,e){const n=new ne(t);return e.forEach((t=>{t.steps.forEach((t=>{n.step(t)}))})),n}function us(t,e){const n=[];return t.descendants(((t,o)=>{e(t)&&n.push({node:t,pos:o})})),n}function ps(t,e,n){const o=[];return t.nodesBetween(e.from,e.to,((t,e)=>{n(t)&&o.push({node:t,pos:e})})),o}function fs(t){return e=>function(t,e){for(let n=t.depth;n>0;n-=1){const o=t.node(n);if(e(o))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:o}}}(e.$from,t)}function ms(t,e){const n=ls("string"==typeof e?e:e.name,t.schema);return"node"===n?function(t,e){const n=wi(e,t.schema),{from:o,to:r}=t.selection,i=[];t.doc.nodesBetween(o,r,(t=>{i.push(t)}));const s=i.reverse().find((t=>t.type.name===n.name));return s?{...s.attrs}:{}}(t,e):"mark"===n?ds(t,e):{}}function gs(t){const e=function(t,e=JSON.stringify){const n={};return t.filter((t=>{const o=e(t);return!Object.prototype.hasOwnProperty.call(n,o)&&(n[o]=!0)}))}(t);return 1===e.length?e:e.filter(((t,n)=>{const o=e.filter(((t,e)=>e!==n));return!o.some((e=>t.oldRange.from>=e.oldRange.from&&t.oldRange.to<=e.oldRange.to&&t.newRange.from>=e.newRange.from&&t.newRange.to<=e.newRange.to))}))}function ys(t){const{mapping:e,steps:n}=t,o=[];return e.maps.forEach(((t,r)=>{const i=[];if(t.ranges.length)t.forEach(((t,e)=>{i.push({from:t,to:e})}));else{const{from:t,to:e}=n[r];if(void 0===t||void 0===e)return;i.push({from:t,to:e})}i.forEach((({from:t,to:n})=>{const i=e.slice(r).map(t,-1),s=e.slice(r).map(n),l=e.invert().map(i,-1),a=e.invert().map(s);o.push({oldRange:{from:l,to:a},newRange:{from:i,to:s}})}))})),gs(o)}function bs(t,e,n){const o=[];return t===e?n.resolve(t).marks().forEach((e=>{const r=Ki(n.resolve(t),e.type);r&&o.push({mark:e,...r})})):n.nodesBetween(t,e,((t,e)=>{t&&void 0!==(null==t?void 0:t.nodeSize)&&o.push(...t.marks.map((n=>({from:e,to:e+t.nodeSize,mark:n}))))})),o}function ws(t,e,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const o=t.find((t=>t.type===e&&t.name===n));return!!o&&o.attribute.keepOnSplit})))}function vs(t,e,n={}){const{empty:o,ranges:r}=t.selection,i=e?Zi(e,t.schema):null;if(o)return!!(t.storedMarks||t.selection.$from.marks()).filter((t=>!i||i.name===t.type.name)).find((t=>Wi(t.attrs,n,{strict:!1})));let s=0;const l=[];if(r.forEach((({$from:e,$to:n})=>{const o=e.pos,r=n.pos;t.doc.nodesBetween(o,r,((t,e)=>{if(!t.isText&&!t.marks.length)return;const n=Math.max(o,e),i=Math.min(r,e+t.nodeSize);s+=i-n,l.push(...t.marks.map((t=>({mark:t,from:n,to:i}))))}))})),0===s)return!1;const a=l.filter((t=>!i||i.name===t.mark.type.name)).filter((t=>Wi(t.mark.attrs,n,{strict:!1}))).reduce(((t,e)=>t+e.to-e.from),0),c=l.filter((t=>!i||t.mark.type!==i&&t.mark.type.excludes(i))).reduce(((t,e)=>t+e.to-e.from),0);return(a>0?a+c:a)>=s}function ks(t,e){const{nodeExtensions:n}=yi(e),o=n.find((e=>e.name===t));if(!o)return!1;const r=Ci(gi(o,"group",{name:o.name,options:o.options,storage:o.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function xs(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var o;if(n){if("hardBreak"===t.type.name)return!0;if(t.isText)return/^\s*$/m.test(null!==(o=t.text)&&void 0!==o?o:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(0===t.content.childCount)return!0;if(e){let o=!0;return t.content.forEach((t=>{!1!==o&&(xs(t,{ignoreWhitespace:n,checkChildren:e})||(o=!1))})),o}return!1}function Cs(t,e,n){const o=t.state.doc.content.size,r=Xi(e,0,o),i=Xi(n,0,o),s=t.coordsAtPos(r),l=t.coordsAtPos(i,-1),a=Math.min(s.top,l.top),c=Math.max(s.bottom,l.bottom),d=Math.min(s.left,l.left),h=Math.max(s.right,l.right),u={top:a,bottom:c,left:d,right:h,width:h-d,height:c-a,x:d,y:a};return{...u,toJSON:()=>u}}function Ss(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const o=n.filter((t=>null==e?void 0:e.includes(t.type.name)));t.tr.ensureMarks(o)}}const Ms=(t,e)=>{const n=fs((t=>t.type===e))(t.selection);if(!n)return!0;const o=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===o)return!0;const r=t.doc.nodeAt(o);return n.node.type!==(null==r?void 0:r.type)||!Bt(t.doc,n.pos)||(t.join(n.pos),!0)},Es=(t,e)=>{const n=fs((t=>t.type===e))(t.selection);if(!n)return!0;const o=t.doc.resolve(n.start).after(n.depth);if(void 0===o)return!0;const r=t.doc.nodeAt(o);return n.node.type!==(null==r?void 0:r.type)||!Bt(t.doc,o)||(t.join(o),!0)};var Ts=Object.freeze({__proto__:null,blur:()=>({editor:t,view:e})=>(requestAnimationFrame((()=>{var n;t.isDestroyed||(e.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),clearContent:(t=!1)=>({commands:e})=>e.setContent("",t),clearNodes:()=>({state:t,tr:e,dispatch:n})=>{const{selection:o}=e,{ranges:r}=o;return!n||(r.forEach((({$from:n,$to:o})=>{t.doc.nodesBetween(n.pos,o.pos,((t,n)=>{if(t.type.isText)return;const{doc:o,mapping:r}=e,i=o.resolve(r.map(n)),s=o.resolve(r.map(n+t.nodeSize)),l=i.blockRange(s);if(!l)return;const a=It(l);if(t.type.isTextblock){const{defaultType:t}=i.parent.contentMatchAt(i.index());e.setNodeMarkup(l.start,t)}(a||0===a)&&e.lift(l,a)}))})),!0)},command:t=>e=>t(e),createParagraphNear:()=>({state:t,dispatch:e})=>((t,e)=>{let n=t.selection,{$from:o,$to:r}=n;if(n instanceof ue||o.parent.inlineContent||r.parent.inlineContent)return!1;let i=ii(r.parent.contentMatchAt(r.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let n=(!o.parentOffset&&r.index()<r.parent.childCount?o:r).pos,s=t.tr.insert(n,i.createAndFill());s.setSelection(ae.create(s.doc,n+1)),e(s.scrollIntoView())}return!0})(t,e),cut:(t,e)=>({editor:n,tr:o})=>{const{state:r}=n,i=r.doc.slice(t.from,t.to);o.deleteRange(t.from,t.to);const s=o.mapping.map(e);return o.insert(s,i.content),o.setSelection(new ae(o.doc.resolve(s-1))),!0},deleteCurrentNode:()=>({tr:t,dispatch:e})=>{const{selection:n}=t,o=n.$anchor.node();if(o.content.size>0)return!1;const r=t.selection.$anchor;for(let i=r.depth;i>0;i-=1){if(r.node(i).type===o.type){if(e){const e=r.before(i),n=r.after(i);t.delete(e,n).scrollIntoView()}return!0}}return!1},deleteNode:t=>({tr:e,state:n,dispatch:o})=>{const r=wi(t,n.schema),i=e.selection.$anchor;for(let t=i.depth;t>0;t-=1){if(i.node(t).type===r){if(o){const n=i.before(t),o=i.after(t);e.delete(n,o).scrollIntoView()}return!0}}return!1},deleteRange:t=>({tr:e,dispatch:n})=>{const{from:o,to:r}=t;return n&&e.delete(o,r),!0},deleteSelection:()=>({state:t,dispatch:e})=>((t,e)=>!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0))(t,e),enter:()=>({commands:t})=>t.keyboardShortcut("Enter"),exitCode:()=>({state:t,dispatch:e})=>((t,e)=>{let{$head:n,$anchor:o}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;let r=n.node(-1),i=n.indexAfter(-1),s=ii(r.contentMatchAt(i));if(!s||!r.canReplaceWith(i,i,s))return!1;if(e){let o=n.after(),r=t.tr.replaceWith(o,o,s.createAndFill());r.setSelection(re.near(r.doc.resolve(o),1)),e(r.scrollIntoView())}return!0})(t,e),extendMarkRange:(t,e={})=>({tr:n,state:o,dispatch:r})=>{const i=Zi(t,o.schema),{doc:s,selection:l}=n,{$from:a,from:c,to:d}=l;if(r){const t=Ki(a,i,e);if(t&&t.from<=c&&t.to>=d){const e=ae.create(s,t.from,t.to);n.setSelection(e)}}return!0},first:t=>e=>{const n="function"==typeof t?t(e):t;for(let t=0;t<n.length;t+=1)if(n[t](e))return!0;return!1},focus:(t=null,e={})=>({editor:n,view:o,tr:r,dispatch:i})=>{e={scrollIntoView:!0,...e};const s=()=>{Qi()&&o.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(o.focus(),(null==e?void 0:e.scrollIntoView)&&n.commands.scrollIntoView())}))};if(o.hasFocus()&&null===t||!1===t)return!0;if(i&&null===t&&!Gi(n.state.selection))return s(),!0;const l=Yi(r.doc,t)||n.state.selection,a=n.state.selection.eq(l);return i&&(a||r.setSelection(l),a&&r.storedMarks&&r.setStoredMarks(r.storedMarks),s()),!0},forEach:(t,e)=>n=>t.every(((t,o)=>e(t,{...n,index:o}))),insertContent:(t,e)=>({tr:n,commands:o})=>o.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),insertContentAt:(t,e,n)=>({tr:o,dispatch:r,editor:i})=>{var s;if(r){let r;n={parseOptions:{},updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};try{r=ns(e,i.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:null!==(s=n.errorOnInvalidContent)&&void 0!==s?s:i.options.enableContentCheck})}catch(l){return i.emit("contentError",{editor:i,error:l,disableCollaboration:()=>{}}),!1}let{from:a,to:c}="number"==typeof t?{from:t,to:t}:{from:t.from,to:t.to},d=!0,h=!0;if(("type"in r?[r]:r).forEach((t=>{t.check(),d=!!d&&(t.isText&&0===t.marks.length),h=!!h&&t.isBlock})),a===c&&h){const{parent:t}=o.doc.resolve(a);t.isTextblock&&!t.type.spec.code&&!t.childCount&&(a-=1,c+=1)}let u;d?(u=Array.isArray(e)?e.map((t=>t.text||"")).join(""):"object"==typeof e&&e&&e.text?e.text:e,o.insertText(u,a,c)):(u=r,o.replaceWith(a,c,u)),n.updateSelection&&rs(o,o.steps.length-1,-1),n.applyInputRules&&o.setMeta("applyInputRules",{from:a,text:u}),n.applyPasteRules&&o.setMeta("applyPasteRules",{from:a,text:u})}return!0},joinBackward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let o=Qr(t,n);if(!o)return!1;let r=ni(o);if(!r){let n=o.blockRange(),r=n&&It(n);return null!=r&&(e&&e(t.tr.lift(n,r).scrollIntoView()),!0)}let i=r.nodeBefore;if(si(t,r,e,-1))return!0;if(0==o.parent.content.size&&(ei(i,"end")||de.isSelectable(i)))for(let s=o.depth;;s--){let n=$t(t.doc,o.before(s),o.after(s),m.empty);if(n&&n.slice.size<n.to-n.from){if(e){let o=t.tr.step(n);o.setSelection(ei(i,"end")?re.findFrom(o.doc.resolve(o.mapping.map(r.pos,-1)),-1):de.create(o.doc,r.pos-i.nodeSize)),e(o.scrollIntoView())}return!0}if(1==s||o.node(s-1).childCount>1)break}return!(!i.isAtom||r.depth!=o.depth-1||(e&&e(t.tr.delete(r.pos-i.nodeSize,r.pos).scrollIntoView()),0))})(t,e),joinDown:()=>({state:t,dispatch:e})=>((t,e)=>{let n,o=t.selection;if(o instanceof de){if(o.node.isTextblock||!Bt(t.doc,o.to))return!1;n=o.to}else if(n=zt(t.doc,o.to,1),null==n)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0})(t,e),joinForward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let o=oi(t,n);if(!o)return!1;let r=ri(o);if(!r)return!1;let i=r.nodeAfter;if(si(t,r,e,1))return!0;if(0==o.parent.content.size&&(ei(i,"start")||de.isSelectable(i))){let n=$t(t.doc,o.before(),o.after(),m.empty);if(n&&n.slice.size<n.to-n.from){if(e){let o=t.tr.step(n);o.setSelection(ei(i,"start")?re.findFrom(o.doc.resolve(o.mapping.map(r.pos)),1):de.create(o.doc,o.mapping.map(r.pos))),e(o.scrollIntoView())}return!0}}return!(!i.isAtom||r.depth!=o.depth-1||(e&&e(t.tr.delete(r.pos,r.pos+i.nodeSize).scrollIntoView()),0))})(t,e),joinItemBackward:()=>({state:t,dispatch:e,tr:n})=>{try{const o=zt(t.doc,t.selection.$from.pos,-1);return null!=o&&(n.join(o,2),e&&e(n),!0)}catch(o){return!1}},joinItemForward:()=>({state:t,dispatch:e,tr:n})=>{try{const o=zt(t.doc,t.selection.$from.pos,1);return null!=o&&(n.join(o,2),e&&e(n),!0)}catch(o){return!1}},joinTextblockBackward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let o=Qr(t,n);if(!o)return!1;let r=ni(o);return!!r&&ti(t,r,e)})(t,e),joinTextblockForward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let o=oi(t,n);if(!o)return!1;let r=ri(o);return!!r&&ti(t,r,e)})(t,e),joinUp:()=>({state:t,dispatch:e})=>((t,e)=>{let n,o=t.selection,r=o instanceof de;if(r){if(o.node.isTextblock||!Bt(t.doc,o.from))return!1;n=o.from}else if(n=zt(t.doc,o.from,-1),null==n)return!1;if(e){let o=t.tr.join(n);r&&o.setSelection(de.create(o.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(o.scrollIntoView())}return!0})(t,e),keyboardShortcut:t=>({editor:e,view:n,tr:o,dispatch:r})=>{const i=function(t){const e=t.split(/-(?!$)/);let n,o,r,i,s=e[e.length-1];"Space"===s&&(s=" ");for(let l=0;l<e.length-1;l+=1){const t=e[l];if(/^(cmd|meta|m)$/i.test(t))i=!0;else if(/^a(lt)?$/i.test(t))n=!0;else if(/^(c|ctrl|control)$/i.test(t))o=!0;else if(/^s(hift)?$/i.test(t))r=!0;else{if(!/^mod$/i.test(t))throw new Error(`Unrecognized modifier name: ${t}`);Qi()||is()?i=!0:o=!0}}return n&&(s=`Alt-${s}`),o&&(s=`Ctrl-${s}`),i&&(s=`Meta-${s}`),r&&(s=`Shift-${s}`),s}(t).split(/-(?!$)/),s=i.find((t=>!["Alt","Ctrl","Meta","Shift"].includes(t))),l=new KeyboardEvent("keydown",{key:"Space"===s?" ":s,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),a=e.captureTransaction((()=>{n.someProp("handleKeyDown",(t=>t(n,l)))}));return null==a||a.steps.forEach((t=>{const e=t.map(o.mapping);e&&r&&o.maybeStep(e)})),!0},lift:(t,e={})=>({state:n,dispatch:o})=>!!ss(n,wi(t,n.schema),e)&&((t,e)=>{let{$from:n,$to:o}=t.selection,r=n.blockRange(o),i=r&&It(r);return null!=i&&(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)})(n,o),liftEmptyBlock:()=>({state:t,dispatch:e})=>((t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if(Vt(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}let o=n.blockRange(),r=o&&It(o);return null!=r&&(e&&e(t.tr.lift(o,r).scrollIntoView()),!0)})(t,e),liftListItem:t=>({state:e,dispatch:n})=>ui(wi(t,e.schema))(e,n),newlineInCode:()=>({state:t,dispatch:e})=>((t,e)=>{let{$head:n,$anchor:o}=t.selection;return!(!n.parent.type.spec.code||!n.sameParent(o)||(e&&e(t.tr.insertText("\n").scrollIntoView()),0))})(t,e),resetAttributes:(t,e)=>({tr:n,state:o,dispatch:r})=>{let i=null,s=null;const l=ls("string"==typeof t?t:t.name,o.schema);return!!l&&("node"===l&&(i=wi(t,o.schema)),"mark"===l&&(s=Zi(t,o.schema)),r&&n.selection.ranges.forEach((t=>{o.doc.nodesBetween(t.$from.pos,t.$to.pos,((t,o)=>{i&&i===t.type&&n.setNodeMarkup(o,void 0,as(t.attrs,e)),s&&t.marks.length&&t.marks.forEach((r=>{s===r.type&&n.addMark(o,o+t.nodeSize,s.create(as(r.attrs,e)))}))}))})),!0)},scrollIntoView:()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),selectAll:()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),selectNodeBackward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let{$head:o,empty:r}=t.selection,i=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):o.parentOffset>0)return!1;i=ni(o)}let s=i&&i.nodeBefore;return!(!s||!de.isSelectable(s)||(e&&e(t.tr.setSelection(de.create(t.doc,i.pos-s.nodeSize)).scrollIntoView()),0))})(t,e),selectNodeForward:()=>({state:t,dispatch:e})=>((t,e,n)=>{let{$head:o,empty:r}=t.selection,i=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size)return!1;i=ri(o)}let s=i&&i.nodeAfter;return!(!s||!de.isSelectable(s)||(e&&e(t.tr.setSelection(de.create(t.doc,i.pos)).scrollIntoView()),0))})(t,e),selectParentNode:()=>({state:t,dispatch:e})=>((t,e)=>{let n,{$from:o,to:r}=t.selection,i=o.sharedDepth(r);return 0!=i&&(n=o.before(i),e&&e(t.tr.setSelection(de.create(t.doc,n))),!0)})(t,e),selectTextblockEnd:()=>({state:t,dispatch:e})=>ci(t,e),selectTextblockStart:()=>({state:t,dispatch:e})=>ai(t,e),setContent:(t,e=!1,n={},o={})=>({editor:r,tr:i,dispatch:s,commands:l})=>{var a,c;const{doc:d}=i;if("full"!==n.preserveWhitespace){const l=cs(t,r.schema,n,{errorOnInvalidContent:null!==(a=o.errorOnInvalidContent)&&void 0!==a?a:r.options.enableContentCheck});return s&&i.replaceWith(0,d.content.size,l).setMeta("preventUpdate",!e),!0}return s&&i.setMeta("preventUpdate",!e),l.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:null!==(c=o.errorOnInvalidContent)&&void 0!==c?c:r.options.enableContentCheck})},setMark:(t,e={})=>({tr:n,state:o,dispatch:r})=>{const{selection:i}=n,{empty:s,ranges:l}=i,a=Zi(t,o.schema);if(r)if(s){const t=ds(o,a);n.addStoredMark(a.create({...t,...e}))}else l.forEach((t=>{const r=t.$from.pos,i=t.$to.pos;o.doc.nodesBetween(r,i,((t,o)=>{const s=Math.max(o,r),l=Math.min(o+t.nodeSize,i);t.marks.find((t=>t.type===a))?t.marks.forEach((t=>{a===t.type&&n.addMark(s,l,a.create({...t.attrs,...e}))})):n.addMark(s,l,a.create(e))}))}));return function(t,e,n){var o;const{selection:r}=e;let i=null;if(Gi(r)&&(i=r.$cursor),i){const e=null!==(o=t.storedMarks)&&void 0!==o?o:i.marks();return!!n.isInSet(e)||!e.some((t=>t.type.excludes(n)))}const{ranges:s}=r;return s.some((({$from:e,$to:o})=>{let r=0===e.depth&&t.doc.inlineContent&&t.doc.type.allowsMarkType(n);return t.doc.nodesBetween(e.pos,o.pos,((t,e,o)=>{if(r)return!1;if(t.isInline){const e=!o||o.type.allowsMarkType(n),i=!!n.isInSet(t.marks)||!t.marks.some((t=>t.type.excludes(n)));r=e&&i}return!r})),r}))}(o,n,a)},setMeta:(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),setNode:(t,e={})=>({state:n,dispatch:o,chain:r})=>{const i=wi(t,n.schema);return!!i.isTextblock&&r().command((({commands:t})=>!!di(i,e)(n)||t.clearNodes())).command((({state:t})=>di(i,e)(t,o))).run()},setNodeSelection:t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,o=Xi(t,0,n.content.size),r=de.create(n,o);e.setSelection(r)}return!0},setTextSelection:t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,{from:o,to:r}="number"==typeof t?{from:t,to:t}:t,i=ae.atStart(n).from,s=ae.atEnd(n).to,l=Xi(o,i,s),a=Xi(r,i,s),c=ae.create(n,l,a);e.setSelection(c)}return!0},sinkListItem:t=>({state:e,dispatch:n})=>{const o=wi(t,e.schema);return(r=o,function(t,e){let{$from:n,$to:o}=t.selection,i=n.blockRange(o,(t=>t.childCount>0&&t.firstChild.type==r));if(!i)return!1;let s=i.startIndex;if(0==s)return!1;let l=i.parent,a=l.child(s-1);if(a.type!=r)return!1;if(e){let n=a.lastChild&&a.lastChild.type==l.type,o=c.from(n?r.create():null),s=new m(c.from(r.create(null,c.from(l.type.create(null,o)))),n?3:1,0),d=i.start,h=i.end;e(t.tr.step(new _t(d-(n?3:1),h,d,h,s,1,!0)).scrollIntoView())}return!0})(e,n);var r},splitBlock:({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:o,editor:r})=>{const{selection:i,doc:s}=e,{$from:l,$to:a}=i,c=ws(r.extensionManager.attributes,l.node().type.name,l.node().attrs);if(i instanceof de&&i.node.isBlock)return!(!l.parentOffset||!Vt(s,l.pos))&&(o&&(t&&Ss(n,r.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const d=a.parentOffset===a.parent.content.size,h=0===l.depth?void 0:function(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(l.node(-1).contentMatchAt(l.indexAfter(-1)));let u=d&&h?[{type:h,attrs:c}]:void 0,p=Vt(e.doc,e.mapping.map(l.pos),1,u);if(u||p||!Vt(e.doc,e.mapping.map(l.pos),1,h?[{type:h}]:void 0)||(p=!0,u=h?[{type:h,attrs:c}]:void 0),o){if(p&&(i instanceof ae&&e.deleteSelection(),e.split(e.mapping.map(l.pos),1,u),h&&!d&&!l.parentOffset&&l.parent.type!==h)){const t=e.mapping.map(l.before()),n=e.doc.resolve(t);l.node(-1).canReplaceWith(n.index(),n.index()+1,h)&&e.setNodeMarkup(e.mapping.map(l.before()),h)}t&&Ss(n,r.extensionManager.splittableMarks),e.scrollIntoView()}return p},splitListItem:(t,e={})=>({tr:n,state:o,dispatch:r,editor:i})=>{var s;const l=wi(t,o.schema),{$from:a,$to:d}=o.selection,h=o.selection.node;if(h&&h.isBlock||a.depth<2||!a.sameParent(d))return!1;const u=a.node(-1);if(u.type!==l)return!1;const p=i.extensionManager.attributes;if(0===a.parent.content.size&&a.node(-1).childCount===a.indexAfter(-1)){if(2===a.depth||a.node(-3).type!==l||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let t=c.empty;const o=a.index(-1)?1:a.index(-2)?2:3;for(let e=a.depth-o;e>=a.depth-3;e-=1)t=c.from(a.node(e).copy(t));const r=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,i={...ws(p,a.node().type.name,a.node().attrs),...e},d=(null===(s=l.contentMatch.defaultType)||void 0===s?void 0:s.createAndFill(i))||void 0;t=t.append(c.from(l.createAndFill(null,d)||void 0));const h=a.before(a.depth-(o-1));n.replace(h,a.after(-r),new m(t,4-o,0));let u=-1;n.doc.nodesBetween(h,n.doc.content.size,((t,e)=>{if(u>-1)return!1;t.isTextblock&&0===t.content.size&&(u=e+1)})),u>-1&&n.setSelection(ae.near(n.doc.resolve(u))),n.scrollIntoView()}return!0}const f=d.pos===a.end()?u.contentMatchAt(0).defaultType:null,g={...ws(p,u.type.name,u.attrs),...e},y={...ws(p,a.node().type.name,a.node().attrs),...e};n.delete(a.pos,d.pos);const b=f?[{type:l,attrs:g},{type:f,attrs:y}]:[{type:l,attrs:g}];if(!Vt(n.doc,a.pos,2))return!1;if(r){const{selection:t,storedMarks:e}=o,{splittableMarks:s}=i.extensionManager,l=e||t.$to.parentOffset&&t.$from.marks();if(n.split(a.pos,2,b).scrollIntoView(),!l||!r)return!0;const c=l.filter((t=>s.includes(t.type.name)));n.ensureMarks(c)}return!0},toggleList:(t,e,n,o={})=>({editor:r,tr:i,state:s,dispatch:l,chain:a,commands:c,can:d})=>{const{extensions:h,splittableMarks:u}=r.extensionManager,p=wi(t,s.schema),f=wi(e,s.schema),{selection:m,storedMarks:g}=s,{$from:y,$to:b}=m,w=y.blockRange(b),v=g||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const k=fs((t=>ks(t.type.name,h)))(m);if(w.depth>=1&&k&&w.depth-k.depth<=1){if(k.node.type===p)return c.liftListItem(f);if(ks(k.node.type.name,h)&&p.validContent(k.node.content)&&l)return a().command((()=>(i.setNodeMarkup(k.pos,p),!0))).command((()=>Ms(i,p))).command((()=>Es(i,p))).run()}return n&&v&&l?a().command((()=>{const t=d().wrapInList(p,o),e=v.filter((t=>u.includes(t.type.name)));return i.ensureMarks(e),!!t||c.clearNodes()})).wrapInList(p,o).command((()=>Ms(i,p))).command((()=>Es(i,p))).run():a().command((()=>!!d().wrapInList(p,o)||c.clearNodes())).wrapInList(p,o).command((()=>Ms(i,p))).command((()=>Es(i,p))).run()},toggleMark:(t,e={},n={})=>({state:o,commands:r})=>{const{extendEmptyMarkRange:i=!1}=n,s=Zi(t,o.schema);return vs(o,s,e)?r.unsetMark(s,{extendEmptyMarkRange:i}):r.setMark(s,e)},toggleNode:(t,e,n={})=>({state:o,commands:r})=>{const i=wi(t,o.schema),s=wi(e,o.schema);return ss(o,i,n)?r.setNode(s):r.setNode(i,n)},toggleWrap:(t,e={})=>({state:n,commands:o})=>{const r=wi(t,n.schema);return ss(n,r,e)?o.lift(r):o.wrapIn(r,e)},undoInputRule:()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let o=0;o<n.length;o+=1){const r=n[o];let i;if(r.spec.isInputRules&&(i=r.getState(t))){if(e){const e=t.tr,n=i.transform;for(let t=n.steps.length-1;t>=0;t-=1)e.step(n.steps[t].invert(n.docs[t]));if(i.text){const n=e.doc.resolve(i.from).marks();e.replaceWith(i.from,i.to,t.schema.text(i.text,n))}else e.delete(i.from,i.to)}return!0}}return!1},unsetAllMarks:()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:o,ranges:r}=n;return o||e&&r.forEach((e=>{t.removeMark(e.$from.pos,e.$to.pos)})),!0},unsetMark:(t,e={})=>({tr:n,state:o,dispatch:r})=>{var i;const{extendEmptyMarkRange:s=!1}=e,{selection:l}=n,a=Zi(t,o.schema),{$from:c,empty:d,ranges:h}=l;if(!r)return!0;if(d&&s){let{from:t,to:e}=l;const o=null===(i=c.marks().find((t=>t.type===a)))||void 0===i?void 0:i.attrs,r=Ki(c,a,o);r&&(t=r.from,e=r.to),n.removeMark(t,e,a)}else h.forEach((t=>{n.removeMark(t.$from.pos,t.$to.pos,a)}));return n.removeStoredMark(a),!0},updateAttributes:(t,e={})=>({tr:n,state:o,dispatch:r})=>{let i=null,s=null;const l=ls("string"==typeof t?t:t.name,o.schema);return!!l&&("node"===l&&(i=wi(t,o.schema)),"mark"===l&&(s=Zi(t,o.schema)),r&&n.selection.ranges.forEach((t=>{const r=t.$from.pos,l=t.$to.pos;o.doc.nodesBetween(r,l,((t,o)=>{i&&i===t.type&&n.setNodeMarkup(o,void 0,{...t.attrs,...e}),s&&t.marks.length&&t.marks.forEach((i=>{if(s===i.type){const a=Math.max(o,r),c=Math.min(o+t.nodeSize,l);n.addMark(a,c,s.create({...i.attrs,...e}))}}))}))})),!0)},wrapIn:(t,e={})=>({state:n,dispatch:o})=>function(t,e=null){return function(n,o){let{$from:r,$to:i}=n.selection,s=r.blockRange(i),l=s&&Pt(s,t,e);return!!l&&(o&&o(n.tr.wrap(s,l).scrollIntoView()),!0)}}(wi(t,n.schema),e)(n,o),wrapInList:(t,e={})=>({state:n,dispatch:o})=>hi(wi(t,n.schema),e)(n,o)});const Os=zi.create({name:"commands",addCommands:()=>({...Ts})}),As=zi.create({name:"editable",addProseMirrorPlugins(){return[new Ce({key:new Ee("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Ns=zi.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Ce({key:new Ee("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const o=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(o),!1},blur:(e,n)=>{t.isFocused=!1;const o=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(o),!1}}}})]}}),_s=zi.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first((({commands:t})=>[()=>t.undoInputRule(),()=>t.command((({tr:e})=>{const{selection:n,doc:o}=e,{empty:r,$anchor:i}=n,{pos:s,parent:l}=i,a=i.parent.isTextblock&&s>0?e.doc.resolve(s-1):i,c=a.parent.type.spec.isolating,d=i.pos-i.parentOffset,h=c&&1===a.parent.childCount?d===i.pos:re.atStart(o).from===s;return!(!r||!l.type.isTextblock||l.textContent.length||!h||h&&"paragraph"===i.parent.type.name)&&t.clearNodes()})),()=>t.deleteSelection(),()=>t.joinBackward(),()=>t.selectNodeBackward()])),e=()=>this.editor.commands.first((({commands:t})=>[()=>t.deleteSelection(),()=>t.deleteCurrentNode(),()=>t.joinForward(),()=>t.selectNodeForward()])),n={Enter:()=>this.editor.commands.first((({commands:t})=>[()=>t.newlineInCode(),()=>t.createParagraphNear(),()=>t.liftEmptyBlock(),()=>t.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},o={...n},r={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Qi()||is()?r:o},addProseMirrorPlugins(){return[new Ce({key:new Ee("clearDocument"),appendTransaction:(t,e,n)=>{if(!(t.some((t=>t.docChanged))&&!e.doc.eq(n.doc)))return;const{empty:o,from:r,to:i}=e.selection,s=re.atStart(e.doc).from,l=re.atEnd(e.doc).to;if(o||!(r===s&&i===l))return;if(!(0===n.doc.textBetween(0,n.doc.content.size," "," ").length))return;const a=n.tr,c=pi({state:n,transaction:a}),{commands:d}=new fi({editor:this.editor,state:c});return d.clearNodes(),a.steps.length?a:void 0}})]}}),Ls=zi.create({name:"tabindex",addProseMirrorPlugins(){return[new Ce({key:new Ee("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Ds=Object.freeze({__proto__:null,ClipboardTextSerializer:Ui,Commands:Os,Editable:As,FocusEvents:Ns,Keymap:_s,Tabindex:Ls});class Rs{get name(){return this.node.type.name}constructor(t,e,n=!1,o=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=t,this.editor=e,this.currentNode=o}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return null!==(t=this.actualDepth)&&void 0!==t?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return;e=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:e,to:n},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new Rs(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new Rs(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new Rs(t,this.editor)}get children(){const t=[];return this.node.content.forEach(((e,n)=>{const o=e.isBlock&&!e.isTextblock,r=this.pos+n+1,i=this.resolvedPos.doc.resolve(r);if(!o&&i.depth<=this.depth)return;const s=new Rs(i,this.editor,o,o?e:null);o&&(s.actualDepth=this.depth+1),t.push(new Rs(i,this.editor,o,o?e:null))})),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,e={}){let n=null,o=this.parent;for(;o&&!n;){if(o.node.type.name===t)if(Object.keys(e).length>0){const t=o.node.attrs,n=Object.keys(e);for(let o=0;o<n.length;o+=1){const r=n[o];if(t[r]!==e[r])break}}else n=o;o=o.parent}return n}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},n=!1){let o=[];if(!this.children||0===this.children.length)return o;const r=Object.keys(e);return this.children.forEach((i=>{if(!(n&&o.length>0)){if(i.node.type.name===t){r.every((t=>e[t]===i.node.attrs[t]))&&o.push(i)}n&&o.length>0||(o=o.concat(i.querySelectorAll(t,e,n)))}})),o}setAttribute(t){const e=this.editor.state.selection;this.editor.chain().setTextSelection(this.from).updateAttributes(this.node.type.name,t).setTextSelection(e.from).run()}}class Is extends mi{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:t})=>{throw t}},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(t,e,n){const o=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(null!==o)return o;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style"+(n?`-${n}`:""),""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const n=xi(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],o=this.state.reconfigure({plugins:n});this.view.updateState(o)}unregisterPlugin(t){if(this.isDestroyed)return;const e="string"==typeof t?`${t}$`:t.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((t=>!t.key.startsWith(e)))});this.view.updateState(n)}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[As,Ui.configure({blockSeparator:null===(e=null===(t=this.options.coreExtensionOptions)||void 0===t?void 0:t.clipboardTextSerializer)||void 0===e?void 0:e.blockSeparator}),Os,Ns,_s,Ls]:[],...this.options.extensions].filter((t=>["extension","node","mark"].includes(null==t?void 0:t.type)));this.extensionManager=new Vi(n,this)}createCommandManager(){this.commandManager=new fi({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){let t;try{t=cs(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message)))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.options.extensions=this.options.extensions.filter((t=>"collaboration"!==t.name)),this.createExtensionManager()}}),t=cs(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const e=Yi(t,this.options.autofocus);this.view=new Hr(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:ke.create({doc:t,selection:e||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass();this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void t.steps.forEach((t=>{var e;return null===(e=this.capturedTransaction)||void 0===e?void 0:e.step(t)})):void(this.capturedTransaction=t);const e=this.state.apply(t),n=!this.state.selection.eq(e.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const o=t.getMeta("focus"),r=t.getMeta("blur");o&&this.emit("focus",{editor:this,event:o.event,transaction:t}),r&&this.emit("blur",{editor:this,event:r.event,transaction:t}),t.docChanged&&!t.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return ms(this.state,t)}isActive(t,e){const n="string"==typeof t?t:null,o="string"==typeof t?e:t;return function(t,e,n={}){if(!e)return ss(t,null,n)||vs(t,null,n);const o=ls(e,t.schema);return"node"===o?ss(t,e,n):"mark"===o&&vs(t,e,n)}(this.state,n,o)}getJSON(){return this.state.doc.toJSON()}getHTML(){return function(t,e){const n=dt.fromSchema(e).serializeFragment(t),o=document.implementation.createHTMLDocument().createElement("div");return o.appendChild(n),o.innerHTML}(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e="\n\n",textSerializers:n={}}=t||{};return function(t,e){return Fi(t,{from:0,to:t.content.size},e)}(this.state.doc,{blockSeparator:e,textSerializers:{...$i(this.schema),...n}})}get isEmpty(){return xs(this.state.doc)}getCharacterCount(){return this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var t;return!(null===(t=this.view)||void 0===t?void 0:t.docView)}$node(t,e){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return(null===(n=this.$doc)||void 0===n?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new Rs(e,this)}get $doc(){return this.$pos(0)}}function Ps(t){return new _i({find:t.find,handler:({state:e,range:n,match:o})=>{const r=Ci(t.getAttributes,void 0,o);if(!1===r||null===r)return null;const{tr:i}=e,s=o[o.length-1],l=o[0];if(s){const o=l.search(/\S/),a=n.from+l.indexOf(s),c=a+s.length;if(bs(n.from,n.to,e.doc).filter((e=>e.mark.type.excluded.find((n=>n===t.type&&n!==e.mark.type)))).filter((t=>t.to>a)).length)return null;c<n.to&&i.delete(c,n.to),a>n.from&&i.delete(n.from+o,a);const d=n.from+o+s.length;i.addMark(n.from+o,d,t.type.create(r||{})),i.removeStoredMark(t.type)}}})}class Hs{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ci(gi(this,"addOptions",{name:this.name}))),this.storage=Ci(gi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Hs(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>ji(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new Hs(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length,e.options=Ci(gi(e,"addOptions",{name:e.name})),e.storage=Ci(gi(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:n}=t.state,o=t.state.selection.$from;if(o.pos===o.end()){const r=o.marks();if(!!!r.find((t=>(null==t?void 0:t.type.name)===e.name)))return!1;const i=r.find((t=>(null==t?void 0:t.type.name)===e.name));return i&&n.removeStoredMark(i),n.insertText(" ",o.pos),t.view.dispatch(n),!0}return!1}}let Vs=class t{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Ci(gi(this,"addOptions",{name:this.name}))),this.storage=Ci(gi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new t(e)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>ji(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(e={}){const n=new t(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length,n.options=Ci(gi(n,"addOptions",{name:n.name})),n.storage=Ci(gi(n,"addStorage",{name:n.name,options:n.options})),n}};class Bs{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,o,r,i,s,l;const{view:a}=this.editor,c=t.target,d=3===c.nodeType?null===(e=c.parentElement)||void 0===e?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(null===(n=this.contentDOM)||void 0===n?void 0:n.contains(c))||!d)return;let h=0,u=0;if(this.dom!==d){const e=this.dom.getBoundingClientRect(),n=d.getBoundingClientRect(),l=null!==(o=t.offsetX)&&void 0!==o?o:null===(r=t.nativeEvent)||void 0===r?void 0:r.offsetX,a=null!==(i=t.offsetY)&&void 0!==i?i:null===(s=t.nativeEvent)||void 0===s?void 0:s.offsetY;h=n.x-e.x+l,u=n.y-e.y+a}null===(l=t.dataTransfer)||void 0===l||l.setDragImage(this.dom,h,u);const p=de.create(a.state.doc,this.getPos()),f=a.state.tr.setSelection(p);a.dispatch(f)}stopEvent(t){var e;if(!this.dom)return!1;if("function"==typeof this.options.stopEvent)return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!(null===(e=this.contentDOM)||void 0===e?void 0:e.contains(n))))return!1;const o=t.type.startsWith("drag"),r="drop"===t.type;if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!r&&!o)return!0;const{isEditable:i}=this.editor,{isDragging:s}=this,l=!!this.node.type.spec.draggable,a=de.isSelectable(this.node),c="copy"===t.type,d="paste"===t.type,h="cut"===t.type,u="mousedown"===t.type;if(!l&&a&&o&&t.preventDefault(),l&&o&&!s)return t.preventDefault(),!1;if(l&&i&&!s&&u){const t=n.closest("[data-drag-handle]");t&&(this.dom===t||this.dom.contains(t))&&(this.isDragging=!0,document.addEventListener("dragend",(()=>{this.isDragging=!1}),{once:!0}),document.addEventListener("drop",(()=>{this.isDragging=!1}),{once:!0}),document.addEventListener("mouseup",(()=>{this.isDragging=!1}),{once:!0}))}return!(s||r||c||d||h||u&&a)}ignoreMutation(t){if(!this.dom||!this.contentDOM)return!0;if("function"==typeof this.options.ignoreMutation)return this.options.ignoreMutation({mutation:t});if(this.node.isLeaf||this.node.isAtom)return!0;if("selection"===t.type)return!1;if(this.dom.contains(t.target)&&"childList"===t.type&&(Qi()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&this.editor.isFocused){if([...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every((t=>t.isContentEditable)))return!1}return this.contentDOM===t.target&&"attributes"===t.type||!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command((({tr:e})=>{const n=this.getPos();return e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0}))}deleteNode(){const t=this.getPos(),e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}}function js(t){return new Ii({find:t.find,handler:({state:e,range:n,match:o,pasteEvent:r})=>{const i=Ci(t.getAttributes,void 0,o,r);if(!1===i||null===i)return null;const{tr:s}=e,l=o[o.length-1],a=o[0];let c=n.to;if(l){const o=a.search(/\S/),r=n.from+a.indexOf(l),d=r+l.length;if(bs(n.from,n.to,e.doc).filter((e=>e.mark.type.excluded.find((n=>n===t.type&&n!==e.mark.type)))).filter((t=>t.to>r)).length)return null;d<n.to&&s.delete(d,n.to),r>n.from&&s.delete(n.from+o,r),c=n.from+o+l.length,s.addMark(n.from+o,c,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}var zs,Fs=new Uint8Array(16);function $s(){if(!zs&&!(zs="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zs(Fs)}const Us=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Ws=[],qs=0;qs<256;++qs)Ws.push((qs+256).toString(16).substr(1));function Js(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Ws[t[e+0]]+Ws[t[e+1]]+Ws[t[e+2]]+Ws[t[e+3]]+"-"+Ws[t[e+4]]+Ws[t[e+5]]+"-"+Ws[t[e+6]]+Ws[t[e+7]]+"-"+Ws[t[e+8]]+Ws[t[e+9]]+"-"+Ws[t[e+10]]+Ws[t[e+11]]+Ws[t[e+12]]+Ws[t[e+13]]+Ws[t[e+14]]+Ws[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&Us.test(t)}(n))throw TypeError("Stringified UUID is invalid");return n}function Ks(t,e,n){var o=(t=t||{}).random||(t.rng||$s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(var r=0;r<16;++r)e[n+r]=o[r];return e}return Js(o)}const Zs=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Gs=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Xs=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Ys=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Qs=Hs.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],renderHTML({HTMLAttributes:t}){return["strong",vi(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ps({find:Zs,type:this.type}),Ps({find:Xs,type:this.type})]},addPasteRules(){return[js({find:Gs,type:this.type}),js({find:Ys,type:this.type})]}}),tl=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,el=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,nl=Hs.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:t}){return["code",vi(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ps({find:tl,type:this.type})]},addPasteRules(){return[js({find:el,type:this.type})]}}),ol=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,rl=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,il=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,sl=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,ll=Hs.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:t=>"normal"!==t.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes:t}){return["em",vi(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ps({find:ol,type:this.type}),Ps({find:il,type:this.type})]},addPasteRules(){return[js({find:rl,type:this.type}),js({find:sl,type:this.type})]}}),al=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cl=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,dl=Hs.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>!!t.includes("line-through")&&{}}],renderHTML({HTMLAttributes:t}){return["s",vi(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ps({find:al,type:this.type})]},addPasteRules(){return[js({find:cl,type:this.type})]}}),hl=Hs.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>!!t.includes("underline")&&{}}],renderHTML({HTMLAttributes:t}){return["u",vi(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),ul=Vs.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:t}){return["td",vi(this.options.HTMLAttributes,t),0]}}),pl=Vs.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:t}){return["th",vi(this.options.HTMLAttributes,t),0]}}),fl=Vs.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:t}){return["tr",vi(this.options.HTMLAttributes,t),0]}});var ml,gl;if("undefined"!=typeof WeakMap){let t=new WeakMap;ml=e=>t.get(e),gl=(e,n)=>(t.set(e,n),n)}else{const t=[],e=10;let n=0;ml=e=>{for(let n=0;n<t.length;n+=2)if(t[n]==e)return t[n+1]},gl=(o,r)=>(n==e&&(n=0),t[n++]=o,t[n++]=r)}var yl=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,r=e/this.width|0;let i=o+1,s=r+1;for(let t=1;i<this.width&&this.map[e+t]==n;t++)i++;for(let t=1;s<this.height&&this.map[e+this.width*t]==n;t++)s++;return{left:o,top:r,right:i,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:r,top:i,bottom:s}=this.findCell(t);return"horiz"==e?(n<0?0==o:r==this.width)?null:this.map[i*this.width+(n<0?o-1:r)]:(n<0?0==i:s==this.height)?null:this.map[o+this.width*(n<0?i-1:s)]}rectBetween(t,e){const{left:n,right:o,top:r,bottom:i}=this.findCell(t),{left:s,right:l,top:a,bottom:c}=this.findCell(e);return{left:Math.min(n,s),top:Math.min(r,a),right:Math.max(o,l),bottom:Math.max(i,c)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let r=t.left;r<t.right;r++){const i=o*this.width+r,s=this.map[i];n[s]||(n[s]=!0,r==t.left&&r&&this.map[i-1]==s||o==t.top&&o&&this.map[i-this.width]==s||e.push(s))}return e}positionAt(t,e,n){for(let o=0,r=0;;o++){const i=r+n.child(o).nodeSize;if(o==t){let n=e+t*this.width;const o=(t+1)*this.width;for(;n<o&&this.map[n]<r;)n++;return n==o?i-1:this.map[n]}r=i}}static get(t){return ml(t)||gl(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);const e=function(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const r=t.child(o);let i=0;if(n)for(let e=0;e<o;e++){const n=t.child(e);for(let t=0;t<n.childCount;t++){const r=n.child(t);e+r.attrs.rowspan>o&&(i+=r.attrs.colspan)}}for(let t=0;t<r.childCount;t++){const e=r.child(t);i+=e.attrs.colspan,e.attrs.rowspan>1&&(n=!0)}-1==e?e=i:e!=i&&(e=Math.max(e,i))}return e}(t),n=t.childCount,o=[];let r=0,i=null;const s=[];for(let c=0,d=e*n;c<d;c++)o[c]=0;for(let c=0,d=0;c<n;c++){const l=t.child(c);d++;for(let t=0;;t++){for(;r<o.length&&0!=o[r];)r++;if(t==l.childCount)break;const a=l.child(t),{colspan:h,rowspan:u,colwidth:p}=a.attrs;for(let t=0;t<u;t++){if(t+c>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:d,n:u-t});break}const l=r+t*e;for(let t=0;t<h;t++){0==o[l+t]?o[l+t]=d:(i||(i=[])).push({type:"collision",row:c,pos:d,n:h-t});const n=p&&p[t];if(n){const o=(l+t)%e*2,r=s[o];null==r||r!=n&&1==s[o+1]?(s[o]=n,s[o+1]=1):r==n&&s[o+1]++}}}r+=h,d+=a.nodeSize}const a=(c+1)*e;let h=0;for(;r<a;)0==o[r++]&&h++;h&&(i||(i=[])).push({type:"missing",row:c,n:h}),d++}const l=new yl(e,n,o,i);let a=!1;for(let c=0;!a&&c<s.length;c+=2)null!=s[c]&&s[c+1]<n&&(a=!0);a&&function(t,e,n){t.problems||(t.problems=[]);const o={};for(let r=0;r<t.map.length;r++){const i=t.map[r];if(o[i])continue;o[i]=!0;const s=n.nodeAt(i);if(!s)throw new RangeError(`No cell with offset ${i} found`);let l=null;const a=s.attrs;for(let n=0;n<a.colspan;n++){const o=e[2*((r+n)%t.width)];null==o||a.colwidth&&a.colwidth[n]==o||((l||(l=bl(a)))[n]=o)}l&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:l})}}(l,s,t);return l}(t))}};function bl(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function wl(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],r=o.spec.tableRole;r&&(e[r]=o)}}return e}var vl=new Ee("selectingCells");function kl(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function xl(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function Cl(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;const n=kl(e.$head)||function(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if("cell"==o||"header_cell"==o)return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if("cell"==o||"header_cell"==o)return t.doc.resolve(n-e.nodeSize)}}(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Sl(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function Ml(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function El(t,e,n){const o=t.node(-1),r=yl.get(o),i=t.start(-1),s=r.nextCell(t.pos-i,e,n);return null==s?null:t.node(0).resolve(i+s)}function Tl(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some((t=>t>0))||(o.colwidth=null)),o}var Ol=class t extends re{constructor(t,e=t){const n=t.node(-1),o=yl.get(n),r=t.start(-1),i=o.rectBetween(t.pos-r,e.pos-r),s=t.node(0),l=o.cellsInRect(i).filter((t=>t!=e.pos-r));l.unshift(e.pos-r);const a=l.map((t=>{const e=n.nodeAt(t);if(!e)throw RangeError(`No cell with offset ${t} found`);const o=r+t+1;return new ie(s.resolve(o),s.resolve(o+e.content.size))}));super(a[0].$from,a[0].$to,a),this.$anchorCell=t,this.$headCell=e}map(e,n){const o=e.resolve(n.map(this.$anchorCell.pos)),r=e.resolve(n.map(this.$headCell.pos));if(Sl(o)&&Sl(r)&&Ml(o,r)){const e=this.$anchorCell.node(-1)!=o.node(-1);return e&&this.isRowSelection()?t.rowSelection(o,r):e&&this.isColSelection()?t.colSelection(o,r):new t(o,r)}return ae.between(o,r)}content(){const t=this.$anchorCell.node(-1),e=yl.get(t),n=this.$anchorCell.start(-1),o=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),r={},i=[];for(let l=o.top;l<o.bottom;l++){const n=[];for(let i=l*e.width+o.left,s=o.left;s<o.right;s++,i++){const s=e.map[i];if(r[s])continue;r[s]=!0;const l=e.findCell(s);let a=t.nodeAt(s);if(!a)throw RangeError(`No cell with offset ${s} found`);const c=o.left-l.left,d=l.right-o.right;if(c>0||d>0){let t=a.attrs;if(c>0&&(t=Tl(t,0,c)),d>0&&(t=Tl(t,t.colspan-d,d)),l.left<o.left){if(a=a.type.createAndFill(t),!a)throw RangeError(`Could not create cell with attrs ${JSON.stringify(t)}`)}else a=a.type.create(t,a.content)}if(l.top<o.top||l.bottom>o.bottom){const t={...a.attrs,rowspan:Math.min(l.bottom,o.bottom)-Math.max(l.top,o.top)};a=l.top<o.top?a.type.createAndFill(t):a.type.create(t,a.content)}n.push(a)}i.push(t.child(l).copy(c.from(n)))}const s=this.isColSelection()&&this.isRowSelection()?t:i;return new m(c.from(s),1,1)}replace(t,e=m.empty){const n=t.steps.length,o=this.ranges;for(let i=0;i<o.length;i++){const{$from:r,$to:s}=o[i],l=t.mapping.slice(n);t.replace(l.map(r.pos),l.map(s.pos),i?m.empty:e)}const r=re.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);r&&t.setSelection(r)}replaceWith(t,e){this.replace(t,new m(c.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),n=yl.get(e),o=this.$anchorCell.start(-1),r=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let i=0;i<r.length;i++)t(e.nodeAt(r[i]),o+r[i])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const n=t+this.$anchorCell.nodeAfter.attrs.rowspan,o=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,o)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const o=e.node(-1),r=yl.get(o),i=e.start(-1),s=r.findCell(e.pos-i),l=r.findCell(n.pos-i),a=e.node(0);return s.top<=l.top?(s.top>0&&(e=a.resolve(i+r.map[s.left])),l.bottom<r.height&&(n=a.resolve(i+r.map[r.width*(r.height-1)+l.right-1]))):(l.top>0&&(n=a.resolve(i+r.map[l.left])),s.bottom<r.height&&(e=a.resolve(i+r.map[r.width*(r.height-1)+s.right-1]))),new t(e,n)}isRowSelection(){const t=this.$anchorCell.node(-1),e=yl.get(t),n=this.$anchorCell.start(-1),o=e.colCount(this.$anchorCell.pos-n),r=e.colCount(this.$headCell.pos-n);if(Math.min(o,r)>0)return!1;const i=o+this.$anchorCell.nodeAfter.attrs.colspan,s=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,s)==e.width}eq(e){return e instanceof t&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const o=e.node(-1),r=yl.get(o),i=e.start(-1),s=r.findCell(e.pos-i),l=r.findCell(n.pos-i),a=e.node(0);return s.left<=l.left?(s.left>0&&(e=a.resolve(i+r.map[s.top*r.width])),l.right<r.width&&(n=a.resolve(i+r.map[r.width*(l.top+1)-1]))):(l.left>0&&(n=a.resolve(i+r.map[l.top*r.width])),s.right<r.width&&(e=a.resolve(i+r.map[r.width*(s.top+1)-1]))),new t(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new t(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){return new t(e.resolve(n),e.resolve(o))}getBookmark(){return new Al(this.$anchorCell.pos,this.$headCell.pos)}};Ol.prototype.visible=!1,re.jsonID("cell",Ol);var Al=class t{constructor(t,e){this.anchor=t,this.head=e}map(e){return new t(e.map(this.anchor),e.map(this.head))}resolve(t){const e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&Ml(e,n)?new Ol(e,n):re.near(n,1)}};function Nl(t){if(!(t.selection instanceof Ol))return null;const e=[];return t.selection.forEachCell(((t,n)=>{e.push(cr.node(n,n+t.nodeSize,{class:"selectedCell"}))})),ur.create(t.doc,e)}var _l=new Ee("fix-tables");function Ll(t,e,n,o){const r=t.childCount,i=e.childCount;t:for(let s=0,l=0;s<i;s++){const i=e.child(s);for(let e=l,o=Math.min(r,s+3);e<o;e++)if(t.child(e)==i){l=e+1,n+=i.nodeSize;continue t}o(i,n),l<r&&t.child(l).sameMarkup(i)?Ll(t.child(l),i,n+1,o):i.nodesBetween(0,i.content.size,o,n+1),n+=i.nodeSize}}function Dl(t,e){let n;const o=(e,o)=>{"table"==e.type.spec.tableRole&&(n=function(t,e,n,o){const r=yl.get(e);if(!r.problems)return o;o||(o=t.tr);const i=[];for(let a=0;a<r.height;a++)i.push(0);for(let a=0;a<r.problems.length;a++){const t=r.problems[a];if("collision"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;const s=r.attrs;for(let e=0;e<s.rowspan;e++)i[t.row+e]+=t.n;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,Tl(s,s.colspan-t.n,t.n))}else if("missing"==t.type)i[t.row]+=t.n;else if("overlong_rowspan"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,{...r.attrs,rowspan:r.attrs.rowspan-t.n})}else if("colwidth mismatch"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,{...r.attrs,colwidth:t.colwidth})}}let s,l;for(let a=0;a<i.length;a++)i[a]&&(null==s&&(s=a),l=a);for(let a=0,c=n+1;a<r.height;a++){const n=e.child(a),r=c+n.nodeSize,d=i[a];if(d>0){let e="cell";n.firstChild&&(e=n.firstChild.type.spec.tableRole);const i=[];for(let n=0;n<d;n++){const n=wl(t.schema)[e].createAndFill();n&&i.push(n)}const h=0!=a&&s!=a-1||l!=a?r-1:c+1;o.insert(o.mapping.map(h),i)}c=r}return o.setMeta(_l,{fixTables:!0})}(t,e,o,n))};return e?e.doc!=t.doc&&Ll(e.doc,t.doc,0,o):t.doc.descendants(o),n}function Rl(t){const e=t.selection,n=Cl(t),o=n.node(-1),r=n.start(-1),i=yl.get(o);return{...e instanceof Ol?i.rectBetween(e.$anchorCell.pos-r,e.$headCell.pos-r):i.findCell(n.pos-r),tableStart:r,map:i,table:o}}function Il(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let r=0;r<o.length;r++){const t=e.table.nodeAt(o[r]);if(t&&t.type!==n.header_cell)return!1}return!0}function Pl(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,n){if(!xl(e))return!1;if(n){const o=wl(e.schema),r=Rl(e),i=e.tr,s=r.map.cellsInRect("column"==t?{left:r.left,top:0,right:r.right,bottom:r.map.height}:"row"==t?{left:0,top:r.top,right:r.map.width,bottom:r.bottom}:r),l=s.map((t=>r.table.nodeAt(t)));for(let t=0;t<s.length;t++)l[t].type==o.header_cell&&i.setNodeMarkup(r.tableStart+s[t],o.cell,l[t].attrs);if(0==i.steps.length)for(let t=0;t<s.length;t++)i.setNodeMarkup(r.tableStart+s[t],o.header_cell,l[t].attrs);n(i)}return!0}}(t):function(e,n){if(!xl(e))return!1;if(n){const o=wl(e.schema),r=Rl(e),i=e.tr,s=Il("row",r,o),l=Il("column",r,o),a=("column"===t?s:"row"===t&&l)?1:0,c="column"==t?{left:0,top:a,right:1,bottom:r.map.height}:"row"==t?{left:a,top:0,right:r.map.width,bottom:1}:r,d="column"==t?l?o.cell:o.header_cell:"row"==t?s?o.cell:o.header_cell:o.cell;r.map.cellsInRect(c).forEach((t=>{const e=t+r.tableStart,n=i.doc.nodeAt(e);n&&i.setNodeMarkup(e,d,n.attrs)})),n(i)}return!0}}function Hl(t,e){const n=t.selection;if(!(n instanceof Ol))return!1;if(e){const o=t.tr,r=wl(t.schema).cell.createAndFill().content;n.forEachCell(((t,e)=>{t.content.eq(r)||o.replace(o.mapping.map(e+1),o.mapping.map(e+t.nodeSize-1),new m(r,0,0))})),o.docChanged&&e(o)}return!0}function Vl(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:o}=t;for(;1==e.childCount&&(n>0&&o>0||"table"==e.child(0).type.spec.tableRole);)n--,o--,e=e.child(0).content;const r=e.child(0),i=r.type.spec.tableRole,s=r.type.schema,l=[];if("row"==i)for(let a=0;a<e.childCount;a++){let t=e.child(a).content;const r=a?0:Math.max(0,n-1),i=a<e.childCount-1?0:Math.max(0,o-1);(r||i)&&(t=Bl(wl(s).row,new m(t,r,i)).content),l.push(t)}else{if("cell"!=i&&"header_cell"!=i)return null;l.push(n||o?Bl(wl(s).row,new m(e,n,o)).content:e)}return function(t,e){const n=[];for(let r=0;r<e.length;r++){const t=e[r];for(let e=t.childCount-1;e>=0;e--){const{rowspan:o,colspan:i}=t.child(e).attrs;for(let t=r;t<r+o;t++)n[t]=(n[t]||0)+i}}let o=0;for(let r=0;r<n.length;r++)o=Math.max(o,n[r]);for(let r=0;r<n.length;r++)if(r>=e.length&&e.push(c.empty),n[r]<o){const i=wl(t).cell.createAndFill(),s=[];for(let t=n[r];t<o;t++)s.push(i);e[r]=e[r].append(c.from(s))}return{height:e.length,width:o,rows:e}}(s,l)}function Bl(t,e){const n=t.createAndFill();return new ne(n).replace(0,n.content.size,e).doc}function jl(t,e,n,o,r,i,s,l){if(0==s||s==e.height)return!1;let a=!1;for(let c=r;c<i;c++){const r=s*e.width+c,i=e.map[r];if(e.map[r-e.width]==i){a=!0;const r=n.nodeAt(i),{top:d,left:h}=e.findCell(i);t.setNodeMarkup(t.mapping.slice(l).map(i+o),null,{...r.attrs,rowspan:s-d}),t.insert(t.mapping.slice(l).map(e.positionAt(s,h,n)),r.type.createAndFill({...r.attrs,rowspan:d+r.attrs.rowspan-s})),c+=r.attrs.colspan-1}}return a}function zl(t,e,n,o,r,i,s,l){if(0==s||s==e.width)return!1;let a=!1;for(let c=r;c<i;c++){const r=c*e.width+s,i=e.map[r];if(e.map[r-1]==i){a=!0;const r=n.nodeAt(i),d=e.colCount(i),h=t.mapping.slice(l).map(i+o);t.setNodeMarkup(h,null,Tl(r.attrs,s-d,r.attrs.colspan-(s-d))),t.insert(h+r.nodeSize,r.type.createAndFill(Tl(r.attrs,0,s-d))),c+=r.attrs.rowspan-1}}return a}function Fl(t,e,n,o,r){let i=n?t.doc.nodeAt(n-1):t.doc;if(!i)throw new Error("No table found");let s=yl.get(i);const{top:l,left:a}=o,d=a+r.width,h=l+r.height,u=t.tr;let p=0;function f(){if(i=n?u.doc.nodeAt(n-1):u.doc,!i)throw new Error("No table found");s=yl.get(i),p=u.mapping.maps.length}(function(t,e,n,o,r,i,s){const l=wl(t.doc.type.schema);let a,d;if(r>e.width)for(let c=0,h=0;c<e.height;c++){const i=n.child(c);h+=i.nodeSize;const u=[];let p;p=null==i.lastChild||i.lastChild.type==l.cell?a||(a=l.cell.createAndFill()):d||(d=l.header_cell.createAndFill());for(let t=e.width;t<r;t++)u.push(p);t.insert(t.mapping.slice(s).map(h-1+o),u)}if(i>e.height){const h=[];for(let t=0,o=(e.height-1)*e.width;t<Math.max(e.width,r);t++){const r=!(t>=e.width)&&n.nodeAt(e.map[o+t]).type==l.header_cell;h.push(r?d||(d=l.header_cell.createAndFill()):a||(a=l.cell.createAndFill()))}const u=l.row.create(null,c.from(h)),p=[];for(let t=e.height;t<i;t++)p.push(u);t.insert(t.mapping.slice(s).map(o+n.nodeSize-2),p)}return!(!a&&!d)})(u,s,i,n,d,h,p)&&f(),jl(u,s,i,n,a,d,l,p)&&f(),jl(u,s,i,n,a,d,h,p)&&f(),zl(u,s,i,n,l,h,a,p)&&f(),zl(u,s,i,n,l,h,d,p)&&f();for(let c=l;c<h;c++){const t=s.positionAt(c,a,i),e=s.positionAt(c,d,i);u.replace(u.mapping.slice(p).map(t+n),u.mapping.slice(p).map(e+n),new m(r.rows[c-l],0,0))}f(),u.setSelection(new Ol(u.doc.resolve(n+s.positionAt(l,a,i)),u.doc.resolve(n+s.positionAt(h-1,d-1,i)))),e(u)}Pl("row",{useDeprecatedLogic:!0}),Pl("column",{useDeprecatedLogic:!0}),Pl("cell",{useDeprecatedLogic:!0});var $l=Yr({ArrowLeft:Wl("horiz",-1),ArrowRight:Wl("horiz",1),ArrowUp:Wl("vert",-1),ArrowDown:Wl("vert",1),"Shift-ArrowLeft":ql("horiz",-1),"Shift-ArrowRight":ql("horiz",1),"Shift-ArrowUp":ql("vert",-1),"Shift-ArrowDown":ql("vert",1),Backspace:Hl,"Mod-Backspace":Hl,Delete:Hl,"Mod-Delete":Hl});function Ul(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Wl(t,e){return(n,o,r)=>{if(!r)return!1;const i=n.selection;if(i instanceof Ol)return Ul(n,o,re.near(i.$headCell,e));if("horiz"!=t&&!i.empty)return!1;const s=Gl(r,t,e);if(null==s)return!1;if("horiz"==t)return Ul(n,o,re.near(n.doc.resolve(i.head+e),e));{const r=n.doc.resolve(s),i=El(r,t,e);let l;return l=i?re.near(i,1):e<0?re.near(n.doc.resolve(r.before(-1)),-1):re.near(n.doc.resolve(r.after(-1)),1),Ul(n,o,l)}}}function ql(t,e){return(n,o,r)=>{if(!r)return!1;const i=n.selection;let s;if(i instanceof Ol)s=i;else{const o=Gl(r,t,e);if(null==o)return!1;s=new Ol(n.doc.resolve(o))}const l=El(s.$headCell,t,e);return!!l&&Ul(n,o,new Ol(s.$anchorCell,l))}}function Jl(t,e){const n=kl(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new Ol(n))),!0)}function Kl(t,e,n){if(!xl(t.state))return!1;let o=Vl(n);const r=t.state.selection;if(r instanceof Ol){o||(o={width:1,height:1,rows:[c.from(Bl(wl(t.state.schema).cell,n))]});const e=r.$anchorCell.node(-1),i=r.$anchorCell.start(-1),s=yl.get(e).rectBetween(r.$anchorCell.pos-i,r.$headCell.pos-i);return o=function({width:t,height:e,rows:n},o,r){if(t!=o){const e=[],r=[];for(let t=0;t<n.length;t++){const i=n[t],s=[];for(let n=e[t]||0,r=0;n<o;r++){let l=i.child(r%i.childCount);n+l.attrs.colspan>o&&(l=l.type.createChecked(Tl(l.attrs,l.attrs.colspan,n+l.attrs.colspan-o),l.content)),s.push(l),n+=l.attrs.colspan;for(let n=1;n<l.attrs.rowspan;n++)e[t+n]=(e[t+n]||0)+l.attrs.colspan}r.push(c.from(s))}n=r,t=o}if(e!=r){const t=[];for(let o=0,i=0;o<r;o++,i++){const s=[],l=n[i%e];for(let t=0;t<l.childCount;t++){let e=l.child(t);o+e.attrs.rowspan>r&&(e=e.type.create({...e.attrs,rowspan:Math.max(1,r-e.attrs.rowspan)},e.content)),s.push(e)}t.push(c.from(s))}n=t,e=r}return{width:t,height:e,rows:n}}(o,s.right-s.left,s.bottom-s.top),Fl(t.state,t.dispatch,i,s,o),!0}if(o){const e=Cl(t.state),n=e.start(-1);return Fl(t.state,t.dispatch,n,yl.get(e.node(-1)).findCell(e.pos-n),o),!0}return!1}function Zl(t,e){var n;if(e.ctrlKey||e.metaKey)return;const o=Xl(t,e.target);let r;if(e.shiftKey&&t.state.selection instanceof Ol)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&null!=(r=kl(t.state.selection.$anchor))&&(null==(n=Yl(t,e))?void 0:n.pos)!=r.pos)i(r,e),e.preventDefault();else if(!o)return;function i(e,n){let o=Yl(t,n);const r=null==vl.getState(t.state);if(!o||!Ml(e,o)){if(!r)return;o=e}const i=new Ol(e,o);if(r||!t.state.selection.eq(i)){const n=t.state.tr.setSelection(i);r&&n.setMeta(vl,e.pos),t.dispatch(n)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",l),null!=vl.getState(t.state)&&t.dispatch(t.state.tr.setMeta(vl,-1))}function l(n){const r=n,l=vl.getState(t.state);let a;if(null!=l)a=t.state.doc.resolve(l);else if(Xl(t,r.target)!=o&&(a=Yl(t,e),!a))return s();a&&i(a,r)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",l)}function Gl(t,e,n){if(!(t.state.selection instanceof ae))return null;const{$head:o}=t.state.selection;for(let r=o.depth-1;r>=0;r--){const i=o.node(r);if((n<0?o.index(r):o.indexAfter(r))!=(n<0?0:i.childCount))return null;if("cell"==i.type.spec.tableRole||"header_cell"==i.type.spec.tableRole){const i=o.before(r),s="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(s)?i:null}}return null}function Xl(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function Yl(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?kl(t.state.doc.resolve(n.pos)):null}var Ql=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ta(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,ta(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}};function ta(t,e,n,o,r,i){var s;let l=0,a=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let t=0,n=0;t<d.childCount;t++){const{colspan:s,colwidth:h}=d.child(t).attrs;for(let t=0;t<s;t++,n++){const s=r==n?i:h&&h[t],d=s?s+"px":"";l+=s||o,s||(a=!1),c?(c.style.width!=d&&(c.style.width=d),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=d}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}a?(n.style.width=l+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=l+"px")}}var ea=new Ee("tableColumnResizing");function na({handleWidth:t=5,cellMinWidth:e=25,View:n=Ql,lastColumnResizable:o=!0}={}){const r=new Ce({key:ea,state:{init(t,o){var i,s;const l=null==(s=null==(i=r.spec)?void 0:i.props)?void 0:s.nodeViews,a=wl(o.schema).table.name;return n&&l&&(l[a]=(t,o)=>new n(t,e,o)),new oa(-1,!1)},apply:(t,e)=>e.apply(t)},props:{attributes:t=>{const e=ea.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(e,n)=>{!function(t,e,n,o,r){const i=ea.getState(t.state);if(!i)return;if(!i.dragging){const o=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let s=-1;if(o){const{left:r,right:i}=o.getBoundingClientRect();e.clientX-r<=n?s=ra(t,e,"left",n):i-e.clientX<=n&&(s=ra(t,e,"right",n))}if(s!=i.activeHandle){if(!r&&-1!==s){const e=t.state.doc.resolve(s),n=e.node(-1),o=yl.get(n),r=e.start(-1);if(o.colCount(e.pos-r)+e.nodeAfter.attrs.colspan-1==o.width-1)return}sa(t,s)}}}(e,n,t,0,o)},mouseleave:t=>{!function(t){const e=ea.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&sa(t,-1)}(t)},mousedown:(t,n)=>{!function(t,e,n){var o;const r=null!=(o=t.dom.ownerDocument.defaultView)?o:window,i=ea.getState(t.state);if(!i||-1==i.activeHandle||i.dragging)return!1;const s=t.state.doc.nodeAt(i.activeHandle),l=function(t,e,{colspan:n,colwidth:o}){const r=o&&o[o.length-1];if(r)return r;const i=t.domAtPos(e);let s=i.node.childNodes[i.offset].offsetWidth,l=n;if(o)for(let a=0;a<n;a++)o[a]&&(s-=o[a],l--);return s/l}(t,i.activeHandle,s.attrs);function a(e){r.removeEventListener("mouseup",a),r.removeEventListener("mousemove",c);const o=ea.getState(t.state);(null==o?void 0:o.dragging)&&(!function(t,e,n){const o=t.state.doc.resolve(e),r=o.node(-1),i=yl.get(r),s=o.start(-1),l=i.colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let c=0;c<i.height;c++){const t=c*i.width+l;if(c&&i.map[t]==i.map[t-i.width])continue;const e=i.map[t],o=r.nodeAt(e).attrs,d=1==o.colspan?0:l-i.colCount(e);if(o.colwidth&&o.colwidth[d]==n)continue;const h=o.colwidth?o.colwidth.slice():la(o.colspan);h[d]=n,a.setNodeMarkup(s+e,null,{...o,colwidth:h})}a.docChanged&&t.dispatch(a)}(t,o.activeHandle,ia(o.dragging,e,n)),t.dispatch(t.state.tr.setMeta(ea,{setDragging:null})))}function c(e){if(!e.which)return a(e);const o=ea.getState(t.state);if(o&&o.dragging){const r=ia(o.dragging,e,n);!function(t,e,n,o){const r=t.state.doc.resolve(e),i=r.node(-1),s=r.start(-1),l=yl.get(i).colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1;let a=t.domAtPos(r.start(-1)).node;for(;a&&"TABLE"!=a.nodeName;)a=a.parentNode;if(!a)return;ta(i,a.firstChild,a,o,l,n)}(t,o.activeHandle,r,n)}}t.dispatch(t.state.tr.setMeta(ea,{setDragging:{startX:e.clientX,startWidth:l}})),r.addEventListener("mouseup",a),r.addEventListener("mousemove",c),e.preventDefault()}(t,n,e)}},decorations:t=>{const e=ea.getState(t);if(e&&e.activeHandle>-1)return function(t,e){const n=[],o=t.doc.resolve(e),r=o.node(-1);if(!r)return ur.empty;const i=yl.get(r),s=o.start(-1),l=i.colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1;for(let a=0;a<i.height;a++){const t=l+a*i.width;if(!(l!=i.width-1&&i.map[t]==i.map[t+1]||0!=a&&i.map[t]==i.map[t-i.width])){const e=i.map[t],o=s+e+r.nodeAt(e).nodeSize-1,l=document.createElement("div");l.className="column-resize-handle",n.push(cr.widget(o,l))}}return ur.create(t.doc,n)}(t,e.activeHandle)},nodeViews:{}}});return r}var oa=class t{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(e){const n=this,o=e.getMeta(ea);if(o&&null!=o.setHandle)return new t(o.setHandle,!1);if(o&&void 0!==o.setDragging)return new t(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&e.docChanged){let o=e.mapping.map(n.activeHandle,-1);return Sl(e.doc.resolve(o))||(o=-1),new t(o,n.dragging)}return n}};function ra(t,e,n,o){const r="right"==n?-o:o,i=t.posAtCoords({left:e.clientX+r,top:e.clientY});if(!i)return-1;const{pos:s}=i,l=kl(t.state.doc.resolve(s));if(!l)return-1;if("right"==n)return l.pos;const a=yl.get(l.node(-1)),c=l.start(-1),d=a.map.indexOf(l.pos-c);return d%a.width==0?-1:c+a.map[d-1]}function ia(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function sa(t,e){t.dispatch(t.state.tr.setMeta(ea,{setHandle:e}))}function la(t){return Array(t).fill(0)}function aa({allowTableNodeSelection:t=!1}={}){return new Ce({key:vl,state:{init:()=>null,apply(t,e){const n=t.getMeta(vl);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;const{deleted:o,pos:r}=t.mapping.mapResult(e);return o?null:r}},props:{decorations:Nl,handleDOMEvents:{mousedown:Zl},createSelectionBetween:t=>null!=vl.getState(t.state)?t.state.selection:null,handleTripleClick:Jl,handleKeyDown:$l,handlePaste:Kl},appendTransaction:(e,n,o)=>function(t,e,n){const o=(e||t).selection,r=(e||t).doc;let i,s;if(o instanceof de&&(s=o.node.type.spec.tableRole)){if("cell"==s||"header_cell"==s)i=Ol.create(r,o.from);else if("row"==s){const t=r.resolve(o.from+1);i=Ol.rowSelection(t,t)}else if(!n){const t=yl.get(o.node),e=o.from+1,n=e+t.map[t.width*t.height-1];i=Ol.create(r,e+1,n)}}else o instanceof ae&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,o=e.pos,r=t.depth;for(;r>=0&&!(t.after(r+1)<t.end(r));r--,n++);for(let i=e.depth;i>=0&&!(e.before(i+1)>e.start(i));i--,o--);return n==o&&/row|table/.test(t.node(r).type.spec.tableRole)}(o)?i=ae.create(r,o.from):o instanceof ae&&function({$from:t,$to:e}){let n,o;for(let r=t.depth;r>0;r--){const e=t.node(r);if("cell"===e.type.spec.tableRole||"header_cell"===e.type.spec.tableRole){n=e;break}}for(let r=e.depth;r>0;r--){const t=e.node(r);if("cell"===t.type.spec.tableRole||"header_cell"===t.type.spec.tableRole){o=t;break}}return n!==o&&0===e.parentOffset}(o)&&(i=ae.create(r,o.$from.start(),o.$from.end()));return i&&(e||(e=t.tr)).setSelection(i),e}(o,Dl(o,n),t)})}const ca=()=>new Map,da=t=>{const e=ca();return t.forEach(((t,n)=>{e.set(n,t)})),e},ha=(t,e,n)=>{let o=t.get(e);return void 0===o&&t.set(e,o=n()),o},ua=()=>new Set,pa=t=>t[t.length-1],fa=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},ma=Array.from,ga=Array.isArray;class ya{constructor(){this._observers=ca()}on(t,e){return ha(this._observers,t,ua).add(e),e}once(t,e){const n=(...o)=>{this.off(t,n),e(...o)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return ma((this._observers.get(t)||ca()).values()).forEach((t=>t(...e)))}destroy(){this._observers=ca()}}const ba=Math.floor,wa=Math.abs,va=(t,e)=>t<e?t:e,ka=(t,e)=>t>e?t:e,xa=t=>0!==t?t<0:1/t<0,Ca=64,Sa=128,Ma=127,Ea=Number.MAX_SAFE_INTEGER,Ta=Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&ba(t)===t),Oa=/^\s*/g,Aa=/([A-Z])/g,Na=(t,e)=>(t=>t.replace(Oa,""))(t.replace(Aa,(t=>`${e}${(t=>t.toLowerCase())(t)}`))),_a="undefined"!=typeof TextEncoder?new TextEncoder:null,La=_a?t=>_a.encode(t):t=>{const e=unescape(encodeURIComponent(t)),n=e.length,o=new Uint8Array(n);for(let r=0;r<n;r++)o[r]=e.codePointAt(r);return o};let Da="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Da&&1===Da.decode(new Uint8Array).length&&(Da=null);class Ra{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ia=()=>new Ra,Pa=t=>{const e=new Uint8Array((t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e})(t));let n=0;for(let o=0;o<t.bufs.length;o++){const r=t.bufs[o];e.set(r,n),n+=r.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},Ha=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},Va=Ha,Ba=(t,e)=>{for(;e>Ma;)Ha(t,Sa|Ma&e),e=ba(e/128);Ha(t,Ma&e)},ja=(t,e)=>{const n=xa(e);for(n&&(e=-e),Ha(t,(e>63?Sa:0)|(n?Ca:0)|63&e),e=ba(e/64);e>0;)Ha(t,(e>Ma?Sa:0)|Ma&e),e=ba(e/128)},za=new Uint8Array(3e4),Fa=za.length/3,$a=_a&&_a.encodeInto?(t,e)=>{if(e.length<Fa){const n=_a.encodeInto(e,za).written||0;Ba(t,n);for(let e=0;e<n;e++)Ha(t,za[e])}else Wa(t,La(e))}:(t,e)=>{const n=unescape(encodeURIComponent(e)),o=n.length;Ba(t,o);for(let r=0;r<o;r++)Ha(t,n.codePointAt(r))},Ua=(t,e)=>{const n=t.cbuf.length,o=t.cpos,r=va(n-o,e.length),i=e.length-r;t.cbuf.set(e.subarray(0,r),o),t.cpos+=r,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ka(2*n,i)),t.cbuf.set(e.subarray(r)),t.cpos=i)},Wa=(t,e)=>{Ba(t,e.byteLength),Ua(t,e)},qa=(t,e)=>{((t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*ka(n,e)),t.cpos=0)})(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Ja=new DataView(new ArrayBuffer(4)),Ka=(t,e)=>{switch(typeof e){case"string":Ha(t,119),$a(t,e);break;case"number":Ta(e)&&wa(e)<=2147483647?(Ha(t,125),ja(t,e)):(n=e,Ja.setFloat32(0,n),Ja.getFloat32(0)===n?(Ha(t,124),((t,e)=>{qa(t,4).setFloat32(0,e,!1)})(t,e)):(Ha(t,123),((t,e)=>{qa(t,8).setFloat64(0,e,!1)})(t,e)));break;case"bigint":Ha(t,122),((t,e)=>{qa(t,8).setBigInt64(0,e,!1)})(t,e);break;case"object":if(null===e)Ha(t,126);else if(ga(e)){Ha(t,117),Ba(t,e.length);for(let n=0;n<e.length;n++)Ka(t,e[n])}else if(e instanceof Uint8Array)Ha(t,116),Wa(t,e);else{Ha(t,118);const n=Object.keys(e);Ba(t,n.length);for(let o=0;o<n.length;o++){const r=n[o];$a(t,r),Ka(t,e[r])}}break;case"boolean":Ha(t,e?120:121);break;default:Ha(t,127)}var n};class Za extends Ra{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Ba(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Ga=t=>{t.count>0&&(ja(t.encoder,1===t.count?t.s:-t.s),t.count>1&&Ba(t.encoder,t.count-2))};class Xa{constructor(){this.encoder=new Ra,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ga(this),this.count=1,this.s=t)}toUint8Array(){return Ga(this),Pa(this.encoder)}}const Ya=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);ja(t.encoder,e),t.count>1&&Ba(t.encoder,t.count-2)}};class Qa{constructor(){this.encoder=new Ra,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Ya(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Ya(this),Pa(this.encoder)}}class tc{constructor(){this.sarr=[],this.s="",this.lensE=new Xa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Ra;return this.sarr.push(this.s),this.s="",$a(t,this.sarr.join("")),Ua(t,this.lensE.toUint8Array()),Pa(t)}}const ec=t=>new Error(t),nc=()=>{throw ec("Method unimplemented")},oc=()=>{throw ec("Unexpected case")},rc=ec("Unexpected end of array"),ic=ec("Integer out of Range");class sc{constructor(t){this.arr=t,this.pos=0}}const lc=t=>new sc(t),ac=t=>((t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n})(t,dc(t)),cc=t=>t.arr[t.pos++],dc=t=>{let e=0,n=1;const o=t.arr.length;for(;t.pos<o;){const o=t.arr[t.pos++];if(e+=(o&Ma)*n,n*=128,o<Sa)return e;if(e>Ea)throw ic}throw rc},hc=t=>{let e=t.arr[t.pos++],n=63&e,o=64;const r=(e&Ca)>0?-1:1;if(!(e&Sa))return r*n;const i=t.arr.length;for(;t.pos<i;){if(e=t.arr[t.pos++],n+=(e&Ma)*o,o*=128,e<Sa)return r*n;if(n>Ea)throw ic}throw rc},uc=Da?t=>Da.decode(ac(t)):t=>{let e=dc(t);if(0===e)return"";{let n=String.fromCodePoint(cc(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(cc(t));else for(;e>0;){const o=e<1e4?e:1e4,r=t.arr.subarray(t.pos,t.pos+o);t.pos+=o,n+=String.fromCodePoint.apply(null,r),e-=o}return decodeURIComponent(escape(n))}},pc=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},fc=[t=>{},t=>null,hc,t=>pc(t,4).getFloat32(0,!1),t=>pc(t,8).getFloat64(0,!1),t=>pc(t,8).getBigInt64(0,!1),t=>!1,t=>!0,uc,t=>{const e=dc(t),n={};for(let o=0;o<e;o++){n[uc(t)]=mc(t)}return n},t=>{const e=dc(t),n=[];for(let o=0;o<e;o++)n.push(mc(t));return n},ac],mc=t=>fc[127-cc(t)](t);class gc extends sc{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){var t;return 0===this.count&&(this.s=this.reader(this),(t=this).pos!==t.arr.length?this.count=dc(this)+1:this.count=-1),this.count--,this.s}}class yc extends sc{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=hc(this);const t=xa(this.s);this.count=1,t&&(this.s=-this.s,this.count=dc(this)+2)}return this.count--,this.s}}class bc extends sc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=hc(this),e=1&t;this.diff=ba(t/2),this.count=1,e&&(this.count=dc(this)+2)}return this.s+=this.diff,this.count--,this.s}}class wc{constructor(t){this.decoder=new yc(t),this.str=uc(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}const vc=crypto.getRandomValues.bind(crypto),kc=Math.random,xc=()=>vc(new Uint32Array(1))[0],Cc=[1e7]+-1e3+-4e3+-8e3+-1e11,Sc=()=>Cc.replace(/[018]/g,(t=>(t^xc()&15>>t/4).toString(16))),Mc=Date.now,Ec=t=>new Promise(t);Promise.all.bind(Promise);const Tc=t=>void 0===t?null:t;let Oc=new class{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}},Ac=!0;try{"undefined"!=typeof localStorage&&localStorage&&(Oc=localStorage,Ac=!1)}catch(eM){}const Nc=Oc,_c=Object.assign,Lc=Object.keys,Dc=t=>Lc(t).length,Rc=(t,e)=>t===e||Dc(t)===Dc(e)&&((t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0})(t,((t,n)=>(void 0!==t||((t,e)=>Object.prototype.hasOwnProperty.call(t,e))(e,n))&&e[n]===t)),Ic=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Ic(t,e,n+1)}},Pc="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0),Hc="undefined"!=typeof window&&"undefined"!=typeof document&&!Pc;let Vc;const Bc=t=>(()=>{if(void 0===Vc)if(Pc){Vc=ca();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const o=t[n];"-"===o[0]?(null!==e&&Vc.set(e,""),e=o):null!==e&&(Vc.set(e,o),e=null)}null!==e&&Vc.set(e,"")}else"object"==typeof location?(Vc=ca(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");Vc.set(`--${Na(e,"-")}`,n),Vc.set(`-${Na(e,"-")}`,n)}}))):Vc=ca();return Vc})().has(t),jc=t=>Tc(Pc?process.env[t.toUpperCase().replaceAll("-","_")]:Nc.getItem(t)),zc=t=>Bc("--"+t)||null!==jc(t);zc("production");Pc&&["true","1","2"].includes({}.FORCE_COLOR)||!Bc("--no-colors")&&!zc("no-color")&&(!Pc||process.stdout.isTTY)&&(!Pc||Bc("--color")||null!==jc("COLORTERM")||(jc("TERM")||"").includes("color"));class Fc{constructor(t,e){this.left=t,this.right=e}}const $c=(t,e)=>new Fc(t,e),Uc="undefined"!=typeof document?document:{};"undefined"!=typeof DOMParser&&new DOMParser;const Wc=(qc=clearTimeout,class{constructor(t){this._=t}destroy(){qc(this._)}});var qc;const Jc=(t,e)=>new Wc(setTimeout(e,t)),Kc=Symbol,Zc=Kc(),Gc=Kc(),Xc=Kc(),Yc=Kc(),Qc=Kc(),td=Kc(),ed=Kc(),nd=Kc(),od=Kc(),rd=($c("font-weight","bold"),$c("font-weight","normal"),$c("color","blue"),$c("color","green"),$c("color","grey"),$c("color","red"),$c("color","purple"),$c("color","orange"),$c("color","black"),ua()),id=t=>({[Symbol.iterator](){return this},next:t}),sd=(t,e)=>id((()=>{const{done:n,value:o}=t.next();return{done:n,value:n?void 0:e(o)}}));class ld{constructor(t,e){this.clock=t,this.len=e}}class ad{constructor(){this.clients=new Map}}const cd=(t,e,n)=>e.clients.forEach(((e,o)=>{const r=t.doc.store.clients.get(o);for(let i=0;i<e.length;i++){const o=e[i];ih(t,r,o.clock,o.len,n)}})),dd=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==((t,e)=>{let n=0,o=t.length-1;for(;n<=o;){const r=ba((n+o)/2),i=t[r],s=i.clock;if(s<=e){if(e<s+i.len)return r;n=r+1}else o=r-1}return null})(n,e.clock)},hd=t=>{t.clients.forEach((t=>{let e,n;for(t.sort(((t,e)=>t.clock-e.clock)),e=1,n=1;e<t.length;e++){const o=t[n-1],r=t[e];o.clock+o.len>=r.clock?o.len=ka(o.len,r.clock+r.len-o.clock):(n<e&&(t[n]=r),n++)}t.length=n}))},ud=t=>{const e=new ad;for(let n=0;n<t.length;n++)t[n].clients.forEach(((o,r)=>{if(!e.clients.has(r)){const i=o.slice();for(let e=n+1;e<t.length;e++)fa(i,t[e].clients.get(r)||[]);e.clients.set(r,i)}}));return hd(e),e},pd=(t,e,n,o)=>{ha(t.clients,e,(()=>[])).push(new ld(n,o))},fd=()=>new ad,md=(t,e)=>{Ba(t.restEncoder,e.clients.size),ma(e.clients.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{t.resetDsCurVal(),Ba(t.restEncoder,e);const o=n.length;Ba(t.restEncoder,o);for(let r=0;r<o;r++){const e=n[r];t.writeDsClock(e.clock),t.writeDsLen(e.len)}}))},gd=(t,e,n)=>{const o=new ad,r=dc(t.restDecoder);for(let i=0;i<r;i++){t.resetDsCurVal();const r=dc(t.restDecoder),i=dc(t.restDecoder),s=n.clients.get(r)||[],l=Yd(n,r);for(let n=0;n<i;n++){const n=t.readDsClock(),i=n+t.readDsLen();if(n<l){l<i&&pd(o,r,l,i-l);let t=th(s,n),a=s[t];for(!a.deleted&&a.id.clock<n&&(s.splice(t+1,0,Uu(e,a,n-a.id.clock)),t++);t<s.length&&(a=s[t++],a.id.clock<i);)a.deleted||(i<a.id.clock+a.length&&s.splice(t,0,Uu(e,a,i-a.id.clock)),a.delete(e))}else pd(o,r,n,i-n)}}if(o.clients.size>0){const t=new Sd;return Ba(t.restEncoder,0),md(t,o),t.toUint8Array()}return null},yd=xc;class bd extends ya{constructor({guid:t=Sc(),collectionid:e=null,gc:n=!0,gcFilter:o=(()=>!0),meta:r=null,autoLoad:i=!1,shouldLoad:s=!0}={}){super(),this.gc=n,this.gcFilter=o,this.clientID=yd(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new Gd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=s,this.autoLoad=i,this.meta=r,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ec((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const l=()=>Ec((t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=l()),this.isSynced=void 0===t||!0===t,this.isSynced&&!this.isLoaded&&this.emit("load",[this])})),this.whenSynced=l()}load(){const t=this._item;null===t||this.shouldLoad||hh(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ma(this.subdocs).map((t=>t.guid)))}transact(t,e=null){return hh(this,t,e)}get(t,e=Lh){const n=ha(this.share,t,(()=>{const t=new e;return t._integrate(this,null),t})),o=n.constructor;if(e!==Lh&&o!==e){if(o===Lh){const o=new e;o._map=n._map,n._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=o})),o._start=n._start;for(let t=o._start;null!==t;t=t.right)t.parent=o;return o._length=n._length,this.share.set(t,o),o._integrate(this,null),o}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,Xh)}getText(t=""){return this.get(t,mu)}getMap(t=""){return this.get(t,Qh)}getXmlElement(t=""){return this.get(t,bu)}getXmlFragment(t=""){return this.get(t,yu)}toJSON(){const t={};return this.share.forEach(((e,n)=>{t[n]=e.toJSON()})),t}destroy(){ma(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new bd({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,hh(t.parent.doc,(n=>{const o=e.doc;t.deleted||n.subdocsAdded.add(o),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class wd{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=dc(this.restDecoder),this.dsCurrVal}readDsLen(){const t=dc(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class vd extends wd{constructor(t){super(t),this.keys=[],dc(t),this.keyClockDecoder=new bc(ac(t)),this.clientDecoder=new yc(ac(t)),this.leftClockDecoder=new bc(ac(t)),this.rightClockDecoder=new bc(ac(t)),this.infoDecoder=new gc(ac(t),cc),this.stringDecoder=new wc(ac(t)),this.parentInfoDecoder=new gc(ac(t),cc),this.typeRefDecoder=new yc(ac(t)),this.lenDecoder=new yc(ac(t))}readLeftID(){return new Dd(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Dd(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return mc(this.restDecoder)}readBuf(){return ac(this.restDecoder)}readJSON(){return mc(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class kd{constructor(){this.restEncoder=Ia()}toUint8Array(){return Pa(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Ba(this.restEncoder,t)}writeDsLen(t){Ba(this.restEncoder,t)}}class xd extends kd{writeLeftID(t){Ba(this.restEncoder,t.client),Ba(this.restEncoder,t.clock)}writeRightID(t){Ba(this.restEncoder,t.client),Ba(this.restEncoder,t.clock)}writeClient(t){Ba(this.restEncoder,t)}writeInfo(t){Va(this.restEncoder,t)}writeString(t){$a(this.restEncoder,t)}writeParentInfo(t){Ba(this.restEncoder,t?1:0)}writeTypeRef(t){Ba(this.restEncoder,t)}writeLen(t){Ba(this.restEncoder,t)}writeAny(t){Ka(this.restEncoder,t)}writeBuf(t){Wa(this.restEncoder,t)}writeJSON(t){$a(this.restEncoder,JSON.stringify(t))}writeKey(t){$a(this.restEncoder,t)}}class Cd{constructor(){this.restEncoder=Ia(),this.dsCurrVal=0}toUint8Array(){return Pa(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,Ba(this.restEncoder,e)}writeDsLen(t){0===t&&oc(),Ba(this.restEncoder,t-1),this.dsCurrVal+=t}}class Sd extends Cd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Qa,this.clientEncoder=new Xa,this.leftClockEncoder=new Qa,this.rightClockEncoder=new Qa,this.infoEncoder=new Za(Va),this.stringEncoder=new tc,this.parentInfoEncoder=new Za(Va),this.typeRefEncoder=new Xa,this.lenEncoder=new Xa}toUint8Array(){const t=Ia();return Ba(t,0),Wa(t,this.keyClockEncoder.toUint8Array()),Wa(t,this.clientEncoder.toUint8Array()),Wa(t,this.leftClockEncoder.toUint8Array()),Wa(t,this.rightClockEncoder.toUint8Array()),Wa(t,Pa(this.infoEncoder)),Wa(t,this.stringEncoder.toUint8Array()),Wa(t,Pa(this.parentInfoEncoder)),Wa(t,this.typeRefEncoder.toUint8Array()),Wa(t,this.lenEncoder.toUint8Array()),Ua(t,Pa(this.restEncoder)),Pa(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ka(this.restEncoder,t)}writeBuf(t){Wa(this.restEncoder,t)}writeJSON(t){Ka(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Md=(t,e,n)=>{const o=new Map;n.forEach(((t,n)=>{Yd(e,n)>t&&o.set(n,t)})),Xd(e).forEach(((t,e)=>{n.has(e)||o.set(e,0)})),Ba(t.restEncoder,o.size),ma(o.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([n,o])=>{((t,e,n,o)=>{o=ka(o,e[0].id.clock);const r=th(e,o);Ba(t.restEncoder,e.length-r),t.writeClient(n),Ba(t.restEncoder,o);const i=e[r];i.write(t,o-i.id.clock);for(let s=r+1;s<e.length;s++)e[s].write(t,0)})(t,e.clients.get(n),n,o)}))},Ed=(t,e,n,o=new vd(t))=>hh(e,(t=>{t.local=!1;let e=!1;const n=t.doc,r=n.store,i=((t,e)=>{const n=ca(),o=dc(t.restDecoder);for(let r=0;r<o;r++){const o=dc(t.restDecoder),r=new Array(o),i=t.readClient();let s=dc(t.restDecoder);n.set(i,{i:0,refs:r});for(let n=0;n<o;n++){const o=t.readInfo();switch(31&o){case 0:{const e=t.readLen();r[n]=new Cu(Id(i,s),e),s+=e;break}case 10:{const e=dc(t.restDecoder);r[n]=new Gu(Id(i,s),e),s+=e;break}default:{const l=!(192&o),a=new Ju(Id(i,s),null,(o&Sa)===Sa?t.readLeftID():null,null,(o&Ca)===Ca?t.readRightID():null,l?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,!l||32&~o?null:t.readString(),Ku(t,o));r[n]=a,s+=a.length}}}}return n})(o,n),s=((t,e,n)=>{const o=[];let r=ma(n.keys()).sort(((t,e)=>t-e));if(0===r.length)return null;const i=()=>{if(0===r.length)return null;let t=n.get(r[r.length-1]);for(;t.refs.length===t.i;){if(r.pop(),!(r.length>0))return null;t=n.get(r[r.length-1])}return t};let s=i();if(null===s)return null;const l=new Gd,a=new Map,c=(t,e)=>{const n=a.get(t);(null==n||n>e)&&a.set(t,e)};let d=s.refs[s.i++];const h=new Map,u=()=>{for(const t of o){const e=t.id.client,o=n.get(e);o?(o.i--,l.clients.set(e,o.refs.slice(o.i)),n.delete(e),o.i=0,o.refs=[]):l.clients.set(e,[t]),r=r.filter((t=>t!==e))}o.length=0};for(;;){if(d.constructor!==Gu){const r=ha(h,d.id.client,(()=>Yd(e,d.id.client)))-d.id.clock;if(r<0)o.push(d),c(d.id.client,d.id.clock-1),u();else{const i=d.getMissing(t,e);if(null!==i){o.push(d);const t=n.get(i)||{refs:[],i:0};if(t.refs.length!==t.i){d=t.refs[t.i++];continue}c(i,Yd(e,i)),u()}else(0===r||r<d.length)&&(d.integrate(t,r),h.set(d.id.client,d.id.clock+d.length))}}if(o.length>0)d=o.pop();else if(null!==s&&s.i<s.refs.length)d=s.refs[s.i++];else{if(s=i(),null===s)break;d=s.refs[s.i++]}}if(l.clients.size>0){const t=new Sd;return Md(t,l,new Map),Ba(t.restEncoder,0),{missing:a,update:t.toUint8Array()}}return null})(t,r,i),l=r.pendingStructs;if(l){for(const[t,n]of l.missing)if(n<Yd(r,t)){e=!0;break}if(s){for(const[t,e]of s.missing){const n=l.missing.get(t);(null==n||n>e)&&l.missing.set(t,e)}l.update=wh([l.update,s.update])}}else r.pendingStructs=s;const a=gd(o,t,r);if(r.pendingDs){const e=new vd(lc(r.pendingDs));dc(e.restDecoder);const n=gd(e,t,r);r.pendingDs=a&&n?wh([a,n]):a||n}else r.pendingDs=a;if(e){const e=r.pendingStructs.update;r.pendingStructs=null,Td(t.doc,e)}}),n,!1),Td=(t,e,n,o=vd)=>{const r=lc(e);Ed(r,t,n,new o(r))};class Od{constructor(){this.l=[]}}const Ad=()=>new Od,Nd=(t,e)=>t.l.push(e),_d=(t,e)=>{const n=t.l;n.length;t.l=n.filter((t=>e!==t)),t.l.length},Ld=(t,e,n)=>Ic(t.l,[e,n]);class Dd{constructor(t,e){this.client=t,this.clock=e}}const Rd=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,Id=(t,e)=>new Dd(t,e),Pd=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw oc()},Hd=(t,e)=>{for(;null!==e;){if(e.parent===t)return!0;e=e.parent._item}return!1};class Vd{constructor(t,e,n,o=0){this.type=t,this.tname=e,this.item=n,this.assoc=o}}const Bd=t=>new Vd(null==t.type?null:Id(t.type.client,t.type.clock),t.tname??null,null==t.item?null:Id(t.item.client,t.item.clock),null==t.assoc?0:t.assoc);class jd{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const zd=(t,e,n)=>{let o=null,r=null;return null===t._item?r=Pd(t):o=Id(t._item.id.client,t._item.id.clock),new Vd(o,r,e,n)},Fd=(t,e,n=0)=>{let o=t._start;if(n<0){if(0===e)return zd(t,null,n);e--}for(;null!==o;){if(!o.deleted&&o.countable){if(o.length>e)return zd(t,Id(o.id.client,o.id.clock+e),n);e-=o.length}if(null===o.right&&n<0)return zd(t,o.lastId,n);o=o.right}return zd(t,null,n)},$d=(t,e,n=!0)=>{const o=e.store,r=t.item,i=t.type,s=t.tname,l=t.assoc;let a=null,c=0;if(null!==r){if(Yd(o,r.client)<=r.clock)return null;const t=n?Fu(o,r):{item:eh(o,r),diff:0},e=t.item;if(!(e instanceof Ju))return null;if(a=e.parent,null===a._item||!a._item.deleted){c=e.deleted||!e.countable?0:t.diff+(l>=0?0:1);let n=e.left;for(;null!==n;)!n.deleted&&n.countable&&(c+=n.length),n=n.left}}else{if(null!==s)a=e.get(s);else{if(null===i)throw oc();{if(Yd(o,i.client)<=i.clock)return null;const{item:t}=n?Fu(o,i):{item:eh(o,i)};if(!(t instanceof Ju&&t.content instanceof zu))return null;a=t.content.type}}c=l>=0?a._length:0}return((t,e,n=0)=>new jd(t,e,n))(a,c,t.assoc)},Ud=(t,e)=>t===e||null!==t&&null!==e&&t.tname===e.tname&&Rd(t.item,e.item)&&Rd(t.type,e.type)&&t.assoc===e.assoc;class Wd{constructor(t,e){this.ds=t,this.sv=e}}const qd=(t,e)=>new Wd(t,e);qd(fd(),new Map);const Jd=t=>qd((t=>{const e=fd();return t.clients.forEach(((t,n)=>{const o=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const r=n.id.clock;let i=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])i+=n.length;o.push(new ld(r,i))}}o.length>0&&e.clients.set(n,o)})),e})(t.store),Xd(t.store)),Kd=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!dd(e.ds,t.id),Zd=(t,e)=>{const n=ha(t.meta,Zd,ua),o=t.doc.store;n.has(e)||(e.sv.forEach(((e,n)=>{e<Yd(o,n)&&oh(t,Id(n,e))})),cd(t,e.ds,(t=>{})),n.add(e))};class Gd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Xd=t=>{const e=new Map;return t.clients.forEach(((t,n)=>{const o=t[t.length-1];e.set(n,o.id.clock+o.length)})),e},Yd=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const o=n[n.length-1];return o.id.clock+o.length},Qd=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw oc()}n.push(e)},th=(t,e)=>{let n=0,o=t.length-1,r=t[o],i=r.id.clock;if(i===e)return o;let s=ba(e/(i+r.length-1)*o);for(;n<=o;){if(r=t[s],i=r.id.clock,i<=e){if(e<i+r.length)return s;n=s+1}else o=s-1;s=ba((n+o)/2)}throw oc()},eh=(t,e)=>{const n=t.clients.get(e.client);return n[th(n,e.clock)]},nh=(t,e,n)=>{const o=th(e,n),r=e[o];return r.id.clock<n&&r instanceof Ju?(e.splice(o+1,0,Uu(t,r,n-r.id.clock)),o+1):o},oh=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[nh(t,n,e.clock)]},rh=(t,e,n)=>{const o=e.clients.get(n.client),r=th(o,n.clock),i=o[r];return n.clock!==i.id.clock+i.length-1&&i.constructor!==Cu&&o.splice(r+1,0,Uu(t,i,n.clock-i.id.clock+1)),i},ih=(t,e,n,o,r)=>{if(0===o)return;const i=n+o;let s,l=nh(t,e,n);do{s=e[l++],i<s.id.clock+s.length&&nh(t,e,i),r(s)}while(l<e.length&&e[l].id.clock<i)};class sh{constructor(t,e,n){this.doc=t,this.deleteSet=new ad,this.beforeState=Xd(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const lh=(t,e)=>!(0===e.deleteSet.clients.size&&!((t,e)=>{for(const[n,o]of t)if(e(o,n))return!0;return!1})(e.afterState,((t,n)=>e.beforeState.get(n)!==t)))&&(hd(e.deleteSet),((t,e)=>{Md(t,e.doc.store,e.beforeState)})(t,e),md(t,e.deleteSet),!0),ah=(t,e,n)=>{const o=e._item;(null===o||o.id.clock<(t.beforeState.get(o.id.client)||0)&&!o.deleted)&&ha(t.changed,e,ua).add(n)},ch=(t,e)=>{let n=t[e],o=t[e-1],r=e;for(;r>0&&(o.deleted===n.deleted&&o.constructor===n.constructor&&o.mergeWith(n));n=o,o=t[--r-1])n instanceof Ju&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,o);const i=e-r;return i&&t.splice(e+1-i,i),i},dh=(t,e)=>{if(e<t.length){const n=t[e],o=n.doc,r=o.store,i=n.deleteSet,s=n._mergeStructs;try{hd(i),n.afterState=Xd(n.doc.store),o.emit("beforeObserverCalls",[n,o]);const t=[];n.changed.forEach(((e,o)=>t.push((()=>{null!==o._item&&o._item.deleted||o._callObserver(n,e)})))),t.push((()=>{n.changedParentTypes.forEach(((t,e)=>{e._dEH.l.length>0&&(null===e._item||!e._item.deleted)&&((t=t.filter((t=>null===t.target._item||!t.target._item.deleted))).forEach((t=>{t.currentTarget=e,t._path=null})),t.sort(((t,e)=>t.path.length-e.path.length)),Ld(e._dEH,t,n))}))})),t.push((()=>o.emit("afterTransaction",[n,o]))),Ic(t,[]),n._needFormattingCleanup&&uu(n)}finally{o.gc&&((t,e,n)=>{for(const[o,r]of t.clients.entries()){const t=e.clients.get(o);for(let o=r.length-1;o>=0;o--){const i=r[o],s=i.clock+i.len;for(let o=th(t,i.clock),r=t[o];o<t.length&&r.id.clock<s;r=t[++o]){const r=t[o];if(i.clock+i.len<=r.id.clock)break;r instanceof Ju&&r.deleted&&!r.keep&&n(r)&&r.gc(e,!1)}}}})(i,r,o.gcFilter),((t,e)=>{t.clients.forEach(((t,n)=>{const o=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e];for(let t=va(o.length-1,1+th(o,n.clock+n.len-1)),e=o[t];t>0&&e.id.clock>=n.clock;e=o[t])t-=1+ch(o,t)}}))})(i,r),n.afterState.forEach(((t,e)=>{const o=n.beforeState.get(e)||0;if(o!==t){const t=r.clients.get(e),n=ka(th(t,o),1);for(let e=t.length-1;e>=n;)e-=1+ch(t,e)}}));for(let t=s.length-1;t>=0;t--){const{client:e,clock:n}=s[t].id,o=r.clients.get(e),i=th(o,n);i+1<o.length&&ch(o,i+1)>1||i>0&&ch(o,i)}if(n.local||n.afterState.get(o.clientID)===n.beforeState.get(o.clientID)||(((...t)=>{rd.forEach((e=>e.print(t)))})(nd,Zc,"[yjs] ",Gc,td,"Changed the client-id because another client seems to be using it."),o.clientID=yd()),o.emit("afterTransactionCleanup",[n,o]),o._observers.has("update")){const t=new xd;lh(t,n)&&o.emit("update",[t.toUint8Array(),n.origin,o,n])}if(o._observers.has("updateV2")){const t=new Sd;lh(t,n)&&o.emit("updateV2",[t.toUint8Array(),n.origin,o,n])}const{subdocsAdded:l,subdocsLoaded:a,subdocsRemoved:c}=n;(l.size>0||c.size>0||a.size>0)&&(l.forEach((t=>{t.clientID=o.clientID,null==t.collectionid&&(t.collectionid=o.collectionid),o.subdocs.add(t)})),c.forEach((t=>o.subdocs.delete(t))),o.emit("subdocs",[{loaded:a,added:l,removed:c},o,n]),c.forEach((t=>t.destroy()))),t.length<=e+1?(o._transactionCleanups=[],o.emit("afterAllTransactions",[o,t])):dh(t,e+1)}}},hh=(t,e,n=null,o=!0)=>{const r=t._transactionCleanups;let i=!1,s=null;null===t._transaction&&(i=!0,t._transaction=new sh(t,n,o),r.push(t._transaction),1===r.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{s=e(t._transaction)}finally{if(i){const e=t._transaction===r[0];t._transaction=null,e&&dh(r,0)}}return s};class uh{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const ph=(t,e,n)=>{cd(t,n.deletions,(t=>{t instanceof Ju&&e.scope.some((e=>Hd(e,t)))&&$u(t,!1)}))},fh=(t,e,n)=>{let o=null;const r=t.doc,i=t.scope;hh(r,(n=>{for(;e.length>0&&null===t.currStackItem;){const o=r.store,s=e.pop(),l=new Set,a=[];let c=!1;cd(n,s.insertions,(t=>{if(t instanceof Ju){if(null!==t.redone){let{item:e,diff:r}=Fu(o,t.id);r>0&&(e=oh(n,Id(e.id.client,e.id.clock+r))),t=e}!t.deleted&&i.some((e=>Hd(e,t)))&&a.push(t)}})),cd(n,s.deletions,(t=>{t instanceof Ju&&i.some((e=>Hd(e,t)))&&!dd(s.insertions,t.id)&&l.add(t)})),l.forEach((e=>{c=null!==qu(n,e,l,s.insertions,t.ignoreRemoteMapChanges,t)||c}));for(let e=a.length-1;e>=0;e--){const o=a[e];t.deleteFilter(o)&&(o.delete(n),c=!0)}t.currStackItem=c?s:null}n.changed.forEach(((t,e)=>{t.has(null)&&e._searchMarker&&(e._searchMarker.length=0)})),o=n}),t);const s=t.currStackItem;if(null!=s){const e=o.changedParentTypes;t.emit("stack-item-popped",[{stackItem:s,type:n,changedParentTypes:e,origin:t},t]),t.currStackItem=null}return s};class mh extends ya{constructor(t,{captureTimeout:e=500,captureTransaction:n=(t=>!0),deleteFilter:o=(()=>!0),trackedOrigins:r=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:s=(ga(t)?t[0].doc:t.doc)}={}){super(),this.scope=[],this.doc=s,this.addToScope(t),this.deleteFilter=o,r.add(this),this.trackedOrigins=r,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.captureTimeout=e,this.afterTransactionHandler=t=>{if(!(this.captureTransaction(t)&&this.scope.some((e=>t.changedParentTypes.has(e)))&&(this.trackedOrigins.has(t.origin)||t.origin&&this.trackedOrigins.has(t.origin.constructor))))return;const e=this.undoing,n=this.redoing,o=e?this.redoStack:this.undoStack;e?this.stopCapturing():n||this.clear(!1,!0);const r=new ad;t.afterState.forEach(((e,n)=>{const o=t.beforeState.get(n)||0,i=e-o;i>0&&pd(r,n,o,i)}));const i=Mc();let s=!1;if(this.lastChange>0&&i-this.lastChange<this.captureTimeout&&o.length>0&&!e&&!n){const e=o[o.length-1];e.deletions=ud([e.deletions,t.deleteSet]),e.insertions=ud([e.insertions,r])}else o.push(new uh(t.deleteSet,r)),s=!0;e||n||(this.lastChange=i),cd(t,t.deleteSet,(t=>{t instanceof Ju&&this.scope.some((e=>Hd(e,t)))&&$u(t,!0)}));const l=[{stackItem:o[o.length-1],origin:t.origin,type:e?"redo":"undo",changedParentTypes:t.changedParentTypes},this];s?this.emit("stack-item-added",l):this.emit("stack-item-updated",l)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",(()=>{this.destroy()}))}addToScope(t){(t=ga(t)?t:[t]).forEach((t=>{this.scope.every((e=>e!==t))&&(t.doc!==this.doc&&((...t)=>{t.unshift(nd),rd.forEach((e=>e.print(t)))})("[yjs#509] Not same Y.Doc"),this.scope.push(t))}))}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact((n=>{t&&(this.undoStack.forEach((t=>ph(n,this,t))),this.undoStack=[]),e&&(this.redoStack.forEach((t=>ph(n,this,t))),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])}))}stopCapturing(){this.lastChange=0}undo(){let t;this.undoing=!0;try{t=fh(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){let t;this.redoing=!0;try{t=fh(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class gh{constructor(t,e){this.gen=function*(t){const e=dc(t.restDecoder);for(let n=0;n<e;n++){const e=dc(t.restDecoder),n=t.readClient();let o=dc(t.restDecoder);for(let r=0;r<e;r++){const e=t.readInfo();if(10===e){const e=dc(t.restDecoder);yield new Gu(Id(n,o),e),o+=e}else if(31&e){const r=!(192&e),i=new Ju(Id(n,o),null,(e&Sa)===Sa?t.readLeftID():null,null,(e&Ca)===Ca?t.readRightID():null,r?t.readParentInfo()?t.readString():t.readLeftID():null,!r||32&~e?null:t.readString(),Ku(t,e));yield i,o+=i.length}else{const e=t.readLen();yield new Cu(Id(n,o),e),o+=e}}}}(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Gu);return this.curr}}class yh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const bh=(t,e)=>{if(t.constructor===Cu){const{client:n,clock:o}=t.id;return new Cu(Id(n,o+e),t.length-e)}if(t.constructor===Gu){const{client:n,clock:o}=t.id;return new Gu(Id(n,o+e),t.length-e)}{const n=t,{client:o,clock:r}=n.id;return new Ju(Id(o,r+e),null,Id(o,r+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},wh=(t,e=vd,n=Sd)=>{if(1===t.length)return t[0];const o=t.map((t=>new e(lc(t))));let r=o.map((t=>new gh(t,!0))),i=null;const s=new n,l=new yh(s);for(;r=r.filter((t=>null!==t.curr)),r.sort(((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===Gu?1:-1:n}return e.curr.id.client-t.curr.id.client})),0!==r.length;){const t=r[0],e=t.curr.id.client;if(null!==i){let n=t.curr,o=!1;for(;null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client;)n=t.next(),o=!0;if(null===n||n.id.client!==e||o&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(e!==i.struct.id.client)kh(l,i.struct,i.offset),i={struct:n,offset:0},t.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===Gu)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{kh(l,i.struct,i.offset);const t=n.id.clock-i.struct.id.clock-i.struct.length;i={struct:new Gu(Id(e,i.struct.id.clock+i.struct.length),t),offset:0}}else{const e=i.struct.id.clock+i.struct.length-n.id.clock;e>0&&(i.struct.constructor===Gu?i.struct.length-=e:n=bh(n,e)),i.struct.mergeWith(n)||(kh(l,i.struct,i.offset),i={struct:n,offset:0},t.next())}}else i={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==Gu;n=t.next())kh(l,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(kh(l,i.struct,i.offset),i=null),xh(l);const a=o.map((t=>(t=>{const e=new ad,n=dc(t.restDecoder);for(let o=0;o<n;o++){t.resetDsCurVal();const n=dc(t.restDecoder),o=dc(t.restDecoder);if(o>0){const r=ha(e.clients,n,(()=>[]));for(let e=0;e<o;e++)r.push(new ld(t.readDsClock(),t.readDsLen()))}}return e})(t))),c=ud(a);return md(s,c),s.toUint8Array()},vh=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Pa(t.encoder.restEncoder)}),t.encoder.restEncoder=Ia(),t.written=0)},kh=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&vh(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Ba(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},xh=t=>{vh(t);const e=t.encoder.restEncoder;Ba(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const o=t.clientStructs[n];Ba(e,o.written),Ua(e,o.restEncoder)}},Ch="You must not compute changes after the event-handler fired.";class Sh{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Mh(this.currentTarget,this.target))}deletes(t){return dd(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw ec(Ch);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach((n=>{if(null!==n){const o=e._map.get(n);let r,i;if(this.adds(o)){let t=o.left;for(;null!==t&&this.adds(t);)t=t.left;if(this.deletes(o)){if(null===t||!this.deletes(t))return;r="delete",i=pa(t.content.getContent())}else null!==t&&this.deletes(t)?(r="update",i=pa(t.content.getContent())):(r="add",i=void 0)}else{if(!this.deletes(o))return;r="delete",i=pa(o.content.getContent())}t.set(n,{action:r,oldValue:i})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){if(0===this.transaction.doc._transactionCleanups.length)throw ec(Ch);const e=this.target,n=ua(),o=ua(),r=[];t={added:n,deleted:o,delta:r,keys:this.keys};if(this.transaction.changed.get(e).has(null)){let t=null;const i=()=>{t&&r.push(t)};for(let r=e._start;null!==r;r=r.right)r.deleted?this.deletes(r)&&!this.adds(r)&&(null!==t&&void 0!==t.delete||(i(),t={delete:0}),t.delete+=r.length,o.add(r)):this.adds(r)?(null!==t&&void 0!==t.insert||(i(),t={insert:[]}),t.insert=t.insert.concat(r.content.getContent()),n.add(r)):(null!==t&&void 0!==t.retain||(i(),t={retain:0}),t.retain+=r.length);null!==t&&void 0===t.retain&&i()}this._changes=t}return t}}const Mh=(t,e)=>{const n=[];for(;null!==e._item&&e!==t;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,o=e._item.parent._start;for(;o!==e._item&&null!==o;)!o.deleted&&o.countable&&(t+=o.length),o=o.right;n.unshift(t)}e=e._item.parent}return n};let Eh=0;class Th{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Eh++}}const Oh=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Eh++},Ah=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,n)=>wa(e-t.index)<wa(e-n.index)?t:n));let o=t._start,r=0;for(null!==n&&(o=n.p,r=n.index,(t=>{t.timestamp=Eh++})(n));null!==o.right&&r<e;){if(!o.deleted&&o.countable){if(e<r+o.length)break;r+=o.length}o=o.right}for(;null!==o.left&&r>e;)o=o.left,!o.deleted&&o.countable&&(r-=o.length);for(;null!==o.left&&o.left.id.client===o.id.client&&o.left.id.clock+o.left.length===o.id.clock;)o=o.left,!o.deleted&&o.countable&&(r-=o.length);return null!==n&&wa(n.index-r)<o.parent.length/80?(Oh(n,o,r),n):((t,e,n)=>{if(t.length>=80){const o=t.reduce(((t,e)=>t.timestamp<e.timestamp?t:e));return Oh(o,e,n),o}{const o=new Th(e,n);return t.push(o),o}})(t._searchMarker,o,r)},Nh=(t,e,n)=>{for(let o=t.length-1;o>=0;o--){const r=t[o];if(n>0){let e=r.p;for(e.marker=!1;e&&(e.deleted||!e.countable);)e=e.left,e&&!e.deleted&&e.countable&&(r.index-=e.length);if(null===e||!0===e.marker){t.splice(o,1);continue}r.p=e,e.marker=!0}(e<r.index||n>0&&e===r.index)&&(r.index=ka(e,r.index+n))}},_h=(t,e,n)=>{const o=t,r=e.changedParentTypes;for(;ha(r,t,(()=>[])).push(n),null!==t._item;)t=t._item.parent;Ld(o._eH,n,e)};class Lh{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ad(),this._dEH=Ad(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw nc()}clone(){throw nc()}_write(t){}get _first(){let t=this._start;for(;null!==t&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Nd(this._eH,t)}observeDeep(t){Nd(this._dEH,t)}unobserve(t){_d(this._eH,t)}unobserveDeep(t){_d(this._dEH,t)}toJSON(){}}const Dh=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let o=n-e;const r=[];let i=t._start;for(;null!==i&&o>0;){if(i.countable&&!i.deleted){const t=i.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&o>0;n++)r.push(t[n]),o--;e=0}}i=i.right}return r},Rh=t=>{const e=[];let n=t._start;for(;null!==n;){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},Ih=(t,e)=>{const n=[];let o=t._start;for(;null!==o;){if(o.countable&&Kd(o,e)){const t=o.content.getContent();for(let e=0;e<t.length;e++)n.push(t[e])}o=o.right}return n},Ph=(t,e)=>{let n=0,o=t._start;for(;null!==o;){if(o.countable&&!o.deleted){const r=o.content.getContent();for(let o=0;o<r.length;o++)e(r[o],n++,t)}o=o.right}},Hh=(t,e)=>{const n=[];return Ph(t,((o,r)=>{n.push(e(o,r,t))})),n},Vh=t=>{let e=t._start,n=null,o=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),o=0,e=e.right}const t=n[o++];return n.length<=o&&(n=null),{done:!1,value:t}}}},Bh=(t,e)=>{const n=Ah(t,e);let o=t._start;for(null!==n&&(o=n.p,e-=n.index);null!==o;o=o.right)if(!o.deleted&&o.countable){if(e<o.length)return o.content.getContent()[e];e-=o.length}},jh=(t,e,n,o)=>{let r=n;const i=t.doc,s=i.clientID,l=i.store,a=null===n?e._start:n.right;let c=[];const d=()=>{c.length>0&&(r=new Ju(Id(s,Yd(l,s)),r,r&&r.lastId,a,a&&a.id,e,null,new _u(c)),r.integrate(t,0),c=[])};o.forEach((n=>{if(null===n)c.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(n);break;default:switch(d(),n.constructor){case Uint8Array:case ArrayBuffer:r=new Ju(Id(s,Yd(l,s)),r,r&&r.lastId,a,a&&a.id,e,null,new Su(new Uint8Array(n))),r.integrate(t,0);break;case bd:r=new Ju(Id(s,Yd(l,s)),r,r&&r.lastId,a,a&&a.id,e,null,new Tu(n)),r.integrate(t,0);break;default:if(!(n instanceof Lh))throw new Error("Unexpected content type in insert operation");r=new Ju(Id(s,Yd(l,s)),r,r&&r.lastId,a,a&&a.id,e,null,new zu(n)),r.integrate(t,0)}}})),d()},zh=()=>ec("Length exceeded!"),Fh=(t,e,n,o)=>{if(n>e._length)throw zh();if(0===n)return e._searchMarker&&Nh(e._searchMarker,n,o.length),jh(t,e,null,o);const r=n,i=Ah(e,n);let s=e._start;for(null!==i&&(s=i.p,0===(n-=i.index)&&(s=s.prev,n+=s&&s.countable&&!s.deleted?s.length:0));null!==s;s=s.right)if(!s.deleted&&s.countable){if(n<=s.length){n<s.length&&oh(t,Id(s.id.client,s.id.clock+n));break}n-=s.length}return e._searchMarker&&Nh(e._searchMarker,r,o.length),jh(t,e,s,o)},$h=(t,e,n,o)=>{if(0===o)return;const r=n,i=o,s=Ah(e,n);let l=e._start;for(null!==s&&(l=s.p,n-=s.index);null!==l&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&oh(t,Id(l.id.client,l.id.clock+n)),n-=l.length);for(;o>0&&null!==l;)l.deleted||(o<l.length&&oh(t,Id(l.id.client,l.id.clock+o)),l.delete(t),o-=l.length),l=l.right;if(o>0)throw zh();e._searchMarker&&Nh(e._searchMarker,r,-i+o)},Uh=(t,e,n)=>{const o=e._map.get(n);void 0!==o&&o.delete(t)},Wh=(t,e,n,o)=>{const r=e._map.get(n)||null,i=t.doc,s=i.clientID;let l;if(null==o)l=new _u([o]);else switch(o.constructor){case Number:case Object:case Boolean:case Array:case String:l=new _u([o]);break;case Uint8Array:l=new Su(o);break;case bd:l=new Tu(o);break;default:if(!(o instanceof Lh))throw new Error("Unexpected content type");l=new zu(o)}new Ju(Id(s,Yd(i.store,s)),r,r&&r.lastId,null,null,e,n,l).integrate(t,0)},qh=(t,e)=>{const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Jh=t=>{const e={};return t._map.forEach(((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])})),e},Kh=(t,e)=>{const n=t._map.get(e);return void 0!==n&&!n.deleted},Zh=t=>{return e=t.entries(),n=t=>!t[1].deleted,id((()=>{let t;do{t=e.next()}while(!t.done&&!n(t.value));return t}));var e,n};class Gh extends Sh{}class Xh extends Lh{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Xh;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Xh}clone(){const t=new Xh;return t.insert(0,this.toArray().map((t=>t instanceof Lh?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),_h(this,t,new Gh(this,t))}insert(t,e){null!==this.doc?hh(this.doc,(n=>{Fh(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?hh(this.doc,(e=>{((t,e,n)=>{let o=(e._searchMarker||[]).reduce(((t,e)=>e.index>t.index?e:t),{index:0,p:e._start}).p;if(o)for(;o.right;)o=o.right;jh(t,e,o,n)})(e,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?hh(this.doc,(n=>{$h(n,this,t,e)})):this._prelimContent.splice(t,e)}get(t){return Bh(this,t)}toArray(){return Rh(this)}slice(t=0,e=this.length){return Dh(this,t,e)}toJSON(){return this.map((t=>t instanceof Lh?t.toJSON():t))}map(t){return Hh(this,t)}forEach(t){Ph(this,t)}[Symbol.iterator](){return Vh(this)}_write(t){t.writeTypeRef(Ru)}}class Yh extends Sh{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Qh extends Lh{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach(((t,e)=>{this.set(e,t)})),this._prelimContent=null}_copy(){return new Qh}clone(){const t=new Qh;return this.forEach(((e,n)=>{t.set(n,e instanceof Lh?e.clone():e)})),t}_callObserver(t,e){_h(this,t,new Yh(this,t,e))}toJSON(){const t={};return this._map.forEach(((e,n)=>{if(!e.deleted){const o=e.content.getContent()[e.length-1];t[n]=o instanceof Lh?o.toJSON():o}})),t}get size(){return[...Zh(this._map)].length}keys(){return sd(Zh(this._map),(t=>t[0]))}values(){return sd(Zh(this._map),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return sd(Zh(this._map),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this._map.forEach(((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?hh(this.doc,(e=>{Uh(e,this,t)})):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?hh(this.doc,(n=>{Wh(n,this,t,e)})):this._prelimContent.set(t,e),e}get(t){return qh(this,t)}has(t){return Kh(this,t)}clear(){null!==this.doc?hh(this.doc,(t=>{this.forEach((function(e,n,o){Uh(t,o,n)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(Iu)}}const tu=(t,e)=>t===e||"object"==typeof t&&"object"==typeof e&&t&&e&&Rc(t,e);class eu{constructor(t,e,n,o){this.left=t,this.right=e,this.index=n,this.currentAttributes=o}forward(){if(null===this.right&&oc(),this.right.content.constructor===Au)this.right.deleted||iu(this.currentAttributes,this.right.content);else this.right.deleted||(this.index+=this.right.length);this.left=this.right,this.right=this.right.right}}const nu=(t,e,n)=>{for(;null!==e.right&&n>0;){if(e.right.content.constructor===Au)e.right.deleted||iu(e.currentAttributes,e.right.content);else e.right.deleted||(n<e.right.length&&oh(t,Id(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);e.left=e.right,e.right=e.right.right}return e},ou=(t,e,n,o)=>{const r=new Map,i=o?Ah(e,n):null;if(i){const e=new eu(i.p.left,i.p,i.index,r);return nu(t,e,n-i.index)}{const o=new eu(null,e._start,0,r);return nu(t,o,n)}},ru=(t,e,n,o)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===Au&&tu(o.get(n.right.content.key),n.right.content.value));)n.right.deleted||o.delete(n.right.content.key),n.forward();const r=t.doc,i=r.clientID;o.forEach(((o,s)=>{const l=n.left,a=n.right,c=new Ju(Id(i,Yd(r.store,i)),l,l&&l.lastId,a,a&&a.id,e,null,new Au(s,o));c.integrate(t,0),n.right=c,n.forward()}))},iu=(t,e)=>{const{key:n,value:o}=e;null===o?t.delete(n):t.set(n,o)},su=(t,e)=>{for(;null!==t.right&&(t.right.deleted||t.right.content.constructor===Au&&tu(e[t.right.content.key]??null,t.right.content.value));)t.forward()},lu=(t,e,n,o)=>{const r=t.doc,i=r.clientID,s=new Map;for(const l in o){const a=o[l],c=n.currentAttributes.get(l)??null;if(!tu(c,a)){s.set(l,c);const{left:o,right:d}=n;n.right=new Ju(Id(i,Yd(r.store,i)),o,o&&o.lastId,d,d&&d.id,e,null,new Au(l,a)),n.right.integrate(t,0),n.forward()}}return s},au=(t,e,n,o,r)=>{n.currentAttributes.forEach(((t,e)=>{void 0===r[e]&&(r[e]=null)}));const i=t.doc,s=i.clientID;su(n,r);const l=lu(t,e,n,r),a=o.constructor===String?new Lu(o):o instanceof Lh?new zu(o):new Ou(o);let{left:c,right:d,index:h}=n;e._searchMarker&&Nh(e._searchMarker,n.index,a.getLength()),d=new Ju(Id(s,Yd(i.store,s)),c,c&&c.lastId,d,d&&d.id,e,null,a),d.integrate(t,0),n.right=d,n.index=h,n.forward(),ru(t,e,n,l)},cu=(t,e,n,o,r)=>{const i=t.doc,s=i.clientID;su(n,r);const l=lu(t,e,n,r);t:for(;null!==n.right&&(o>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Au));){if(!n.right.deleted)switch(n.right.content.constructor){case Au:{const{key:e,value:i}=n.right.content,s=r[e];if(void 0!==s){if(tu(s,i))l.delete(e);else{if(0===o)break t;l.set(e,i)}n.right.delete(t)}else n.currentAttributes.set(e,i);break}default:o<n.right.length&&oh(t,Id(n.right.id.client,n.right.id.clock+o)),o-=n.right.length}n.forward()}if(o>0){let r="";for(;o>0;o--)r+="\n";n.right=new Ju(Id(s,Yd(i.store,s)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Lu(r)),n.right.integrate(t,0),n.forward()}ru(t,e,n,l)},du=(t,e,n,o,r)=>{let i=e;const s=ca();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Au){const t=i.content;s.set(t.key,t)}i=i.right}let l=0,a=!1;for(;e!==i;){if(n===e&&(a=!0),!e.deleted){const n=e.content;switch(n.constructor){case Au:{const{key:i,value:c}=n,d=o.get(i)??null;s.get(i)===n&&d!==c||(e.delete(t),l++,a||(r.get(i)??null)!==c||d===c||(null===d?r.delete(i):r.set(i,d))),a||e.deleted||iu(r,n);break}}}e=e.right}return l},hu=t=>{let e=0;return hh(t.doc,(n=>{let o=t._start,r=t._start,i=ca();const s=da(i);for(;r;){if(!1===r.deleted)if(r.content.constructor===Au)iu(s,r.content);else e+=du(n,o,r,i,s),i=da(s),o=r;r=r.right}})),e},uu=t=>{const e=new Set,n=t.doc;for(const[o,r]of t.afterState.entries()){const i=t.beforeState.get(o)||0;r!==i&&ih(t,n.store.clients.get(o),i,r,(t=>{t.deleted||t.content.constructor!==Au||t.constructor===Cu||e.add(t.parent)}))}hh(n,(n=>{cd(t,t.deleteSet,(t=>{if(t instanceof Cu||!t.parent._hasFormatting||e.has(t.parent))return;const o=t.parent;t.content.constructor===Au?e.add(o):((t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Au){const o=e.content.key;n.has(o)?e.delete(t):n.add(o)}e=e.left}})(n,t)}));for(const t of e)hu(t)}))},pu=(t,e,n)=>{const o=n,r=da(e.currentAttributes),i=e.right;for(;n>0&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case zu:case Ou:case Lu:n<e.right.length&&oh(t,Id(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t)}e.forward()}i&&du(t,i,e.right,r,e.currentAttributes);const s=(e.left||e.right).parent;return s._searchMarker&&Nh(s._searchMarker,e.index,-o+n),e};class fu extends Sh{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];hh(t,(t=>{const n=new Map,o=new Map;let r=this.target._start,i=null;const s={};let l="",a=0,c=0;const d=()=>{if(null!==i){let t=null;switch(i){case"delete":c>0&&(t={delete:c}),c=0;break;case"insert":("object"==typeof l||l.length>0)&&(t={insert:l},n.size>0&&(t.attributes={},n.forEach(((e,n)=>{null!==e&&(t.attributes[n]=e)})))),l="";break;case"retain":a>0&&(t={retain:a},(t=>{for(const e in t)return!1;return!0})(s)||(t.attributes=_c({},s))),a=0}t&&e.push(t),i=null}};for(;null!==r;){switch(r.content.constructor){case zu:case Ou:this.adds(r)?this.deletes(r)||(d(),i="insert",l=r.content.getContent()[0],d()):this.deletes(r)?("delete"!==i&&(d(),i="delete"),c+=1):r.deleted||("retain"!==i&&(d(),i="retain"),a+=1);break;case Lu:this.adds(r)?this.deletes(r)||("insert"!==i&&(d(),i="insert"),l+=r.content.str):this.deletes(r)?("delete"!==i&&(d(),i="delete"),c+=r.length):r.deleted||("retain"!==i&&(d(),i="retain"),a+=r.length);break;case Au:{const{key:e,value:l}=r.content;if(this.adds(r)){if(!this.deletes(r)){const a=n.get(e)??null;tu(a,l)?null!==l&&r.delete(t):("retain"===i&&d(),tu(l,o.get(e)??null)?delete s[e]:s[e]=l)}}else if(this.deletes(r)){o.set(e,l);const t=n.get(e)??null;tu(t,l)||("retain"===i&&d(),s[e]=t)}else if(!r.deleted){o.set(e,l);const n=s[e];void 0!==n&&(tu(n,l)?null!==n&&r.delete(t):("retain"===i&&d(),null===l?delete s[e]:s[e]=l))}r.deleted||("insert"===i&&d(),iu(n,r.content));break}}r=r.right}for(d();e.length>0;){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}})),this._delta=e}return this._delta}}class mu extends Lh{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach((t=>t()))}catch(eM){}this._pending=null}_copy(){return new mu}clone(){const t=new mu;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new fu(this,t,e);_h(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===Lu&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?hh(this.doc,(n=>{const o=new eu(null,this._start,0,new Map);for(let r=0;r<t.length;r++){const i=t[r];if(void 0!==i.insert){const s=e||"string"!=typeof i.insert||r!==t.length-1||null!==o.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof s||s.length>0)&&au(n,this,o,s,i.attributes||{})}else void 0!==i.retain?cu(n,this,o,i.retain,i.attributes||{}):void 0!==i.delete&&pu(n,o,i.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,e,n){const o=[],r=new Map,i=this.doc;let s="",l=this._start;function a(){if(s.length>0){const t={};let e=!1;r.forEach(((n,o)=>{e=!0,t[o]=n}));const n={insert:s};e&&(n.attributes=t),o.push(n),s=""}}const c=()=>{for(;null!==l;){if(Kd(l,t)||void 0!==e&&Kd(l,e))switch(l.content.constructor){case Lu:{const o=r.get("ychange");void 0===t||Kd(l,t)?void 0===e||Kd(l,e)?void 0!==o&&(a(),r.delete("ychange")):void 0!==o&&o.user===l.id.client&&"added"===o.type||(a(),r.set("ychange",n?n("added",l.id):{type:"added"})):void 0!==o&&o.user===l.id.client&&"removed"===o.type||(a(),r.set("ychange",n?n("removed",l.id):{type:"removed"})),s+=l.content.str;break}case zu:case Ou:{a();const t={insert:l.content.getContent()[0]};if(r.size>0){const e={};t.attributes=e,r.forEach(((t,n)=>{e[n]=t}))}o.push(t);break}case Au:Kd(l,t)&&(a(),iu(r,l.content))}l=l.right}a()};return t||e?hh(i,(n=>{t&&Zd(n,t),e&&Zd(n,e),c()}),"cleanup"):c(),o}insert(t,e,n){if(e.length<=0)return;const o=this.doc;null!==o?hh(o,(o=>{const r=ou(o,this,t,!n);n||(n={},r.currentAttributes.forEach(((t,e)=>{n[e]=t}))),au(o,this,r,e,n)})):this._pending.push((()=>this.insert(t,e,n)))}insertEmbed(t,e,n){const o=this.doc;null!==o?hh(o,(o=>{const r=ou(o,this,t,!n);au(o,this,r,e,n||{})})):this._pending.push((()=>this.insertEmbed(t,e,n||{})))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?hh(n,(n=>{pu(n,ou(n,this,t,!0),e)})):this._pending.push((()=>this.delete(t,e)))}format(t,e,n){if(0===e)return;const o=this.doc;null!==o?hh(o,(o=>{const r=ou(o,this,t,!1);null!==r.right&&cu(o,this,r,e,n)})):this._pending.push((()=>this.format(t,e,n)))}removeAttribute(t){null!==this.doc?hh(this.doc,(e=>{Uh(e,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,e){null!==this.doc?hh(this.doc,(n=>{Wh(n,this,t,e)})):this._pending.push((()=>this.setAttribute(t,e)))}getAttribute(t){return qh(this,t)}getAttributes(){return Jh(this)}_write(t){t.writeTypeRef(Pu)}}class gu{constructor(t,e=(()=>!0)){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==bu&&e.constructor!==yu||null===e._start)for(;null!==t;){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class yu extends Lh{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new yu}clone(){const t=new yu;return t.insert(0,this.toArray().map((t=>t instanceof Lh?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new gu(this,t)}querySelector(t){t=t.toUpperCase();const e=new gu(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)).next();return e.done?null:e.value}querySelectorAll(t){return t=t.toUpperCase(),ma(new gu(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)))}_callObserver(t,e){_h(this,t,new wu(this,e,t))}toString(){return Hh(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const o=t.createDocumentFragment();return void 0!==n&&n._createAssociation(o,this),Ph(this,(r=>{o.insertBefore(r.toDOM(t,e,n),null)})),o}insert(t,e){null!==this.doc?hh(this.doc,(n=>{Fh(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)hh(this.doc,(n=>{const o=t&&t instanceof Lh?t._item:t;jh(n,this,o,e)}));else{const n=this._prelimContent,o=null===t?0:n.findIndex((e=>e===t))+1;if(0===o&&null!==t)throw ec("Reference item not found");n.splice(o,0,...e)}}delete(t,e=1){null!==this.doc?hh(this.doc,(n=>{$h(n,this,t,e)})):this._prelimContent.splice(t,e)}toArray(){return Rh(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Bh(this,t)}slice(t=0,e=this.length){return Dh(this,t,e)}forEach(t){Ph(this,t)}_write(t){t.writeTypeRef(Vu)}}class bu extends yu{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach(((t,e)=>{this.setAttribute(e,t)})),this._prelimAttrs=null}_copy(){return new bu(this.nodeName)}clone(){const t=new bu(this.nodeName);return((t,e)=>{for(const n in t)e(t[n],n)})(this.getAttributes(),((e,n)=>{"string"==typeof e&&t.setAttribute(n,e)})),t.insert(0,this.toArray().map((t=>t instanceof Lh?t.clone():t))),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const i in t)n.push(i);n.sort();const o=n.length;for(let i=0;i<o;i++){const o=n[i];e.push(o+'="'+t[o]+'"')}const r=this.nodeName.toLocaleLowerCase();return`<${r}${e.length>0?" "+e.join(" "):""}>${super.toString()}</${r}>`}removeAttribute(t){null!==this.doc?hh(this.doc,(e=>{Uh(e,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?hh(this.doc,(n=>{Wh(n,this,t,e)})):this._prelimAttrs.set(t,e)}getAttribute(t){return qh(this,t)}hasAttribute(t){return Kh(this,t)}getAttributes(t){return t?((t,e)=>{const n={};return t._map.forEach(((t,o)=>{let r=t;for(;null!==r&&(!e.sv.has(r.id.client)||r.id.clock>=(e.sv.get(r.id.client)||0));)r=r.left;null!==r&&Kd(r,e)&&(n[o]=r.content.getContent()[r.length-1])})),n})(this,t):Jh(this)}toDOM(t=document,e={},n){const o=t.createElement(this.nodeName),r=this.getAttributes();for(const i in r){const t=r[i];"string"==typeof t&&o.setAttribute(i,t)}return Ph(this,(r=>{o.appendChild(r.toDOM(t,e,n))})),void 0!==n&&n._createAssociation(o,this),o}_write(t){t.writeTypeRef(Hu),t.writeKey(this.nodeName)}}class wu extends Sh{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class vu extends Qh{constructor(t){super(),this.hookName=t}_copy(){return new vu(this.hookName)}clone(){const t=new vu(this.hookName);return this.forEach(((e,n)=>{t.set(n,e)})),t}toDOM(t=document,e={},n){const o=e[this.hookName];let r;return r=void 0!==o?o.createDom(this):document.createElement(this.hookName),r.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(Bu),t.writeKey(this.hookName)}}class ku extends mu{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new ku}clone(){const t=new ku;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const o=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(o,this),o}toString(){return this.toDelta().map((t=>{const e=[];for(const o in t.attributes){const n=[];for(const e in t.attributes[o])n.push({key:e,value:t.attributes[o][e]});n.sort(((t,e)=>t.key<e.key?-1:1)),e.push({nodeName:o,attrs:n})}e.sort(((t,e)=>t.nodeName<e.nodeName?-1:1));let n="";for(let o=0;o<e.length;o++){const t=e[o];n+=`<${t.nodeName}`;for(let e=0;e<t.attrs.length;e++){const o=t.attrs[e];n+=` ${o.key}="${o.value}"`}n+=">"}n+=t.insert;for(let o=e.length-1;o>=0;o--)n+=`</${e[o].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(ju)}}class xu{constructor(t,e){this.id=t,this.length=e}get deleted(){throw nc()}mergeWith(t){return!1}write(t,e,n){throw nc()}integrate(t,e){throw nc()}}class Cu extends xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Qd(t.doc.store,this)}write(t,e){t.writeInfo(0),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Su{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Su(this.content)}splice(t){throw nc()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Mu{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Mu(this.len)}splice(t){const e=new Mu(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){pd(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Eu=(t,e)=>new bd({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Tu{constructor(t){t._item,this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Tu(Eu(this.doc.guid,this.opts))}splice(t){throw nc()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class Ou{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ou(this.embed)}splice(t){throw nc()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class Au{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Au(this.key,this.value)}splice(t){throw nc()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class Nu{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Nu(this.arr)}splice(t){const e=new Nu(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let o=e;o<n;o++){const e=this.arr[o];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}class _u{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _u(this.arr)}splice(t){const e=new _u(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let o=e;o<n;o++){const e=this.arr[o];t.writeAny(e)}}getRef(){return 8}}class Lu{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Lu(this.str)}splice(t){const e=new Lu(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const Du=[t=>new Xh,t=>new Qh,t=>new mu,t=>new bu(t.readKey()),t=>new yu,t=>new vu(t.readKey()),t=>new ku],Ru=0,Iu=1,Pu=2,Hu=3,Vu=4,Bu=5,ju=6;class zu{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new zu(this.type._copy())}splice(t){throw nc()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;null!==e;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach((e=>{e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t)})),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;null!==e;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach((e=>{for(;null!==e;)e.gc(t,!0),e=e.left})),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Fu=(t,e)=>{let n,o=e,r=0;do{r>0&&(o=Id(o.client,o.clock+r)),n=eh(t,o),r=o.clock-n.id.clock,o=n.redone}while(null!==o&&n instanceof Ju);return{item:n,diff:r}},$u=(t,e)=>{for(;null!==t&&t.keep!==e;)t.keep=e,t=t.parent._item},Uu=(t,e,n)=>{const{client:o,clock:r}=e.id,i=new Ju(Id(o,r+n),e,Id(o,r+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),null!==e.redone&&(i.redone=Id(e.redone.client,e.redone.clock+n)),e.right=i,null!==i.right&&(i.right.left=i),t._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),e.length=n,i},Wu=(t,e)=>((t,e)=>{for(let n=0;n<t.length;n++)if(e(t[n],n,t))return!0;return!1})(t,(t=>dd(t.deletions,e))),qu=(t,e,n,o,r,i)=>{const s=t.doc,l=s.store,a=s.clientID,c=e.redone;if(null!==c)return oh(t,c);let d,h=e.parent._item,u=null;if(null!==h&&!0===h.deleted){if(null===h.redone&&(!n.has(h)||null===qu(t,h,n,o,r,i)))return null;for(;null!==h.redone;)h=oh(t,h.redone)}const p=null===h?e.parent:h.content.type;if(null===e.parentSub){for(u=e.left,d=e;null!==u;){let e=u;for(;null!==e&&e.parent._item!==h;)e=null===e.redone?null:oh(t,e.redone);if(null!==e&&e.parent._item===h){u=e;break}u=u.left}for(;null!==d;){let e=d;for(;null!==e&&e.parent._item!==h;)e=null===e.redone?null:oh(t,e.redone);if(null!==e&&e.parent._item===h){d=e;break}d=d.right}}else if(d=null,e.right&&!r){for(u=e;null!==u&&null!==u.right&&(u.right.redone||dd(o,u.right.id)||Wu(i.undoStack,u.right.id)||Wu(i.redoStack,u.right.id));)for(u=u.right;u.redone;)u=oh(t,u.redone);if(u&&null!==u.right)return null}else u=p._map.get(e.parentSub)||null;const f=Yd(l,a),m=Id(a,f),g=new Ju(m,u,u&&u.lastId,d,d&&d.id,p,e.parentSub,e.content.copy());return e.redone=m,$u(g,!0),g.integrate(t,0),g};let Ju=class t extends xu{constructor(t,e,n,o,r,i,s,l){super(t,l.getLength()),this.origin=n,this.left=e,this.right=o,this.rightOrigin=r,this.parent=i,this.parentSub=s,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(t){(8&this.info)>0!==t&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Yd(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Yd(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Dd&&this.id.client!==this.parent.client&&this.parent.clock>=Yd(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=rh(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=oh(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Cu||this.right&&this.right.constructor===Cu)this.parent=null;else if(this.parent){if(this.parent.constructor===Dd){const t=eh(n,this.parent);t.constructor===Cu?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===t&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===t&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=rh(t,t.doc.store,Id(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start;const o=new Set,r=new Set;for(;null!==e&&e!==this.right;){if(r.add(e),o.add(e),Rd(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,o.clear();else if(Rd(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!r.has(eh(t.doc.store,e.origin)))break;o.has(eh(t.doc.store,e.origin))||(n=e,o.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Qd(t.doc.store,this),this.content.integrate(t,this),ah(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new Cu(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;null!==t&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;null!==t&&t.deleted;)t=t.left;return t}get lastId(){return 1===this.length?this.id:Id(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Rd(t.origin,this.lastId)&&this.right===t&&Rd(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach((e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),pd(t.deleteSet,this.id.client,this.id.clock,this.length),ah(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw oc();this.content.gc(t),e?((t,e,n)=>{const o=t.clients.get(e.id.client);o[th(o,e.id.clock)]=n})(t,this,new Cu(this.id,this.length)):this.content=new Mu(this.length)}write(t,e){const n=e>0?Id(this.id.client,this.id.clock+e-1):this.origin,o=this.rightOrigin,r=this.parentSub,i=31&this.content.getRef()|(null===n?0:Sa)|(null===o?0:Ca)|(null===r?0:32);if(t.writeInfo(i),null!==n&&t.writeLeftID(n),null!==o&&t.writeRightID(o),null===n&&null===o){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=Pd(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===Dd?(t.writeParentInfo(!1),t.writeLeftID(e)):oc();null!==r&&t.writeString(r)}this.content.write(t,e)}};const Ku=(t,e)=>Zu[31&e](t),Zu=[()=>{oc()},t=>new Mu(t.readLen()),t=>{const e=t.readLen(),n=[];for(let o=0;o<e;o++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new Nu(n)},t=>new Su(t.readBuf()),t=>new Lu(t.readString()),t=>new Ou(t.readJSON()),t=>new Au(t.readKey(),t.readJSON()),t=>new zu(Du[t.readTypeRef()](t)),t=>{const e=t.readLen(),n=[];for(let o=0;o<e;o++)n.push(t.readAny());return new _u(n)},t=>new Tu(Eu(t.readString(),t.readAny())),()=>{oc()}];class Gu extends xu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){oc()}write(t,e){t.writeInfo(10),Ba(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Xu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},Yu="__ $YJS$ __";Xu[Yu],Xu[Yu]=!0;const Qu=/[\uD800-\uDBFF]/,tp=/[\uDC00-\uDFFF]/,ep=(t,e)=>{let n=0,o=0;for(;n<t.length&&n<e.length&&t[n]===e[n];)n++;for(n>0&&Qu.test(t[n-1])&&n--;o+n<t.length&&o+n<e.length&&t[t.length-o-1]===e[e.length-o-1];)o++;return o>0&&tp.test(t[t.length-o])&&o--,{index:n,remove:t.length-n-o,insert:e.slice(n,e.length-o)}},np=new Ee("y-sync"),op=new Ee("y-undo"),rp=new Ee("yjs-cursor"),ip=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!dd(e.ds,t.id),sp=[{light:"#ecd44433",dark:"#ecd444"}],lp=(t,e,n)=>{if(!t.has(n)){if(t.size<e.length){const n=ua();t.forEach((t=>n.add(t))),e=e.filter((t=>!n.has(t)))}t.set(n,(o=e)[ba(kc()*o.length)])}var o;return t.get(n)},ap=(t,e)=>({anchor:Tp(e.selection.anchor,t.type,t.mapping),head:Tp(e.selection.head,t.type,t.mapping)});class cp{constructor(t,e=new Map){this.type=t,this.prosemirrorView=null,this.mux=(()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else void 0!==n&&n()}})(),this.mapping=e,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{null===this.beforeTransactionSelection&&null!=this.prosemirrorView&&(this.beforeTransactionSelection=ap(this,this.prosemirrorView.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return!!this.prosemirrorView.hasFocus()&&(Hc&&null===this._domSelectionInView&&(Jc(0,(()=>{this._domSelectionInView=null})),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView)}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection(),e=this.prosemirrorView._root.createRange();e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset);0===e.getClientRects().length&&e.startContainer&&e.collapsed&&e.selectNodeContents(e.startContainer);const n=e.getBoundingClientRect(),o=Uc.documentElement;return n.bottom>=0&&n.right>=0&&n.left<=(window.innerWidth||o.clientWidth||0)&&n.top<=(window.innerHeight||o.clientHeight||0)}renderSnapshot(t,e){e||(e=qd(fd(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(np,{snapshot:t,prevSnapshot:e}))}unrenderSnapshot(){this.mapping.clear(),this.mux((()=>{const t=this.type.toArray().map((t=>hp(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t)),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new m(c.from(t),0,0));e.setMeta(np,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(e)}))}_forceRerender(){this.mapping.clear(),this.mux((()=>{const t=null!==this.beforeTransactionSelection?null:this.prosemirrorView.state.selection,e=this.type.toArray().map((t=>hp(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t)),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new m(c.from(e),0,0));t&&n.setSelection(ae.create(n.doc,t.anchor,t.head)),this.prosemirrorView.dispatch(n.setMeta(np,{isChangeOrigin:!0,binding:this}))}))}_renderSnapshot(t,e,n){let o=this.doc;t||(t=Jd(this.doc)),(t instanceof Uint8Array||e instanceof Uint8Array)&&(t instanceof Uint8Array&&e instanceof Uint8Array||oc(),o=new bd({gc:!1}),Td(o,e),e=Jd(o),Td(o,t),t=Jd(o)),this.mapping.clear(),this.mux((()=>{o.transact((o=>{const r=n.permanentUserData;r&&r.dss.forEach((t=>{cd(o,t,(t=>{}))}));const i=(t,e)=>{const o="added"===t?r.getUserByClientId(e.client):r.getUserByDeletedId(e);return{user:o,type:t,color:lp(n.colorMapping,n.colors,o)}},s=Ih(this.type,new Wd(e.ds,t.sv)).map((n=>!n._item.deleted||ip(n._item,t)||ip(n._item,e)?hp(n,this.prosemirrorView.state.schema,new Map,t,e,i):null)).filter((t=>null!==t)),l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new m(c.from(s),0,0));this.prosemirrorView.dispatch(l.setMeta(np,{isChangeOrigin:!0}))}),np)}))}_typeChanged(t,e){if(null==this.prosemirrorView)return;const n=np.getState(this.prosemirrorView.state);0!==t.length&&null==n.snapshot&&null==n.prevSnapshot?this.mux((()=>{const t=(t,e)=>this.mapping.delete(e);cd(e,e.deleteSet,(t=>{if(t.constructor===Ju){const e=t.content.type;e&&this.mapping.delete(e)}})),e.changed.forEach(t),e.changedParentTypes.forEach(t);const n=this.type.toArray().map((t=>dp(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t));let o=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new m(c.from(n),0,0));((t,e,n)=>{if(null!==e&&null!==e.anchor&&null!==e.head){const o=Ap(n.doc,n.type,e.anchor,n.mapping),r=Ap(n.doc,n.type,e.head,n.mapping);null!==o&&null!==r&&(t=t.setSelection(ae.create(t.doc,o,r)))}})(o,this.beforeTransactionSelection,this),o=o.setMeta(np,{isChangeOrigin:!0,isUndoRedoOperation:e.origin instanceof mh}),null!==this.beforeTransactionSelection&&this._isLocalCursorInView()&&o.scrollIntoView(),this.prosemirrorView.dispatch(o)})):this.renderSnapshot(n.snapshot,n.prevSnapshot)}_prosemirrorChanged(t){this.doc.transact((()=>{Cp(this.doc,this.type,t,this.mapping),this.beforeTransactionSelection=ap(this,this.prosemirrorView.state)}),np)}initView(t){null!=this.prosemirrorView&&this.destroy(),this.prosemirrorView=t,this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),this.type.observeDeep(this._observeFunction)}destroy(){null!=this.prosemirrorView&&(this.prosemirrorView=null,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions))}}const dp=(t,e,n,o,r,i)=>{const s=n.get(t);if(void 0===s){if(t instanceof bu)return hp(t,e,n,o,r,i);throw nc()}return s},hp=(t,e,n,o,r,i)=>{const s=[],l=t=>{if(t.constructor===bu){const l=dp(t,e,n,o,r,i);null!==l&&s.push(l)}else{const l=up(t,e,n,o,r,i);null!==l&&l.forEach((t=>{null!==t&&s.push(t)}))}};void 0===o||void 0===r?t.toArray().forEach(l):Ih(t,new Wd(r.ds,o.sv)).forEach(l);try{const l=t.getAttributes(o);void 0!==o&&(ip(t._item,o)?ip(t._item,r)||(l.ychange=i?i("added",t._item.id):{type:"added"}):l.ychange=i?i("removed",t._item.id):{type:"removed"});const a=e.node(t.nodeName,l,s);return n.set(t,a),a}catch(eM){return t.doc.transact((e=>{t._item.delete(e)}),np),n.delete(t),null}},up=(t,e,n,o,r,i)=>{const s=[],l=t.toDelta(o,r,i);try{for(let t=0;t<l.length;t++){const n=l[t],o=[];for(const t in n.attributes)o.push(e.mark(t,n.attributes[t]));s.push(e.text(n.insert,o))}}catch(eM){return t.doc.transact((e=>{t._item.delete(e)}),np),null}return s},pp=(t,e)=>t instanceof Array?((t,e)=>{const n=new ku,o=t.map((t=>({insert:t.text,attributes:xp(t.marks)})));return n.applyDelta(o),e.set(n,t),n})(t,e):((t,e)=>{const n=new bu(t.type.name);for(const o in t.attrs){const e=t.attrs[o];null!==e&&"ychange"!==o&&n.setAttribute(o,e)}return n.insert(0,gp(t).map((t=>pp(t,e)))),e.set(n,t),n})(t,e),fp=t=>"object"==typeof t&&null!==t,mp=(t,e)=>{const n=Object.keys(t).filter((e=>null!==t[e]));let o=n.length===Object.keys(e).filter((t=>null!==e[t])).length;for(let r=0;r<n.length&&o;r++){const i=n[r],s=t[i],l=e[i];o="ychange"===i||s===l||fp(s)&&fp(l)&&mp(s,l)}return o},gp=t=>{const e=t.content.content,n=[];for(let o=0;o<e.length;o++){const t=e[o];if(t.isText){const t=[];for(let n=e[o];o<e.length&&n.isText;n=e[++o])t.push(n);o--,n.push(t)}else n.push(t)}return n},yp=(t,e)=>{const n=t.toDelta();return n.length===e.length&&n.every(((t,n)=>t.insert===e[n].text&&Lc(t.attributes||{}).length===e[n].marks.length&&e[n].marks.every((e=>mp(t.attributes[e.type.name]||{},e.attrs)))))},bp=(t,e)=>{if(t instanceof bu&&!(e instanceof Array)&&Sp(t,e)){const n=gp(e);return t._length===n.length&&mp(t.getAttributes(),e.attrs)&&t.toArray().every(((t,e)=>bp(t,n[e])))}return t instanceof ku&&e instanceof Array&&yp(t,e)},wp=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every(((t,n)=>e[n]===t)),vp=(t,e,n)=>{const o=t.toArray(),r=gp(e),i=r.length,s=o.length,l=va(s,i);let a=0,c=0,d=!1;for(;a<l;a++){const t=o[a],e=r[a];if(wp(n.get(t),e))d=!0;else if(!bp(t,e))break}for(;a+c<l;c++){const t=o[s-c-1],e=r[i-c-1];if(wp(n.get(t),e))d=!0;else if(!bp(t,e))break}return{equalityFactor:a+c,foundMappedChild:d}},kp=(t,e,n)=>{n.set(t,e);const{nAttrs:o,str:r}=(t=>{let e="",n=t._start;const o={};for(;null!==n;)n.deleted||(n.countable&&n.content instanceof Lu?e+=n.content.str:n.content instanceof Au&&(o[n.content.key]=null)),n=n.right;return{str:e,nAttrs:o}})(t),i=e.map((t=>({insert:t.text,attributes:Object.assign({},o,xp(t.marks))}))),{insert:s,remove:l,index:a}=ep(r,i.map((t=>t.insert)).join(""));t.delete(a,l),t.insert(a,s),t.applyDelta(i.map((t=>({retain:t.insert.length,attributes:t.attributes}))))},xp=t=>{const e={};return t.forEach((t=>{"ychange"!==t.type.name&&(e[t.type.name]=t.attrs)})),e},Cp=(t,e,n,o)=>{if(e instanceof bu&&e.nodeName!==n.type.name)throw new Error("node name mismatch!");if(o.set(e,n),e instanceof bu){const t=e.getAttributes(),o=n.attrs;for(const n in o)null!==o[n]?t[n]!==o[n]&&"ychange"!==n&&e.setAttribute(n,o[n]):e.removeAttribute(n);for(const n in t)void 0===o[n]&&e.removeAttribute(n)}const r=gp(n),i=r.length,s=e.toArray(),l=s.length,a=va(i,l);let c=0,d=0;for(;c<a;c++){const t=s[c],e=r[c];if(!wp(o.get(t),e)){if(!bp(t,e))break;o.set(t,e)}}for(;d+c+1<a;d++){const t=s[l-d-1],e=r[i-d-1];if(!wp(o.get(t),e)){if(!bp(t,e))break;o.set(t,e)}}t.transact((()=>{for(;l-c-d>0&&i-c-d>0;){const n=s[c],a=r[c],h=s[l-d-1],u=r[i-d-1];if(n instanceof ku&&a instanceof Array)yp(n,a)||kp(n,a,o),c+=1;else{let r=n instanceof bu&&Sp(n,a),i=h instanceof bu&&Sp(h,u);if(r&&i){const t=vp(n,a,o),e=vp(h,u,o);t.foundMappedChild&&!e.foundMappedChild?i=!1:!t.foundMappedChild&&e.foundMappedChild||t.equalityFactor<e.equalityFactor?r=!1:i=!1}r?(Cp(t,n,a,o),c+=1):i?(Cp(t,h,u,o),d+=1):(o.delete(e.get(c)),e.delete(c,1),e.insert(c,[pp(a,o)]),c+=1)}}const n=l-c-d;if(1===l&&0===i&&s[0]instanceof ku?(o.delete(s[0]),s[0].delete(0,s[0].length)):n>0&&(e.slice(c,c+n).forEach((t=>o.delete(t))),e.delete(c,n)),c+d<i){const t=[];for(let e=c;e<i-d;e++)t.push(pp(r[e],o));e.insert(c,t)}}),np)},Sp=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name;let Mp=null;const Ep=()=>{const t=Mp;Mp=null,t.forEach(((t,e)=>{const n=e.state.tr,o=np.getState(e.state);o&&o.binding&&!o.binding.isDestroyed&&(t.forEach(((t,e)=>{n.setMeta(e,t)})),e.dispatch(n))}))},Tp=(t,e,n)=>{if(0===t)return Fd(e,0,-1);let o=null===e._first?null:e._first.content.type;for(;null!==o&&e!==o;){if(o instanceof ku){if(o._length>=t)return Fd(o,t,-1);if(t-=o._length,null!==o._item&&null!==o._item.next)o=o._item.next.content.type;else{do{o=null===o._item?null:o._item.parent,t--}while(o!==e&&null!==o&&null!==o._item&&null===o._item.next);null!==o&&o!==e&&(o=null===o._item?null:o._item.next.content.type)}}else{const r=(n.get(o)||{nodeSize:0}).nodeSize;if(null!==o._first&&t<r)o=o._first.content.type,t--;else{if(1===t&&0===o._length&&r>1)return new Vd(null===o._item?null:o._item.id,null===o._item?Pd(o):null,null);if(t-=r,null!==o._item&&null!==o._item.next)o=o._item.next.content.type;else{if(0===t)return o=null===o._item?o:o._item.parent,new Vd(null===o._item?null:o._item.id,null===o._item?Pd(o):null,null);do{o=o._item.parent,t--}while(o!==e&&null===o._item.next);o!==e&&(o=o._item.next.content.type)}}}if(null===o)throw oc();if(0===t&&o.constructor!==ku&&o!==e)return Op(o._item.parent,o._item)}return Fd(e,e._length,-1)},Op=(t,e)=>{let n=null,o=null;return null===t._item?o=Pd(t):n=Id(t._item.id.client,t._item.id.clock),new Vd(n,o,e.id)},Ap=(t,e,n,o)=>{const r=$d(n,t);if(null===r||r.type!==e&&!Hd(e,r.type._item))return null;let i=r.type,s=0;if(i.constructor===ku)s=r.index;else if(null===i._item||!i._item.deleted){let t=i._first,e=0;for(;e<i._length&&e<r.index&&null!==t;){if(!t.deleted){const n=t.content.type;e++,s+=n instanceof ku?n._length:o.get(n).nodeSize}t=t.right}s+=1}for(;i!==e&&null!==i._item;){const t=i._item.parent;if(null===t._item||!t._item.deleted){s+=1;let e=t._first;for(;null!==e;){const t=e.content.type;if(t===i)break;e.deleted||(s+=t instanceof ku?t._length:o.get(t).nodeSize),e=e.right}}i=t}return s-1},Np=(t,e,n)=>t!==e,_p=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null);const o=document.createTextNode(""),r=document.createTextNode("");return e.insertBefore(o,null),e.insertBefore(n,null),e.insertBefore(r,null),e},Lp=t=>({style:`background-color: ${t.color}70`,class:"ProseMirror-yjs-selection"}),Dp=/^#[0-9a-fA-F]{6}$/,Rp=(t,e,n,o,r)=>{const i=np.getState(t),s=i.doc,l=[];return null!=i.snapshot||null!=i.prevSnapshot||null===i.binding?ur.create(t.doc,[]):(e.getStates().forEach(((e,a)=>{if(n(s.clientID,a,e)&&null!=e.cursor){const n=e.user||{};null==n.color?n.color="#ffa500":Dp.test(n.color),null==n.name&&(n.name=`User: ${a}`);let c=Ap(s,i.type,Bd(e.cursor.anchor),i.binding.mapping),d=Ap(s,i.type,Bd(e.cursor.head),i.binding.mapping);if(null!==c&&null!==d){const e=ka(t.doc.content.size-1,0);c=va(c,e),d=va(d,e),l.push(cr.widget(d,(()=>o(n)),{key:a+"",side:10}));const i=va(c,d),s=ka(c,d);l.push(cr.inline(i,s,r(n),{inclusiveEnd:!0,inclusiveStart:!1}))}}})),ur.create(t.doc,l))},Ip=(t,{awarenessStateFilter:e=Np,cursorBuilder:n=_p,selectionBuilder:o=Lp,getSelection:r=(t=>t.selection)}={},i="cursor")=>new Ce({key:rp,state:{init:(r,i)=>Rp(i,t,e,n,o),apply(r,i,s,l){const a=np.getState(l),c=r.getMeta(rp);return a&&a.isChangeOrigin||c&&c.awarenessUpdated?Rp(l,t,e,n,o):i.map(r.mapping,r.doc)}},props:{decorations:t=>rp.getState(t)},view:e=>{const n=()=>{e.docView&&((t,e,n)=>{Mp||(Mp=new Map,Jc(0,Ep)),ha(Mp,t,ca).set(e,n)})(e,rp,{awarenessUpdated:!0})},o=()=>{const n=np.getState(e.state),o=t.getLocalState()||{};if(null!=n.binding)if(e.hasFocus()){const s=r(e.state),l=Tp(s.anchor,n.type,n.binding.mapping),a=Tp(s.head,n.type,n.binding.mapping);null!=o.cursor&&Ud(Bd(o.cursor.anchor),l)&&Ud(Bd(o.cursor.head),a)||t.setLocalStateField(i,{anchor:l,head:a})}else null!=o.cursor&&null!==Ap(n.doc,n.type,Bd(o.cursor.anchor),n.binding.mapping)&&t.setLocalStateField(i,null)};return t.on("change",n),e.dom.addEventListener("focusin",o),e.dom.addEventListener("focusout",o),{update:o,destroy:()=>{e.dom.removeEventListener("focusin",o),e.dom.removeEventListener("focusout",o),t.off("change",n),t.setLocalStateField(i,null)}}}}),Pp=new Set(["paragraph"]),Hp=({protectedNodes:t=Pp,trackedOrigins:e=[],undoManager:n=null}={})=>new Ce({key:op,state:{init:(o,r)=>{const i=np.getState(r),s=n||new mh(i.type,{trackedOrigins:new Set([np].concat(e)),deleteFilter:e=>((t,e)=>!(t instanceof Ju&&t.content instanceof zu&&(t.content.type instanceof mu||t.content.type instanceof bu&&e.has(t.content.type.nodeName))&&0!==t.content.type._length))(e,t),captureTransaction:t=>!1!==t.meta.get("addToHistory")});return{undoManager:s,prevSel:null,hasUndoOps:s.undoStack.length>0,hasRedoOps:s.redoStack.length>0}},apply:(t,e,n,o)=>{const r=np.getState(o).binding,i=e.undoManager,s=i.undoStack.length>0,l=i.redoStack.length>0;return r?{undoManager:i,prevSel:ap(r,n),hasUndoOps:s,hasRedoOps:l}:s!==e.hasUndoOps||l!==e.hasRedoOps?Object.assign({},e,{hasUndoOps:i.undoStack.length>0,hasRedoOps:i.redoStack.length>0}):e}},view:t=>{const e=np.getState(t.state),n=op.getState(t.state).undoManager;return n.on("stack-item-added",(({stackItem:n})=>{const o=e.binding;o&&n.meta.set(o,op.getState(t.state).prevSel)})),n.on("stack-item-popped",(({stackItem:t})=>{const n=e.binding;n&&(n.beforeTransactionSelection=t.meta.get(n)||n.beforeTransactionSelection)})),{destroy:()=>{n.destroy()}}}}),Vp=zi.create({name:"collaboration",priority:1e3,addOptions:()=>({document:null,field:"default",fragment:null}),onCreate(){this.editor.extensionManager.extensions.find((t=>"history"===t.name))},addCommands:()=>({undo:()=>({tr:t,state:e,dispatch:n})=>{t.setMeta("preventDispatch",!0);return 0!==op.getState(e).undoManager.undoStack.length&&(!n||(t=>{const e=op.getState(t).undoManager;if(null!=e)return e.undo(),!0})(e))},redo:()=>({tr:t,state:e,dispatch:n})=>{t.setMeta("preventDispatch",!0);return 0!==op.getState(e).undoManager.redoStack.length&&(!n||(t=>{const e=op.getState(t).undoManager;if(null!=e)return e.redo(),!0})(e))}}),addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const t=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),e=Hp(),n=e.spec.view;e.spec.view=t=>{const{undoManager:e}=op.getState(t.state);e.restore&&(e.restore(),e.restore=()=>{});const o=n?n(t):void 0;return{destroy:()=>{const t=e.trackedOrigins.has(e),n=e._observers;e.restore=()=>{t&&e.trackedOrigins.add(e),e.doc.on("afterTransaction",e.afterTransactionHandler),e._observers=n},(null==o?void 0:o.destroy)&&o.destroy()}}};const o=((t,{colors:e=sp,colorMapping:n=new Map,permanentUserData:o=null,onFirstRender:r=(()=>{}),mapping:i}={})=>{let s=!1;const l=new cp(t,i),a=new Ce({props:{editable:t=>{const e=np.getState(t);return null==e.snapshot&&null==e.prevSnapshot}},key:np,state:{init:(r,i)=>({type:t,doc:t.doc,binding:l,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,isUndoRedoOperation:!1,addToHistory:!0,colors:e,colorMapping:n,permanentUserData:o}),apply:(t,e)=>{const n=t.getMeta(np);if(void 0!==n){e=Object.assign({},e);for(const t in n)e[t]=n[t]}return e.addToHistory=!1!==t.getMeta("addToHistory"),e.isChangeOrigin=void 0!==n&&!!n.isChangeOrigin,e.isUndoRedoOperation=void 0!==n&&!!n.isChangeOrigin&&!!n.isUndoRedoOperation,null!==l.prosemirrorView&&(void 0===n||null==n.snapshot&&null==n.prevSnapshot||Jc(0,(()=>{null!=l.prosemirrorView&&(null==n.restore?l._renderSnapshot(n.snapshot,n.prevSnapshot,e):(l._renderSnapshot(n.snapshot,n.snapshot,e),delete e.restore,delete e.snapshot,delete e.prevSnapshot,l.mux((()=>{l._prosemirrorChanged(l.prosemirrorView.state.doc)}))))}))),e}},view:t=>(l.initView(t),null==i&&l._forceRerender(),r(),{update:()=>{const e=a.getState(t.state);if(null==e.snapshot&&null==e.prevSnapshot&&(s||null!==t.state.doc.content.findDiffStart(t.state.doc.type.createAndFill().content))){if(s=!0,!1===e.addToHistory&&!e.isChangeOrigin){const e=op.getState(t.state),n=e&&e.undoManager;n&&n.stopCapturing()}l.mux((()=>{e.doc.transact((n=>{n.meta.set("addToHistory",e.addToHistory),l._prosemirrorChanged(t.state.doc)}),np)}))}},destroy:()=>{l.destroy()}})});return a})(t,{...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender});return[o,e]}}),Bp=t=>Array.from(t.entries()).map((([t,e])=>({clientId:t,...e.user}))),jp=()=>null,zp=zi.create({name:"collaborationCursor",priority:999,addOptions:()=>({provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");return n.classList.add("collaboration-cursor__label"),n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null),e.insertBefore(n,null),e},selectionRender:Lp,onUpdate:jp}),onCreate(){if(this.options.onUpdate,!this.options.provider)throw new Error('The "provider" option is required for the CollaborationCursor extension')},addStorage:()=>({users:[]}),addCommands(){return{updateUser:t=>()=>(this.options.user=t,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:t=>({editor:e})=>e.commands.updateUser(t)}},addProseMirrorPlugins(){return[Ip((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=Bp(this.options.provider.awareness.states),this.options.provider.awareness.on("update",(()=>{this.storage.users=Bp(this.options.provider.awareness.states)})),this.options.provider.awareness))(),{cursorBuilder:this.options.render,selectionBuilder:this.options.selectionRender})]}});function Fp(t={}){return new Ce({view:e=>new $p(e,t)})}class $p{constructor(t,e){var n;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=e.width)&&void 0!==n?n:1,this.color=!1===e.color?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map((e=>{let n=t=>{this[e](t)};return t.dom.addEventListener(e,n),{name:e,handler:n}}))}destroy(){this.handlers.forEach((({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e)))}update(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent;if(n){let n=e.nodeBefore,o=e.nodeAfter;if(n||o){let e=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(e){let r=e.getBoundingClientRect(),i=n?r.bottom:r.top;n&&o&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:r.left,right:r.right,top:i-this.width/2,bottom:i+this.width/2}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos);t={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let o,r,i=this.editorView.dom.offsetParent;if(this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!i||i==document.body&&"static"==getComputedStyle(i).position)o=-pageXOffset,r=-pageYOffset;else{let t=i.getBoundingClientRect();o=t.left-i.scrollLeft,r=t.top-i.scrollTop}this.element.style.left=t.left-o+"px",this.element.style.top=t.top-r+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),o=n&&n.type.spec.disableDropCursor,r="function"==typeof o?o(this.editorView,e,t):o;if(e&&!r){let t=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let e=Ft(this.editorView.state.doc,t,this.editorView.dragging.slice);null!=e&&(t=e)}this.setCursor(t),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}const Up=zi.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Fp(this.options)]}});class Wp extends re{constructor(t){super(t,t)}map(t,e){let n=t.resolve(e.map(this.head));return Wp.valid(n)?new Wp(n):re.near(n)}content(){return m.empty}eq(t){return t instanceof Wp&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Wp(t.resolve(e.pos))}getBookmark(){return new qp(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!function(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),o=t.node(e);if(0!=n)for(let t=o.child(n-1);;t=t.lastChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(o.type.spec.isolating)return!0}return!0}(t)||!function(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),o=t.node(e);if(n!=o.childCount)for(let t=o.child(n);;t=t.firstChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(o.type.spec.isolating)return!0}return!0}(t))return!1;let n=e.type.spec.allowGapCursor;if(null!=n)return n;let o=e.contentMatchAt(t.index()).defaultType;return o&&o.isTextblock}static findGapCursorFrom(t,e,n=!1){t:for(;;){if(!n&&Wp.valid(t))return t;let o=t.pos,r=null;for(let n=t.depth;;n--){let i=t.node(n);if(e>0?t.indexAfter(n)<i.childCount:t.index(n)>0){r=i.child(e>0?t.indexAfter(n):t.index(n)-1);break}if(0==n)return null;o+=e;let s=t.doc.resolve(o);if(Wp.valid(s))return s}for(;;){let i=e>0?r.firstChild:r.lastChild;if(!i){if(r.isAtom&&!r.isText&&!de.isSelectable(r)){t=t.doc.resolve(o+r.nodeSize*e),n=!1;continue t}break}r=i,o+=e;let s=t.doc.resolve(o);if(Wp.valid(s))return s}return null}}}Wp.prototype.visible=!1,Wp.findFrom=Wp.findGapCursorFrom,re.jsonID("gapcursor",Wp);class qp{constructor(t){this.pos=t}map(t){return new qp(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return Wp.valid(e)?new Wp(e):re.near(e)}}const Jp=Yr({ArrowLeft:Kp("horiz",-1),ArrowRight:Kp("horiz",1),ArrowUp:Kp("vert",-1),ArrowDown:Kp("vert",1)});function Kp(t,e){const n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,o,r){let i=t.selection,s=e>0?i.$to:i.$from,l=i.empty;if(i instanceof ae){if(!r.endOfTextblock(n)||0==s.depth)return!1;l=!1,s=t.doc.resolve(e>0?s.after():s.before())}let a=Wp.findGapCursorFrom(s,e,l);return!!a&&(o&&o(t.tr.setSelection(new Wp(a))),!0)}}function Zp(t,e,n){if(!t||!t.editable)return!1;let o=t.state.doc.resolve(e);if(!Wp.valid(o))return!1;let r=t.posAtCoords({left:n.clientX,top:n.clientY});return!(r&&r.inside>-1&&de.isSelectable(t.state.doc.nodeAt(r.inside)))&&(t.dispatch(t.state.tr.setSelection(new Wp(o))),!0)}function Gp(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof Wp))return!1;let{$from:n}=t.state.selection,o=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!o)return!1;let r=c.empty;for(let s=o.length-1;s>=0;s--)r=c.from(o[s].createAndFill(null,r));let i=t.state.tr.replace(n.pos,n.pos,new m(r,0,0));return i.setSelection(ae.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function Xp(t){if(!(t.selection instanceof Wp))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ur.create(t.doc,[cr.widget(t.selection.head,e,{key:"gapcursor"})])}const Yp=zi.create({name:"gapCursor",addProseMirrorPlugins:()=>[new Ce({props:{decorations:Xp,createSelectionBetween:(t,e,n)=>e.pos==n.pos&&Wp.valid(n)?new Wp(n):null,handleClick:Zp,handleKeyDown:Jp,handleDOMEvents:{beforeinput:Gp}}})],extendNodeSchema(t){var e;return{allowGapCursor:null!==(e=Ci(gi(t,"allowGapCursor",{name:t.name,options:t.options,storage:t.storage})))&&void 0!==e?e:null}}}),Qp=Vs.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:t}){return["br",vi(this.options.HTMLAttributes,t)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:o})=>t.first([()=>t.exitCode(),()=>t.command((()=>{const{selection:t,storedMarks:r}=n;if(t.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:s}=o.extensionManager,l=r||t.$to.parentOffset&&t.$from.marks();return e().insertContent({type:this.name}).command((({tr:t,dispatch:e})=>{if(e&&l&&i){const e=l.filter((t=>s.includes(t.type.name)));t.ensureMarks(e)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}});var tf=200,ef=function(){};ef.prototype.append=function(t){return t.length?(t=ef.from(t),!this.length&&t||t.length<tf&&this.leafAppend(t)||this.length<tf&&t.leafPrepend(this)||this.appendInner(t)):this},ef.prototype.prepend=function(t){return t.length?ef.from(t).append(this):this},ef.prototype.appendInner=function(t){return new of(this,t)},ef.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?ef.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},ef.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},ef.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},ef.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var o=[];return this.forEach((function(e,n){return o.push(t(e,n))}),e,n),o},ef.from=function(t){return t instanceof ef?t:t&&t.length?new nf(t):ef.empty};var nf=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,o){for(var r=e;r<n;r++)if(!1===t(this.values[r],o+r))return!1},e.prototype.forEachInvertedInner=function(t,e,n,o){for(var r=e-1;r>=n;r--)if(!1===t(this.values[r],o+r))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=tf)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=tf)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(ef);ef.empty=new nf([]);var of=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,o){var r=this.left.length;return!(e<r&&!1===this.left.forEachInner(t,e,Math.min(n,r),o))&&(!(n>r&&!1===this.right.forEachInner(t,Math.max(e-r,0),Math.min(this.length,n)-r,o+r))&&void 0)},e.prototype.forEachInvertedInner=function(t,e,n,o){var r=this.left.length;return!(e>r&&!1===this.right.forEachInvertedInner(t,e-r,Math.max(n,r)-r,o+r))&&(!(n<r&&!1===this.left.forEachInvertedInner(t,Math.min(e,r),n,o))&&void 0)},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(ef);class rf{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(0==this.eventCount)return null;let n,o,r=this.items.length;for(;;r--){if(this.items.get(r-1).selection){--r;break}}e&&(n=this.remapping(r,this.items.length),o=n.maps.length);let i,s,l=t.tr,a=[],c=[];return this.items.forEach(((t,e)=>{if(!t.step)return n||(n=this.remapping(r,e+1),o=n.maps.length),o--,void c.push(t);if(n){c.push(new sf(t.map));let e,r=t.step.map(n.slice(o));r&&l.maybeStep(r).doc&&(e=l.mapping.maps[l.mapping.maps.length-1],a.push(new sf(e,void 0,void 0,a.length+c.length))),o--,e&&n.appendMap(e,o)}else l.maybeStep(t.step);return t.selection?(i=n?t.selection.map(n.slice(o)):t.selection,s=new rf(this.items.slice(0,r).append(c.reverse().concat(a)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:s,transform:l,selection:i}}addTransform(t,e,n,o){let r=[],i=this.eventCount,s=this.items,l=!o&&s.length?s.get(s.length-1):null;for(let c=0;c<t.steps.length;c++){let n,a=t.steps[c].invert(t.docs[c]),d=new sf(t.mapping.maps[c],a,e);(n=l&&l.merge(d))&&(d=n,c?r.pop():s=s.slice(0,s.length-1)),r.push(d),e&&(i++,e=void 0),o||(l=d)}let a=i-n.depth;return a>af&&(s=function(t,e){let n;return t.forEach(((t,o)=>{if(t.selection&&0==e--)return n=o,!1})),t.slice(n)}(s,a),i-=a),new rf(s.append(r),i)}remapping(t,e){let n=new kt;return this.items.forEach(((e,o)=>{let r=null!=e.mirrorOffset&&o-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,r)}),t,e),n}addMaps(t){return 0==this.eventCount?this:new rf(this.items.append(t.map((t=>new sf(t)))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],o=Math.max(0,this.items.length-e),r=t.mapping,i=t.steps.length,s=this.eventCount;this.items.forEach((t=>{t.selection&&s--}),o);let l=e;this.items.forEach((e=>{let o=r.getMirror(--l);if(null==o)return;i=Math.min(i,o);let a=r.maps[o];if(e.step){let i=t.steps[o].invert(t.docs[o]),c=e.selection&&e.selection.map(r.slice(l+1,o));c&&s++,n.push(new sf(a,i,c))}else n.push(new sf(a))}),o);let a=[];for(let h=e;h<i;h++)a.push(new sf(r.maps[h]));let c=this.items.slice(0,o).append(a).append(n),d=new rf(c,s);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let t=0;return this.items.forEach((e=>{e.step||t++})),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,o=[],r=0;return this.items.forEach(((i,s)=>{if(s>=t)o.push(i),i.selection&&r++;else if(i.step){let t=i.step.map(e.slice(n)),s=t&&t.getMap();if(n--,s&&e.appendMap(s,n),t){let l=i.selection&&i.selection.map(e.slice(n));l&&r++;let a,c=new sf(s.invert(),t,l),d=o.length-1;(a=o.length&&o[d].merge(c))?o[d]=a:o.push(c)}}else i.map&&n--}),this.items.length,0),new rf(ef.from(o.reverse()),r)}}rf.empty=new rf(ef.empty,0);class sf{constructor(t,e,n,o){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=o}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new sf(e.getMap().invert(),e,this.selection)}}}class lf{constructor(t,e,n,o,r){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=o,this.prevComposition=r}}const af=20;function cf(t){let e=[];for(let n=t.length-1;n>=0&&0==e.length;n--)t[n].forEach(((t,n,o,r)=>e.push(o,r)));return e}function df(t,e){if(!t)return null;let n=[];for(let o=0;o<t.length;o+=2){let r=e.map(t[o],1),i=e.map(t[o+1],-1);r<=i&&n.push(r,i)}return n}let hf=!1,uf=null;function pf(t){let e=t.plugins;if(uf!=e){hf=!1,uf=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){hf=!0;break}}return hf}const ff=new Ee("history"),mf=new Ee("closeHistory");function gf(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ce({key:ff,state:{init:()=>new lf(rf.empty,rf.empty,null,0,-1),apply:(e,n,o)=>function(t,e,n,o){let r,i=n.getMeta(ff);if(i)return i.historyState;n.getMeta(mf)&&(t=new lf(t.done,t.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(s&&s.getMeta(ff))return s.getMeta(ff).redo?new lf(t.done.addTransform(n,void 0,o,pf(e)),t.undone,cf(n.mapping.maps),t.prevTime,t.prevComposition):new lf(t.done,t.undone.addTransform(n,void 0,o,pf(e)),null,t.prevTime,t.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(r=n.getMeta("rebased"))?new lf(t.done.rebased(n,r),t.undone.rebased(n,r),df(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new lf(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),df(t.prevRanges,n.mapping),t.prevTime,t.prevComposition);{let r=n.getMeta("composition"),i=0==t.prevTime||!s&&t.prevComposition!=r&&(t.prevTime<(n.time||0)-o.newGroupDelay||!function(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach(((t,o)=>{for(let r=0;r<e.length;r+=2)t<=e[r+1]&&o>=e[r]&&(n=!0)})),n}(n,t.prevRanges)),l=s?df(t.prevRanges,n.mapping):cf(n.mapping.maps);return new lf(t.done.addTransform(n,i?e.selection.getBookmark():void 0,o,pf(e)),rf.empty,l,n.time,null==r?t.prevComposition:r)}}(n,o,e,t)},config:t,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,o="historyUndo"==n?bf:"historyRedo"==n?wf:null;return!!o&&(e.preventDefault(),o(t.state,t.dispatch))}}}})}function yf(t,e){return(n,o)=>{let r=ff.getState(n);if(!r||0==(t?r.undone:r.done).eventCount)return!1;if(o){let i=function(t,e,n){let o=pf(e),r=ff.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,o);if(!i)return null;let s=i.selection.resolve(i.transform.doc),l=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),r,o),a=new lf(n?l:i.remaining,n?i.remaining:l,null,0,-1);return i.transform.setSelection(s).setMeta(ff,{redo:n,historyState:a})}(r,n,t);i&&o(e?i.scrollIntoView():i)}return!0}}const bf=yf(!1,!0),wf=yf(!0,!0),vf=zi.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:t,dispatch:e})=>bf(t,e),redo:()=>({state:t,dispatch:e})=>wf(t,e)}),addProseMirrorPlugins(){return[gf(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),kf="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4vianca6w0s2x0a2z0ure5ba0by2idu3namex3narepublic11d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0cast4mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dabur3d1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0ardian6cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2tura4vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9dnavy5lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0a1b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp2w2ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4finity6ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",xf="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Cf=(t,e)=>{for(const n in e)t[n]=e[n];return t},Sf="numeric",Mf="ascii",Ef="alpha",Tf="asciinumeric",Of="alphanumeric",Af="domain",Nf="emoji",_f="scheme",Lf="slashscheme",Df="whitespace";function Rf(t,e){return t in e||(e[t]=[]),e[t]}function If(t,e,n){e[Sf]&&(e[Tf]=!0,e[Of]=!0),e[Mf]&&(e[Tf]=!0,e[Ef]=!0),e[Tf]&&(e[Of]=!0),e[Ef]&&(e[Of]=!0),e[Of]&&(e[Af]=!0),e[Nf]&&(e[Af]=!0);for(const o in e){const e=Rf(o,n);e.indexOf(t)<0&&e.push(t)}}function Pf(t){void 0===t&&(t=null),this.j={},this.jr=[],this.jd=null,this.t=t}Pf.groups={},Pf.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let o=0;o<e.jr.length;o++){const n=e.jr[o][0],r=e.jr[o][1];if(r&&n.test(t))return r}return e.jd},has(t,e){return void 0===e&&(e=!1),e?t in this.j:!!this.go(t)},ta(t,e,n,o){for(let r=0;r<t.length;r++)this.tt(t[r],e,n,o)},tr(t,e,n,o){let r;return o=o||Pf.groups,e&&e.j?r=e:(r=new Pf(e),n&&o&&If(e,n,o)),this.jr.push([t,r]),r},ts(t,e,n,o){let r=this;const i=t.length;if(!i)return r;for(let s=0;s<i-1;s++)r=r.tt(t[s]);return r.tt(t[i-1],e,n,o)},tt(t,e,n,o){o=o||Pf.groups;const r=this;if(e&&e.j)return r.j[t]=e,e;const i=e;let s,l=r.go(t);if(l?(s=new Pf,Cf(s.j,l.j),s.jr.push.apply(s.jr,l.jr),s.jd=l.jd,s.t=l.t):s=new Pf,i){if(o)if(s.t&&"string"==typeof s.t){const t=Cf(function(t,e){const n={};for(const o in e)e[o].indexOf(t)>=0&&(n[o]=!0);return n}(s.t,o),n);If(i,t,o)}else n&&If(i,n,o);s.t=i}return r.j[t]=s,s}};const Hf=(t,e,n,o,r)=>t.ta(e,n,o,r),Vf=(t,e,n,o,r)=>t.tr(e,n,o,r),Bf=(t,e,n,o,r)=>t.ts(e,n,o,r),jf=(t,e,n,o,r)=>t.tt(e,n,o,r),zf="WORD",Ff="UWORD",$f="LOCALHOST",Uf="TLD",Wf="UTLD",qf="SCHEME",Jf="SLASH_SCHEME",Kf="NUM",Zf="WS",Gf="NL",Xf="OPENBRACE",Yf="CLOSEBRACE",Qf="OPENBRACKET",tm="CLOSEBRACKET",em="OPENPAREN",nm="CLOSEPAREN",om="OPENANGLEBRACKET",rm="CLOSEANGLEBRACKET",im="FULLWIDTHLEFTPAREN",sm="FULLWIDTHRIGHTPAREN",lm="LEFTCORNERBRACKET",am="RIGHTCORNERBRACKET",cm="LEFTWHITECORNERBRACKET",dm="RIGHTWHITECORNERBRACKET",hm="FULLWIDTHLESSTHAN",um="FULLWIDTHGREATERTHAN",pm="AMPERSAND",fm="APOSTROPHE",mm="ASTERISK",gm="AT",ym="BACKSLASH",bm="BACKTICK",wm="CARET",vm="COLON",km="COMMA",xm="DOLLAR",Cm="DOT",Sm="EQUALS",Mm="EXCLAMATION",Em="HYPHEN",Tm="PERCENT",Om="PIPE",Am="PLUS",Nm="POUND",_m="QUERY",Lm="QUOTE",Dm="SEMI",Rm="SLASH",Im="TILDE",Pm="UNDERSCORE",Hm="EMOJI",Vm="SYM";var Bm=Object.freeze({__proto__:null,WORD:zf,UWORD:Ff,LOCALHOST:$f,TLD:Uf,UTLD:Wf,SCHEME:qf,SLASH_SCHEME:Jf,NUM:Kf,WS:Zf,NL:Gf,OPENBRACE:Xf,CLOSEBRACE:Yf,OPENBRACKET:Qf,CLOSEBRACKET:tm,OPENPAREN:em,CLOSEPAREN:nm,OPENANGLEBRACKET:om,CLOSEANGLEBRACKET:rm,FULLWIDTHLEFTPAREN:im,FULLWIDTHRIGHTPAREN:sm,LEFTCORNERBRACKET:lm,RIGHTCORNERBRACKET:am,LEFTWHITECORNERBRACKET:cm,RIGHTWHITECORNERBRACKET:dm,FULLWIDTHLESSTHAN:hm,FULLWIDTHGREATERTHAN:um,AMPERSAND:pm,APOSTROPHE:fm,ASTERISK:mm,AT:gm,BACKSLASH:ym,BACKTICK:bm,CARET:wm,COLON:vm,COMMA:km,DOLLAR:xm,DOT:Cm,EQUALS:Sm,EXCLAMATION:Mm,HYPHEN:Em,PERCENT:Tm,PIPE:Om,PLUS:Am,POUND:Nm,QUERY:_m,QUOTE:Lm,SEMI:Dm,SLASH:Rm,TILDE:Im,UNDERSCORE:Pm,EMOJI:Hm,SYM:Vm});const jm=/[a-z]/,zm=/\p{L}/u,Fm=/\p{Emoji}/u,$m=/\d/,Um=/\s/,Wm="\n",qm="",Jm="";let Km=null,Zm=null;function Gm(t,e,n,o,r){let i;const s=e.length;for(let l=0;l<s-1;l++){const n=e[l];t.j[n]?i=t.j[n]:(i=new Pf(o),i.jr=r.slice(),t.j[n]=i),t=i}return i=new Pf(n),i.jr=r.slice(),t.j[e[s-1]]=i,i}function Xm(t){const e=[],n=[];let o=0;for(;o<t.length;){let r=0;for(;"0123456789".indexOf(t[o+r])>=0;)r++;if(r>0){e.push(n.join(""));for(let e=parseInt(t.substring(o,o+r),10);e>0;e--)n.pop();o+=r}else n.push(t[o]),o++}return e}const Ym={defaultProtocol:"http",events:null,format:tg,formatHref:tg,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Qm(t,e){void 0===e&&(e=null);let n=Cf({},Ym);t&&(n=Cf(n,t instanceof Qm?t.o:t));const o=n.ignoreTags,r=[];for(let i=0;i<o.length;i++)r.push(o[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=r}function tg(t){return t}function eg(t,e){this.t="token",this.v=t,this.tk=e}function ng(t,e){class n extends eg{constructor(e,n){super(e,n),this.t=t}}for(const o in e)n.prototype[o]=e[o];return n.t=t,n}Qm.prototype={o:Ym,ignoreTags:[],defaultRender:t=>t,check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const o=null!=e;let r=this.o[t];return r?("object"==typeof r?(r=n.t in r?r[n.t]:Ym[t],"function"==typeof r&&o&&(r=r(e,n))):"function"==typeof r&&o&&(r=r(e,n.t,n)),r):r},getObj(t,e,n){let o=this.o[t];return"function"==typeof o&&null!=e&&(o=o(e,n.t,n)),o},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}},eg.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),o=t.get("format",e,this);return n&&o.length>n?o.substring(0,n)+"":o},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t){return void 0===t&&(t=Ym.defaultProtocol),{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),o=t.get("formatHref",n,this),r=t.get("tagName",n,e),i=this.toFormattedString(t),s={},l=t.get("className",n,e),a=t.get("target",n,e),c=t.get("rel",n,e),d=t.getObj("attributes",n,e),h=t.getObj("events",n,e);return s.href=o,l&&(s.class=l),a&&(s.target=a),c&&(s.rel=c),d&&Cf(s,d),{tagName:r,attributes:s,content:i,eventListeners:h}}};const og=ng("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),rg=ng("text"),ig=ng("nl"),sg=ng("url",{isLink:!0,toHref(t){return void 0===t&&(t=Ym.defaultProtocol),this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==$f&&t[1].t===vm}}),lg=t=>new Pf(t);function ag(t,e,n){const o=n[0].s,r=n[n.length-1].e;return new t(e.slice(o,r),n)}const cg="undefined"!=typeof console&&console&&console.warn||(()=>{}),dg={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function hg(t,e){if(void 0===e&&(e=!1),dg.initialized&&cg(`linkifyjs: already initialized - will not register custom scheme "${t}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');dg.customSchemes.push([t,e])}function ug(){dg.scanner=function(t){void 0===t&&(t=[]);const e={};Pf.groups=e;const n=new Pf;null==Km&&(Km=Xm(kf)),null==Zm&&(Zm=Xm(xf)),jf(n,"'",fm),jf(n,"{",Xf),jf(n,"}",Yf),jf(n,"[",Qf),jf(n,"]",tm),jf(n,"(",em),jf(n,")",nm),jf(n,"<",om),jf(n,">",rm),jf(n,"",im),jf(n,"",sm),jf(n,"",lm),jf(n,"",am),jf(n,"",cm),jf(n,"",dm),jf(n,"",hm),jf(n,"",um),jf(n,"&",pm),jf(n,"*",mm),jf(n,"@",gm),jf(n,"`",bm),jf(n,"^",wm),jf(n,":",vm),jf(n,",",km),jf(n,"$",xm),jf(n,".",Cm),jf(n,"=",Sm),jf(n,"!",Mm),jf(n,"-",Em),jf(n,"%",Tm),jf(n,"|",Om),jf(n,"+",Am),jf(n,"#",Nm),jf(n,"?",_m),jf(n,'"',Lm),jf(n,"/",Rm),jf(n,";",Dm),jf(n,"~",Im),jf(n,"_",Pm),jf(n,"\\",ym);const o=Vf(n,$m,Kf,{[Sf]:!0});Vf(o,$m,o);const r=Vf(n,jm,zf,{[Mf]:!0});Vf(r,jm,r);const i=Vf(n,zm,Ff,{[Ef]:!0});Vf(i,jm),Vf(i,zm,i);const s=Vf(n,Um,Zf,{[Df]:!0});jf(n,Wm,Gf,{[Df]:!0}),jf(s,Wm),Vf(s,Um,s);const l=Vf(n,Fm,Hm,{[Nf]:!0});Vf(l,Fm,l),jf(l,qm,l);const a=jf(l,Jm);Vf(a,Fm,l);const c=[[jm,r]],d=[[jm,null],[zm,i]];for(let h=0;h<Km.length;h++)Gm(n,Km[h],Uf,zf,c);for(let h=0;h<Zm.length;h++)Gm(n,Zm[h],Wf,Ff,d);If(Uf,{tld:!0,ascii:!0},e),If(Wf,{utld:!0,alpha:!0},e),Gm(n,"file",qf,zf,c),Gm(n,"mailto",qf,zf,c),Gm(n,"http",Jf,zf,c),Gm(n,"https",Jf,zf,c),Gm(n,"ftp",Jf,zf,c),Gm(n,"ftps",Jf,zf,c),If(qf,{scheme:!0,ascii:!0},e),If(Jf,{slashscheme:!0,ascii:!0},e),t=t.sort(((t,e)=>t[0]>e[0]?1:-1));for(let h=0;h<t.length;h++){const e=t[h][0],o=t[h][1]?{[_f]:!0}:{[Lf]:!0};e.indexOf("-")>=0?o[Af]=!0:jm.test(e)?$m.test(e)?o[Tf]=!0:o[Mf]=!0:o[Sf]=!0,Bf(n,e,e,o)}return Bf(n,"localhost",$f,{ascii:!0}),n.jd=new Pf(Vm),{start:n,tokens:Cf({groups:e},Bm)}}(dg.customSchemes);for(let t=0;t<dg.tokenQueue.length;t++)dg.tokenQueue[t][1]({scanner:dg.scanner});dg.parser=function(t){let{groups:e}=t;const n=e.domain.concat([pm,mm,gm,ym,bm,wm,xm,Sm,Em,Kf,Tm,Om,Am,Nm,Rm,Vm,Im,Pm]),o=[fm,vm,km,Cm,Mm,_m,Lm,Dm,om,rm,Xf,Yf,tm,Qf,em,nm,im,sm,lm,am,cm,dm,hm,um],r=[pm,fm,mm,ym,bm,wm,xm,Sm,Em,Xf,Yf,Tm,Om,Am,Nm,_m,Rm,Vm,Im,Pm],i=lg(),s=jf(i,Im);Hf(s,r,s),Hf(s,e.domain,s);const l=lg(),a=lg(),c=lg();Hf(i,e.domain,l),Hf(i,e.scheme,a),Hf(i,e.slashscheme,c),Hf(l,r,s),Hf(l,e.domain,l);const d=jf(l,gm);jf(s,gm,d),jf(a,gm,d),jf(c,gm,d);const h=jf(s,Cm);Hf(h,r,s),Hf(h,e.domain,s);const u=lg();Hf(d,e.domain,u),Hf(u,e.domain,u);const p=jf(u,Cm);Hf(p,e.domain,u);const f=lg(og);Hf(p,e.tld,f),Hf(p,e.utld,f),jf(d,$f,f);const m=jf(u,Em);Hf(m,e.domain,u),Hf(f,e.domain,u),jf(f,Cm,p),jf(f,Em,m);const g=jf(f,vm);Hf(g,e.numeric,og);const y=jf(l,Em),b=jf(l,Cm);Hf(y,e.domain,l),Hf(b,r,s),Hf(b,e.domain,l);const w=lg(sg);Hf(b,e.tld,w),Hf(b,e.utld,w),Hf(w,e.domain,l),Hf(w,r,s),jf(w,Cm,b),jf(w,Em,y),jf(w,gm,d);const v=jf(w,vm),k=lg(sg);Hf(v,e.numeric,k);const x=lg(sg),C=lg();Hf(x,n,x),Hf(x,o,C),Hf(C,n,x),Hf(C,o,C),jf(w,Rm,x),jf(k,Rm,x);const S=jf(a,vm),M=jf(c,vm),E=jf(M,Rm),T=jf(E,Rm);Hf(a,e.domain,l),jf(a,Cm,b),jf(a,Em,y),Hf(c,e.domain,l),jf(c,Cm,b),jf(c,Em,y),Hf(S,e.domain,x),jf(S,Rm,x),Hf(T,e.domain,x),Hf(T,n,x),jf(T,Rm,x);const O=[[Xf,Yf],[Qf,tm],[em,nm],[om,rm],[im,sm],[lm,am],[cm,dm],[hm,um]];for(let A=0;A<O.length;A++){const[t,e]=O[A],r=jf(x,t);jf(C,t,r),jf(r,e,x);const i=lg(sg);Hf(r,n,i);const s=lg();Hf(r,o),Hf(i,n,i),Hf(i,o,s),Hf(s,n,i),Hf(s,o,s),jf(i,e,x),jf(s,e,x)}return jf(i,$f,w),jf(i,Gf,ig),{start:i,tokens:Bm}}(dg.scanner.tokens);for(let t=0;t<dg.pluginQueue.length;t++)dg.pluginQueue[t][1]({scanner:dg.scanner,parser:dg.parser});dg.initialized=!0}function pg(t){return dg.initialized||ug(),function(t,e,n){let o=n.length,r=0,i=[],s=[];for(;r<o;){let l=t,a=null,c=null,d=0,h=null,u=-1;for(;r<o&&!(a=l.go(n[r].t));)s.push(n[r++]);for(;r<o&&(c=a||l.go(n[r].t));)a=null,l=c,l.accepts()?(u=0,h=l):u>=0&&u++,r++,d++;if(u<0)r-=d,r<o&&(s.push(n[r]),r++);else{s.length>0&&(i.push(ag(rg,e,s)),s=[]),r-=u,d-=u;const t=h.t,o=n.slice(r-d,r);i.push(ag(t,e,o))}}return s.length>0&&i.push(ag(rg,e,s)),i}(dg.parser.start,t,function(t,e){const n=function(t){const e=[],n=t.length;let o=0;for(;o<n;){let r,i=t.charCodeAt(o),s=i<55296||i>56319||o+1===n||(r=t.charCodeAt(o+1))<56320||r>57343?t[o]:t.slice(o,o+2);e.push(s),o+=s.length}return e}(e.replace(/[A-Z]/g,(t=>t.toLowerCase()))),o=n.length,r=[];let i=0,s=0;for(;s<o;){let l=t,a=null,c=0,d=null,h=-1,u=-1;for(;s<o&&(a=l.go(n[s]));)l=a,l.accepts()?(h=0,u=0,d=l):h>=0&&(h+=n[s].length,u++),c+=n[s].length,i+=n[s].length,s++;i-=h,s-=u,c-=h,r.push({t:d.t,v:e.slice(i-c,i),s:i-c,e:i})}return r}(dg.scanner.start,t))}function fg(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),e&&"object"==typeof e){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const o=new Qm(n),r=pg(t),i=[];for(let s=0;s<r.length;s++){const t=r[s];!t.isLink||e&&t.t!==e||!o.check(t)||i.push(t.toFormattedObject(o))}return i}const mg=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function gg(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach((t=>{const e="string"==typeof t?t:t.scheme;e&&n.push(e)})),!t||t.replace(mg,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z+.-]+(?:[^a-z+.-:]|$))`,"i"))}const yg=Hs.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.protocols.forEach((t=>{"string"!=typeof t?hg(t.scheme,t.optionalSlashes):hg(t)}))},onDestroy(){Pf.groups={},dg.scanner=null,dg.parser=null,dg.tokenQueue=[],dg.pluginQueue=[],dg.customSchemes=[],dg.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:t=>!!t}),addAttributes(){return{href:{default:null,parseHTML:t=>t.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!(!e||!gg(e,this.options.protocols))&&null}}]},renderHTML({HTMLAttributes:t}){return gg(t.href,this.options.protocols)?["a",vi(this.options.HTMLAttributes,t),0]:["a",vi(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[js({find:t=>{const e=[];if(t){const{validate:n}=this.options,o=fg(t).filter((t=>t.isLink&&n(t.value)));o.length&&o.forEach((t=>e.push({text:t.value,data:{href:t.href},index:t.start})))}return e},type:this.type,getAttributes:t=>{var e;return{href:null===(e=t.data)||void 0===e?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(function(t){return new Ce({key:new Ee("autolink"),appendTransaction:(e,n,o)=>{const r=e.some((t=>t.docChanged))&&!n.doc.eq(o.doc),i=e.some((t=>t.getMeta("preventAutolink")));if(!r||i)return;const{tr:s}=o;return ys(hs(n.doc,[...e])).forEach((({newRange:e})=>{const n=ps(o.doc,e,(t=>t.isTextblock));let r,i;if(n.length>1?(r=n[0],i=o.doc.textBetween(r.pos,r.pos+r.node.nodeSize,void 0," ")):n.length&&o.doc.textBetween(e.from,e.to," "," ").endsWith(" ")&&(r=n[0],i=o.doc.textBetween(r.pos,e.to,void 0," ")),r&&i){const e=i.split(" ").filter((t=>""!==t));if(e.length<=0)return!1;const n=e[e.length-1],a=r.pos+i.lastIndexOf(n);if(!n)return!1;const c=pg(n).map((e=>e.toObject(t.defaultProtocol)));if(!(1===(l=c).length?l[0].isLink:3===l.length&&l[1].isLink&&["()","[]"].includes(l[0].value+l[2].value)))return!1;c.filter((t=>t.isLink)).map((t=>({...t,from:a+t.start+1,to:a+t.end+1}))).filter((t=>!o.schema.marks.code||!o.doc.rangeHasMark(t.from,t.to,o.schema.marks.code))).filter((e=>t.validate(e.value))).forEach((e=>{bs(e.from,e.to,o.doc).some((e=>e.mark.type===t.type))||s.addMark(e.from,e.to,t.type.create({href:e.href}))}))}var l})),s.steps.length?s:void 0}})}({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:this.options.validate})),!0===this.options.openOnClick&&t.push(function(t){return new Ce({key:new Ee("handleClickLink"),props:{handleClick:(e,n,o)=>{var r,i;if(0!==o.button)return!1;if(!e.editable)return!1;let s=o.target;const l=[];for(;"DIV"!==s.nodeName;)l.push(s),s=s.parentNode;if(!l.find((t=>"A"===t.nodeName)))return!1;const a=ms(e.state,t.type.name),c=o.target,d=null!==(r=null==c?void 0:c.href)&&void 0!==r?r:a.href,h=null!==(i=null==c?void 0:c.target)&&void 0!==i?i:a.target;return!(!c||!d||(window.open(d,h),0))}}})}({type:this.type})),this.options.linkOnPaste&&t.push(function(t){return new Ce({key:new Ee("handlePasteLink"),props:{handlePaste:(e,n,o)=>{const{state:r}=e,{selection:i}=r,{empty:s}=i;if(s)return!1;let l="";o.content.forEach((t=>{l+=t.textContent}));const a=fg(l,{defaultProtocol:t.defaultProtocol}).find((t=>t.isLink&&t.value===l));return!(!l||!a||(t.editor.commands.setMark(t.type,{href:a.href}),0))}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),bg=Vs.create({name:"text",group:"inline"});var wg=Object.defineProperty,vg=(t,e,n)=>((t,e,n)=>e in t?wg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);const kg={slash_menu:{heading:{title:"Heading 1",subtext:"Top-level heading",aliases:["h","heading1","h1"],group:"Headings"},heading_2:{title:"Heading 2",subtext:"Key section heading",aliases:["h2","heading2","subheading"],group:"Headings"},heading_3:{title:"Heading 3",subtext:"Subsection and group heading",aliases:["h3","heading3","subheading"],group:"Headings"},numbered_list:{title:"Numbered List",subtext:"List with ordered items",aliases:["ol","li","list","numberedlist","numbered list"],group:"Basic blocks"},bullet_list:{title:"Bullet List",subtext:"List with unordered items",aliases:["ul","li","list","bulletlist","bullet list"],group:"Basic blocks"},check_list:{title:"Check List",subtext:"List with checkboxes",aliases:["ul","li","list","checklist","check list","checked list","checkbox"],group:"Basic blocks"},paragraph:{title:"Paragraph",subtext:"The body of your document",aliases:["p","paragraph"],group:"Basic blocks"},table:{title:"Table",subtext:"Table with editable cells",aliases:["table"],group:"Advanced"},image:{title:"Image",subtext:"Resizable image with caption",aliases:["image","imageUpload","upload","img","picture","media","url"],group:"Media"},video:{title:"Video",subtext:"Resizable video with caption",aliases:["video","videoUpload","upload","mp4","film","media","url"],group:"Media"},audio:{title:"Audio",subtext:"Embedded audio with caption",aliases:["audio","audioUpload","upload","mp3","sound","media","url"],group:"Media"},file:{title:"File",subtext:"Embedded file",aliases:["file","upload","embed","media","url"],group:"Media"},emoji:{title:"Emoji",subtext:"Search for and insert an emoji",aliases:["emoji","emote","emotion","face"],group:"Others"}},placeholders:{default:"Enter text or type '/' for commands",heading:"Heading",bulletListItem:"List",numberedListItem:"List",checkListItem:"List"},file_blocks:{image:{add_button_text:"Add image"},video:{add_button_text:"Add video"},audio:{add_button_text:"Add audio"},file:{add_button_text:"Add file"}},side_menu:{add_block_label:"Add block",drag_handle_label:"Open block menu"},drag_handle:{delete_menuitem:"Delete",colors_menuitem:"Colors"},table_handle:{delete_column_menuitem:"Delete column",delete_row_menuitem:"Delete row",add_left_menuitem:"Add column left",add_right_menuitem:"Add column right",add_above_menuitem:"Add row above",add_below_menuitem:"Add row below"},suggestion_menu:{no_items_title:"No items found",loading:"Loading"},color_picker:{text_title:"Text",background_title:"Background",colors:{default:"Default",gray:"Gray",brown:"Brown",red:"Red",orange:"Orange",yellow:"Yellow",green:"Green",blue:"Blue",purple:"Purple",pink:"Pink"}},formatting_toolbar:{bold:{tooltip:"Bold",secondary_tooltip:"Mod+B"},italic:{tooltip:"Italic",secondary_tooltip:"Mod+I"},underline:{tooltip:"Underline",secondary_tooltip:"Mod+U"},strike:{tooltip:"Strike",secondary_tooltip:"Mod+Shift+S"},code:{tooltip:"Code",secondary_tooltip:""},colors:{tooltip:"Colors"},link:{tooltip:"Create link",secondary_tooltip:"Mod+K"},file_caption:{tooltip:"Edit caption",input_placeholder:"Edit caption"},file_replace:{tooltip:{image:"Replace image",video:"Replace video",audio:"Replace audio",file:"Replace file"}},file_rename:{tooltip:{image:"Rename image",video:"Rename video",audio:"Rename audio",file:"Rename file"},input_placeholder:{image:"Rename image",video:"Rename video",audio:"Rename audio",file:"Rename file"}},file_download:{tooltip:{image:"Download image",video:"Download video",audio:"Download audio",file:"Download file"}},file_delete:{tooltip:{image:"Delete image",video:"Delete video",audio:"Delete audio",file:"Delete file"}},file_preview_toggle:{tooltip:"Toggle preview"},nest:{tooltip:"Nest block",secondary_tooltip:"Tab"},unnest:{tooltip:"Unnest block",secondary_tooltip:"Shift+Tab"},align_left:{tooltip:"Align text left"},align_center:{tooltip:"Align text center"},align_right:{tooltip:"Align text right"},align_justify:{tooltip:"Justify text"}},file_panel:{upload:{title:"Upload",file_placeholder:{image:"Upload image",video:"Upload video",audio:"Upload audio",file:"Upload file"},upload_error:"Error: Upload failed"},embed:{title:"Embed",embed_button:{image:"Embed image",video:"Embed video",audio:"Embed audio",file:"Embed file"},url_placeholder:"Enter URL"}},link_toolbar:{delete:{tooltip:"Remove link"},edit:{text:"Edit link",tooltip:"Edit"},open:{tooltip:"Open in new tab"},form:{title_placeholder:"Edit title",url_placeholder:"Edit URL"}},generic:{ctrl_shortcut:"Ctrl"}};let xg;async function Cg(){if(xg)return xg;const e=await Promise.all([t((()=>import("./index-a34129cf.js")),["./index-a34129cf.js","./index-52537ad8.js","./index-cd3bd7b5.css","./index-4f38d191.js","./index-f2e8a3df.js"],import.meta.url),t((()=>import("./index-53745949.js")),["./index-53745949.js","./index-4f38d191.js","./index-93c92338.js","./index-ef6a7e57.js","./index-9747001a.js"],import.meta.url),t((()=>import("./index-ff72a641.js")),["./index-ff72a641.js","./index-52537ad8.js","./index-cd3bd7b5.css","./index-12a6a146.js","./index-f5cec5c0.js"],import.meta.url),t((()=>import("./index-7fef2900.js")),["./index-7fef2900.js","./index-f2e8a3df.js","./index-4f38d191.js"],import.meta.url),t((()=>import("./index-e9276d88.js")),["./index-e9276d88.js","./index-9747001a.js","./index-308ab40d.js","./index-12a6a146.js","./index-52537ad8.js","./index-cd3bd7b5.css","./index-c7af2da5.js","./index-1fe765b2.js","./index-5adc07c7.js"],import.meta.url),t((()=>import("./index-572e3a7a.js")),["./index-572e3a7a.js","./index-140d22db.js","./index-a58c8af0.js","./index-ef6a7e57.js","./index-308ab40d.js","./list-item-20847868.js","./index-2791e9ec.js"],import.meta.url),t((()=>import("./index-3e1b7c8f.js")),["./index-3e1b7c8f.js","./index-93c92338.js","./list-item-20847868.js","./index-2791e9ec.js","./index-1fe765b2.js","./index-308ab40d.js","./index-5adc07c7.js","./index-c7af2da5.js"],import.meta.url),t((()=>import("./index-b5604367.js")),["./index-b5604367.js","./index-140d22db.js","./index-a58c8af0.js","./index-2791e9ec.js","./index-f5cec5c0.js","./index-5adc07c7.js"],import.meta.url),t((()=>import("./index-bee434d0.js")),["./index-bee434d0.js","./index-a58c8af0.js","./index-1fe765b2.js","./index-308ab40d.js"],import.meta.url),t((()=>import("./index-df4878f2.js")),[],import.meta.url)]);return xg={rehypeParse:e[0],rehypeStringify:e[1],unified:e[2],hastUtilFromDom:e[3],rehypeRemark:e[4],remarkGfm:e[5],remarkStringify:e[6],remarkParse:e[7],remarkRehype:e[8],rehypeFormat:e[9]},xg}function Sg(t){return function(t,e=JSON.stringify){const n={};return t.filter((t=>{const o=e(t);return!Object.prototype.hasOwnProperty.call(n,o)&&(n[o]=!0)}))}(t.filter(((e,n)=>t.indexOf(e)!==n)))}const Mg=zi.create({name:"uniqueID",priority:1e4,addOptions:()=>({attributeName:"id",types:[],generateID:()=>{if(typeof window<"u"&&window.__TEST_OPTIONS){const t=window.__TEST_OPTIONS;return void 0===t.mockID?t.mockID=0:t.mockID++,t.mockID.toString()}return Ks()},filterTransaction:null}),addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>({[`data-${this.options.attributeName}`]:t[this.options.attributeName]})}}}]},addProseMirrorPlugins(){let t=null,e=!1;return[new Ce({key:new Ee("uniqueID"),appendTransaction:(t,e,n)=>{const o=t.some((t=>t.docChanged))&&!e.doc.eq(n.doc),r=this.options.filterTransaction&&t.some((t=>{let e,n;return!(null!==(n=(e=this.options).filterTransaction)&&void 0!==n&&n.call(e,t))}));if(!o||r)return;const{tr:i}=n,{types:s,attributeName:l,generateID:a}=this.options,c=hs(e.doc,t),{mapping:d}=c;return ys(c).forEach((({newRange:t})=>{const o=ps(n.doc,t,(t=>s.includes(t.type.name))),r=Sg(o.map((({node:t})=>t.attrs[l])).filter((t=>null!==t)));o.forEach((({node:t,pos:o})=>{let s;const c=null===(s=i.doc.nodeAt(o))||void 0===s?void 0:s.attrs[l];if(null===c){const r=e.doc.type.createAndFill().content;if(null===e.doc.content.findDiffStart(r)){const e=JSON.parse(JSON.stringify(n.doc.toJSON()));if(e.content[0].content[0].attrs.id="initialBlockId",JSON.stringify(e.content)===JSON.stringify(r.toJSON()))return void i.setNodeMarkup(o,void 0,{...t.attrs,[l]:"initialBlockId"})}return void i.setNodeMarkup(o,void 0,{...t.attrs,[l]:a()})}const{deleted:h}=d.invert().mapResult(o);h&&r.includes(c)&&i.setNodeMarkup(o,void 0,{...t.attrs,[l]:a()})}))})),i.steps.length?i:void 0},view(e){const n=n=>{let o;t=null!==(o=e.dom.parentElement)&&void 0!==o&&o.contains(n.target)?e.dom.parentElement:null};return window.addEventListener("dragstart",n),{destroy(){window.removeEventListener("dragstart",n)}}},props:{handleDOMEvents:{drop:(n,o)=>{let r;return(t!==n.dom.parentElement||"copy"===(null===(r=o.dataTransfer)||void 0===r?void 0:r.effectAllowed))&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:t=>{if(!e)return t;const{types:n,attributeName:o}=this.options,r=t=>{const e=[];return t.forEach((t=>{if(t.isText)return void e.push(t);if(!n.includes(t.type.name))return void e.push(t.copy(r(t.content)));const i=t.type.create({...t.attrs,[o]:null},r(t.content),t.marks);e.push(i)})),c.from(e)};return e=!1,new m(r(t.content),t.openStart,t.openEnd)}}})]}});function Eg(t){const e=t.attrs.id,n=t.firstChild;return{id:e,node:t,contentNode:n,contentType:n.type,numChildBlocks:2===t.childCount?t.lastChild.childCount:0}}function Tg(t,e){const n=t.nodeSize-2;if(e<=1)for(e=2;"blockContainer"!==t.resolve(e).parent.type.name&&e<n;)e++;else if(e>=n)for(e=n-1;"blockContainer"!==t.resolve(e).parent.type.name&&e>1;)e--;"blockGroup"===t.resolve(e).parent.type.name&&e++;const o=t.resolve(e),r=o.depth;let i=o.node(r),s=r;for(;;){if(s<0)throw new Error("Could not find blockContainer node. This can only happen if the underlying BlockNote schema has been edited.");if("blockContainer"===i.type.name)break;s-=1,i=o.node(s)}const{id:l,contentNode:a,contentType:c,numChildBlocks:d}=Eg(i);return{id:l,node:i,contentNode:a,contentType:c,numChildBlocks:d,startPos:o.start(s),endPos:o.end(s),depth:s}}function Og(t){return"link"===t.type}function Ag(t){return"string"!=typeof t&&"link"===t.type}function Ng(t){return"string"!=typeof t&&"text"===t.type}class _g extends Error{constructor(t){super(`Unreachable case: ${t}`)}}function Lg(t,e=!0){const{"data-test":n,...o}=t;if(Object.keys(o).length>0&&e)throw new Error("Object must be empty "+JSON.stringify(t))}function Dg(t,e,n){const o=[];for(const[r,i]of Object.entries(t.styles)){const t=n[r];if(!t)throw new Error(`style ${r} not found in styleSchema`);if("boolean"===t.propSchema)o.push(e.mark(r));else{if("string"!==t.propSchema)throw new _g(t.propSchema);o.push(e.mark(r,{stringValue:i}))}}return t.text.split(/(\n)/g).filter((t=>t.length>0)).map((t=>"\n"===t?e.nodes.hardBreak.create():e.text(t,o)))}function Rg(t,e,n){const o=e.marks.link.create({href:t.href});return Ig(t.content,e,n).map((t=>{if("text"===t.type.name)return t.mark([...t.marks,o]);if("hardBreak"===t.type.name)return t;throw new Error("unexpected node type")}))}function Ig(t,e,n){const o=[];if("string"==typeof t)return o.push(...Dg({type:"text",text:t,styles:{}},e,n)),o;for(const r of t)o.push(...Dg(r,e,n));return o}function Pg(t,e,n){const o=[];for(const r of t)"string"==typeof r?o.push(...Ig(r,e,n)):Ag(r)?o.push(...Rg(r,e,n)):Ng(r)?o.push(...Ig([r],e,n)):o.push(Vg(r,e,n));return o}function Hg(t,e,n){const o=[];for(const r of t.rows){const t=[];for(const o of r.cells){let r;if(o)if("string"==typeof o)r=e.nodes.tableParagraph.create({},e.text(o));else{const t=Pg(o,e,n);r=e.nodes.tableParagraph.create({},t)}else r=e.nodes.tableParagraph.create({});const i=e.nodes.tableCell.create({},r);t.push(i)}const i=e.nodes.tableRow.create({},t);o.push(i)}return o}function Vg(t,e,n){let o,r=t.type;if(void 0===r&&(r="paragraph"),!e.nodes[r])throw new Error(`node type ${r} not found in schema`);if(t.content)if("string"==typeof t.content){const i=Pg([t.content],e,n);o=e.nodes[r].create(t.props,i)}else if(Array.isArray(t.content)){const i=Pg(t.content,e,n);o=e.nodes[r].create(t.props,i)}else{if("tableContent"!==t.content.type)throw new _g(t.content.type);{const i=Hg(t.content,e,n);o=e.nodes[r].create(t.props,i)}}else o=e.nodes[r].create(t.props);return o}function Bg(t,e,n){let o=t.id;void 0===o&&(o=Mg.options.generateID());const r=Vg(t,e,n),i=[];if(t.children)for(const l of t.children)i.push(Bg(l,e,n));const s=e.nodes.blockGroup.create({},i);return e.nodes.blockContainer.create({id:o,...t.props},i.length>0?[r,s]:r)}function jg(t,e,n){const o=[];let r;return t.content.forEach((t=>{if("hardBreak"===t.type.name){if(r)if(Ng(r))r.text+="\n";else{if(!Og(r))throw new Error("unexpected");r.content[r.content.length-1].text+="\n"}else r={type:"text",text:"\n",styles:{}};return}if("link"!==t.type.name&&"text"!==t.type.name&&e[t.type.name])return r&&(o.push(r),r=void 0),void o.push(zg(t,e,n));const i={};let s;for(const e of t.marks)if("link"===e.type.name)s=e;else{const t=n[e.type.name];if(!t)throw new Error(`style ${e.type.name} not found in styleSchema`);if("boolean"===t.propSchema)i[t.type]=!0;else{if("string"!==t.propSchema)throw new _g(t.propSchema);i[t.type]=e.attrs.stringValue}}r?Ng(r)?s?(o.push(r),r={type:"link",href:s.attrs.href,content:[{type:"text",text:t.textContent,styles:i}]}):JSON.stringify(r.styles)===JSON.stringify(i)?r.text+=t.textContent:(o.push(r),r={type:"text",text:t.textContent,styles:i}):Og(r)&&(s?r.href===s.attrs.href?JSON.stringify(r.content[r.content.length-1].styles)===JSON.stringify(i)?r.content[r.content.length-1].text+=t.textContent:r.content.push({type:"text",text:t.textContent,styles:i}):(o.push(r),r={type:"link",href:s.attrs.href,content:[{type:"text",text:t.textContent,styles:i}]}):(o.push(r),r={type:"text",text:t.textContent,styles:i})):r=s?{type:"link",href:s.attrs.href,content:[{type:"text",text:t.textContent,styles:i}]}:{type:"text",text:t.textContent,styles:i}})),r&&o.push(r),o}function zg(t,e,n){if("text"===t.type.name||"link"===t.type.name)throw new Error("unexpected");const o={},r=e[t.type.name];for(const[s,l]of Object.entries(t.attrs)){if(!r)throw Error("ic node is of an unrecognized type: "+t.type.name);s in r.propSchema&&(o[s]=l)}let i;return i="styled"===r.content?jg(t,e,n):void 0,{type:t.type.name,props:o,content:i}}function Fg(t,e,n,o,r){if("blockContainer"!==t.type.name)throw Error("Node must be of type blockContainer, but is of type"+t.type.name+".");const i=null==r?void 0:r.get(t);if(i)return i;const s=Eg(t);let l=s.id;null===l&&(l=Mg.options.generateID());const a={};for(const[p,f]of Object.entries({...t.attrs,...s.contentNode.attrs})){const t=e[s.contentType.name];if(!t)throw Error("Block is of an unrecognized type: "+s.contentType.name);p in t.propSchema&&(a[p]=f)}const c=e[s.contentType.name],d=[];for(let p=0;p<s.numChildBlocks;p++)d.push(Fg(t.lastChild.child(p),e,n,o,r));let h;if("inline"===c.content)h=jg(s.contentNode,n,o);else if("table"===c.content)h=function(t,e,n){const o={type:"tableContent",rows:[]};return t.content.forEach((t=>{const r={cells:[]};t.content.forEach((t=>{r.cells.push(jg(t.firstChild,e,n))})),o.rows.push(r)})),o}(s.contentNode,n,o);else{if("none"!==c.content)throw new _g(c.content);h=void 0}const u={id:l,type:c.type,props:a,content:h,children:d};return null==r||r.set(t,u),u}const $g=(t,e,n,o,r)=>{if(!n.nodes[t.type.name])throw new Error("Serializer is missing a node type: "+t.type.name);const{dom:i,contentDOM:s}=dt.renderSpec(function(t){return t.document||window.document}(e),n.nodes[t.type.name](t));if(s){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");if("blockContainer"===t.type.name){const i=t.childCount>0&&"blockContent"===t.firstChild.type.spec.group?t.firstChild:void 0,l=t.childCount>0&&"blockGroup"===t.lastChild.type.spec.group?t.lastChild:void 0;if(void 0!==i){const l=o.blockImplementations[i.type.name].implementation,a=(r?l.toExternalHTML:l.toInternalHTML)(Fg(t,o.schema.blockSchema,o.schema.inlineContentSchema,o.schema.styleSchema,o.blockCache),o);if(void 0!==a.contentDOM){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");a.contentDOM.appendChild(n.serializeFragment(i.content,e))}s.appendChild(a.dom)}void 0!==l&&n.serializeFragment(c.from(l),e,s)}else n.serializeFragment(t.content,e,s)}return i},Ug=(t,e,n)=>{const o=e.serializeFragment(t,n),r=document.createElement("div");return r.appendChild(o),r.innerHTML};function Wg(t){const e=xg;if(!e)throw new Error("simplifyBlocks requires ESM dependencies to be initialized");const n=new Set([...t.orderedListItemBlockTypes,...t.unorderedListItemBlockTypes]),o=r=>{var i;if(1===r.children.length&&"blockGroup"===(null==(i=r.children[0].properties)?void 0:i.dataNodeType)){const t=r.children[0];r.children.pop(),r.children.push(...t.children)}let s,l=r.children.length;for(let a=0;a<l;a++){const i=r.children[a].children[0],c=i.children.find((t=>{const e=t.properties,n=null==e?void 0:e.className;return null==n?void 0:n.includes("bn-block-content")})),d=i.children.find((t=>{const e=t.properties,n=null==e?void 0:e.className;return null==n?void 0:n.includes("bn-block-group")}));if(!c)return r.children.splice(a,1,...d.children),void o(r);const h=n.has(c.properties.dataContentType),u=h?t.orderedListItemBlockTypes.has(c.properties.dataContentType)?"ol":"ul":null;if(d&&o(d),s&&s.tagName!==u){r.children.splice(a-s.children.length,s.children.length,s);const t=s.children.length-1;a-=t,l-=t,s=void 0}if(h){s||(s=e.hastUtilFromDom.fromDom(document.createElement(u)));const t=e.hastUtilFromDom.fromDom(document.createElement("li"));t.children.push(...c.children),d&&t.children.push(...d.children),s.children.push(t)}else if(d){r.children.splice(a+1,0,...d.children),r.children[a]=c.children[0];const t=d.children.length;a+=t,l+=t}else r.children[a]=c.children[0]}s&&r.children.splice(l-s.children.length,s.children.length,s)};return o}const qg=(t,e)=>{const n=xg;if(!n)throw new Error("External HTML exporter requires ESM dependencies to be initialized");const o=dt.fromSchema(t);return o.serializeNodeInner=(t,n)=>$g(t,n,o,e,!0),o.exportProseMirrorFragment=(t,e)=>n.unified.unified().use(n.rehypeParse.default,{fragment:!0}).use(Wg,{orderedListItemBlockTypes:new Set(["numberedListItem"]),unorderedListItemBlockTypes:new Set(["bulletListItem","checkListItem"])}).use(n.rehypeStringify.default).processSync(Ug(t,o,e)).value,o.exportBlocks=(n,r)=>{const i=n.map((n=>Bg(n,t,e.schema.styleSchema))),s=t.nodes.blockGroup.create(null,i);return o.exportProseMirrorFragment(c.from(s),r)},o},Jg=(t,e)=>{const n=dt.fromSchema(t);return n.serializeNodeInner=(t,o)=>$g(t,o,n,e,!1),n.serializeProseMirrorFragment=(t,e)=>Ug(t,n,e),n.serializeBlocks=(o,r)=>{const i=o.map((n=>Bg(n,t,e.schema.styleSchema))),s=t.nodes.blockGroup.create(null,i);return n.serializeProseMirrorFragment(c.from(s),r)},n},Kg=t=>{const{contentType:e}=Tg(t.state.doc,t.state.selection.from);return e.spec.content},Zg=()=>typeof navigator<"u"&&(/Mac/.test(navigator.platform)||/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent));function Gg(t,e="Ctrl"){return Zg()?t.replace("Mod",""):t.replace("Mod",e)}function Xg(...t){return t.filter((t=>t)).join(" ")}const Yg=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function Qg(t,e,n,o){const r=document.createElement("div");r.className=Xg("bn-block-content",n.class),r.setAttribute("data-content-type",t);for(const[s,l]of Object.entries(n))"class"!==s&&r.setAttribute(s,l);const i=document.createElement(e);i.className=Xg("bn-inline-content",o.class);for(const[s,l]of Object.entries(o))"class"!==s&&i.setAttribute(s,l);return r.appendChild(i),{dom:r,contentDOM:i}}const ty=(t,e)=>{const n=Bg(t,e.pmSchema,e.schema.styleSchema).firstChild,o=e.pmSchema.nodes[n.type.name].spec.toDOM;if(void 0===o)throw new Error("This block has no default HTML serialization as its corresponding TipTap node doesn't implement `renderHTML`.");const r=o(n);if("object"!=typeof r||!("dom"in r))throw new Error("Cannot use this block's default HTML serialization as its corresponding TipTap node's `renderHTML` function does not return an object with the `dom` property.");return r},ey={backgroundColor:{default:"default"},textColor:{default:"default"},textAlignment:{default:"left",values:["left","center","right","justify"]}},ny=["backgroundColor","textColor"];function oy(t){return"data-"+t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ry(t){const e=t.split("/");return e.length&&""!==e[e.length-1]?e[e.length-1]:t}function iy(t){const e={};return Object.entries(t).filter((([t,e])=>!ny.includes(t))).forEach((([t,n])=>{e[t]={default:n.default,keepOnSplit:!0,parseHTML:e=>{const o=e.getAttribute(oy(t));if(null===o)return null;if("boolean"==typeof n.default)return"true"===o||"false"!==o&&null;if("number"==typeof n.default){const t=parseFloat(o);return!Number.isNaN(t)&&Number.isFinite(t)?t:null}return o},renderHTML:e=>e[t]!==n.default?{[oy(t)]:e[t]}:{}}})),e}function sy(t,e,n,o){if("boolean"==typeof t)throw new Error("Cannot find node position as getPos is a boolean, not a function.");const r=t(),i=n.state.doc.resolve(r).node().attrs.id;if(!i)throw new Error("Block doesn't have id");const s=e.getBlock(i);if(s.type!==o)throw new Error("Block type does not match");return s}function ly(t,e,n,o,r=!1,i){const s=document.createElement("div");if(void 0!==i)for(const[l,a]of Object.entries(i))"class"!==l&&s.setAttribute(l,a);s.className=Xg("bn-block-content",(null==i?void 0:i.class)||""),s.setAttribute("data-content-type",e);for(const[l,a]of Object.entries(n))!ny.includes(l)&&a!==o[l].default&&s.setAttribute(oy(l),a);return r&&s.setAttribute("data-file-block",""),s.appendChild(t.dom),void 0!==t.contentDOM&&(t.contentDOM.className=Xg("bn-inline-content",t.contentDOM.className),t.contentDOM.setAttribute("data-editable","")),{...t,dom:s}}function ay(t){return Vs.create(t)}function cy(t,e){return{config:t,implementation:e}}function dy(t,e,n){return cy({type:t.name,content:"inline*"===t.config.content?"inline":"tableRow+"===t.config.content?"table":"none",propSchema:e},{node:t,requiredExtensions:n,toInternalHTML:ty,toExternalHTML:ty})}function hy(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,e.config])))}function uy(t,e){const n=[{tag:"[data-content-type="+t.type+"]",contentElement:"[data-editable]"}];return e&&n.push({tag:"*",getAttrs(t){if("string"==typeof t)return!1;const n=null==e?void 0:e(t);return void 0!==n&&n}}),n}function py(t,e){const n=ay({name:t.type,content:"inline"===t.content?"inline*":"",group:"blockContent",selectable:!0,addAttributes:()=>iy(t.propSchema),parseHTML:()=>uy(t,e.parse),renderHTML(){const t=document.createElement("div");return t.setAttribute("data-tmp-placeholder","true"),{dom:t}},addNodeView(){return({getPos:n})=>{var o;const r=this.options.editor,i=sy(n,r,this.editor,t.type),s=(null==(o=this.options.domAttributes)?void 0:o.blockContent)||{};return ly(e.render(i,r),i.type,i.props,t.propSchema,s)}}});if(n.name!==t.type)throw new Error("Node name does not match block type. This is a bug in BlockNote.");return cy(t,{node:n,toInternalHTML:(o,r)=>{var i;const s=(null==(i=n.options.domAttributes)?void 0:i.blockContent)||{};return ly(e.render(o,r),o.type,o.props,t.propSchema,t.isFileBlock,s)},toExternalHTML:(o,r)=>{var i,s;const l=(null==(i=n.options.domAttributes)?void 0:i.blockContent)||{};let a=null==(s=e.toExternalHTML)?void 0:s.call(e,o,r);return void 0===a&&(a=e.render(o,r)),ly(a,o.type,o.props,t.propSchema,l)}})}function fy(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,e.config])))}function my(t,e){return function(t,e){return{config:t,implementation:e}}({type:t.name,propSchema:e},{mark:t})}function gy(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>[t,e.config])))}const yy=t=>{const e=document.createElement("div");e.className="bn-file-default-preview";const n=document.createElement("div");n.className="bn-file-default-preview-icon",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"></path></svg>';const o=document.createElement("p");return o.className="bn-file-default-preview-name",o.textContent=t.props.name||"",e.appendChild(n),e.appendChild(o),{dom:e}},by=(t,e)=>{const n=document.createElement("div");n.className="bn-file-and-caption-wrapper";const o=document.createElement("p");return o.className="bn-file-caption",o.textContent=t.props.caption,n.appendChild(e),n.appendChild(o),{dom:n}},wy=(t,e,n,o)=>{const r=document.createElement("div");r.className="bn-add-file-button";const i=document.createElement("div");i.className="bn-add-file-button-icon",o?i.appendChild(o):i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"></path></svg>';const s=document.createElement("p");s.className="bn-add-file-button-text",s.innerHTML=n||e.dictionary.file_blocks.file.add_button_text;const l=t=>{t.preventDefault()},a=()=>{e.dispatch(e._tiptapEditor.state.tr.setMeta(e.filePanel.plugin,{block:t}))};return r.appendChild(i),r.appendChild(s),r.addEventListener("mousedown",l,!0),r.addEventListener("click",a,!0),{dom:r,destroy:()=>{r.removeEventListener("mousedown",l,!0),r.removeEventListener("click",a,!0)}}},vy=t=>({url:t.src||void 0}),ky=(t,e)=>{const n=t.querySelector(e);if(!n)return;const o=t.querySelector("figcaption");return{targetElement:n,caption:(null==o?void 0:o.textContent)??void 0}},xy=(t,e)=>{const n=document.createElement("div"),o=document.createElement("p");return o.textContent=e,n.appendChild(t),n.appendChild(o),{dom:n}},Cy=(t,e)=>{const n=document.createElement("figure"),o=document.createElement("figcaption");return o.textContent=e,n.appendChild(t),n.appendChild(o),{dom:n}},Sy=(t,e,n,o,r)=>{if(!t.props.previewWidth)throw new Error("Block must have a `previewWidth` prop.");const i=document.createElement("div");i.className="bn-visual-media-wrapper";const s=document.createElement("div");s.className="bn-visual-media-resize-handle",s.style.left="4px";const l=document.createElement("div");let a;l.className="bn-visual-media-resize-handle",l.style.right="4px";const c=n=>{if(!a)return void(!e.isEditable&&i.contains(s)&&i.contains(l)&&(i.removeChild(s),i.removeChild(l)));let o;o="center"===t.props.textAlignment?"left"===a.handleUsed?a.initialWidth+2*(a.initialClientX-n.clientX):a.initialWidth+2*(n.clientX-a.initialClientX):"left"===a.handleUsed?a.initialWidth+a.initialClientX-n.clientX:a.initialWidth+n.clientX-a.initialClientX;o<64?r(64):o>e.domElement.firstElementChild.clientWidth?r(e.domElement.firstElementChild.clientWidth):r(o)},d=n=>{(!n.target||!i.contains(n.target)||!e.isEditable)&&i.contains(s)&&i.contains(l)&&(i.removeChild(s),i.removeChild(l)),a&&(a=void 0,e.updateBlock(t,{props:{previewWidth:o()}}))},h=()=>{e.isEditable&&(i.appendChild(s),i.appendChild(l))},u=t=>{t.relatedTarget===s||t.relatedTarget===l||a||e.isEditable&&i.contains(s)&&i.contains(l)&&(i.removeChild(s),i.removeChild(l))},p=e=>{e.preventDefault(),i.appendChild(s),i.appendChild(l),a={handleUsed:"left",initialWidth:t.props.previewWidth,initialClientX:e.clientX}},f=e=>{e.preventDefault(),i.appendChild(s),i.appendChild(l),a={handleUsed:"right",initialWidth:t.props.previewWidth,initialClientX:e.clientX}};return i.appendChild(n),window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),n.addEventListener("mouseenter",h),n.addEventListener("mouseleave",u),s.addEventListener("mousedown",p),l.addEventListener("mousedown",f),{dom:i,destroy:()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),n.removeEventListener("mouseenter",h),n.removeEventListener("mouseleave",u),s.removeEventListener("mousedown",p),l.removeEventListener("mousedown",f)}}},My=t=>({url:t.src||void 0}),Ey={type:"audio",propSchema:{backgroundColor:ey.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0}},content:"none",isFileBlock:!0,fileBlockAcceptMimeTypes:["audio/*"]},Ty=t=>{if("AUDIO"===t.tagName)return My(t);if("FIGURE"===t.tagName){const e=ky(t,"audio");if(!e)return;const{targetElement:n,caption:o}=e;return{...My(n),caption:o}}},Oy=py(Ey,{render:(t,e)=>{const n=document.createElement("div");if(n.className="bn-file-block-content-wrapper",""===t.props.url){const o=document.createElement("div");o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"></path></svg>';const r=wy(t,e,e.dictionary.file_blocks.audio.add_button_text,o.firstElementChild);return n.appendChild(r.dom),{dom:n,destroy:()=>{var t;null==(t=null==r?void 0:r.destroy)||t.call(r)}}}if(t.props.showPreview){const o=document.createElement("audio");o.className="bn-audio",e.resolveFileUrl(t.props.url).then((t=>{o.src=t})),o.controls=!0,o.contentEditable="false",o.draggable=!1;const r=by(t,o);return n.appendChild(r.dom),{dom:n}}{const e=yy(t).dom;return{dom:by(t,e).dom}}},parse:Ty,toExternalHTML:t=>{if(!t.props.url){const t=document.createElement("p");return t.textContent="Add audio",{dom:t}}let e;return t.props.showPreview?(e=document.createElement("audio"),e.src=t.props.url):(e=document.createElement("a"),e.href=t.props.url,e.textContent=t.props.name||t.props.url),t.props.caption?t.props.showPreview?Cy(e,t.props.caption):xy(e,t.props.caption):{dom:e}}}),Ay={type:"file",propSchema:{backgroundColor:ey.backgroundColor,name:{default:""},url:{default:""},caption:{default:""}},content:"none",isFileBlock:!0},Ny=t=>{if("EMBED"===t.tagName)return vy(t);if("FIGURE"===t.tagName){const e=ky(t,"embed");if(!e)return;const{targetElement:n,caption:o}=e;return{...vy(n),caption:o}}},_y=py(Ay,{render:(t,e)=>{const n=document.createElement("div");if(n.className="bn-file-block-content-wrapper",""===t.props.url){const o=wy(t,e);return n.appendChild(o.dom),{dom:n,destroy:o.destroy}}{const e=yy(t).dom,o=by(t,e);return n.appendChild(o.dom),{dom:n}}},parse:Ny,toExternalHTML:t=>{if(!t.props.url){const t=document.createElement("p");return t.textContent="Add file",{dom:t}}const e=document.createElement("a");return e.href=t.props.url,e.textContent=t.props.name||t.props.url,t.props.caption?xy(e,t.props.caption):{dom:e}}}),Ly=t=>({url:t.src||void 0,previewWidth:t.width||void 0}),Dy={type:"image",propSchema:{textAlignment:ey.textAlignment,backgroundColor:ey.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0},previewWidth:{default:512}},content:"none",isFileBlock:!0,fileBlockAcceptMimeTypes:["image/*"]},Ry=t=>{if("IMG"===t.tagName)return Ly(t);if("FIGURE"===t.tagName){const e=ky(t,"img");if(!e)return;const{targetElement:n,caption:o}=e;return{...Ly(n),caption:o}}},Iy=py(Dy,{render:(t,e)=>{const n=document.createElement("div");if(n.className="bn-file-block-content-wrapper",""===t.props.url){const o=document.createElement("div");o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"></path></svg>';const r=wy(t,e,e.dictionary.file_blocks.image.add_button_text,o.firstElementChild);return n.appendChild(r.dom),{dom:n,destroy:()=>{var t;null==(t=null==r?void 0:r.destroy)||t.call(r)}}}if(t.props.showPreview){const o=document.createElement("img");o.className="bn-visual-media",e.resolveFileUrl(t.props.url).then((t=>{o.src=t})),o.alt=t.props.name||t.props.caption||"BlockNote image",o.contentEditable="false",o.draggable=!1,o.width=Math.min(t.props.previewWidth,e.domElement.firstElementChild.clientWidth);const r=Sy(t,e,o,(()=>o.width),(t=>o.width=t)),i=by(t,r.dom);return n.appendChild(i.dom),{dom:n,destroy:r.destroy}}{const e=yy(t).dom;return{dom:by(t,e).dom}}},parse:Ry,toExternalHTML:t=>{if(!t.props.url){const t=document.createElement("p");return t.textContent="Add image",{dom:t}}let e;return t.props.showPreview?(e=document.createElement("img"),e.src=t.props.url,e.alt=t.props.name||t.props.caption||"BlockNote image",e.width=t.props.previewWidth):(e=document.createElement("a"),e.href=t.props.url,e.textContent=t.props.name||t.props.url),t.props.caption?t.props.showPreview?Cy(e,t.props.caption):xy(e,t.props.caption):{dom:e}}}),Py=t=>({url:t.src||void 0,previewWidth:t.width||void 0}),Hy={type:"video",propSchema:{textAlignment:ey.textAlignment,backgroundColor:ey.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0},previewWidth:{default:512}},content:"none",isFileBlock:!0,fileBlockAcceptMimeTypes:["video/*"]},Vy=t=>{if("VIDEO"===t.tagName)return Py(t);if("FIGURE"===t.tagName){const e=ky(t,"video");if(!e)return;const{targetElement:n,caption:o}=e;return{...Py(n),caption:o}}},By=py(Hy,{render:(t,e)=>{const n=document.createElement("div");if(n.className="bn-file-block-content-wrapper",""===t.props.url){const o=document.createElement("div");o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM8 5V19H16V5H8ZM4 5V7H6V5H4ZM18 5V7H20V5H18ZM4 9V11H6V9H4ZM18 9V11H20V9H18ZM4 13V15H6V13H4ZM18 13V15H20V13H18ZM4 17V19H6V17H4ZM18 17V19H20V17H18Z"></path></svg>';const r=wy(t,e,e.dictionary.file_blocks.video.add_button_text,o.firstElementChild);return n.appendChild(r.dom),{dom:n,destroy:()=>{var t;null==(t=null==r?void 0:r.destroy)||t.call(r)}}}if(t.props.showPreview){const o=document.createElement("video");o.className="bn-visual-media",o.src=t.props.url,o.controls=!0,o.contentEditable="false",o.draggable=!1,o.width=Math.min(t.props.previewWidth,e.domElement.firstElementChild.clientWidth);const r=Sy(t,e,o,(()=>o.width),(t=>o.width=t)),i=by(t,r.dom);return n.appendChild(i.dom),{dom:n,destroy:r.destroy}}{const e=yy(t).dom;return{dom:by(t,e).dom}}},parse:Vy,toExternalHTML:t=>{if(!t.props.url){const t=document.createElement("p");return t.textContent="Add video",{dom:t}}let e;return t.props.showPreview?(e=document.createElement("video"),e.src=t.props.url,e.width=t.props.previewWidth):(e=document.createElement("a"),e.href=t.props.url,e.textContent=t.props.name||t.props.url),t.props.caption?t.props.showPreview?Cy(e,t.props.caption):xy(e,t.props.caption):{dom:e}}}),jy=my(Hs.create({name:"backgroundColor",addAttributes:()=>({stringValue:{default:void 0,parseHTML:t=>t.getAttribute("data-background-color"),renderHTML:t=>({"data-background-color":t.stringValue})}}),parseHTML:()=>[{tag:"span",getAttrs:t=>"string"!=typeof t&&(!!t.hasAttribute("data-background-color")&&{stringValue:t.getAttribute("data-background-color")})}],renderHTML:({HTMLAttributes:t})=>["span",t,0]}),"string"),zy=my(Hs.create({name:"textColor",addAttributes:()=>({stringValue:{default:void 0,parseHTML:t=>t.getAttribute("data-text-color"),renderHTML:t=>({"data-text-color":t.stringValue})}}),parseHTML:()=>[{tag:"span",getAttrs:t=>"string"!=typeof t&&(!!t.hasAttribute("data-text-color")&&{stringValue:t.getAttribute("data-text-color")})}],renderHTML:({HTMLAttributes:t})=>["span",t,0]}),"string"),Fy={...ey,level:{default:1,values:[1,2,3]}},$y=ay({name:"heading",content:"inline*",group:"blockContent",addAttributes:()=>({level:{default:1,parseHTML:t=>{const e=t.getAttribute("data-level"),n=parseInt(e);if(isFinite(n))return n},renderHTML:t=>({"data-level":t.level.toString()})}}),addInputRules(){return[...[1,2,3].map((t=>new _i({find:new RegExp(`^(#{${t}})\\s$`),handler:({state:e,chain:n,range:o})=>{"inline*"===Kg(this.editor)&&n().BNUpdateBlock(e.selection.from,{type:"heading",props:{level:t}}).deleteRange({from:o.from,to:o.to})}})))]},addKeyboardShortcuts(){return{"Mod-Alt-1":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"heading",props:{level:1}}),"Mod-Alt-2":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"heading",props:{level:2}}),"Mod-Alt-3":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"heading",props:{level:3}})}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",getAttrs:t=>"string"!=typeof t&&{level:t.getAttribute("data-level")}},{tag:"h1",attrs:{level:1},node:"heading"},{tag:"h2",attrs:{level:2},node:"heading"},{tag:"h3",attrs:{level:3},node:"heading"}]},renderHTML({node:t,HTMLAttributes:e}){var n,o;return Qg(this.name,`h${t.attrs.level}`,{...(null==(n=this.options.domAttributes)?void 0:n.blockContent)||{},...e},(null==(o=this.options.domAttributes)?void 0:o.inlineContent)||{})}}),Uy=dy($y,Fy),Wy=t=>{const{contentNode:e,contentType:n}=Tg(t.state.doc,t.state.selection.from),o=t.state.selection.anchor===t.state.selection.head;return!("bulletListItem"!==n.name&&"numberedListItem"!==n.name&&"checkListItem"!==n.name||!o)&&t.commands.first((({state:t,chain:n,commands:o})=>[()=>o.command((()=>0===e.childCount&&o.BNUpdateBlock(t.selection.from,{type:"paragraph",props:{}}))),()=>o.command((()=>e.childCount>0&&(n().deleteSelection().BNSplitBlock(t.selection.from,!0).run(),!0)))]))},qy={...ey},Jy=ay({name:"bulletListItem",content:"inline*",group:"blockContent",priority:90,addInputRules(){return[new _i({find:new RegExp("^[-+*]\\s$"),handler:({state:t,chain:e,range:n})=>{"inline*"===Kg(this.editor)&&e().BNUpdateBlock(t.selection.from,{type:"bulletListItem",props:{}}).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>Wy(this.editor),"Mod-Shift-8":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"bulletListItem",props:{}})}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]"},{tag:"li",getAttrs:t=>{if("string"==typeof t)return!1;const e=t.parentElement;return null!==e&&(("UL"===e.tagName||"DIV"===e.tagName&&"UL"===e.parentElement.tagName)&&{})},node:"bulletListItem"},{tag:"p",getAttrs:t=>{if("string"==typeof t)return!1;const e=t.parentElement;return null!==e&&("bulletListItem"===e.getAttribute("data-content-type")&&{})},priority:300,node:"bulletListItem"}]},renderHTML({HTMLAttributes:t}){var e,n;return Qg(this.name,"p",{...(null==(e=this.options.domAttributes)?void 0:e.blockContent)||{},...t},(null==(n=this.options.domAttributes)?void 0:n.inlineContent)||{})}}),Ky=dy(Jy,qy),Zy=new Ee("numbered-list-indexing"),Gy={...ey},Xy=ay({name:"numberedListItem",content:"inline*",group:"blockContent",priority:90,addAttributes:()=>({index:{default:null,parseHTML:t=>t.getAttribute("data-index"),renderHTML:t=>({"data-index":t.index})}}),addInputRules(){return[new _i({find:new RegExp("^1\\.\\s$"),handler:({state:t,chain:e,range:n})=>{"inline*"===Kg(this.editor)&&e().BNUpdateBlock(t.selection.from,{type:"numberedListItem",props:{}}).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>Wy(this.editor),"Mod-Shift-7":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"numberedListItem",props:{}})}},addProseMirrorPlugins:()=>[new Ce({key:Zy,appendTransaction:(t,e,n)=>{const o=n.tr;o.setMeta("numberedListIndexing",!0);let r=!1;return n.doc.descendants(((t,e)=>{if("blockContainer"===t.type.name&&"numberedListItem"===t.firstChild.type.name){let t="1";const n=1===e,i=Tg(o.doc,e+1);if(void 0===i)return;if(!n){const n=Tg(o.doc,e-2);if(void 0===n)return;if(i.depth===n.depth){const e=n.contentNode;if("numberedListItem"===n.contentType.name){const n=e.attrs.index;t=(parseInt(n)+1).toString()}}}i.contentNode.attrs.index!==t&&(r=!0,o.setNodeMarkup(e+1,void 0,{index:t}))}})),r?o:null}})],parseHTML(){return[{tag:"div[data-content-type="+this.name+"]"},{tag:"li",getAttrs:t=>{if("string"==typeof t)return!1;const e=t.parentElement;return null!==e&&(("OL"===e.tagName||"DIV"===e.tagName&&"OL"===e.parentElement.tagName)&&{})},node:"numberedListItem"},{tag:"p",getAttrs:t=>{if("string"==typeof t)return!1;const e=t.parentElement;return null!==e&&("numberedListItem"===e.getAttribute("data-content-type")&&{})},priority:300,node:"numberedListItem"}]},renderHTML({HTMLAttributes:t}){var e,n;return Qg(this.name,"p",{...(null==(e=this.options.domAttributes)?void 0:e.blockContent)||{},...t},(null==(n=this.options.domAttributes)?void 0:n.inlineContent)||{})}}),Yy=dy(Xy,Gy),Qy={...ey,checked:{default:!1}},tb=ay({name:"checkListItem",content:"inline*",group:"blockContent",addAttributes:()=>({checked:{default:!1,parseHTML:t=>"true"===t.getAttribute("data-checked")||void 0,renderHTML:t=>t.checked?{"data-checked":t.checked.toString()}:{}}}),addInputRules(){return[new _i({find:new RegExp("\\[\\s*\\]\\s$"),handler:({state:t,chain:e,range:n})=>{"inline*"===Kg(this.editor)&&e().BNUpdateBlock(t.selection.from,{type:"checkListItem",props:{checked:!1}}).deleteRange({from:n.from,to:n.to})}}),new _i({find:new RegExp("\\[[Xx]\\]\\s$"),handler:({state:t,chain:e,range:n})=>{"inline*"===Kg(this.editor)&&e().BNUpdateBlock(t.selection.from,{type:"checkListItem",props:{checked:!0}}).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>Wy(this.editor),"Mod-Shift-9":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"checkListItem",props:{}})}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]"},{tag:"input",getAttrs:t=>"string"!=typeof t&&("checkbox"===t.type&&{checked:t.checked}),node:"checkListItem"},{tag:"li",getAttrs:t=>{if("string"==typeof t)return!1;const e=t.parentElement;if(null===e)return!1;if("UL"===e.tagName||"DIV"===e.tagName&&"UL"===e.parentElement.tagName){const e=t.querySelector("input[type=checkbox]")||null;return null!==e&&{checked:e.checked}}return!1},node:"checkListItem"}]},renderHTML({node:t,HTMLAttributes:e}){var n,o;const r=document.createElement("input");r.type="checkbox",r.checked=t.attrs.checked,t.attrs.checked&&r.setAttribute("checked","");const{dom:i,contentDOM:s}=Qg(this.name,"p",{...(null==(n=this.options.domAttributes)?void 0:n.blockContent)||{},...e},(null==(o=this.options.domAttributes)?void 0:o.inlineContent)||{});return i.insertBefore(r,s),{dom:i,contentDOM:s}},addNodeView(){return({node:t,getPos:e,editor:n,HTMLAttributes:o})=>{var r,i;const s=document.createElement("div"),l=document.createElement("div");l.contentEditable="false";const a=document.createElement("input");a.type="checkbox",a.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","");const c=()=>{n.isEditable?"boolean"!=typeof e&&this.editor.commands.BNUpdateBlock(e(),{type:"checkListItem",props:{checked:a.checked}}):a.checked=!a.checked};a.addEventListener("change",c);const{dom:d,contentDOM:h}=Qg(this.name,"p",{...(null==(r=this.options.domAttributes)?void 0:r.blockContent)||{},...o},(null==(i=this.options.domAttributes)?void 0:i.inlineContent)||{});if("boolean"!=typeof e){const t="label-"+this.editor.state.doc.resolve(e()).node().attrs.id;a.setAttribute("aria-labelledby",t),h.id=t}return d.removeChild(h),d.appendChild(s),s.appendChild(l),s.appendChild(h),l.appendChild(a),{dom:d,contentDOM:h,destroy:()=>{a.removeEventListener("change",c)}}}}}),eb=dy(tb,Qy),nb={...ey},ob=ay({name:"paragraph",content:"inline*",group:"blockContent",addKeyboardShortcuts(){return{"Mod-Alt-0":()=>"inline*"!==Kg(this.editor)||this.editor.commands.BNUpdateBlock(this.editor.state.selection.anchor,{type:"paragraph",props:{}})}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]"},{tag:"p",priority:200,getAttrs:t=>{var e;return!("string"==typeof t||null==(e=t.textContent)||!e.trim())&&{}},node:"paragraph"}]},renderHTML({HTMLAttributes:t}){var e,n;return Qg(this.name,"p",{...(null==(e=this.options.domAttributes)?void 0:e.blockContent)||{},...t},(null==(n=this.options.domAttributes)?void 0:n.inlineContent)||{})}}),rb=dy(ob,nb),ib=zi.create({name:"BlockNoteTableExtension",addProseMirrorPlugins:()=>[na({cellMinWidth:100}),aa()],addKeyboardShortcuts(){return{Enter:()=>!(!this.editor.state.selection.empty||"tableParagraph"!==this.editor.state.selection.$head.parent.type.name)&&(this.editor.commands.setHardBreak(),!0),Backspace:()=>{const t=this.editor.state.selection,e=t.empty,n=0===t.$head.parentOffset,o="tableParagraph"===t.$head.node().type.name;return e&&n&&o}}},extendNodeSchema:t=>({tableRole:Ci(gi(t,"tableRole",{name:t.name,options:t.options,storage:t.storage}))})}),sb={...ey},lb=ay({name:"table",content:"tableRow+",group:"blockContent",tableRole:"table",isolating:!0,parseHTML:()=>[{tag:"table"}],renderHTML({HTMLAttributes:t}){var e,n;return Qg(this.name,"table",{...(null==(e=this.options.domAttributes)?void 0:e.blockContent)||{},...t},(null==(n=this.options.domAttributes)?void 0:n.inlineContent)||{})}}),ab={paragraph:rb,heading:Uy,bulletListItem:Ky,numberedListItem:Yy,checkListItem:eb,table:dy(lb,sb,[ib,Vs.create({name:"tableParagraph",group:"tableContent",content:"inline*",parseHTML:()=>[{tag:"td"},{tag:"p",getAttrs:t=>{if("string"==typeof t||!t.textContent)return!1;const e=t.parentElement;return null!==e&&("TD"===e.tagName&&{})}}],renderHTML({HTMLAttributes:t}){return["p",vi(this.options.HTMLAttributes,t),0]}}),pl.extend({content:"tableContent"}),ul.extend({content:"tableContent"}),fl]),file:_y,image:Iy,video:By,audio:Oy},cb=hy(ab),db={bold:my(Qs,"boolean"),italic:my(ll,"boolean"),underline:my(hl,"boolean"),strike:my(dl,"boolean"),code:my(nl,"boolean"),textColor:zy,backgroundColor:jy};gy(db);const hb={text:{config:"text",implementation:{}},link:{config:"link",implementation:{}}},ub=fy(hb);function pb(t,e){return t in e.schema.blockSchema&&e.schema.blockSchema[t]===cb[t]}function fb(t,e){return t.type in e.schema.blockSchema&&e.schema.blockSchema[t.type].isFileBlock||!1}function mb(t,e){return e.schema.blockSchema[t.type].isFileBlock&&!t.props.url}function gb(t,e,n){return e in n.schema.blockSchema&&t in n.schema.blockSchema[e].propSchema&&n.schema.blockSchema[e].propSchema[t]===ey[t]}function yb(t,e,n){return gb(t,e.type,n)}function bb(t,e){let n,o;if(e.firstChild.descendants(((e,r)=>!n&&("blockContainer"!==e.type.name||e.attrs.id!==t||(n=e,o=r+1,!1)))),void 0===n||void 0===o)throw Error("Could not find block in the editor with matching ID.");return{node:n,posBeforeNode:o}}function wb(t,e,n){const o=e._tiptapEditor,r=o.state.tr,i=new Set(t.map((t=>"string"==typeof t?t:t.id))),s=[];let l=0;if(o.state.doc.descendants(((t,o)=>{if(0===i.size)return!1;if("blockContainer"!==t.type.name||!i.has(t.attrs.id))return!0;s.push(Fg(t,e.schema.blockSchema,e.schema.inlineContentSchema,e.schema.styleSchema,e.blockCache)),i.delete(t.attrs.id),l=(null==n?void 0:n(t,o,r,l))||l;const a=r.doc.nodeSize;r.delete(o-l-1,o-l+t.nodeSize+1);const c=r.doc.nodeSize;return l+=a-c,!1})),i.size>0){const t=[...i].join("\n");throw Error("Blocks with the following IDs could not be found in the editor: "+t)}return e.dispatch(r),s}function vb(){const t=e=>{let n=e.children.length;for(let o=0;o<n;o++){const r=e.children[o];if("element"===r.type&&(t(r),"u"===r.tagName))if(r.children.length>0){e.children.splice(o,1,...r.children);const t=r.children.length-1;n+=t,o+=t}else e.children.splice(o,1),n--,o--}};return t}function kb(){const t=xg;if(!t)throw new Error("simplifyBlocks requires ESM dependencies to be initialized");const e=n=>{var o;if(n.children&&"length"in n.children&&n.children.length)for(let r=n.children.length-1;r>=0;r--){const i=n.children[r],s=r+1<n.children.length?n.children[r+1]:void 0;"element"===i.type&&"input"===i.tagName&&"checkbox"===(null==(o=i.properties)?void 0:o.type)&&"element"===(null==s?void 0:s.type)&&"p"===s.tagName?(s.tagName="span",s.children.splice(0,0,t.hastUtilFromDom.fromDom(document.createTextNode(" ")))):e(i)}};return e}function xb(t){const e=xg;if(!e)throw new Error("cleanHTMLToMarkdown requires ESM dependencies to be initialized");return e.unified.unified().use(e.rehypeParse.default,{fragment:!0}).use(vb).use(kb).use(e.rehypeRemark.default).use(e.remarkGfm.default).use(e.remarkStringify.default,{handlers:{text:t=>t.value}}).processSync(t).value}function Cb(t){t.querySelectorAll("li > ul, li > ol").forEach((t=>{const e=function(t){return Array.prototype.indexOf.call(t.parentElement.childNodes,t)}(t),n=t.parentElement,o=Array.from(n.childNodes).slice(e+1);t.remove(),o.forEach((t=>{t.remove()})),n.insertAdjacentElement("afterend",t),o.reverse().forEach((e=>{if(function(t){return 3===t.nodeType&&!/\S/.test(t.nodeValue||"")}(e))return;const n=document.createElement("li");n.append(e),t.insertAdjacentElement("afterend",n)})),0===n.childNodes.length&&n.remove()}))}let Sb=null;function Mb(t){if("string"==typeof t){const e=(Sb||(Sb=document.implementation.createHTMLDocument("title"))).createElement("div");e.innerHTML=t,t=e}return Cb(t),function(t){t.querySelectorAll("li + ul, li + ol").forEach((t=>{var e,n;const o=t.previousElementSibling,r=document.createElement("div");o.insertAdjacentElement("afterend",r),r.append(o);const i=document.createElement("div");for(i.setAttribute("data-node-type","blockGroup"),r.append(i);"UL"===(null==(e=r.nextElementSibling)?void 0:e.nodeName)||"OL"===(null==(n=r.nextElementSibling)?void 0:n.nodeName);)i.append(r.nextElementSibling)}))}(t),t}async function Eb(t,e,n,o,r){const i=Mb(t),s=tt.fromSchema(r).parse(i,{topNode:r.nodes.blockGroup.create()}),l=[];for(let a=0;a<s.childCount;a++)l.push(Fg(s.child(a),e,n,o));return l}function Tb(t,e){const n=e.value?e.value+"\n":"",o={};e.lang&&(o["data-language"]=e.lang);let r={type:"element",tagName:"code",properties:o,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}class Ob{constructor(){vg(this,"callbacks",{})}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),()=>this.off(t,e)}emit(t,...e){const n=this.callbacks[t];n&&n.forEach((t=>t.apply(this,e)))}off(t,e){const n=this.callbacks[t];n&&(e?this.callbacks[t]=n.filter((t=>t!==e)):delete this.callbacks[t])}removeAllListeners(){this.callbacks={}}}let Ab=class{constructor(t,e,n,o){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"mouseDownHandler",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),vg(this,"dragstartHandler",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),vg(this,"scrollHandler",(()=>{var t;if(null!=(t=this.state)&&t.show){const t=this.pmView.root.querySelector(`[data-node-type="blockContainer"][data-id="${this.state.block.id}"]`);this.state.referencePos=t.getBoundingClientRect(),this.emitUpdate()}})),vg(this,"closeMenu",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),this.editor=t,this.pluginKey=e,this.pmView=n,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized file panel");o(this.state)},n.dom.addEventListener("mousedown",this.mouseDownHandler),n.dom.addEventListener("dragstart",this.dragstartHandler),n.root.addEventListener("scroll",this.scrollHandler,!0)}update(t,e){var n,o;const r=this.pluginKey.getState(t.state);if((null==(n=this.state)||!n.show)&&r.block&&this.editor.isEditable){const t=this.pmView.root.querySelector(`[data-node-type="blockContainer"][data-id="${r.block.id}"]`);return this.state={show:!0,referencePos:t.getBoundingClientRect(),block:r.block},void this.emitUpdate()}(!t.state.selection.eq(e.selection)||!t.state.doc.eq(e.doc)||!this.editor.isEditable)&&null!=(o=this.state)&&o.show&&(this.state.show=!1,this.emitUpdate())}destroy(){this.pmView.dom.removeEventListener("mousedown",this.mouseDownHandler),this.pmView.dom.removeEventListener("dragstart",this.dragstartHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0)}};const Nb=new Ee("FilePanelPlugin");let _b=class extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"closeMenu",(()=>this.view.closeMenu())),this.plugin=new Ce({key:Nb,view:e=>(this.view=new Ab(t,Nb,e,(t=>{this.emit("update",t)})),this.view),props:{handleKeyDown:(t,e)=>!("Escape"!==e.key||!this.shown)&&(this.view.closeMenu(),!0)},state:{init:()=>({block:void 0}),apply:t=>{var e;return{block:null==(e=t.getMeta(Nb))?void 0:e.block}}}})}get shown(){var t,e;return(null==(e=null==(t=this.view)?void 0:t.state)?void 0:e.show)||!1}onUpdate(t){return this.on("update",t)}},Lb=class{constructor(t,e,n){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"preventHide",!1),vg(this,"preventShow",!1),vg(this,"shouldShow",(({state:t,from:e,to:n,view:o})=>{const{doc:r,selection:i}=t,{empty:s}=i,l=!r.textBetween(e,n).length&&Gi(t.selection);return!(!o.hasFocus()||s||l)})),vg(this,"blurHandler",(t=>{var e;if(this.preventHide)return void(this.preventHide=!1);const n=this.pmView.dom.parentElement;t&&t.relatedTarget&&(n===t.relatedTarget||n.contains(t.relatedTarget)||t.relatedTarget.matches(".bn-ui-container, .bn-ui-container *"))||null!=(e=this.state)&&e.show&&(this.state.show=!1,this.emitUpdate())})),vg(this,"viewMousedownHandler",(()=>{this.preventShow=!0})),vg(this,"viewMouseupHandler",(()=>{this.preventShow=!1,setTimeout((()=>this.update(this.pmView)))})),vg(this,"dragHandler",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),vg(this,"scrollHandler",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.referencePos=this.getSelectionBoundingBox(),this.emitUpdate())})),vg(this,"closeMenu",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),this.editor=t,this.pmView=e,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized formatting toolbar");n(this.state)},e.dom.addEventListener("mousedown",this.viewMousedownHandler),e.dom.addEventListener("mouseup",this.viewMouseupHandler),e.dom.addEventListener("dragstart",this.dragHandler),e.dom.addEventListener("dragover",this.dragHandler),e.dom.addEventListener("blur",this.blurHandler),e.root.addEventListener("scroll",this.scrollHandler,!0)}update(t,e){var n,o;const{state:r,composing:i}=t,{doc:s,selection:l}=r,a=e&&e.doc.eq(s)&&e.selection.eq(l);if(i||a)return;const{ranges:c}=l,d=Math.min(...c.map((t=>t.$from.pos))),h=Math.max(...c.map((t=>t.$to.pos))),u=null==(n=this.shouldShow)?void 0:n.call(this,{view:t,state:r,from:d,to:h});return this.preventShow||!u&&!this.preventHide?null==(o=this.state)||!o.show||this.preventHide||u&&!this.preventShow&&this.editor.isEditable?void 0:(this.state.show=!1,void this.emitUpdate()):(this.state={show:!0,referencePos:this.getSelectionBoundingBox()},void this.emitUpdate())}destroy(){this.pmView.dom.removeEventListener("mousedown",this.viewMousedownHandler),this.pmView.dom.removeEventListener("mouseup",this.viewMouseupHandler),this.pmView.dom.removeEventListener("dragstart",this.dragHandler),this.pmView.dom.removeEventListener("dragover",this.dragHandler),this.pmView.dom.removeEventListener("blur",this.blurHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0)}getSelectionBoundingBox(){const{state:t}=this.pmView,{selection:e}=t,{ranges:n}=e,o=Math.min(...n.map((t=>t.$from.pos))),r=Math.max(...n.map((t=>t.$to.pos)));if(function(t){return t instanceof de}(e)){const t=this.pmView.nodeDOM(o);if(t)return t.getBoundingClientRect()}return Cs(this.pmView,o,r)}};const Db=new Ee("FormattingToolbarPlugin");let Rb=class extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"closeMenu",(()=>this.view.closeMenu())),this.plugin=new Ce({key:Db,view:e=>(this.view=new Lb(t,e,(t=>{this.emit("update",t)})),this.view),props:{handleKeyDown:(t,e)=>!("Escape"!==e.key||!this.shown)&&(this.view.closeMenu(),!0)}})}get shown(){var t,e;return(null==(e=null==(t=this.view)?void 0:t.state)?void 0:e.show)||!1}onUpdate(t){return this.on("update",t)}},Ib=class{constructor(t,e,n){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"menuUpdateTimer"),vg(this,"startMenuUpdateTimer"),vg(this,"stopMenuUpdateTimer"),vg(this,"mouseHoveredLinkMark"),vg(this,"mouseHoveredLinkMarkRange"),vg(this,"keyboardHoveredLinkMark"),vg(this,"keyboardHoveredLinkMarkRange"),vg(this,"linkMark"),vg(this,"linkMarkRange"),vg(this,"mouseOverHandler",(t=>{if(this.mouseHoveredLinkMark=void 0,this.mouseHoveredLinkMarkRange=void 0,this.stopMenuUpdateTimer(),t.target instanceof HTMLAnchorElement&&"A"===t.target.nodeName){const e=t.target,n=this.pmView.posAtDOM(e,0)+1,o=this.pmView.state.doc.resolve(n),r=o.marks();for(const t of r)if(t.type.name===this.pmView.state.schema.mark("link").type.name){this.mouseHoveredLinkMark=t,this.mouseHoveredLinkMarkRange=Ki(o,t.type,t.attrs)||void 0;break}}return this.startMenuUpdateTimer(),!1})),vg(this,"clickHandler",(t=>{var e;const n=this.pmView.dom.parentElement;this.linkMark&&t&&t.target&&n!==t.target&&!n.contains(t.target)&&null!=(e=this.state)&&e.show&&(this.state.show=!1,this.emitUpdate())})),vg(this,"scrollHandler",(()=>{var t;void 0!==this.linkMark&&null!=(t=this.state)&&t.show&&(this.state.referencePos=Cs(this.pmView,this.linkMarkRange.from,this.linkMarkRange.to),this.emitUpdate())})),vg(this,"closeMenu",(()=>{var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())})),this.editor=t,this.pmView=e,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized link toolbar");n(this.state)},this.startMenuUpdateTimer=()=>{this.menuUpdateTimer=setTimeout((()=>{this.update()}),250)},this.stopMenuUpdateTimer=()=>(this.menuUpdateTimer&&(clearTimeout(this.menuUpdateTimer),this.menuUpdateTimer=void 0),!1),this.pmView.dom.addEventListener("mouseover",this.mouseOverHandler),this.pmView.root.addEventListener("click",this.clickHandler,!0),this.pmView.root.addEventListener("scroll",this.scrollHandler,!0)}editLink(t,e){var n;const o=this.pmView.state.tr.insertText(e,this.linkMarkRange.from,this.linkMarkRange.to);o.addMark(this.linkMarkRange.from,this.linkMarkRange.from+e.length,this.pmView.state.schema.mark("link",{href:t})),this.editor.dispatch(o),this.pmView.focus(),null!=(n=this.state)&&n.show&&(this.state.show=!1,this.emitUpdate())}deleteLink(){var t;this.editor.dispatch(this.pmView.state.tr.removeMark(this.linkMarkRange.from,this.linkMarkRange.to,this.linkMark.type).setMeta("preventAutolink",!0)),this.pmView.focus(),null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate())}update(){var t;if(!this.pmView.hasFocus())return;const e=this.linkMark;if(this.linkMark=void 0,this.linkMarkRange=void 0,this.keyboardHoveredLinkMark=void 0,this.keyboardHoveredLinkMarkRange=void 0,this.pmView.state.selection.empty){const t=this.pmView.state.selection.$from.marks();for(const e of t)if(e.type.name===this.pmView.state.schema.mark("link").type.name){this.keyboardHoveredLinkMark=e,this.keyboardHoveredLinkMarkRange=Ki(this.pmView.state.selection.$from,e.type,e.attrs)||void 0;break}}return this.mouseHoveredLinkMark&&(this.linkMark=this.mouseHoveredLinkMark,this.linkMarkRange=this.mouseHoveredLinkMarkRange),this.keyboardHoveredLinkMark&&(this.linkMark=this.keyboardHoveredLinkMark,this.linkMarkRange=this.keyboardHoveredLinkMarkRange),this.linkMark&&this.editor.isEditable?(this.state={show:!0,referencePos:Cs(this.pmView,this.linkMarkRange.from,this.linkMarkRange.to),url:this.linkMark.attrs.href,text:this.pmView.state.doc.textBetween(this.linkMarkRange.from,this.linkMarkRange.to)},void this.emitUpdate()):null==(t=this.state)||!t.show||!e||this.linkMark&&this.editor.isEditable?void 0:(this.state.show=!1,void this.emitUpdate())}destroy(){this.pmView.dom.removeEventListener("mouseover",this.mouseOverHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0),this.pmView.root.removeEventListener("click",this.clickHandler,!0)}};const Pb=new Ee("LinkToolbarPlugin");let Hb,Vb=class extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"editLink",((t,e)=>{this.view.editLink(t,e)})),vg(this,"deleteLink",(()=>{this.view.deleteLink()})),vg(this,"startHideTimer",(()=>{this.view.startMenuUpdateTimer()})),vg(this,"stopHideTimer",(()=>{this.view.stopMenuUpdateTimer()})),vg(this,"closeMenu",(()=>this.view.closeMenu())),this.plugin=new Ce({key:Pb,view:e=>(this.view=new Ib(t,e,(t=>{this.emit("update",t)})),this.view),props:{handleKeyDown:(t,e)=>!("Escape"!==e.key||!this.shown)&&(this.view.closeMenu(),!0)}})}onUpdate(t){return this.on("update",t)}get shown(){var t,e;return(null==(e=null==(t=this.view)?void 0:t.state)?void 0:e.show)||!1}};class Bb extends re{constructor(t,e){super(t,e),vg(this,"nodes");const n=t.node();this.nodes=[],t.doc.nodesBetween(t.pos,e.pos,((t,e,o)=>{if(null!==o&&o.eq(n))return this.nodes.push(t),!1}))}static create(t,e,n=e){return new Bb(t.resolve(e),t.resolve(n))}content(){return new m(c.from(this.nodes),0,0)}eq(t){if(!(t instanceof Bb)||this.nodes.length!==t.nodes.length||this.from!==t.from||this.to!==t.to)return!1;for(let e=0;e<this.nodes.length;e++)if(!this.nodes[e].eq(t.nodes[e]))return!1;return!0}map(t,e){const n=e.mapResult(this.from),o=e.mapResult(this.to);return o.deleted?re.near(t.resolve(n.pos)):n.deleted?re.near(t.resolve(o.pos)):new Bb(t.resolve(n.pos),t.resolve(o.pos))}toJSON(){return{type:"node",anchor:this.anchor,head:this.head}}}function jb(t,e){for(var n,o;t&&t.parentElement&&t.parentElement!==e.dom&&"blockContainer"!==(null==(n=t.getAttribute)?void 0:n.call(t,"data-node-type"));)t=t.parentElement;if("blockContainer"===(null==(o=t.getAttribute)?void 0:o.call(t,"data-node-type")))return{node:t,id:t.getAttribute("data-id")}}function zb(t,e,n=e){e===n&&(n+=t.state.doc.resolve(e+1).node().nodeSize);const o=t.domAtPos(e).node.cloneNode(!0),r=t.domAtPos(e).node,i=(t,e)=>Array.prototype.indexOf.call(t.children,e),s=i(r,t.domAtPos(e+1).node.parentElement),l=i(r,t.domAtPos(n-1).node.parentElement);for(let c=r.childElementCount-1;c>=0;c--)(c>l||c<s)&&o.removeChild(o.children[c]);Fb(t.root),Hb=o;const a=t.dom.className.split(" ").filter((t=>"ProseMirror"!==t&&"bn-root"!==t&&"bn-editor"!==t)).join(" ");Hb.className=Hb.className+" bn-drag-preview "+a,t.root instanceof ShadowRoot?t.root.appendChild(Hb):t.root.body.appendChild(Hb)}function Fb(t){void 0!==Hb&&(t instanceof ShadowRoot?t.removeChild(Hb):t.body.removeChild(Hb),Hb=void 0)}function $b(t,e){if(!t.dataTransfer)return;const n=e.prosemirrorView,o=n.dom.getBoundingClientRect(),r={left:o.left+o.width/2,top:t.clientY},i=n.root.elementsFromPoint(r.left,r.top);let s;for(const a of i)if(n.dom.contains(a)){s=jb(a,n);break}if(!s)return;const l=function(t,e){const n=jb(t,e);if(n&&1===n.node.nodeType){const t=e.docView,o=t.nearestDesc(n.node,!0);return o&&o!==t?o.posBefore:null}return null}(s.node,n);if(null!=l){const o=n.state.selection,r=n.state.doc,{from:i,to:s}=function(t,e){let n,o;const r="blockContent"===e.resolve(t.from).node().type.spec.group,i="blockContent"===e.resolve(t.to).node().type.spec.group,s=Math.min(t.$anchor.depth,t.$head.depth);if(r&&i){const r=t.$from.start(s-1),i=t.$to.end(s-1);n=e.resolve(r-1).pos,o=e.resolve(i+1).pos}else n=t.from,o=t.to;return{from:n,to:o}}(o,r),a=i<=l&&l<s,c=o.$anchor.node()!==o.$head.node()||o instanceof Bb;a&&c?(n.dispatch(n.state.tr.setSelection(Bb.create(r,i,s))),zb(n,i,s)):(n.dispatch(n.state.tr.setSelection(de.create(n.state.doc,l))),zb(n,l));const d=n.state.selection.content(),h=e.pmSchema,u=Jg(h,e).serializeProseMirrorFragment(d.content,{}),p=qg(h,e).exportProseMirrorFragment(d.content,{}),f=xb(p);t.dataTransfer.clearData(),t.dataTransfer.setData("blocknote/html",u),t.dataTransfer.setData("text/html",p),t.dataTransfer.setData("text/plain",f),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(Hb,0,0),n.dragging={slice:d,move:!0}}}let Ub=class{constructor(t,e,n){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"needUpdate",!1),vg(this,"mousePos"),vg(this,"horizontalPosAnchoredAtRoot"),vg(this,"horizontalPosAnchor"),vg(this,"hoveredBlock"),vg(this,"isDragging",!1),vg(this,"menuFrozen",!1),vg(this,"updateState",(()=>{var t,e,n,o;if(this.menuFrozen||!this.mousePos)return;const r=this.pmView.dom.firstChild.getBoundingClientRect();this.horizontalPosAnchor=r.x;const i={left:r.left+r.width/2,top:this.mousePos.y},s=this.pmView.root.elementsFromPoint(i.left,i.top);let l;for(const c of s)if(this.pmView.dom.contains(c)){l=jb(c,this.pmView);break}if(!l||!this.editor.isEditable)return void(null!=(t=this.state)&&t.show&&(this.state.show=!1,this.needUpdate=!0));if(null!=(e=this.state)&&e.show&&null!=(n=this.hoveredBlock)&&n.hasAttribute("data-id")&&(null==(o=this.hoveredBlock)?void 0:o.getAttribute("data-id"))===l.id)return;this.hoveredBlock=l.node;const a=l.node.firstChild;if(a&&this.editor.isEditable){const t=a.getBoundingClientRect();this.state={show:!0,referencePos:new DOMRect(this.horizontalPosAnchoredAtRoot?this.horizontalPosAnchor:t.x,t.y,t.width,t.height),block:this.editor.getBlock(this.hoveredBlock.getAttribute("data-id"))},this.needUpdate=!0}})),vg(this,"onDragStart",(()=>{this.isDragging=!0})),vg(this,"onDrop",(t=>{if(this.editor._tiptapEditor.commands.blur(),t.synthetic||!this.isDragging)return;const e=this.pmView.posAtCoords({left:t.clientX,top:t.clientY});if(this.isDragging=!1,!e||-1===e.inside){const e=new Event("drop",t),n=this.pmView.dom.firstChild.getBoundingClientRect();e.clientX=t.clientX<n.left||t.clientX>n.left+n.width?n.left+n.width/2:t.clientX,e.clientY=Math.min(Math.max(t.clientY,n.top),n.top+n.height),e.dataTransfer=t.dataTransfer,e.preventDefault=()=>t.preventDefault(),e.synthetic=!0,this.pmView.dom.dispatchEvent(e)}})),vg(this,"onDragOver",(t=>{if(t.synthetic||!this.isDragging)return;const e=this.pmView.posAtCoords({left:t.clientX,top:t.clientY});if(!e||-1===e.inside){const e=new Event("dragover",t),n=this.pmView.dom.firstChild.getBoundingClientRect();e.clientX=n.left+n.width/2,e.clientY=t.clientY,e.dataTransfer=t.dataTransfer,e.preventDefault=()=>t.preventDefault(),e.synthetic=!0,this.pmView.dom.dispatchEvent(e)}})),vg(this,"onKeyDown",(t=>{var e;null!=(e=this.state)&&e.show&&this.editor.isFocused()&&(this.state.show=!1,this.emitUpdate(this.state),this.menuFrozen=!1)})),vg(this,"onMouseDown",(()=>{this.state&&this.state.show&&this.menuFrozen&&(this.menuFrozen=!1,this.state.show=!1,this.emitUpdate(this.state))})),vg(this,"onMouseMove",(t=>{var e;if(this.menuFrozen)return;this.mousePos={x:t.clientX,y:t.clientY};const n=this.pmView.dom.getBoundingClientRect(),o=this.mousePos.x>n.left&&this.mousePos.x<n.right&&this.mousePos.y>n.top&&this.mousePos.y<n.bottom,r=this.pmView.dom.parentElement;o&&t&&t.target&&r!==t.target&&!r.contains(t.target)?null!=(e=this.state)&&e.show&&(this.state.show=!1,this.emitUpdate(this.state)):(this.updateState(),this.needUpdate&&(this.emitUpdate(this.state),this.needUpdate=!1))})),vg(this,"onScroll",(()=>{var t;if(null!=(t=this.state)&&t.show){const t=this.hoveredBlock.firstChild.getBoundingClientRect();this.state.referencePos=new DOMRect(this.horizontalPosAnchoredAtRoot?this.horizontalPosAnchor:t.x,t.y,t.width,t.height),this.emitUpdate(this.state)}})),this.editor=t,this.pmView=e,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized side menu");n(this.state)},this.horizontalPosAnchoredAtRoot=!0,this.horizontalPosAnchor=this.pmView.dom.firstChild.getBoundingClientRect().x,this.pmView.root.addEventListener("drop",this.onDrop,!0),this.pmView.root.addEventListener("dragover",this.onDragOver),Cg(),this.pmView.dom.addEventListener("dragstart",this.onDragStart),this.pmView.root.addEventListener("mousemove",this.onMouseMove,!0),this.pmView.dom.addEventListener("mousedown",this.onMouseDown),this.pmView.root.addEventListener("keydown",this.onKeyDown,!0),this.pmView.root.addEventListener("scroll",this.onScroll,!0)}update(){var t;const e=null==(t=this.state)?void 0:t.block.id;this.updateState(),this.needUpdate&&this.state&&e!==this.state.block.id&&(this.emitUpdate(this.state),this.needUpdate=!1)}destroy(){var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate(this.state)),this.pmView.root.removeEventListener("mousemove",this.onMouseMove,!0),this.pmView.root.removeEventListener("dragover",this.onDragOver),this.pmView.dom.removeEventListener("dragstart",this.onDragStart),this.pmView.root.removeEventListener("drop",this.onDrop,!0),this.pmView.root.removeEventListener("scroll",this.onScroll,!0),this.pmView.dom.removeEventListener("mousedown",this.onMouseDown),this.pmView.root.removeEventListener("keydown",this.onKeyDown,!0)}addBlock(){var t;null!=(t=this.state)&&t.show&&(this.state.show=!1,this.emitUpdate(this.state));const e=this.hoveredBlock.firstChild.getBoundingClientRect(),n=this.pmView.posAtCoords({left:e.left+e.width/2,top:e.top+e.height/2});if(!n)return;const o=Tg(this.editor._tiptapEditor.state.doc,n.pos);if(void 0===o)return;const{contentNode:r,startPos:i,endPos:s}=o;if("inline*"!==r.type.spec.content||0!==r.textContent.length){const t=s+1,e=t+2;this.editor._tiptapEditor.chain().BNCreateBlock(t).setTextSelection(e).run()}else this.editor._tiptapEditor.commands.setTextSelection(i+1);this.editor.openSelectionMenu("/")}};const Wb=new Ee("SideMenuPlugin");let qb=class extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"addBlock",(()=>this.view.addBlock())),vg(this,"blockDragStart",(t=>{this.view.isDragging=!0,$b(t,this.editor)})),vg(this,"blockDragEnd",(()=>Fb(this.editor.prosemirrorView.root))),vg(this,"freezeMenu",(()=>this.view.menuFrozen=!0)),vg(this,"unfreezeMenu",(()=>{this.view.menuFrozen=!1,this.view.state.show=!1,this.view.emitUpdate(this.view.state)})),this.editor=t,this.plugin=new Ce({key:Wb,view:e=>(this.view=new Ub(t,e,(t=>{this.emit("update",t)})),this.view)})}onUpdate(t){return this.on("update",t)}};const Jb=fs((t=>"blockContainer"===t.type.name));class Kb{constructor(t,e){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"rootEl"),vg(this,"pluginState"),vg(this,"handleScroll",(()=>{var t,e;if(null!=(t=this.state)&&t.show){const t=null==(e=this.rootEl)?void 0:e.querySelector(`[data-decoration-id="${this.pluginState.decorationId}"]`);this.state.referencePos=t.getBoundingClientRect(),this.emitUpdate(this.pluginState.triggerCharacter)}})),vg(this,"closeMenu",(()=>{this.editor.dispatch(this.editor._tiptapEditor.view.state.tr.setMeta(Zb,null))})),vg(this,"clearQuery",(()=>{void 0!==this.pluginState&&this.editor._tiptapEditor.chain().focus().deleteRange({from:this.pluginState.queryStartPos-(this.pluginState.fromUserInput?this.pluginState.triggerCharacter.length:0),to:this.editor._tiptapEditor.state.selection.from}).run()})),this.editor=t,this.pluginState=void 0,this.emitUpdate=t=>{if(!this.state)throw new Error("Attempting to update uninitialized suggestions menu");e(t,this.state)},this.rootEl=this.editor._tiptapEditor.view.root,this.rootEl.addEventListener("scroll",this.handleScroll,!0)}update(t,e){var n;const o=Zb.getState(e),r=Zb.getState(t.state),i=void 0!==o&&void 0===r;if(!(void 0===o&&void 0!==r||void 0!==o&&void 0!==r||i))return;if(this.pluginState=i?o:r,i||!this.editor.isEditable)return this.state.show=!1,void this.emitUpdate(this.pluginState.triggerCharacter);const s=null==(n=this.rootEl)?void 0:n.querySelector(`[data-decoration-id="${this.pluginState.decorationId}"]`);this.editor.isEditable&&(this.state={show:!0,referencePos:s.getBoundingClientRect(),query:this.pluginState.query},this.emitUpdate(this.pluginState.triggerCharacter))}destroy(){var t;null==(t=this.rootEl)||t.removeEventListener("scroll",this.handleScroll,!0)}}const Zb=new Ee("SuggestionMenuPlugin");class Gb extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"triggerCharacters",[]),vg(this,"addTriggerCharacter",(t=>{this.triggerCharacters.push(t)})),vg(this,"removeTriggerCharacter",(t=>{this.triggerCharacters=this.triggerCharacters.filter((e=>e!==t))})),vg(this,"closeMenu",(()=>this.view.closeMenu())),vg(this,"clearQuery",(()=>this.view.clearQuery()));const e=this.triggerCharacters;this.plugin=new Ce({key:Zb,view:()=>(this.view=new Kb(t,((t,e)=>{this.emit(`update ${t}`,e)})),this.view),state:{init(){},apply(t,e,n,o){if(void 0!==t.getMeta("orderedListIndexing"))return e;const r=t.getMeta(Zb);if("object"==typeof r&&null!==r&&void 0===e)return{triggerCharacter:r.triggerCharacter,fromUserInput:!1!==r.fromUserInput,queryStartPos:o.selection.from,query:"",decorationId:`id_${Math.floor(4294967295*Math.random())}`};if(void 0===e)return e;if(o.selection.from!==o.selection.to||null===r||t.getMeta("focus")||t.getMeta("blur")||t.getMeta("pointer")||void 0!==e.triggerCharacter&&o.selection.from<e.queryStartPos)return;const i={...e};return i.query=o.doc.textBetween(e.queryStartPos,o.selection.from),i}},props:{handleTextInput(t,n,o,r){const i=this.getState(t.state);return!(!e.includes(r)||void 0!==i)&&(t.dispatch(t.state.tr.insertText(r).scrollIntoView().setMeta(Zb,{triggerCharacter:r})),!0)},decorations(t){const e=this.getState(t);if(void 0===e)return null;if(!e.fromUserInput){const n=Jb(t.selection);if(n)return ur.create(t.doc,[cr.node(n.pos,n.pos+n.node.nodeSize,{nodeName:"span",class:"bn-suggestion-decorator","data-decoration-id":e.decorationId})])}return ur.create(t.doc,[cr.inline(e.queryStartPos-e.triggerCharacter.length,e.queryStartPos,{nodeName:"span",class:"bn-suggestion-decorator","data-decoration-id":e.decorationId})])}}})}onUpdate(t,e){return this.triggerCharacters.includes(t)||this.addTriggerCharacter(t),this.on(`update ${t}`,e)}get shown(){var t,e;return(null==(e=null==(t=this.view)?void 0:t.state)?void 0:e.show)||!1}}let Xb;function Yb(t){Xb||(Xb=document.createElement("div"),Xb.innerHTML="_",Xb.style.opacity="0",Xb.style.height="1px",Xb.style.width="1px",t instanceof Document?t.body.appendChild(Xb):t.appendChild(Xb))}function Qb(t){return Array.prototype.indexOf.call(t.parentElement.childNodes,t)}class tw{constructor(t,e,n){vg(this,"state"),vg(this,"emitUpdate"),vg(this,"tableId"),vg(this,"tablePos"),vg(this,"menuFrozen",!1),vg(this,"prevWasEditable",null),vg(this,"mouseMoveHandler",(t=>{var e;if(this.menuFrozen)return;const n=function(t){for(;t&&"TD"!==t.nodeName&&"TH"!==t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(t.target);if(!n||!this.editor.isEditable)return void(null!=(e=this.state)&&e.show&&(this.state.show=!1,this.emitUpdate()));const o=Qb(n),r=Qb(n.parentElement),i=n.getBoundingClientRect(),s=n.parentElement.parentElement.getBoundingClientRect(),l=jb(n,this.pmView);if(!l)return;let a;return this.editor._tiptapEditor.state.doc.descendants(((t,e)=>{if(typeof a<"u")return!1;if("blockContainer"!==t.type.name||t.attrs.id!==l.id)return!0;const n=Fg(t,this.editor.schema.blockSchema,this.editor.schema.inlineContentSchema,this.editor.schema.styleSchema,this.editor.blockCache);return function(t,e,n){return e.type===t&&e.type in n.schema.blockSchema&&pb(e.type,n)}("table",n,this.editor)&&(this.tablePos=e+1,a=n),!1})),a&&(this.tableId=l.id,void 0===this.state||!this.state.show||this.tableId!==l.id||this.state.rowIndex!==r||this.state.colIndex!==o)?(this.state={show:!0,referencePosCell:i,referencePosTable:s,block:a,colIndex:o,rowIndex:r,draggingState:void 0},this.emitUpdate(),!1):void 0})),vg(this,"dragOverHandler",(t=>{var e;if(void 0===(null==(e=this.state)?void 0:e.draggingState))return;t.preventDefault(),t.dataTransfer.dropEffect="move",function(t,e){t.forEach((t=>{const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)n[e].style.visibility="hidden"}))}(["column-resize-handle","prosemirror-dropcursor-block","prosemirror-dropcursor-inline"],this.pmView.root);const n={left:Math.min(Math.max(t.clientX,this.state.referencePosTable.left+1),this.state.referencePosTable.right-1),top:Math.min(Math.max(t.clientY,this.state.referencePosTable.top+1),this.state.referencePosTable.bottom-1)},o=this.pmView.root.elementsFromPoint(n.left,n.top).filter((t=>"TD"===t.tagName||"TH"===t.tagName));if(0===o.length)throw new Error("Could not find table cell element that the mouse cursor is hovering over.");const r=o[0];let i=!1;const s=Qb(r.parentElement),l=Qb(r),a="row"===this.state.draggingState.draggedCellOrientation?this.state.rowIndex:this.state.colIndex,c=("row"===this.state.draggingState.draggedCellOrientation?s:l)!==a;(this.state.rowIndex!==s||this.state.colIndex!==l)&&(this.state.rowIndex=s,this.state.colIndex=l,this.state.referencePosCell=r.getBoundingClientRect(),i=!0);const d="row"===this.state.draggingState.draggedCellOrientation?n.top:n.left;this.state.draggingState.mousePos!==d&&(this.state.draggingState.mousePos=d,i=!0),i&&this.emitUpdate(),c&&this.editor.dispatch(this.pmView.state.tr.setMeta(ew,!0))})),vg(this,"dropHandler",(t=>{if(void 0===this.state||void 0===this.state.draggingState)return;t.preventDefault();const e=this.state.block.content.rows;if("row"===this.state.draggingState.draggedCellOrientation){const t=e[this.state.draggingState.originalIndex];e.splice(this.state.draggingState.originalIndex,1),e.splice(this.state.rowIndex,0,t)}else{const t=e.map((t=>t.cells[this.state.draggingState.originalIndex]));e.forEach(((e,n)=>{e.cells.splice(this.state.draggingState.originalIndex,1),e.cells.splice(this.state.colIndex,0,t[n])}))}this.editor.updateBlock(this.state.block,{type:"table",content:{type:"tableContent",rows:e}})})),vg(this,"scrollHandler",(()=>{var t;if(null!=(t=this.state)&&t.show){const t=this.pmView.root.querySelector(`[data-node-type="blockContainer"][data-id="${this.tableId}"] table`),e=t.querySelector(`tr:nth-child(${this.state.rowIndex+1}) > td:nth-child(${this.state.colIndex+1})`);this.state.referencePosTable=t.getBoundingClientRect(),this.state.referencePosCell=e.getBoundingClientRect(),this.emitUpdate()}})),this.editor=t,this.pmView=e,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized image toolbar");n(this.state)},e.dom.addEventListener("mousemove",this.mouseMoveHandler),e.root.addEventListener("dragover",this.dragOverHandler),e.root.addEventListener("drop",this.dropHandler),e.root.addEventListener("scroll",this.scrollHandler,!0)}destroy(){this.pmView.dom.removeEventListener("mousemove",this.mouseMoveHandler),this.pmView.root.removeEventListener("dragover",this.dragOverHandler),this.pmView.root.removeEventListener("drop",this.dropHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0)}}const ew=new Ee("TableHandlesPlugin");class nw extends Ob{constructor(t){super(),vg(this,"view"),vg(this,"plugin"),vg(this,"colDragStart",(t=>{if(void 0===this.view.state)throw new Error("Attempted to drag table column, but no table block was hovered prior.");this.view.state.draggingState={draggedCellOrientation:"col",originalIndex:this.view.state.colIndex,mousePos:t.clientX},this.view.emitUpdate(),this.editor.dispatch(this.editor._tiptapEditor.state.tr.setMeta(ew,{draggedCellOrientation:this.view.state.draggingState.draggedCellOrientation,originalIndex:this.view.state.colIndex,newIndex:this.view.state.colIndex,tablePos:this.view.tablePos})),Yb(this.editor._tiptapEditor.view.root),t.dataTransfer.setDragImage(Xb,0,0),t.dataTransfer.effectAllowed="move"})),vg(this,"rowDragStart",(t=>{if(void 0===this.view.state)throw new Error("Attempted to drag table row, but no table block was hovered prior.");this.view.state.draggingState={draggedCellOrientation:"row",originalIndex:this.view.state.rowIndex,mousePos:t.clientY},this.view.emitUpdate(),this.editor.dispatch(this.editor._tiptapEditor.state.tr.setMeta(ew,{draggedCellOrientation:this.view.state.draggingState.draggedCellOrientation,originalIndex:this.view.state.rowIndex,newIndex:this.view.state.rowIndex,tablePos:this.view.tablePos})),Yb(this.editor._tiptapEditor.view.root),t.dataTransfer.setDragImage(Xb,0,0),t.dataTransfer.effectAllowed="copyMove"})),vg(this,"dragEnd",(()=>{if(void 0===this.view.state)throw new Error("Attempted to drag table row, but no table block was hovered prior.");var t;this.view.state.draggingState=void 0,this.view.emitUpdate(),this.editor.dispatch(this.editor._tiptapEditor.state.tr.setMeta(ew,null)),t=this.editor._tiptapEditor.view.root,Xb&&(t instanceof Document?t.body.removeChild(Xb):t.removeChild(Xb),Xb=void 0)})),vg(this,"freezeHandles",(()=>{this.view.menuFrozen=!0})),vg(this,"unfreezeHandles",(()=>{this.view.menuFrozen=!1})),this.editor=t,this.plugin=new Ce({key:ew,view:e=>(this.view=new tw(t,e,(t=>{this.emit("update",t)})),this.view),props:{decorations:t=>{if(void 0===this.view||void 0===this.view.state||void 0===this.view.state.draggingState||void 0===this.view.tablePos)return;const e="row"===this.view.state.draggingState.draggedCellOrientation?this.view.state.rowIndex:this.view.state.colIndex,n=[];if(e===this.view.state.draggingState.originalIndex)return ur.create(t.doc,n);const o=t.doc.resolve(this.view.tablePos+1),r=o.node();if("row"===this.view.state.draggingState.draggedCellOrientation){const r=t.doc.resolve(o.posAtIndex(e)+1),i=r.node();for(let o=0;o<i.childCount;o++){const i=t.doc.resolve(r.posAtIndex(o)+1),s=i.node(),l=i.pos+(e>this.view.state.draggingState.originalIndex?s.nodeSize-2:0);n.push(cr.widget(l,(()=>{const t=document.createElement("div");return t.className="bn-table-drop-cursor",t.style.left="0",t.style.right="0",e>this.view.state.draggingState.originalIndex?t.style.bottom="-2px":t.style.top="-3px",t.style.height="4px",t})))}}else for(let i=0;i<r.childCount;i++){const r=t.doc.resolve(o.posAtIndex(i)+1),s=t.doc.resolve(r.posAtIndex(e)+1),l=s.node(),a=s.pos+(e>this.view.state.draggingState.originalIndex?l.nodeSize-2:0);n.push(cr.widget(a,(()=>{const t=document.createElement("div");return t.className="bn-table-drop-cursor",t.style.top="0",t.style.bottom="0",e>this.view.state.draggingState.originalIndex?t.style.right="-2px":t.style.left="-3px",t.style.width="4px",t})))}return ur.create(t.doc,n)}}})}onUpdate(t){return this.on("update",t)}}async function ow(t,e){const n=t.state.selection.content().content,o=(await Jg(t.state.schema,e)).serializeProseMirrorFragment(n,{});await Cg();const r=qg(t.state.schema,e).exportProseMirrorFragment(n,{});return{internalHTML:o,externalHTML:r,plainText:await xb(r)}}const rw=t=>zi.create({name:"copyToClipboard",addProseMirrorPlugins:()=>[new Ce({props:{handleDOMEvents:{copy:(e,n)=>(n.preventDefault(),n.clipboardData.clearData(),"node"in e.state.selection&&"blockContent"===e.state.selection.node.type.spec.group&&t.dispatch(t._tiptapEditor.state.tr.setSelection(new de(e.state.doc.resolve(e.state.selection.from-1)))),(async()=>{const{internalHTML:o,externalHTML:r,plainText:i}=await ow(e,t);n.clipboardData.setData("blocknote/html",o),n.clipboardData.setData("text/html",r),n.clipboardData.setData("text/plain",i)})(),!0),dragstart(e,n){if("node"in e.state.selection&&"blockContent"===e.state.selection.node.type.spec.group)return t.dispatch(t._tiptapEditor.state.tr.setSelection(new de(e.state.doc.resolve(e.state.selection.from-1)))),n.preventDefault(),n.dataTransfer.clearData(),(async()=>{const{internalHTML:o,externalHTML:r,plainText:i}=await ow(e,t);n.dataTransfer.setData("blocknote/html",o),n.dataTransfer.setData("text/html",r),n.dataTransfer.setData("text/plain",i)})(),!0}}}})]});function iw(t,e){const n=t.getTextCursorPosition().block;if(void 0===n.content)throw new Error("Slash Menu open in a block that doesn't contain content.");Array.isArray(n.content)&&(1===n.content.length&&Ng(n.content[0])&&"text"===n.content[0].type&&"/"===n.content[0].text||0===n.content.length)?t.updateBlock(n,e):(t.insertBlocks([e],n,"after"),t.setTextCursorPosition(t.getTextCursorPosition().nextBlock,"end"));const o=t.getTextCursorPosition().block;return function(t){let e=t.getTextCursorPosition().block,n=t.schema.blockSchema[e.type].content;for(;"none"===n;)e=t.getTextCursorPosition().nextBlock,n=t.schema.blockSchema[e.type].content,t.setTextCursorPosition(e,"end")}(t),o}function sw(t,e){return t.filter((({title:t,aliases:n})=>t.toLowerCase().includes(e.toLowerCase())||n&&0!==n.filter((t=>t.toLowerCase().includes(e.toLowerCase()))).length))}const lw=["blocknote/html","Files","text/html","text/plain"];function aw(t,e){const n=t.split("/"),o=e.split("/");if(2!==n.length)throw new Error(`The string ${t} is not a valid MIME type.`);if(2!==o.length)throw new Error(`The string ${e} is not a valid MIME type.`);return"*"===n[1]||"*"===o[1]?n[0]===o[0]:("*"===n[0]||"*"===o[0]||n[0]===o[0])&&n[1]===o[1]}async function cw(t,e){if(!e.uploadFile)return;const n="dataTransfer"in t?t.dataTransfer:t.clipboardData;if(null===n)return;let o=null;for(const s of lw)if(n.types.includes(s)){o=s;break}if("Files"!==o)return;const r=n.items;if(!r)return;t.preventDefault();const i=Object.values(e.schema.blockSchema).filter((t=>t.isFileBlock));for(let s=0;s<r.length;s++){let t="file";for(const e of i)for(const n of e.fileBlockAcceptMimeTypes||[])if(aw(r[s].type,n)){t=e.type;break}const n=r[s].getAsFile();if(n){const o=await e.uploadFile(n);if("string"==typeof o){iw(e,{type:t,props:{name:n.name,url:o}})}}}}const dw=t=>zi.create({name:"pasteFromClipboard",addProseMirrorPlugins:()=>[new Ce({props:{handleDOMEvents:{paste(e,n){if(n.preventDefault(),!t.isEditable)return;let o=null;for(const t of lw)if(n.clipboardData.types.includes(t)){o=t;break}if(null===o)return!0;if("Files"===o)return cw(n,t),!0;let r=n.clipboardData.getData(o);return"text/html"===o&&(r=Mb(r.trim()).innerHTML),t._tiptapEditor.view.pasteHTML(r),!0}}}})]}),hw=t=>zi.create({name:"dropFile",addProseMirrorPlugins:()=>[new Ce({props:{handleDOMEvents:{drop(e,n){if(!t.isEditable)return;let o=null;for(const t of lw)if(n.dataTransfer.types.includes(t)){o=t;break}return null===o||"Files"===o&&(cw(n,t),!0)}}}})]}),uw=zi.create({name:"blockBackgroundColor",addGlobalAttributes:()=>[{types:["blockContainer"],attributes:{backgroundColor:{default:ey.backgroundColor.default,parseHTML:t=>t.hasAttribute("data-background-color")?t.getAttribute("data-background-color"):ey.backgroundColor.default,renderHTML:t=>t.backgroundColor===ey.backgroundColor.default?{}:{"data-background-color":t.backgroundColor}}}}]}),pw=zi.create({name:"textAlignment",addGlobalAttributes:()=>[{types:["paragraph","heading","bulletListItem","numberedListItem","checkListItem"],attributes:{textAlignment:{default:"left",parseHTML:t=>t.getAttribute("data-text-alignment"),renderHTML:t=>"left"===t.textAlignment?{}:{"data-text-alignment":t.textAlignment}}}}]}),fw=zi.create({name:"blockTextColor",addGlobalAttributes:()=>[{types:["blockContainer"],attributes:{textColor:{default:ey.textColor.default,parseHTML:t=>t.hasAttribute("data-text-color")?t.getAttribute("data-text-color"):ey.textColor.default,renderHTML:t=>t.textColor===ey.textColor.default?{}:{"data-text-color":t.textColor}}}}]}),mw=zi.create({name:"trailingNode",addProseMirrorPlugins(){const t=new Ee(this.name);return[new Ce({key:t,appendTransaction:(e,n,o)=>{const{doc:r,tr:i,schema:s}=o,l=t.getState(o),a=r.content.size-2,c=s.nodes.blockContainer,d=s.nodes.paragraph;if(l)return i.insert(a,c.create(void 0,d.create()))},state:{init:(t,e)=>{},apply:(t,e)=>{if(!t.docChanged)return e;let n=t.doc.lastChild;if(!n||"blockGroup"!==n.type.name)throw new Error("Expected blockGroup");if(n=n.lastChild,!n||"blockContainer"!==n.type.name)throw new Error("Expected blockContainer");const o=n.firstChild;if(!o)throw new Error("Expected blockContent");return n.nodeSize>4||"inline*"!==o.type.spec.content}}})]}}),gw=new Ee("non-editable-block"),yw=new Ee("previous-blocks"),bw={index:"index",level:"level",type:"type",depth:"depth","depth-change":"depth-change"},ww=()=>{let t;return new Ce({key:yw,view(e){return{update:async(e,n)=>{var o;(null==(o=this.key)?void 0:o.getState(e.state).updatedBlocks.size)>0&&(t=setTimeout((()=>{e.dispatch(e.state.tr.setMeta(yw,{clearUpdate:!0}))}),0))},destroy:()=>{t&&clearTimeout(t)}}},state:{init:()=>({prevTransactionOldBlockAttrs:{},currentTransactionOldBlockAttrs:{},updatedBlocks:new Set}),apply(t,e,n,o){if(e.currentTransactionOldBlockAttrs={},e.updatedBlocks.clear(),!t.docChanged||n.doc.eq(o.doc))return e;const r={},i=us(n.doc,(t=>t.attrs.id)),s=new Map(i.map((t=>[t.node.attrs.id,t]))),l=us(o.doc,(t=>t.attrs.id));for(const a of l){const i=s.get(a.node.attrs.id),l=null==i?void 0:i.node.firstChild,c=a.node.firstChild;if(i&&l&&c){const s={index:c.attrs.index,level:c.attrs.level,type:c.type.name,depth:o.doc.resolve(a.pos).depth};let d={index:l.attrs.index,level:l.attrs.level,type:l.type.name,depth:n.doc.resolve(i.pos).depth};r[a.node.attrs.id]=d,t.getMeta("numberedListIndexing")&&(a.node.attrs.id in e.prevTransactionOldBlockAttrs&&(d=e.prevTransactionOldBlockAttrs[a.node.attrs.id]),"numberedListItem"===s.type&&(d.index=s.index)),e.currentTransactionOldBlockAttrs[a.node.attrs.id]=d,JSON.stringify(d)!==JSON.stringify(s)&&(d["depth-change"]=d.depth-s.depth,e.updatedBlocks.add(a.node.attrs.id))}}return e.prevTransactionOldBlockAttrs=r,e}},props:{decorations(t){const e=this.getState(t);if(0===e.updatedBlocks.size)return;const n=[];return t.doc.descendants(((t,o)=>{if(!t.attrs.id||!e.updatedBlocks.has(t.attrs.id))return;const r=e.currentTransactionOldBlockAttrs[t.attrs.id],i={};for(const[e,n]of Object.entries(r))i["data-prev-"+bw[e]]=n||"none";const s=cr.node(o,o+t.nodeSize,{...i});n.push(s)})),ur.create(t.doc,n)}}})},vw={blockColor:"data-block-color",blockStyle:"data-block-style",id:"data-id",depth:"data-depth",depthChange:"data-depth-change"},kw=Vs.create({name:"blockContainer",group:"blockContainer",content:"blockContent blockGroup?",priority:50,defining:!0,parseHTML:()=>[{tag:"div",getAttrs:t=>{if("string"==typeof t)return!1;const e={};for(const[n,o]of Object.entries(vw))t.getAttribute(o)&&(e[n]=t.getAttribute(o));return"blockContainer"===t.getAttribute("data-node-type")&&e}}],renderHTML({HTMLAttributes:t}){var e;const n=document.createElement("div");n.className="bn-block-outer",n.setAttribute("data-node-type","blockOuter");for(const[i,s]of Object.entries(t))"class"!==i&&n.setAttribute(i,s);const o={...(null==(e=this.options.domAttributes)?void 0:e.block)||{},...t},r=document.createElement("div");r.className=Xg("bn-block",o.class),r.setAttribute("data-node-type",this.name);for(const[i,s]of Object.entries(o))"class"!==i&&r.setAttribute(i,s);return n.appendChild(r),{dom:n,contentDOM:r}},addCommands(){return{BNCreateBlock:t=>({state:e,dispatch:n})=>{const o=e.schema.nodes.blockContainer.createAndFill();return n&&e.tr.insert(t,o).scrollIntoView(),!0},BNDeleteBlock:t=>({state:e,dispatch:n})=>{const o=Tg(e.doc,t);if(void 0===o)return!1;const{startPos:r,endPos:i}=o;return n&&e.tr.deleteRange(r,i),!0},BNUpdateBlock:(t,e)=>({state:n,dispatch:o})=>{const r=Tg(n.doc,t);if(void 0===r)return!1;const{startPos:i,endPos:s,node:l,contentNode:a}=r;if(o){if(void 0!==e.children){const t=[];for(const o of e.children)t.push(Bg(o,n.schema,this.options.editor.schema.styleSchema));2===l.childCount?n.tr.replace(i+a.nodeSize+1,s-1,new m(c.from(t),0,0)):n.tr.insert(i+a.nodeSize,n.schema.nodes.blockGroup.create({},t))}const t=a.type.name,o=e.type||t;let r="keep";if(e.content)if("string"==typeof e.content)r=Pg([e.content],n.schema,this.options.editor.schema.styleSchema);else if(Array.isArray(e.content))r=Pg(e.content,n.schema,this.options.editor.schema.styleSchema);else{if("tableContent"!==e.content.type)throw new _g(e.content.type);r=Hg(e.content,n.schema,this.options.editor.schema.styleSchema)}else{const e=n.schema.nodes[t].spec.content,i=n.schema.nodes[o].spec.content;""===e||i!==e&&(r=[])}"keep"===r?n.tr.setNodeMarkup(i,void 0===e.type?void 0:n.schema.nodes[e.type],{...a.attrs,...e.props}):n.tr.replaceWith(i,s,n.schema.nodes[o].create({...a.attrs,...e.props},r)).setSelection(""===n.schema.nodes[o].spec.content?new de(n.tr.doc.resolve(i)):"inline*"===n.schema.nodes[o].spec.content?new ae(n.tr.doc.resolve(i)):new ae(n.tr.doc.resolve(i+4))),n.tr.setNodeMarkup(i-1,void 0,{...l.attrs,...e.props})}return!0},BNMergeBlocks:t=>({state:e,dispatch:n})=>{const o="blockContainer"===e.doc.resolve(t+1).node().type.name,r="blockContainer"===e.doc.resolve(t-1).node().type.name;if(!o||!r)return!1;const i=Tg(e.doc,t+1),{node:s,contentNode:l,startPos:a,endPos:c,depth:d}=i;if(2===s.childCount){const t=e.doc.resolve(a+l.nodeSize+1),o=e.doc.resolve(c-1),r=t.blockRange(o);n&&e.tr.lift(r,d-1)}let h=t-1,u=Tg(e.doc,h);for(;u.numChildBlocks>0;)if(h--,u=Tg(e.doc,h),void 0===u)return!1;return n&&(n(e.tr.deleteRange(a,a+l.nodeSize).replace(h-1,a,new m(l.content,0,0)).scrollIntoView()),e.tr.setSelection(new ae(e.doc.resolve(h-1)))),!0},BNSplitBlock:(t,e,n)=>({state:o,dispatch:r})=>{const i=Tg(o.doc,t);if(void 0===i)return!1;const{contentNode:s,contentType:l,startPos:a,endPos:d,depth:h}=i,u=o.doc.cut(a+1,t),p=o.doc.cut(t,d-1),f=o.schema.nodes.blockContainer.createAndFill(),g=d+1,y=g+2;return r&&(o.tr.insert(g,f),o.tr.replace(y,y+1,p.content.size>0?new m(c.from(p),h+2,h+2):void 0),e&&o.tr.setBlockType(y,y,o.schema.node(l).type,n?s.attrs:void 0),o.tr.setSelection(new ae(o.doc.resolve(y))),o.tr.replace(a+1,d-1,u.content.size>0?new m(c.from(u),h+2,h+2):void 0),o.tr.scrollIntoView()),!0}}},addProseMirrorPlugins:()=>[ww(),new Ce({key:gw,props:{handleKeyDown:(t,e)=>{if("node"in t.state.selection){if(e.ctrlKey||e.metaKey)return!1;if(1===e.key.length)return e.preventDefault(),!0;if(!("Enter"!==e.key||e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)){const e=t.state.tr;return t.dispatch(e.insert(t.state.tr.selection.$to.after(),t.state.schema.nodes.paragraph.create()).setSelection(new ae(e.doc.resolve(t.state.tr.selection.$to.after()+1)))),!0}}return!1}}})],addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.first((({commands:t})=>[()=>t.deleteSelection(),()=>t.undoInputRule(),()=>t.command((({state:e})=>{const{contentType:n,startPos:o}=Tg(e.doc,e.selection.from),r=e.selection.from===o+1,i="paragraph"===n.name;return!(!r||i)&&t.BNUpdateBlock(e.selection.from,{type:"paragraph",props:{}})})),()=>t.command((({state:e})=>{const{startPos:n}=Tg(e.doc,e.selection.from);return e.selection.from===n+1&&t.liftListItem("blockContainer")})),()=>t.command((({state:e})=>{const{depth:n,startPos:o}=Tg(e.doc,e.selection.from),r=e.selection.from===o+1,i=e.selection.empty,s=o-1;return!(2===o||!r||!i||2!==n)&&t.BNMergeBlocks(s)}))])),Delete:()=>this.editor.commands.first((({commands:t})=>[()=>t.deleteSelection(),()=>t.command((({state:e})=>{const{node:n,depth:o,endPos:r}=Tg(e.doc,e.selection.from),i=r===e.doc.nodeSize-4,s=e.selection.from===r-1,l=e.selection.empty,a=2===n.childCount;if(!i&&s&&l&&!a){let n=o,i=r+2,s=e.doc.resolve(i).depth;for(;s<n;)n=s,i+=2,s=e.doc.resolve(i).depth;return t.BNMergeBlocks(i-1)}return!1}))])),Enter:()=>this.editor.commands.first((({commands:t})=>[()=>t.command((({state:e})=>{const{contentNode:n,depth:o}=Tg(e.doc,e.selection.from),r=0===e.selection.$anchor.parentOffset,i=e.selection.anchor===e.selection.head,s=0===n.childCount;return!!(r&&i&&s&&o>2)&&t.liftListItem("blockContainer")})),()=>t.command((({state:t,chain:e})=>{const{contentNode:n,endPos:o}=Tg(t.doc,t.selection.from),r=0===t.selection.$anchor.parentOffset,i=t.selection.anchor===t.selection.head,s=0===n.childCount;if(r&&i&&s){const t=o+1,n=t+2;return e().BNCreateBlock(t).setTextSelection(n).run(),!0}return!1})),()=>t.command((({state:t,chain:e})=>{const{contentNode:n}=Tg(t.doc,t.selection.from),o=0===t.selection.$anchor.parentOffset;return 0!==n.childCount&&(e().deleteSelection().BNSplitBlock(t.selection.from,o,o).run(),!0)}))])),Tab:()=>{var t,e,n;return!(null!=(t=this.options.editor.formattingToolbar)&&t.shown||null!=(e=this.options.editor.linkToolbar)&&e.shown||null!=(n=this.options.editor.filePanel)&&n.shown)&&(this.editor.commands.sinkListItem("blockContainer"),!0)},"Shift-Tab":()=>{var t,e,n;return!(null!=(t=this.options.editor.formattingToolbar)&&t.shown||null!=(e=this.options.editor.linkToolbar)&&e.shown||null!=(n=this.options.editor.filePanel)&&n.shown)&&(this.editor.commands.liftListItem("blockContainer"),!0)}}}}),xw=Vs.create({name:"blockGroup",group:"blockGroup",content:"blockContainer+",parseHTML:()=>[{tag:"div",getAttrs:t=>"string"!=typeof t&&("blockGroup"===t.getAttribute("data-node-type")&&null)}],renderHTML({HTMLAttributes:t}){var e;const n={...(null==(e=this.options.domAttributes)?void 0:e.blockGroup)||{},...t},o=document.createElement("div");o.className=Xg("bn-block-group",n.class),o.setAttribute("data-node-type","blockGroup");for(const[r,i]of Object.entries(n))"class"!==r&&o.setAttribute(r,i);return{dom:o,contentDOM:o}}}),Cw=Vs.create({name:"doc",topNode:!0,content:"blockGroup"}),Sw=t=>{var e;const n=[Ds.ClipboardTextSerializer,Ds.Commands,Ds.Editable,Ds.FocusEvents,Ds.Tabindex,Yp,Mg.configure({types:["blockContainer"]}),Qp.extend({priority:10}),bg,yg.extend({addKeyboardShortcuts(){return{"Mod-k":()=>(this.editor.commands.toggleLink({href:""}),!0)}}}),...Object.values(t.styleSpecs).map((t=>t.implementation.mark)),fw,uw,pw,zi.create({name:"OverrideEscape",addKeyboardShortcuts(){return{Escape:()=>!t.editor.suggestionMenus.shown&&this.editor.commands.blur()}}}),Cw,kw.configure({editor:t.editor,domAttributes:t.domAttributes}),xw.configure({domAttributes:t.domAttributes}),...Object.values(t.inlineContentSpecs).filter((t=>"link"!==t.config&&"text"!==t.config)).map((e=>e.implementation.node.configure({editor:t.editor}))),...Object.values(t.blockSpecs).flatMap((e=>[...(e.implementation.requiredExtensions||[]).map((e=>e.configure({editor:t.editor,domAttributes:t.domAttributes}))),e.implementation.node.configure({editor:t.editor,domAttributes:t.domAttributes})])),rw(t.editor),dw(t.editor),hw(t.editor),Up.configure({width:5,color:"#ddeeff"}),...void 0===t.trailingBlock||t.trailingBlock?[mw]:[]];if(t.collaboration){if(n.push(Vp.configure({fragment:t.collaboration.fragment})),null!=(e=t.collaboration.provider)&&e.awareness){const e=t=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("span");n.classList.add("collaboration-cursor__label"),n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null);const o=document.createTextNode(""),r=document.createTextNode("");return e.insertBefore(o,null),e.insertBefore(n,null),e.insertBefore(r,null),e};n.push(zp.configure({user:t.collaboration.user,render:t.collaboration.renderCursor||e,provider:t.collaboration.provider}))}}else n.push(vf);const o=t.disableExtensions||[];return n.filter((t=>!o.includes(t.name)))};function Mw(t,e){const n=[];return t.forEach(((t,o,r)=>{r!==e&&n.push(t)})),c.from(n)}function Ew(t,e){let n=c.from(t.content);for(let o=0;o<n.childCount;o++)if("blockContent"===n.child(o).type.spec.group){const t=[n.child(o)];if(o+1<n.childCount&&"blockGroup"===n.child(o+1).type.spec.group){const e=n.child(o+1).child(0).child(0);("bulletListItem"===e.type.name||"numberedListItem"===e.type.name||"checkListItem"===e.type.name)&&(t.push(n.child(o+1)),n=Mw(n,o+1))}const r=e.state.schema.nodes.blockContainer.create(void 0,t);n=n.replaceChild(o,r)}return new m(n,t.openStart,t.openEnd)}function Tw(t){return t&&Object.fromEntries(Object.entries(t).filter((([,t])=>void 0!==t)))}class Ow{constructor(t){vg(this,"blockSpecs"),vg(this,"inlineContentSpecs"),vg(this,"styleSpecs"),vg(this,"blockSchema"),vg(this,"inlineContentSchema"),vg(this,"styleSchema"),vg(this,"BlockNoteEditor","only for types"),vg(this,"Block","only for types"),vg(this,"PartialBlock","only for types"),this.blockSpecs=Tw(null==t?void 0:t.blockSpecs)||ab,this.inlineContentSpecs=Tw(null==t?void 0:t.inlineContentSpecs)||hb,this.styleSpecs=Tw(null==t?void 0:t.styleSpecs)||db,this.blockSchema=hy(this.blockSpecs),this.inlineContentSchema=fy(this.inlineContentSpecs),this.styleSchema=gy(this.styleSpecs)}static create(t){return new Ow(t)}}class Aw extends Is{constructor(t,e){super({...t,content:void 0}),vg(this,"_state"),vg(this,"mount",(t=>{t?(this.options.element=t,this.createViewAlternative()):this.destroy()}));const n=this.schema;let o;const r=n.nodes.doc.createAndFill;let i;n.nodes.doc.createAndFill=(...t)=>{if(o)return o;const e=r.apply(n.nodes.doc,t),i=JSON.parse(JSON.stringify(e.toJSON()));return i.content[0].content[0].attrs.id="initialBlockId",o=D.fromJSON(n,i),o};try{i=cs({type:"doc",content:[{type:"blockGroup",content:null==t?void 0:t.content.map((t=>Bg(t,this.schema,e).toJSON()))}]},this.schema,this.options.parseOptions)}catch(s){throw new Error("Error creating document from blocks passed as `initialContent`:\n"+ +JSON.stringify(t.content))}this._state=ke.create({doc:i,schema:this.schema})}get state(){return this.view&&(this._state=this.view.state),this._state}dispatch(t){this.view?this.view.dispatch(t):this._state=this.state.apply(t)}createViewAlternative(){queueMicrotask((()=>{this.view=new Hr({mount:this.options.element},{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:this.state});const t=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(t),this.createNodeViews()}))}}Aw.prototype.createView=()=>{};const Nw=new Ee("blocknote-placeholder"),_w=(t,e)=>new Ce({key:Nw,view:()=>{const n=document.createElement("style"),o=t._tiptapEditor.options.injectNonce;o&&n.setAttribute("nonce",o),t._tiptapEditor.view.root instanceof ShadowRoot?t._tiptapEditor.view.root.append(n):t._tiptapEditor.view.root.head.appendChild(n);const r=n.sheet,i=(t="")=>`.bn-block-content${t} .bn-inline-content:has(> .ProseMirror-trailingBreak:only-child):before`,s=(t,e=!0)=>{const n=e?"[data-is-empty-and-focused]":"";if("default"===t)return i(n);return i(n+`[data-content-type="${t}"]`)};for(const[t,l]of Object.entries(e)){const e="default"===t;r.insertRule(`${s(t,e)}{ content: ${JSON.stringify(l)}; }`),e||r.insertRule(`${s(t,!0)}{ content: ${JSON.stringify(l)}; }`)}return{destroy:()=>{t._tiptapEditor.view.root instanceof ShadowRoot?t._tiptapEditor.view.root.removeChild(n):t._tiptapEditor.view.root.head.removeChild(n)}}},props:{decorations:e=>{const{doc:n,selection:o}=e;if(!t.isEditable||!o.empty)return;const r=o.$anchor,i=r.parent;if(i.content.size>0)return null;const s=r.before(),l=cr.node(s,s+i.nodeSize,{"data-is-empty-and-focused":"true"});return ur.create(n,[l])}}}),Lw={enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!1};class Dw{constructor(t){var e,n,o,r,i,s,l;vg(this,"_pmSchema"),vg(this,"headless",!1),vg(this,"_tiptapEditor"),vg(this,"elementRenderer",null),vg(this,"blockCache",new WeakMap),vg(this,"dictionary"),vg(this,"schema"),vg(this,"blockImplementations"),vg(this,"inlineContentImplementations"),vg(this,"styleImplementations"),vg(this,"formattingToolbar"),vg(this,"linkToolbar"),vg(this,"sideMenu"),vg(this,"suggestionMenus"),vg(this,"filePanel"),vg(this,"tableHandles"),vg(this,"uploadFile"),vg(this,"resolveFileUrl"),vg(this,"mount",(t=>{this._tiptapEditor.mount(t)})),this.options=t;const a=t;if(a.onEditorContentChange)throw new Error("onEditorContentChange initialization option is deprecated, use <BlockNoteView onChange={...} />, the useEditorChange(...) hook, or editor.onChange(...)");if(a.onTextCursorPositionChange)throw new Error("onTextCursorPositionChange initialization option is deprecated, use <BlockNoteView onSelectionChange={...} />, the useEditorSelectionChange(...) hook, or editor.onSelectionChange(...)");if(a.onEditorReady)throw new Error("onEditorReady is deprecated. Editor is immediately ready for use after creation.");if(a.editable)throw new Error("editable initialization option is deprecated, use <BlockNoteView editable={true/false} />, or alternatively editor.isEditable = true/false");this.dictionary=t.dictionary||kg;const c={defaultStyles:!0,schema:t.schema||Ow.create(),_headless:!1,...t,placeholders:{...this.dictionary.placeholders,...t.placeholders}};this.schema=c.schema,this.blockImplementations=c.schema.blockSpecs,this.inlineContentImplementations=c.schema.inlineContentSpecs,this.styleImplementations=c.schema.styleSpecs,this.formattingToolbar=new Rb(this),this.linkToolbar=new Vb(this),this.sideMenu=new qb(this),this.suggestionMenus=new Gb(this),this.filePanel=new _b(this),pb("table",this)&&(this.tableHandles=new nw(this));const d=Sw({editor:this,domAttributes:c.domAttributes||{},blockSpecs:this.schema.blockSpecs,styleSpecs:this.schema.styleSpecs,inlineContentSpecs:this.schema.inlineContentSpecs,collaboration:c.collaboration,trailingBlock:c.trailingBlock,disableExtensions:c.disableExtensions}),h=zi.create({name:"BlockNoteUIExtension",addProseMirrorPlugins:()=>[this.formattingToolbar.plugin,this.linkToolbar.plugin,this.sideMenu.plugin,this.suggestionMenus.plugin,...this.filePanel?[this.filePanel.plugin]:[],...this.tableHandles?[this.tableHandles.plugin]:[],_w(this,c.placeholders)]});d.push(h),this.uploadFile=c.uploadFile,this.resolveFileUrl=c.resolveFileUrl||(async t=>t),this.headless=c._headless,c.collaboration&&c.initialContent;const u=c.initialContent||(t.collaboration?[{type:"paragraph",id:"initialBlockId"}]:[{type:"paragraph",id:Mg.options.generateID()}]);if(!Array.isArray(u)||0===u.length)throw new Error("initialContent must be a non-empty array of blocks, received: "+u);const p={...Lw,...c._tiptapOptions,content:u,extensions:[...(null==(e=c._tiptapOptions)?void 0:e.extensions)||[],...d],editorProps:{...null==(n=c._tiptapOptions)?void 0:n.editorProps,attributes:{tabIndex:"0",...null==(r=null==(o=c._tiptapOptions)?void 0:o.editorProps)?void 0:r.attributes,...null==(i=c.domAttributes)?void 0:i.editor,class:Xg("bn-editor",c.defaultStyles?"bn-default-styles":"",(null==(l=null==(s=c.domAttributes)?void 0:s.editor)?void 0:l.class)||"")},transformPasted:Ew}};var f,m;this.headless?this._pmSchema=(f=p.extensions,Ei(Vi.resolve(f),m)):(this._tiptapEditor=new Aw(p,this.schema.styleSchema),this._pmSchema=this._tiptapEditor.schema)}get pmSchema(){return this._pmSchema}static create(t={}){return new Dw(t)}dispatch(t){this._tiptapEditor.dispatch(t)}get prosemirrorView(){return this._tiptapEditor.view}get domElement(){return this._tiptapEditor.view.dom}isFocused(){return this._tiptapEditor.view.hasFocus()}focus(){this._tiptapEditor.view.focus()}get topLevelBlocks(){return this.document}get document(){const t=[];return this._tiptapEditor.state.doc.firstChild.descendants((e=>(t.push(Fg(e,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache)),!1))),t}getBlock(t){const e="string"==typeof t?t:t.id;let n;return this._tiptapEditor.state.doc.firstChild.descendants((t=>!(typeof n<"u")&&("blockContainer"!==t.type.name||t.attrs.id!==e||(n=Fg(t,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache),!1)))),n}forEachBlock(t,e=!1){const n=this.document.slice();e&&n.reverse(),function n(o){for(const r of o){if(!t(r))return!1;if(!n(e?r.children.slice().reverse():r.children))return!1}return!0}(n)}onEditorContentChange(t){this._tiptapEditor.on("update",t)}onEditorSelectionChange(t){this._tiptapEditor.on("selectionUpdate",t)}getTextCursorPosition(){const{node:t,depth:e,startPos:n,endPos:o}=Tg(this._tiptapEditor.state.doc,this._tiptapEditor.state.selection.from),r=this._tiptapEditor.state.doc.resolve(o).index(e-1),i=this._tiptapEditor.state.doc.resolve(o+1).node().childCount;let s,l;return r>0&&(s=this._tiptapEditor.state.doc.resolve(n-2).node()),r<i-1&&(l=this._tiptapEditor.state.doc.resolve(o+2).node()),{block:Fg(t,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache),prevBlock:void 0===s?void 0:Fg(s,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache),nextBlock:void 0===l?void 0:Fg(l,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache)}}setTextCursorPosition(t,e="start"){const n="string"==typeof t?t:t.id,{posBeforeNode:o}=bb(n,this._tiptapEditor.state.doc),{startPos:r,contentNode:i}=Tg(this._tiptapEditor.state.doc,o+2),s=this.schema.blockSchema[i.type.name].content;if("none"!==s)if("inline"===s)"start"===e?this._tiptapEditor.commands.setTextSelection(r+1):this._tiptapEditor.commands.setTextSelection(r+i.nodeSize-1);else{if("table"!==s)throw new _g(s);"start"===e?this._tiptapEditor.commands.setTextSelection(r+4):this._tiptapEditor.commands.setTextSelection(r+i.nodeSize-4)}else this._tiptapEditor.commands.setNodeSelection(r)}getSelection(){if(this._tiptapEditor.state.selection.from===this._tiptapEditor.state.selection.to||"node"in this._tiptapEditor.state.selection)return;const t=[];return this._tiptapEditor.state.doc.descendants(((e,n)=>{if("blockContent"!==e.type.spec.group)return!0;const o=n+1;return n+e.nodeSize-1<=this._tiptapEditor.state.selection.from||o>=this._tiptapEditor.state.selection.to||(t.push(Fg(this._tiptapEditor.state.doc.resolve(n).node(),this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.blockCache)),!1)})),{blocks:t}}get isEditable(){if(!this._tiptapEditor){if(!this.headless)throw new Error("no editor, but also not headless?");return!1}return void 0===this._tiptapEditor.isEditable||this._tiptapEditor.isEditable}set isEditable(t){if(this._tiptapEditor)this._tiptapEditor.options.editable!==t&&this._tiptapEditor.setEditable(t);else if(!this.headless)throw new Error("no editor, but also not headless?")}insertBlocks(t,e,n="before"){return function(t,e,n="before",o){const r="string"==typeof e?e:e.id,i=[];for(const c of t)i.push(Bg(c,o.pmSchema,o.schema.styleSchema));const{node:s,posBeforeNode:l}=bb(r,o._tiptapEditor.state.doc);if("before"===n&&o.dispatch(o._tiptapEditor.state.tr.insert(l,i)),"after"===n&&o.dispatch(o._tiptapEditor.state.tr.insert(l+s.nodeSize,i)),"nested"===n&&s.childCount<2){const t=o._tiptapEditor.state.schema.nodes.blockGroup.create({},i);o.dispatch(o._tiptapEditor.state.tr.insert(l+s.firstChild.nodeSize+1,t))}const a=[];for(const c of i)a.push(Fg(c,o.schema.blockSchema,o.schema.inlineContentSchema,o.schema.styleSchema,o.blockCache));return a}(t,e,n,this)}updateBlock(t,e){return function(t,e,n){const o=n._tiptapEditor,r="string"==typeof t?t:t.id,{posBeforeNode:i}=bb(r,o.state.doc);return o.commands.BNUpdateBlock(i+1,e),Fg(o.state.doc.resolve(i+1).node(),n.schema.blockSchema,n.schema.inlineContentSchema,n.schema.styleSchema,n.blockCache)}(t,e,this)}removeBlocks(t){return function(t,e){return wb(t,e)}(t,this)}replaceBlocks(t,e){return function(t,e,n){const o=[];for(const l of e)o.push(Bg(l,n.pmSchema,n.schema.styleSchema));const r="string"==typeof t[0]?t[0]:t[0].id,i=wb(t,n,((t,e,n,i)=>{if(t.attrs.id===r){const t=n.doc.nodeSize;return n.insert(e,o),i+t-n.doc.nodeSize}return i})),s=[];for(const l of o)s.push(Fg(l,n.schema.blockSchema,n.schema.inlineContentSchema,n.schema.styleSchema,n.blockCache));return{insertedBlocks:s,removedBlocks:i}}(t,e,this)}insertInlineContent(t){const e=Pg(t,this.pmSchema,this.schema.styleSchema);!function(t,e,n,o={updateSelection:!0}){const r=n._tiptapEditor.state.tr;let{from:i,to:s}="number"==typeof t?{from:t,to:t}:{from:t.from,to:t.to},l=!0,a=!0,c="";if(e.forEach((t=>{t.check(),l&&t.isText&&0===t.marks.length?c+=t.text:l=!1,a=!!a&&t.isBlock})),i===s&&a){const{parent:t}=r.doc.resolve(i);t.isTextblock&&!t.type.spec.code&&!t.childCount&&(i-=1,s+=1)}l?r.insertText(c,i,s):r.replaceWith(i,s,e),o.updateSelection&&rs(r,r.steps.length-1,-1),n.dispatch(r)}({from:this._tiptapEditor.state.selection.from,to:this._tiptapEditor.state.selection.to},e,this)}getActiveStyles(){const t={},e=this._tiptapEditor.state.selection.$to.marks();for(const n of e){const e=this.schema.styleSchema[n.type.name];e?"boolean"===e.propSchema?t[e.type]=!0:t[e.type]=n.attrs.stringValue:n.type.name}return t}addStyles(t){for(const[e,n]of Object.entries(t)){const t=this.schema.styleSchema[e];if(!t)throw new Error(`style ${e} not found in styleSchema`);if("boolean"===t.propSchema)this._tiptapEditor.commands.setMark(e);else{if("string"!==t.propSchema)throw new _g(t.propSchema);this._tiptapEditor.commands.setMark(e,{stringValue:n})}}}removeStyles(t){for(const e of Object.keys(t))this._tiptapEditor.commands.unsetMark(e)}toggleStyles(t){for(const[e,n]of Object.entries(t)){const t=this.schema.styleSchema[e];if(!t)throw new Error(`style ${e} not found in styleSchema`);if("boolean"===t.propSchema)this._tiptapEditor.commands.toggleMark(e);else{if("string"!==t.propSchema)throw new _g(t.propSchema);this._tiptapEditor.commands.toggleMark(e,{stringValue:n})}}}getSelectedText(){return this._tiptapEditor.state.doc.textBetween(this._tiptapEditor.state.selection.from,this._tiptapEditor.state.selection.to)}getSelectedLinkUrl(){return this._tiptapEditor.getAttributes("link").href}createLink(t,e){if(""===t)return;const{from:n,to:o}=this._tiptapEditor.state.selection;e||(e=this._tiptapEditor.state.doc.textBetween(n,o));const r=this.pmSchema.mark("link",{href:t});this.dispatch(this._tiptapEditor.state.tr.insertText(e,n,o).addMark(n,n+e.length,r))}canNestBlock(){const{startPos:t,depth:e}=Tg(this._tiptapEditor.state.doc,this._tiptapEditor.state.selection.from);return this._tiptapEditor.state.doc.resolve(t).index(e-1)>0}nestBlock(){this._tiptapEditor.commands.sinkListItem("blockContainer")}canUnnestBlock(){const{depth:t}=Tg(this._tiptapEditor.state.doc,this._tiptapEditor.state.selection.from);return t>2}unnestBlock(){this._tiptapEditor.commands.liftListItem("blockContainer")}async blocksToHTMLLossy(t=this.document){return await Cg(),qg(this.pmSchema,this).exportBlocks(t,{})}async blocksToFullHTML(t){return Jg(this.pmSchema,this).serializeBlocks(t,{})}async tryParseHTMLToBlocks(t){return Eb(t,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.pmSchema)}async blocksToMarkdownLossy(t=this.document){return async function(t,e,n,o){return await Cg(),xb(qg(e,n).exportBlocks(t,o))}(t,this.pmSchema,this,{})}async tryParseMarkdownToBlocks(t){return async function(t,e,n,o,r){const i=await Cg();return Eb(i.unified.unified().use(i.remarkParse.default).use(i.remarkGfm.default).use(i.remarkRehype.default,{handlers:{...i.remarkRehype.defaultHandlers,code:Tb}}).use(i.rehypeStringify.default).processSync(t).value,e,n,o,r)}(t,this.schema.blockSchema,this.schema.inlineContentSchema,this.schema.styleSchema,this.pmSchema)}updateCollaborationUserInfo(t){if(!this.options.collaboration)throw new Error("Cannot update collaboration user info when collaboration is disabled.");this._tiptapEditor.commands.updateUser(t)}onChange(t){if(this.headless)return;const e=()=>{t(this)};return this._tiptapEditor.on("update",e),()=>{this._tiptapEditor.off("update",e)}}onSelectionChange(t){if(this.headless)return;const e=()=>{t(this)};return this._tiptapEditor.on("selectionUpdate",e),()=>{this._tiptapEditor.off("selectionUpdate",e)}}openSelectionMenu(t){this.prosemirrorView.focus(),this.prosemirrorView.dispatch(this.prosemirrorView.state.tr.scrollIntoView().setMeta(this.suggestionMenus.plugin,{triggerCharacter:t,fromUserInput:!1}))}}let Rw,Iw;async function Pw(e,n){if(!function(t,e){return t in e.schema.inlineContentSchema&&e.schema.inlineContentSchema[t]===ub[t]}("text",e))return[];if(!Rw){Rw=t((()=>import("./native-8e23eda2.js")),[],import.meta.url),Iw=await t((()=>import("./module-c9fe2452.js")),[],import.meta.url);const e=(await Rw).default;await Iw.init({data:e})}const o=(await Rw).default;return(""===n.trim()?Object.values(o.emojis):await Iw.SearchIndex.search(n)).map((t=>({id:t.skins[0].native,onItemClick:()=>e.insertInlineContent(t.skins[0].native+" ")})))}function Hw(t){return jw(t)?(t.nodeName||"").toLowerCase():"#document"}function Vw(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function Bw(t){var e;return null==(e=(jw(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function jw(t){return t instanceof Node||t instanceof Vw(t).Node}function zw(t){return t instanceof Element||t instanceof Vw(t).Element}function Fw(t){return t instanceof HTMLElement||t instanceof Vw(t).HTMLElement}function $w(t){return"undefined"!=typeof ShadowRoot&&(t instanceof ShadowRoot||t instanceof Vw(t).ShadowRoot)}function Uw(t){const{overflow:e,overflowX:n,overflowY:o,display:r}=Gw(t);return/auto|scroll|overlay|hidden|clip/.test(e+o+n)&&!["inline","contents"].includes(r)}function Ww(t){return["table","td","th"].includes(Hw(t))}function qw(t){return[":popover-open",":modal"].some((e=>{try{return t.matches(e)}catch(eM){return!1}}))}function Jw(t){const e=Kw(),n=zw(t)?Gw(t):t;return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!e&&!!n.backdropFilter&&"none"!==n.backdropFilter||!e&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((t=>(n.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(n.contain||"").includes(t)))}function Kw(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Zw(t){return["html","body","#document"].includes(Hw(t))}function Gw(t){return Vw(t).getComputedStyle(t)}function Xw(t){return zw(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Yw(t){if("html"===Hw(t))return t;const e=t.assignedSlot||t.parentNode||$w(t)&&t.host||Bw(t);return $w(e)?e.host:e}function Qw(t){const e=Yw(t);return Zw(e)?t.ownerDocument?t.ownerDocument.body:t.body:Fw(e)&&Uw(e)?e:Qw(e)}function tv(t,e,n){var o;void 0===e&&(e=[]),void 0===n&&(n=!0);const r=Qw(t),i=r===(null==(o=t.ownerDocument)?void 0:o.body),s=Vw(r);if(i){const t=ev(s);return e.concat(s,s.visualViewport||[],Uw(r)?r:[],t&&n?tv(t):[])}return e.concat(r,tv(r,[],n))}function ev(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function nv(t){let e=t.activeElement;for(;null!=(null==(n=e)||null==(n=n.shadowRoot)?void 0:n.activeElement);){var n;e=e.shadowRoot.activeElement}return e}function ov(t,e){if(!t||!e)return!1;const n=null==e.getRootNode?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&$w(n)){let n=e;for(;n;){if(t===n)return!0;n=n.parentNode||n.host}}return!1}function rv(){const t=navigator.userAgentData;return null!=t&&t.platform?t.platform:navigator.platform}function iv(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map((t=>{let{brand:e,version:n}=t;return e+"/"+n})).join(" "):navigator.userAgent}function sv(t){return!iv().includes("jsdom/")&&(!lv()&&0===t.width&&0===t.height||lv()&&1===t.width&&1===t.height&&0===t.pressure&&0===t.detail&&"mouse"===t.pointerType||t.width<1&&t.height<1&&0===t.pressure&&0===t.detail&&"touch"===t.pointerType)}function lv(){const t=/android/i;return t.test(rv())||t.test(iv())}function av(t,e){const n=["mouse","pen"];return e||n.push("",void 0),n.includes(t)}function cv(t){return(null==t?void 0:t.ownerDocument)||document}function dv(t,e){if(null==e)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return null!=n.target&&e.contains(n.target)}function hv(t){return"composedPath"in t?t.composedPath()[0]:t.target}const uv="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";const pv=Math.min,fv=Math.max,mv=Math.round,gv=Math.floor,yv=t=>({x:t,y:t}),bv={left:"right",right:"left",bottom:"top",top:"bottom"},wv={start:"end",end:"start"};function vv(t,e,n){return fv(t,pv(e,n))}function kv(t,e){return"function"==typeof t?t(e):t}function xv(t){return t.split("-")[0]}function Cv(t){return t.split("-")[1]}function Sv(t){return"x"===t?"y":"x"}function Mv(t){return"y"===t?"height":"width"}function Ev(t){return["top","bottom"].includes(xv(t))?"y":"x"}function Tv(t){return Sv(Ev(t))}function Ov(t){return t.replace(/start|end/g,(t=>wv[t]))}function Av(t){return t.replace(/left|right|bottom|top/g,(t=>bv[t]))}function Nv(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}function _v(t){const{x:e,y:n,width:o,height:r}=t;return{width:o,height:r,top:n,left:e,right:e+o,bottom:n+r,x:e,y:n}}function Lv(t,e,n){let{reference:o,floating:r}=t;const i=Ev(e),s=Tv(e),l=Mv(s),a=xv(e),c="y"===i,d=o.x+o.width/2-r.width/2,h=o.y+o.height/2-r.height/2,u=o[l]/2-r[l]/2;let p;switch(a){case"top":p={x:d,y:o.y-r.height};break;case"bottom":p={x:d,y:o.y+o.height};break;case"right":p={x:o.x+o.width,y:h};break;case"left":p={x:o.x-r.width,y:h};break;default:p={x:o.x,y:o.y}}switch(Cv(e)){case"start":p[s]-=u*(n&&c?-1:1);break;case"end":p[s]+=u*(n&&c?-1:1)}return p}async function Dv(t,e){var n;void 0===e&&(e={});const{x:o,y:r,platform:i,rects:s,elements:l,strategy:a}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:p=0}=kv(e,t),f=Nv(p),m=l[u?"floating"===h?"reference":"floating":h],g=_v(await i.getClippingRect({element:null==(n=await(null==i.isElement?void 0:i.isElement(m)))||n?m:m.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(l.floating)),boundary:c,rootBoundary:d,strategy:a})),y="floating"===h?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,b=await(null==i.getOffsetParent?void 0:i.getOffsetParent(l.floating)),w=await(null==i.isElement?void 0:i.isElement(b))&&await(null==i.getScale?void 0:i.getScale(b))||{x:1,y:1},v=_v(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:y,offsetParent:b,strategy:a}):y);return{top:(g.top-v.top+f.top)/w.y,bottom:(v.bottom-g.bottom+f.bottom)/w.y,left:(g.left-v.left+f.left)/w.x,right:(v.right-g.right+f.right)/w.x}}function Rv(t){const e=pv(...t.map((t=>t.left))),n=pv(...t.map((t=>t.top)));return{x:e,y:n,width:fv(...t.map((t=>t.right)))-e,height:fv(...t.map((t=>t.bottom)))-n}}function Iv(t){const e=Gw(t);let n=parseFloat(e.width)||0,o=parseFloat(e.height)||0;const r=Fw(t),i=r?t.offsetWidth:n,s=r?t.offsetHeight:o,l=mv(n)!==i||mv(o)!==s;return l&&(n=i,o=s),{width:n,height:o,$:l}}function Pv(t){return zw(t)?t:t.contextElement}function Hv(t){const e=Pv(t);if(!Fw(e))return yv(1);const n=e.getBoundingClientRect(),{width:o,height:r,$:i}=Iv(e);let s=(i?mv(n.width):n.width)/o,l=(i?mv(n.height):n.height)/r;return s&&Number.isFinite(s)||(s=1),l&&Number.isFinite(l)||(l=1),{x:s,y:l}}const Vv=yv(0);function Bv(t){const e=Vw(t);return Kw()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:Vv}function jv(t,e,n,o){void 0===e&&(e=!1),void 0===n&&(n=!1);const r=t.getBoundingClientRect(),i=Pv(t);let s=yv(1);e&&(o?zw(o)&&(s=Hv(o)):s=Hv(t));const l=function(t,e,n){return void 0===e&&(e=!1),!(!n||e&&n!==Vw(t))&&e}(i,n,o)?Bv(i):yv(0);let a=(r.left+l.x)/s.x,c=(r.top+l.y)/s.y,d=r.width/s.x,h=r.height/s.y;if(i){const t=Vw(i),e=o&&zw(o)?Vw(o):o;let n=t,r=ev(n);for(;r&&o&&e!==n;){const t=Hv(r),e=r.getBoundingClientRect(),o=Gw(r),i=e.left+(r.clientLeft+parseFloat(o.paddingLeft))*t.x,s=e.top+(r.clientTop+parseFloat(o.paddingTop))*t.y;a*=t.x,c*=t.y,d*=t.x,h*=t.y,a+=i,c+=s,n=Vw(r),r=ev(n)}}return _v({width:d,height:h,x:a,y:c})}function zv(t){return jv(Bw(t)).left+Xw(t).scrollLeft}function Fv(t,e,n){let o;if("viewport"===e)o=function(t,e){const n=Vw(t),o=Bw(t),r=n.visualViewport;let i=o.clientWidth,s=o.clientHeight,l=0,a=0;if(r){i=r.width,s=r.height;const t=Kw();(!t||t&&"fixed"===e)&&(l=r.offsetLeft,a=r.offsetTop)}return{width:i,height:s,x:l,y:a}}(t,n);else if("document"===e)o=function(t){const e=Bw(t),n=Xw(t),o=t.ownerDocument.body,r=fv(e.scrollWidth,e.clientWidth,o.scrollWidth,o.clientWidth),i=fv(e.scrollHeight,e.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+zv(t);const l=-n.scrollTop;return"rtl"===Gw(o).direction&&(s+=fv(e.clientWidth,o.clientWidth)-r),{width:r,height:i,x:s,y:l}}(Bw(t));else if(zw(e))o=function(t,e){const n=jv(t,!0,"fixed"===e),o=n.top+t.clientTop,r=n.left+t.clientLeft,i=Fw(t)?Hv(t):yv(1);return{width:t.clientWidth*i.x,height:t.clientHeight*i.y,x:r*i.x,y:o*i.y}}(e,n);else{const n=Bv(t);o={...e,x:e.x-n.x,y:e.y-n.y}}return _v(o)}function $v(t,e){const n=Yw(t);return!(n===e||!zw(n)||Zw(n))&&("fixed"===Gw(n).position||$v(n,e))}function Uv(t,e,n){const o=Fw(e),r=Bw(e),i="fixed"===n,s=jv(t,!0,i,e);let l={scrollLeft:0,scrollTop:0};const a=yv(0);if(o||!o&&!i)if(("body"!==Hw(e)||Uw(r))&&(l=Xw(e)),o){const t=jv(e,!0,i,e);a.x=t.x+e.clientLeft,a.y=t.y+e.clientTop}else r&&(a.x=zv(r));return{x:s.left+l.scrollLeft-a.x,y:s.top+l.scrollTop-a.y,width:s.width,height:s.height}}function Wv(t){return"static"===Gw(t).position}function qv(t,e){return Fw(t)&&"fixed"!==Gw(t).position?e?e(t):t.offsetParent:null}function Jv(t,e){const n=Vw(t);if(qw(t))return n;if(!Fw(t)){let e=Yw(t);for(;e&&!Zw(e);){if(zw(e)&&!Wv(e))return e;e=Yw(e)}return n}let o=qv(t,e);for(;o&&Ww(o)&&Wv(o);)o=qv(o,e);return o&&Zw(o)&&Wv(o)&&!Jw(o)?n:o||function(t){let e=Yw(t);for(;Fw(e)&&!Zw(e);){if(Jw(e))return e;if(qw(e))return null;e=Yw(e)}return null}(t)||n}const Kv={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:n,offsetParent:o,strategy:r}=t;const i="fixed"===r,s=Bw(o),l=!!e&&qw(e.floating);if(o===s||l&&i)return n;let a={scrollLeft:0,scrollTop:0},c=yv(1);const d=yv(0),h=Fw(o);if((h||!h&&!i)&&(("body"!==Hw(o)||Uw(s))&&(a=Xw(o)),Fw(o))){const t=jv(o);c=Hv(o),d.x=t.x+o.clientLeft,d.y=t.y+o.clientTop}return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-a.scrollLeft*c.x+d.x,y:n.y*c.y-a.scrollTop*c.y+d.y}},getDocumentElement:Bw,getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:o,strategy:r}=t;const i="clippingAncestors"===n?qw(e)?[]:function(t,e){const n=e.get(t);if(n)return n;let o=tv(t,[],!1).filter((t=>zw(t)&&"body"!==Hw(t))),r=null;const i="fixed"===Gw(t).position;let s=i?Yw(t):t;for(;zw(s)&&!Zw(s);){const e=Gw(s),n=Jw(s);n||"fixed"!==e.position||(r=null),(i?!n&&!r:!n&&"static"===e.position&&r&&["absolute","fixed"].includes(r.position)||Uw(s)&&!n&&$v(t,s))?o=o.filter((t=>t!==s)):r=e,s=Yw(s)}return e.set(t,o),o}(e,this._c):[].concat(n),s=[...i,o],l=s[0],a=s.reduce(((t,n)=>{const o=Fv(e,n,r);return t.top=fv(o.top,t.top),t.right=pv(o.right,t.right),t.bottom=pv(o.bottom,t.bottom),t.left=fv(o.left,t.left),t}),Fv(e,l,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:Jv,getElementRects:async function(t){const e=this.getOffsetParent||Jv,n=this.getDimensions,o=await n(t.floating);return{reference:Uv(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:n}=Iv(t);return{width:e,height:n}},getScale:Hv,isElement:zw,isRTL:function(t){return"rtl"===Gw(t).direction}};function Zv(t,e,n,o){void 0===o&&(o={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:s="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:a=!1}=o,c=Pv(t),d=r||i?[...c?tv(c):[],...tv(e)]:[];d.forEach((t=>{r&&t.addEventListener("scroll",n,{passive:!0}),i&&t.addEventListener("resize",n)}));const h=c&&l?function(t,e){let n,o=null;const r=Bw(t);function i(){var t;clearTimeout(n),null==(t=o)||t.disconnect(),o=null}return function s(l,a){void 0===l&&(l=!1),void 0===a&&(a=1),i();const{left:c,top:d,width:h,height:u}=t.getBoundingClientRect();if(l||e(),!h||!u)return;const p={rootMargin:-gv(d)+"px "+-gv(r.clientWidth-(c+h))+"px "+-gv(r.clientHeight-(d+u))+"px "+-gv(c)+"px",threshold:fv(0,pv(1,a))||1};let f=!0;function m(t){const e=t[0].intersectionRatio;if(e!==a){if(!f)return s();e?s(!1,e):n=setTimeout((()=>{s(!1,1e-7)}),1e3)}f=!1}try{o=new IntersectionObserver(m,{...p,root:r.ownerDocument})}catch(eM){o=new IntersectionObserver(m,p)}o.observe(t)}(!0),i}(c,n):null;let u,p=-1,f=null;s&&(f=new ResizeObserver((t=>{let[o]=t;o&&o.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame((()=>{var t;null==(t=f)||t.observe(e)}))),n()})),c&&!a&&f.observe(c),f.observe(e));let m=a?jv(t):null;return a&&function e(){const o=jv(t);!m||o.x===m.x&&o.y===m.y&&o.width===m.width&&o.height===m.height||n();m=o,u=requestAnimationFrame(e)}(),n(),()=>{var t;d.forEach((t=>{r&&t.removeEventListener("scroll",n),i&&t.removeEventListener("resize",n)})),null==h||h(),null==(t=f)||t.disconnect(),f=null,a&&cancelAnimationFrame(u)}}const Gv=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){var n,o;const{x:r,y:i,placement:s,middlewareData:l}=e,a=await async function(t,e){const{placement:n,platform:o,elements:r}=t,i=await(null==o.isRTL?void 0:o.isRTL(r.floating)),s=xv(n),l=Cv(n),a="y"===Ev(n),c=["left","top"].includes(s)?-1:1,d=i&&a?-1:1,h=kv(e,t);let{mainAxis:u,crossAxis:p,alignmentAxis:f}="number"==typeof h?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...h};return l&&"number"==typeof f&&(p="end"===l?-1*f:f),a?{x:p*d,y:u*c}:{x:u*c,y:p*d}}(e,t);return s===(null==(n=l.offset)?void 0:n.placement)&&null!=(o=l.arrow)&&o.alignmentOffset?{}:{x:r+a.x,y:i+a.y,data:{...a,placement:s}}}}},Xv=function(t){return void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:o,placement:r}=e,{mainAxis:i=!0,crossAxis:s=!1,limiter:l={fn:t=>{let{x:e,y:n}=t;return{x:e,y:n}}},...a}=kv(t,e),c={x:n,y:o},d=await Dv(e,a),h=Ev(xv(r)),u=Sv(h);let p=c[u],f=c[h];if(i){const t="y"===u?"bottom":"right";p=vv(p+d["y"===u?"top":"left"],p,p-d[t])}if(s){const t="y"===h?"bottom":"right";f=vv(f+d["y"===h?"top":"left"],f,f-d[t])}const m=l.fn({...e,[u]:p,[h]:f});return{...m,data:{x:m.x-n,y:m.y-o}}}}},Yv=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(e){var n,o;const{placement:r,middlewareData:i,rects:s,initialPlacement:l,platform:a,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:u,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:m=!0,...g}=kv(t,e);if(null!=(n=i.arrow)&&n.alignmentOffset)return{};const y=xv(r),b=Ev(l),w=xv(l)===l,v=await(null==a.isRTL?void 0:a.isRTL(c.floating)),k=u||(w||!m?[Av(l)]:function(t){const e=Av(t);return[Ov(t),e,Ov(e)]}(l)),x="none"!==f;!u&&x&&k.push(...function(t,e,n,o){const r=Cv(t);let i=function(t,e,n){const o=["left","right"],r=["right","left"],i=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:o:e?o:r;case"left":case"right":return e?i:s;default:return[]}}(xv(t),"start"===n,o);return r&&(i=i.map((t=>t+"-"+r)),e&&(i=i.concat(i.map(Ov)))),i}(l,m,f,v));const C=[l,...k],S=await Dv(e,g),M=[];let E=(null==(o=i.flip)?void 0:o.overflows)||[];if(d&&M.push(S[y]),h){const t=function(t,e,n){void 0===n&&(n=!1);const o=Cv(t),r=Tv(t),i=Mv(r);let s="x"===r?o===(n?"end":"start")?"right":"left":"start"===o?"bottom":"top";return e.reference[i]>e.floating[i]&&(s=Av(s)),[s,Av(s)]}(r,s,v);M.push(S[t[0]],S[t[1]])}if(E=[...E,{placement:r,overflows:M}],!M.every((t=>t<=0))){var T,O;const t=((null==(T=i.flip)?void 0:T.index)||0)+1,e=C[t];if(e)return{data:{index:t,overflows:E},reset:{placement:e}};let n=null==(O=E.filter((t=>t.overflows[0]<=0)).sort(((t,e)=>t.overflows[1]-e.overflows[1]))[0])?void 0:O.placement;if(!n)switch(p){case"bestFit":{var A;const t=null==(A=E.filter((t=>{if(x){const e=Ev(t.placement);return e===b||"y"===e}return!0})).map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,e)=>t+e),0)])).sort(((t,e)=>t[1]-e[1]))[0])?void 0:A[0];t&&(n=t);break}case"initialPlacement":n=l}if(r!==n)return{reset:{placement:n}}}return{}}}},Qv=function(t){return void 0===t&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:o,platform:r,elements:i}=e,{apply:s=(()=>{}),...l}=kv(t,e),a=await Dv(e,l),c=xv(n),d=Cv(n),h="y"===Ev(n),{width:u,height:p}=o.floating;let f,m;"top"===c||"bottom"===c?(f=c,m=d===(await(null==r.isRTL?void 0:r.isRTL(i.floating))?"start":"end")?"left":"right"):(m=c,f="end"===d?"top":"bottom");const g=p-a.top-a.bottom,y=u-a.left-a.right,b=pv(p-a[f],g),w=pv(u-a[m],y),v=!e.middlewareData.shift;let k=b,x=w;if(h?x=d||v?pv(w,y):y:k=d||v?pv(b,g):g,v&&!d){const t=fv(a.left,0),e=fv(a.right,0),n=fv(a.top,0),o=fv(a.bottom,0);h?x=u-2*(0!==t||0!==e?t+e:fv(a.left,a.right)):k=p-2*(0!==n||0!==o?n+o:fv(a.top,a.bottom))}await s({...e,availableWidth:x,availableHeight:k});const C=await r.getDimensions(i.floating);return u!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}},tk=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:o,placement:r,rects:i,platform:s,elements:l,middlewareData:a}=e,{element:c,padding:d=0}=kv(t,e)||{};if(null==c)return{};const h=Nv(d),u={x:n,y:o},p=Tv(r),f=Mv(p),m=await s.getDimensions(c),g="y"===p,y=g?"top":"left",b=g?"bottom":"right",w=g?"clientHeight":"clientWidth",v=i.reference[f]+i.reference[p]-u[p]-i.floating[f],k=u[p]-i.reference[p],x=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c));let C=x?x[w]:0;C&&await(null==s.isElement?void 0:s.isElement(x))||(C=l.floating[w]||i.floating[f]);const S=v/2-k/2,M=C/2-m[f]/2-1,E=pv(h[y],M),T=pv(h[b],M),O=E,A=C-m[f]-T,N=C/2-m[f]/2+S,_=vv(O,N,A),L=!a.arrow&&null!=Cv(r)&&N!==_&&i.reference[f]/2-(N<O?E:T)-m[f]/2<0,D=L?N<O?N-O:N-A:0;return{[p]:u[p]+D,data:{[p]:_,centerOffset:N-_-D,...L&&{alignmentOffset:D}},reset:L}}}),ek=function(t){return void 0===t&&(t={}),{name:"inline",options:t,async fn(e){const{placement:n,elements:o,rects:r,platform:i,strategy:s}=e,{padding:l=2,x:a,y:c}=kv(t,e),d=Array.from(await(null==i.getClientRects?void 0:i.getClientRects(o.reference))||[]),h=function(t){const e=t.slice().sort(((t,e)=>t.y-e.y)),n=[];let o=null;for(let r=0;r<e.length;r++){const t=e[r];!o||t.y-o.y>o.height/2?n.push([t]):n[n.length-1].push(t),o=t}return n.map((t=>_v(Rv(t))))}(d),u=_v(Rv(d)),p=Nv(l);const f=await i.getElementRects({reference:{getBoundingClientRect:function(){if(2===h.length&&h[0].left>h[1].right&&null!=a&&null!=c)return h.find((t=>a>t.left-p.left&&a<t.right+p.right&&c>t.top-p.top&&c<t.bottom+p.bottom))||u;if(h.length>=2){if("y"===Ev(n)){const t=h[0],e=h[h.length-1],o="top"===xv(n),r=t.top,i=e.bottom,s=o?t.left:e.left,l=o?t.right:e.right;return{top:r,bottom:i,left:s,right:l,width:l-s,height:i-r,x:s,y:r}}const t="left"===xv(n),e=fv(...h.map((t=>t.right))),o=pv(...h.map((t=>t.left))),r=h.filter((n=>t?n.left===o:n.right===e)),i=r[0].top,s=r[r.length-1].bottom;return{top:i,bottom:s,left:o,right:e,width:e-o,height:s-i,x:o,y:i}}return u}},floating:o.floating,strategy:s});return r.reference.x!==f.reference.x||r.reference.y!==f.reference.y||r.reference.width!==f.reference.width||r.reference.height!==f.reference.height?{reset:{rects:f}}:{}}}},nk=function(t){return void 0===t&&(t={}),{options:t,fn(e){const{x:n,y:o,placement:r,rects:i,middlewareData:s}=e,{offset:l=0,mainAxis:a=!0,crossAxis:c=!0}=kv(t,e),d={x:n,y:o},h=Ev(r),u=Sv(h);let p=d[u],f=d[h];const m=kv(l,e),g="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(a){const t="y"===u?"height":"width",e=i.reference[u]-i.floating[t]+g.mainAxis,n=i.reference[u]+i.reference[t]-g.mainAxis;p<e?p=e:p>n&&(p=n)}if(c){var y,b;const t="y"===u?"width":"height",e=["top","left"].includes(xv(r)),n=i.reference[h]-i.floating[t]+(e&&(null==(y=s.offset)?void 0:y[h])||0)+(e?0:g.crossAxis),o=i.reference[h]+i.reference[t]+(e?0:(null==(b=s.offset)?void 0:b[h])||0)-(e?g.crossAxis:0);f<n?f=n:f>o&&(f=o)}return{[u]:p,[h]:f}}}},ok=(t,e,n)=>{const o=new Map,r={platform:Kv,...n},i={...r.platform,_c:o};return(async(t,e,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s}=n,l=i.filter(Boolean),a=await(null==s.isRTL?void 0:s.isRTL(e));let c=await s.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:h}=Lv(c,o,a),u=o,p={},f=0;for(let m=0;m<l.length;m++){const{name:n,fn:i}=l[m],{x:g,y:y,data:b,reset:w}=await i({x:d,y:h,initialPlacement:o,placement:u,strategy:r,middlewareData:p,rects:c,platform:s,elements:{reference:t,floating:e}});d=null!=g?g:d,h=null!=y?y:h,p={...p,[n]:{...p[n],...b}},w&&f<=50&&(f++,"object"==typeof w&&(w.placement&&(u=w.placement),w.rects&&(c=!0===w.rects?await s.getElementRects({reference:t,floating:e,strategy:r}):w.rects),({x:d,y:h}=Lv(c,u,a))),m=-1)}return{x:d,y:h,placement:u,strategy:r,middlewareData:p}})(t,e,{...r,platform:i})};var rk="undefined"!=typeof document?e.useLayoutEffect:e.useEffect;function ik(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if("function"==typeof t&&t.toString()===e.toString())return!0;let n,o,r;if(t&&e&&"object"==typeof t){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(o=n;0!=o--;)if(!ik(t[o],e[o]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(o=n;0!=o--;)if(!{}.hasOwnProperty.call(e,r[o]))return!1;for(o=n;0!=o--;){const n=r[o];if(("_owner"!==n||!t.$$typeof)&&!ik(t[n],e[n]))return!1}return!0}return t!=t&&e!=e}function sk(t){if("undefined"==typeof window)return 1;return(t.ownerDocument.defaultView||window).devicePixelRatio||1}function lk(t,e){const n=sk(t);return Math.round(e*n)/n}function ak(t){const n=e.useRef(t);return rk((()=>{n.current=t})),n}const ck=t=>({name:"arrow",options:t,fn(e){const{element:n,padding:o}="function"==typeof t?t(e):t;return n&&function(t){return{}.hasOwnProperty.call(t,"current")}(n)?null!=n.current?tk({element:n.current,padding:o}).fn(e):{}:n?tk({element:n,padding:o}).fn(e):{}}}),dk=(t,e)=>({...Gv(t),options:[t,e]}),hk=(t,e)=>({...Xv(t),options:[t,e]}),uk=(t,e)=>({...nk(t),options:[t,e]}),pk=(t,e)=>({...Yv(t),options:[t,e]}),fk=(t,e)=>({...Qv(t),options:[t,e]}),mk=(t,e)=>({...ek(t),options:[t,e]}),gk=(t,e)=>({...ck(t),options:[t,e]}),yk={...o},bk=yk.useInsertionEffect||(t=>t());function wk(t){const n=e.useRef((()=>{}));return bk((()=>{n.current=t})),e.useCallback((function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];return null==n.current?void 0:n.current(...e)}),[])}var vk="undefined"!=typeof document?e.useLayoutEffect:e.useEffect;let kk=!1,xk=0;const Ck=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+xk++;const Sk=yk.useId||function(){const[t,n]=e.useState((()=>kk?Ck():void 0));return vk((()=>{null==t&&n(Ck())}),[]),e.useEffect((()=>{kk=!0}),[]),t};const Mk=e.createContext(null),Ek=e.createContext(null),Tk=()=>{var t;return(null==(t=e.useContext(Mk))?void 0:t.id)||null},Ok=()=>e.useContext(Ek);function Ak(t){return"data-floating-ui-"+t}function Nk(t){const n=e.useRef(t);return vk((()=>{n.current=t})),n}const _k=Ak("safe-polygon");function Lk(t,e,n){return n&&!av(n)?0:"number"==typeof t?t:null==t?void 0:t[e]}function Dk(t,n){void 0===n&&(n={});const{open:o,onOpenChange:r,dataRef:i,events:s,elements:l}=t,{enabled:a=!0,delay:c=0,handleClose:d=null,mouseOnly:h=!1,restMs:u=0,move:p=!0}=n,f=Ok(),m=Tk(),g=Nk(d),y=Nk(c),b=Nk(o),w=e.useRef(),v=e.useRef(-1),k=e.useRef(),x=e.useRef(-1),C=e.useRef(!0),S=e.useRef(!1),M=e.useRef((()=>{})),E=e.useCallback((()=>{var t;const e=null==(t=i.current.openEvent)?void 0:t.type;return(null==e?void 0:e.includes("mouse"))&&"mousedown"!==e}),[i]);e.useEffect((()=>{if(a)return s.on("openchange",t),()=>{s.off("openchange",t)};function t(t){let{open:e}=t;e||(clearTimeout(v.current),clearTimeout(x.current),C.current=!0)}}),[a,s]),e.useEffect((()=>{if(!a)return;if(!g.current)return;if(!o)return;function t(t){E()&&r(!1,t,"hover")}const e=cv(l.floating).documentElement;return e.addEventListener("mouseleave",t),()=>{e.removeEventListener("mouseleave",t)}}),[l.floating,o,r,a,g,E]);const T=e.useCallback((function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n="hover");const o=Lk(y.current,"close",w.current);o&&!k.current?(clearTimeout(v.current),v.current=window.setTimeout((()=>r(!1,t,n)),o)):e&&(clearTimeout(v.current),r(!1,t,n))}),[y,r]),O=wk((()=>{M.current(),k.current=void 0})),A=wk((()=>{if(S.current){const t=cv(l.floating).body;t.style.pointerEvents="",t.removeAttribute(_k),S.current=!1}}));e.useEffect((()=>{if(a&&zw(l.domReference)){var t;const e=l.domReference;return o&&e.addEventListener("mouseleave",c),null==(t=l.floating)||t.addEventListener("mouseleave",c),p&&e.addEventListener("mousemove",n,{once:!0}),e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",s),()=>{var t;o&&e.removeEventListener("mouseleave",c),null==(t=l.floating)||t.removeEventListener("mouseleave",c),p&&e.removeEventListener("mousemove",n),e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",s)}}function e(){return!!i.current.openEvent&&["click","mousedown"].includes(i.current.openEvent.type)}function n(t){if(clearTimeout(v.current),C.current=!1,h&&!av(w.current)||u>0&&!Lk(y.current,"open"))return;const e=Lk(y.current,"open",w.current);e?v.current=window.setTimeout((()=>{b.current||r(!0,t,"hover")}),e):r(!0,t,"hover")}function s(t){if(e())return;M.current();const n=cv(l.floating);if(clearTimeout(x.current),g.current&&i.current.floatingContext){o||clearTimeout(v.current),k.current=g.current({...i.current.floatingContext,tree:f,x:t.clientX,y:t.clientY,onClose(){A(),O(),T(t,!0,"safe-polygon")}});const e=k.current;return n.addEventListener("mousemove",e),void(M.current=()=>{n.removeEventListener("mousemove",e)})}("touch"!==w.current||!ov(l.floating,t.relatedTarget))&&T(t)}function c(t){e()||i.current.floatingContext&&(null==g.current||g.current({...i.current.floatingContext,tree:f,x:t.clientX,y:t.clientY,onClose(){A(),O(),T(t)}})(t))}}),[l,a,t,h,u,p,T,O,A,r,o,b,f,y,g,i]),vk((()=>{var t;if(a&&o&&null!=(t=g.current)&&t.__options.blockPointerEvents&&E()){S.current=!0;const t=l.floating;if(zw(l.domReference)&&t){var e;const n=cv(l.floating).body;n.setAttribute(_k,"");const o=l.domReference,r=null==f||null==(e=f.nodesRef.current.find((t=>t.id===m)))||null==(e=e.context)?void 0:e.elements.floating;return r&&(r.style.pointerEvents=""),n.style.pointerEvents="none",o.style.pointerEvents="auto",t.style.pointerEvents="auto",()=>{n.style.pointerEvents="",o.style.pointerEvents="",t.style.pointerEvents=""}}}}),[a,o,m,l,f,g,E]),vk((()=>{o||(w.current=void 0,O(),A())}),[o,O,A]),e.useEffect((()=>()=>{O(),clearTimeout(v.current),clearTimeout(x.current),A()}),[a,l.domReference,O,A]);const N=e.useMemo((()=>{function t(t){w.current=t.pointerType}return{onPointerDown:t,onPointerEnter:t,onMouseMove(t){const{nativeEvent:e}=t;function n(){C.current||b.current||r(!0,e,"hover")}h&&!av(w.current)||o||0===u||(clearTimeout(x.current),"touch"===w.current?n():x.current=window.setTimeout(n,u))}}}),[h,r,o,b,u]),_=e.useMemo((()=>({onMouseEnter(){clearTimeout(v.current)},onMouseLeave(t){T(t.nativeEvent,!1)}})),[T]);return e.useMemo((()=>a?{reference:N,floating:_}:{}),[a,N,_])}const Rk=()=>{},Ik=e.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:Rk,setState:Rk,isInstantPhase:!1}),Pk=()=>e.useContext(Ik);function Hk(t){const{children:n,delay:o,timeoutMs:r=0}=t,[i,s]=e.useReducer(((t,e)=>({...t,...e})),{delay:o,timeoutMs:r,initialDelay:o,currentId:null,isInstantPhase:!1}),l=e.useRef(null),a=e.useCallback((t=>{s({currentId:t})}),[]);return vk((()=>{i.currentId?null===l.current?l.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),l.current=null)}),[i.currentId,i.isInstantPhase]),e.createElement(Ik.Provider,{value:e.useMemo((()=>({...i,setState:s,setCurrentId:a})),[i,a])},n)}function Vk(t,e){void 0===e&&(e={});const{open:n,onOpenChange:o,floatingId:r}=t,{id:i}=e,s=null!=i?i:r,l=Pk(),{currentId:a,setCurrentId:c,initialDelay:d,setState:h,timeoutMs:u}=l;return vk((()=>{a&&(h({delay:{open:1,close:Lk(d,"close")}}),a!==s&&o(!1))}),[s,o,h,a,d]),vk((()=>{function t(){o(!1),h({delay:d,currentId:null})}if(a&&!n&&a===s){if(u){const e=window.setTimeout(t,u);return()=>{clearTimeout(e)}}t()}}),[n,h,a,s,o,d,u]),vk((()=>{c!==Rk&&n&&c(s)}),[n,c,s]),l}function Bk(t,e){let n=t.filter((t=>{var n;return t.parentId===e&&(null==(n=t.context)?void 0:n.open)})),o=n;for(;o.length;)o=t.filter((t=>{var e;return null==(e=o)?void 0:e.some((e=>{var n;return t.parentId===e.id&&(null==(n=t.context)?void 0:n.open)}))})),n=n.concat(o);return n}const jk="data-floating-ui-focusable",zk={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},Fk={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},$k=t=>{var e,n;return{escapeKey:"boolean"==typeof t?t:null!=(e=null==t?void 0:t.escapeKey)&&e,outsidePress:"boolean"==typeof t?t:null==(n=null==t?void 0:t.outsidePress)||n}};function Uk(t,n){void 0===n&&(n={});const{open:o,onOpenChange:r,elements:i,dataRef:s}=t,{enabled:l=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:d="pointerdown",referencePress:h=!1,referencePressEvent:u="pointerdown",ancestorScroll:p=!1,bubbles:f,capture:m}=n,g=Ok(),y=wk("function"==typeof c?c:()=>!1),b="function"==typeof c?y:c,w=e.useRef(!1),v=e.useRef(!1),{escapeKey:k,outsidePress:x}=$k(f),{escapeKey:C,outsidePress:S}=$k(m),M=wk((t=>{var e;if(!o||!l||!a||"Escape"!==t.key)return;const n=null==(e=s.current.floatingContext)?void 0:e.nodeId,i=g?Bk(g.nodesRef.current,n):[];if(!k&&(t.stopPropagation(),i.length>0)){let t=!0;if(i.forEach((e=>{var n;null==(n=e.context)||!n.open||e.context.dataRef.current.__escapeKeyBubbles||(t=!1)})),!t)return}r(!1,function(t){return"nativeEvent"in t}(t)?t.nativeEvent:t,"escape-key")})),E=wk((t=>{var e;const n=()=>{var e;M(t),null==(e=hv(t))||e.removeEventListener("keydown",n)};null==(e=hv(t))||e.addEventListener("keydown",n)})),T=wk((t=>{var e;const n=w.current;w.current=!1;const o=v.current;if(v.current=!1,"click"===d&&o)return;if(n)return;if("function"==typeof b&&!b(t))return;const l=hv(t),a="["+Ak("inert")+"]",c=cv(i.floating).querySelectorAll(a);let h=zw(l)?l:null;for(;h&&!Zw(h);){const t=Yw(h);if(Zw(t)||!zw(t))break;h=t}if(c.length&&zw(l)&&!l.matches("html,body")&&!ov(l,i.floating)&&Array.from(c).every((t=>!ov(h,t))))return;if(Fw(l)&&N){const e=l.clientWidth>0&&l.scrollWidth>l.clientWidth,n=l.clientHeight>0&&l.scrollHeight>l.clientHeight;let o=n&&t.offsetX>l.clientWidth;if(n){"rtl"===Gw(l).direction&&(o=t.offsetX<=l.offsetWidth-l.clientWidth)}if(o||e&&t.offsetY>l.clientHeight)return}const u=null==(e=s.current.floatingContext)?void 0:e.nodeId,p=g&&Bk(g.nodesRef.current,u).some((e=>{var n;return dv(t,null==(n=e.context)?void 0:n.elements.floating)}));if(dv(t,i.floating)||dv(t,i.domReference)||p)return;const f=g?Bk(g.nodesRef.current,u):[];if(f.length>0){let t=!0;if(f.forEach((e=>{var n;null==(n=e.context)||!n.open||e.context.dataRef.current.__outsidePressBubbles||(t=!1)})),!t)return}r(!1,t,"outside-press")})),O=wk((t=>{var e;const n=()=>{var e;T(t),null==(e=hv(t))||e.removeEventListener(d,n)};null==(e=hv(t))||e.addEventListener(d,n)}));e.useEffect((()=>{if(!o||!l)return;function t(t){r(!1,t,"ancestor-scroll")}s.current.__escapeKeyBubbles=k,s.current.__outsidePressBubbles=x;const e=cv(i.floating);a&&e.addEventListener("keydown",C?E:M,C),b&&e.addEventListener(d,S?O:T,S);let n=[];return p&&(zw(i.domReference)&&(n=tv(i.domReference)),zw(i.floating)&&(n=n.concat(tv(i.floating))),!zw(i.reference)&&i.reference&&i.reference.contextElement&&(n=n.concat(tv(i.reference.contextElement)))),n=n.filter((t=>{var n;return t!==(null==(n=e.defaultView)?void 0:n.visualViewport)})),n.forEach((e=>{e.addEventListener("scroll",t,{passive:!0})})),()=>{a&&e.removeEventListener("keydown",C?E:M,C),b&&e.removeEventListener(d,S?O:T,S),n.forEach((e=>{e.removeEventListener("scroll",t)}))}}),[s,i,a,b,d,o,r,p,l,k,x,M,C,E,T,S,O]),e.useEffect((()=>{w.current=!1}),[b,d]);const A=e.useMemo((()=>({onKeyDown:M,[zk[u]]:t=>{h&&r(!1,t.nativeEvent,"reference-press")}})),[M,r,h,u]),N=e.useMemo((()=>({onKeyDown:M,onMouseDown(){v.current=!0},onMouseUp(){v.current=!0},[Fk[d]]:()=>{w.current=!0}})),[M,d]);return e.useMemo((()=>l?{reference:A,floating:N}:{}),[l,A,N])}function Wk(t){const{open:n=!1,onOpenChange:o,elements:r}=t,i=Sk(),s=e.useRef({}),[l]=e.useState((()=>function(){const t=new Map;return{emit(e,n){var o;null==(o=t.get(e))||o.forEach((t=>t(n)))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var o;t.set(e,(null==(o=t.get(e))?void 0:o.filter((t=>t!==n)))||[])}}}())),a=null!=Tk(),[c,d]=e.useState(r.reference),h=wk(((t,e,n)=>{s.current.openEvent=t?e:void 0,l.emit("openchange",{open:t,event:e,reason:n,nested:a}),null==o||o(t,e,n)})),u=e.useMemo((()=>({setPositionReference:d})),[]),p=e.useMemo((()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference})),[c,r.reference,r.floating]);return e.useMemo((()=>({dataRef:s,open:n,onOpenChange:h,elements:p,events:l,floatingId:i,refs:u})),[n,h,p,l,i,u])}function qk(t){void 0===t&&(t={});const{nodeId:o}=t,r=Wk({...t,elements:{reference:null,floating:null,...t.elements}}),i=t.rootContext||r,s=i.elements,[l,a]=e.useState(null),[c,d]=e.useState(null),h=(null==s?void 0:s.reference)||l,u=e.useRef(null),p=Ok();vk((()=>{h&&(u.current=h)}),[h]);const f=function(t){void 0===t&&(t={});const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s,elements:{reference:l,floating:a}={},transform:c=!0,whileElementsMounted:d,open:h}=t,[u,p]=e.useState({x:0,y:0,strategy:r,placement:o,middlewareData:{},isPositioned:!1}),[f,m]=e.useState(i);ik(f,i)||m(i);const[g,y]=e.useState(null),[b,w]=e.useState(null),v=e.useCallback((t=>{t!==S.current&&(S.current=t,y(t))}),[]),k=e.useCallback((t=>{t!==M.current&&(M.current=t,w(t))}),[]),x=l||g,C=a||b,S=e.useRef(null),M=e.useRef(null),E=e.useRef(u),T=null!=d,O=ak(d),A=ak(s),N=e.useCallback((()=>{if(!S.current||!M.current)return;const t={placement:o,strategy:r,middleware:f};A.current&&(t.platform=A.current),ok(S.current,M.current,t).then((t=>{const e={...t,isPositioned:!0};_.current&&!ik(E.current,e)&&(E.current=e,n.flushSync((()=>{p(e)})))}))}),[f,o,r,A]);rk((()=>{!1===h&&E.current.isPositioned&&(E.current.isPositioned=!1,p((t=>({...t,isPositioned:!1}))))}),[h]);const _=e.useRef(!1);rk((()=>(_.current=!0,()=>{_.current=!1})),[]),rk((()=>{if(x&&(S.current=x),C&&(M.current=C),x&&C){if(O.current)return O.current(x,C,N);N()}}),[x,C,N,O,T]);const L=e.useMemo((()=>({reference:S,floating:M,setReference:v,setFloating:k})),[v,k]),D=e.useMemo((()=>({reference:x,floating:C})),[x,C]),R=e.useMemo((()=>{const t={position:r,left:0,top:0};if(!D.floating)return t;const e=lk(D.floating,u.x),n=lk(D.floating,u.y);return c?{...t,transform:"translate("+e+"px, "+n+"px)",...sk(D.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:e,top:n}}),[r,c,D.floating,u.x,u.y]);return e.useMemo((()=>({...u,update:N,refs:L,elements:D,floatingStyles:R})),[u,N,L,D,R])}({...t,elements:{...s,...c&&{reference:c}}}),m=e.useCallback((t=>{const e=zw(t)?{getBoundingClientRect:()=>t.getBoundingClientRect(),contextElement:t}:t;d(e),f.refs.setReference(e)}),[f.refs]),g=e.useCallback((t=>{(zw(t)||null===t)&&(u.current=t,a(t)),(zw(f.refs.reference.current)||null===f.refs.reference.current||null!==t&&!zw(t))&&f.refs.setReference(t)}),[f.refs]),y=e.useMemo((()=>({...f.refs,setReference:g,setPositionReference:m,domReference:u})),[f.refs,g,m]),b=e.useMemo((()=>({...f.elements,domReference:h})),[f.elements,h]),w=e.useMemo((()=>({...f,...i,refs:y,elements:b,nodeId:o})),[f,y,b,o,i]);return vk((()=>{i.dataRef.current.floatingContext=w;const t=null==p?void 0:p.nodesRef.current.find((t=>t.id===o));t&&(t.context=w)})),e.useMemo((()=>({...f,context:w,refs:y,elements:b})),[f,y,b,w])}function Jk(t,n){void 0===n&&(n={});const{open:o,onOpenChange:r,events:i,dataRef:s,elements:l}=t,{enabled:a=!0,visibleOnly:c=!0}=n,d=e.useRef(!1),h=e.useRef(),u=e.useRef(!0);e.useEffect((()=>{if(!a)return;const t=Vw(l.domReference);function e(){!o&&Fw(l.domReference)&&l.domReference===nv(cv(l.domReference))&&(d.current=!0)}function n(){u.current=!0}return t.addEventListener("blur",e),t.addEventListener("keydown",n,!0),()=>{t.removeEventListener("blur",e),t.removeEventListener("keydown",n,!0)}}),[l.domReference,o,a]),e.useEffect((()=>{if(a)return i.on("openchange",t),()=>{i.off("openchange",t)};function t(t){let{reason:e}=t;"reference-press"!==e&&"escape-key"!==e||(d.current=!0)}}),[i,a]),e.useEffect((()=>()=>{clearTimeout(h.current)}),[]);const p=e.useMemo((()=>({onPointerDown(t){sv(t.nativeEvent)||(u.current=!1)},onMouseLeave(){d.current=!1},onFocus(t){if(d.current)return;const e=hv(t.nativeEvent);if(c&&zw(e))try{if(/apple/i.test(navigator.vendor)&&rv().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints)throw Error();if(!e.matches(":focus-visible"))return}catch(eM){if(!u.current&&(!Fw(n=e)||!n.matches(uv)))return}var n;r(!0,t.nativeEvent,"focus")},onBlur(t){d.current=!1;const e=t.relatedTarget,n=t.nativeEvent,o=zw(e)&&e.hasAttribute(Ak("focus-guard"))&&"outside"===e.getAttribute("data-type");h.current=window.setTimeout((()=>{var t;const i=nv(l.domReference?l.domReference.ownerDocument:document);(e||i!==l.domReference)&&(ov(null==(t=s.current.floatingContext)?void 0:t.refs.floating.current,i)||ov(l.domReference,i)||o||r(!1,n,"focus"))}))}})),[s,l.domReference,r,c]);return e.useMemo((()=>a?{reference:p}:{}),[a,p])}const Kk="active",Zk="selected";function Gk(t,e,n){const o=new Map,r="item"===n;let i=t;if(r&&t){const{[Kk]:e,[Zk]:n,...o}=t;i=o}return{..."floating"===n&&{tabIndex:-1,[jk]:""},...i,...e.map((e=>{const o=e?e[n]:null;return"function"==typeof o?t?o(t):null:o})).concat(t).reduce(((t,e)=>e?(Object.entries(e).forEach((e=>{let[n,i]=e;var s;r&&[Kk,Zk].includes(n)||(0===n.indexOf("on")?(o.has(n)||o.set(n,[]),"function"==typeof i&&(null==(s=o.get(n))||s.push(i),t[n]=function(){for(var t,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return null==(t=o.get(n))?void 0:t.map((t=>t(...r))).find((t=>void 0!==t))})):t[n]=i)})),t):t),{})}}function Xk(t){void 0===t&&(t=[]);const n=t.map((t=>null==t?void 0:t.reference)),o=t.map((t=>null==t?void 0:t.floating)),r=t.map((t=>null==t?void 0:t.item)),i=e.useCallback((e=>Gk(e,t,"reference")),n),s=e.useCallback((e=>Gk(e,t,"floating")),o),l=e.useCallback((e=>Gk(e,t,"item")),r);return e.useMemo((()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:l})),[i,s,l])}const Yk=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function Qk(t,n){var o;void 0===n&&(n={});const{open:r,floatingId:i}=t,{enabled:s=!0,role:l="dialog"}=n,a=null!=(o=Yk.get(l))?o:l,c=Sk(),d=null!=Tk(),h=e.useMemo((()=>"tooltip"===a||"label"===l?{["aria-"+("label"===l?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":"alertdialog"===a?"dialog":a,"aria-controls":r?i:void 0,..."listbox"===a&&{role:"combobox"},..."menu"===a&&{id:c},..."menu"===a&&d&&{role:"menuitem"},..."select"===l&&{"aria-autocomplete":"none"},..."combobox"===l&&{"aria-autocomplete":"list"}}),[a,i,d,r,c,l]),u=e.useMemo((()=>{const t={id:i,...a&&{role:a}};return"tooltip"===a||"label"===l?t:{...t,..."menu"===a&&{"aria-labelledby":c}}}),[a,i,c,l]),p=e.useCallback((t=>{let{active:e,selected:n}=t;const o={role:"option",...e&&{id:i+"-option"}};switch(l){case"select":return{...o,"aria-selected":e&&n};case"combobox":return{...o,...e&&{"aria-selected":!0}}}return{}}),[i,l]);return e.useMemo((()=>s?{reference:h,floating:u,item:p}:{}),[s,h,u,p])}const tx=t=>t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,((t,e)=>(e?"-":"")+t.toLowerCase()));function ex(t,e){return"function"==typeof t?t(e):t}function nx(t,n){void 0===n&&(n={});const{open:o,elements:{floating:r}}=t,{duration:i=250}=n,s=("number"==typeof i?i:i.close)||0,[l,a]=e.useState("unmounted"),c=function(t,n){const[o,r]=e.useState(t);return t&&!o&&r(!0),e.useEffect((()=>{if(!t&&o){const t=setTimeout((()=>r(!1)),n);return()=>clearTimeout(t)}}),[t,o,n]),o}(o,s);return c||"close"!==l||a("unmounted"),vk((()=>{if(r){if(o){a("initial");const t=requestAnimationFrame((()=>{a("open")}));return()=>{cancelAnimationFrame(t)}}a("close")}}),[o,r]),{isMounted:c,status:l}}function ox(t,n){void 0===n&&(n={});const{initial:o={opacity:0},open:r,close:i,common:s,duration:l=250}=n,a=t.placement,c=a.split("-")[0],d=e.useMemo((()=>({side:c,placement:a})),[c,a]),h="number"==typeof l,u=(h?l:l.open)||0,p=(h?l:l.close)||0,[f,m]=e.useState((()=>({...ex(s,d),...ex(o,d)}))),{isMounted:g,status:y}=nx(t,{duration:l}),b=Nk(o),w=Nk(r),v=Nk(i),k=Nk(s);return vk((()=>{const t=ex(b.current,d),e=ex(v.current,d),n=ex(k.current,d),o=ex(w.current,d)||Object.keys(t).reduce(((t,e)=>(t[e]="",t)),{});if("initial"===y&&m((e=>({transitionProperty:e.transitionProperty,...n,...t}))),"open"===y&&m({transitionProperty:Object.keys(o).map(tx).join(","),transitionDuration:u+"ms",...n,...o}),"close"===y){const o=e||t;m({transitionProperty:Object.keys(o).map(tx).join(","),transitionDuration:p+"ms",...n,...o})}}),[p,v,b,w,k,u,y,d]),{isMounted:g,styles:f}}var rx,ix={exports:{}},sx={};ix.exports=function(){if(rx)return sx;rx=1;var t=r,e="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},n=t.useState,o=t.useEffect,i=t.useLayoutEffect,s=t.useDebugValue;function l(t){var n=t.getSnapshot;t=t.value;try{var o=n();return!e(t,o)}catch(r){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var r=e(),a=n({inst:{value:r,getSnapshot:e}}),c=a[0].inst,d=a[1];return i((function(){c.value=r,c.getSnapshot=e,l(c)&&d({inst:c})}),[t,r,e]),o((function(){return l(c)&&d({inst:c}),t((function(){l(c)&&d({inst:c})}))}),[t]),s(r),r};return sx.useSyncExternalStore=void 0!==t.useSyncExternalStore?t.useSyncExternalStore:a,sx}();var lx=ix.exports;const ax=(...t)=>e=>{t.forEach((t=>{"function"==typeof t?t(e):t&&(t.current=e)}))},cx=({contentComponent:t})=>{const e=lx.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return r.createElement(r.Fragment,null,Object.values(e))};class dx extends r.Component{constructor(t){var e;super(t),this.editorContentRef=r.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:Boolean(null===(e=t.editor)||void 0===e?void 0:e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const t=this.props.editor;if(t&&!t.isDestroyed&&t.options.element){if(t.contentComponent)return;const e=this.editorContentRef.current;e.append(...t.options.element.childNodes),t.setOptions({element:e}),t.contentComponent=function(){const t=new Set;let e={};return{subscribe:e=>(t.add(e),()=>{t.delete(e)}),getSnapshot:()=>e,getServerSnapshot:()=>e,setRenderer(n,o){e={...e,[n]:i.createPortal(o.reactElement,o.element,n)},t.forEach((t=>t()))},removeRenderer(n){const o={...e};delete o[n],e=o,t.forEach((t=>t()))}}}(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=t.contentComponent.subscribe((()=>{this.setState((t=>t.hasContentComponentInitialized?t:{hasContentComponentInitialized:!0})),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()}))),t.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const t=this.props.editor;if(!t)return;if(this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null,!t.options.element.firstChild)return;const e=document.createElement("div");e.append(...t.options.element.childNodes),t.setOptions({element:e})}render(){const{editor:t,innerRef:e,...n}=this.props;return r.createElement(r.Fragment,null,r.createElement("div",{ref:ax(e,this.editorContentRef),...n}),(null==t?void 0:t.contentComponent)&&r.createElement(cx,{contentComponent:t.contentComponent}))}}const hx=e.forwardRef(((t,e)=>{const n=r.useMemo((()=>Math.floor(4294967295*Math.random()).toString()),[t.editor]);return r.createElement(dx,{key:n,innerRef:e,...t})}));r.memo(hx);var ux,px={};
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */!function(){if(ux)return px;ux=1;var t=r,e=lx,n="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},o=e.useSyncExternalStore,i=t.useRef,s=t.useEffect,l=t.useMemo,a=t.useDebugValue;px.useSyncExternalStoreWithSelector=function(t,e,r,c,d){var h=i(null);if(null===h.current){var u={hasValue:!1,value:null};h.current=u}else u=h.current;h=l((function(){function t(t){if(!s){if(s=!0,o=t,t=c(t),void 0!==d&&u.hasValue){var e=u.value;if(d(e,t))return i=e}return i=t}if(e=i,n(o,t))return e;var r=c(t);return void 0!==d&&d(e,r)?e:(o=t,i=r)}var o,i,s=!1,l=void 0===r?null:r;return[function(){return t(e())},null===l?void 0:function(){return t(l())}]}),[e,r,c,d]);var p=o(t,h[0],h[1]);return s((function(){u.hasValue=!0,u.value=p}),[p]),a(p),p}}();e.createContext({editor:null}).Consumer;const fx=e.createContext({onDragStart:void 0}),mx=()=>e.useContext(fx),gx=t=>{const e=t.as||"div",{nodeViewContentRef:n}=mx();return r.createElement(e,{...t,ref:n,"data-node-view-content":"",style:{whiteSpace:"pre-wrap",...t.style}})},yx=r.forwardRef(((t,e)=>{const{onDragStart:n}=mx(),o=t.as||"div";return r.createElement(o,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})}));class bx{constructor(t,{editor:e,props:o={},as:r="div",className:i="",attrs:s}){this.ref=null,this.id=Math.floor(4294967295*Math.random()).toString(),this.component=t,this.editor=e,this.props=o,this.element=document.createElement(r),this.element.classList.add("react-renderer"),i&&this.element.classList.add(...i.split(" ")),s&&Object.keys(s).forEach((t=>{this.element.setAttribute(t,s[t])})),this.editor.isInitialized?n.flushSync((()=>{this.render()})):this.render()}render(){var t;const e=this.component,n=this.props,o=this.editor;(function(t){return!("function"!=typeof t||!t.prototype||!t.prototype.isReactComponent)}(e)||function(t){var e;return!("object"!=typeof t||"Symbol(react.forward_ref)"!==(null===(e=t.$$typeof)||void 0===e?void 0:e.toString()))}(e))&&(n.ref=t=>{this.ref=t}),this.reactElement=r.createElement(e,n),null===(t=null==o?void 0:o.contentComponent)||void 0===t||t.setRenderer(this.id,this)}updateProps(t={}){this.props={...this.props,...t},this.render()}destroy(){var t;const e=this.editor;null===(t=null==e?void 0:e.contentComponent)||void 0===t||t.removeRenderer(this.id)}}class wx extends Bs{mount(){const t={editor:this.editor,node:this.node,decorations:this.decorations,selected:!1,extension:this.extension,getPos:()=>this.getPos(),updateAttributes:(t={})=>this.updateAttributes(t),deleteNode:()=>this.deleteNode()};if(!this.component.displayName){const t=t=>t.charAt(0).toUpperCase()+t.substring(1);this.component.displayName=t(this.extension.name)}const e={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:t=>{t&&this.contentDOMElement&&t.firstChild!==this.contentDOMElement&&t.appendChild(this.contentDOMElement)}},n=this.component,o=r.memo((t=>r.createElement(fx.Provider,{value:e},r.createElement(n,t))));o.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");let i=this.node.isInline?"span":"div";this.options.as&&(i=this.options.as);const{className:s=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.renderer=new bx(o,{editor:this.editor,props:t,as:i,className:`node-${this.node.type.name} ${s}`.trim(),attrs:this.options.attrs})}get dom(){var t;if(this.renderer.element.firstElementChild&&!(null===(t=this.renderer.element.firstElementChild)||void 0===t?void 0:t.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:t,to:e}=this.editor.state.selection;if(t<=this.getPos()&&e>=this.getPos()+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(t,e){const n=t=>{this.renderer.updateProps(t)};if(t.type!==this.node.type)return!1;if("function"==typeof this.options.update){const o=this.node,r=this.decorations;return this.node=t,this.decorations=e,this.options.update({oldNode:o,oldDecorations:r,newNode:t,newDecorations:e,updateProps:()=>n({node:t,decorations:e})})}return t===this.node&&this.decorations===e||(this.node=t,this.decorations=e,n({node:t,decorations:e})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}}function vx(t,e){return n=>n.editor.contentComponent?new wx(t,n,e):{}}const kx=e.createContext(void 0);function xx(t){return e.useContext(kx)}var Cx,Sx={exports:{}},Mx={};
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Sx.exports=function(){if(Cx)return Mx;Cx=1;var t=r,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(t,n,r){var l,a={},c=null,d=null;for(l in void 0!==r&&(c=""+r),void 0!==n.key&&(c=""+n.key),void 0!==n.ref&&(d=n.ref),n)o.call(n,l)&&!s.hasOwnProperty(l)&&(a[l]=n[l]);if(t&&t.defaultProps)for(l in n=t.defaultProps)void 0===a[l]&&(a[l]=n[l]);return{$$typeof:e,type:t,key:c,ref:d,props:a,_owner:i.current}}return Mx.Fragment=n,Mx.jsx=l,Mx.jsxs=l,Mx}();var Ex=Sx.exports;function Tx(t){const e=xx();if(null==e||!e.editor)throw new Error("useBlockNoteEditor was called outside of a BlockNoteContext provider or BlockNoteView component");return e.editor}function Ox(t,n){const o=xx();n||(n=null==o?void 0:o.editor),e.useEffect((()=>{if(!n)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");return n.onChange(t)}),[t,n])}function Ax(t,n){const o=xx();n||(n=null==o?void 0:o.editor),e.useEffect((()=>{if(!n)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");return n.onSelectionChange(t)}),[t,n])}function Nx(t,e){Ox(t,e),Ax(t,e)}function _x(t,n,o,r){const{refs:i,update:s,context:l,floatingStyles:a}=qk({open:t,...r}),{isMounted:c,styles:d}=ox(l),h=Uk(l),{getReferenceProps:u,getFloatingProps:p}=Xk([h]);return e.useEffect((()=>{s()}),[n,s]),e.useEffect((()=>{null!==n&&i.setReference({getBoundingClientRect:()=>n})}),[n,i]),e.useMemo((()=>({isMounted:c,ref:i.setFloating,style:{display:"flex",...d,...a,zIndex:o},getFloatingProps:p,getReferenceProps:u})),[a,c,i.setFloating,d,o,p,u])}function Lx(t){const[n,o]=e.useState();return e.useEffect((()=>t((t=>{o({...t})}))),[t]),n}const Dx=e.createContext(void 0);function Rx(){return e.useContext(Dx)}var Ix={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Px=r.createContext&&r.createContext(Ix),Hx=["attr","size","title"];function Vx(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(e.indexOf(o)>=0)continue;n[o]=t[o]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Bx(){return Bx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Bx.apply(this,arguments)}function jx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function zx(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?jx(Object(n),!0).forEach((function(e){Fx(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jx(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Fx(t,e,n){return e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $x(t){return t&&t.map(((t,e)=>r.createElement(t.tag,zx({key:e},t.attr),$x(t.child))))}function Ux(t){return e=>r.createElement(Wx,Bx({attr:zx({},t.attr)},e),$x(t.child))}function Wx(t){var e=e=>{var n,{attr:o,size:i,title:s}=t,l=Vx(t,Hx),a=i||e.size||"1em";return e.className&&(n=e.className),t.className&&(n=(n?n+" ":"")+t.className),r.createElement("svg",Bx({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,o,l,{className:n,style:zx(zx({color:t.color||e.color},e.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&r.createElement("title",null,s),t.children)};return void 0!==Px?r.createElement(Px.Consumer,null,(t=>e(t))):e(Ix)}function qx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"},child:[]}]})(t)}function Jx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5.55397 22H3.3999L10.9999 3H12.9999L20.5999 22H18.4458L16.0458 16H7.95397L5.55397 22ZM8.75397 14H15.2458L11.9999 5.88517L8.75397 14Z"},child:[]}]})(t)}function Kx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 20H11V13H4V20H2V4H4V11H11V4H13V20ZM21.0005 8V20H19.0005L19 10.204L17 10.74V8.67L19.5005 8H21.0005Z"},child:[]}]})(t)}function Zx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 4V11H11V4H13V20H11V13H4V20H2V4H4ZM18.5 8C20.5711 8 22.25 9.67893 22.25 11.75C22.25 12.6074 21.9623 13.3976 21.4781 14.0292L21.3302 14.2102L18.0343 18H22V20H15L14.9993 18.444L19.8207 12.8981C20.0881 12.5908 20.25 12.1893 20.25 11.75C20.25 10.7835 19.4665 10 18.5 10C17.5818 10 16.8288 10.7071 16.7558 11.6065L16.75 11.75H14.75C14.75 9.67893 16.4289 8 18.5 8Z"},child:[]}]})(t)}function Gx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M22 8L21.9984 10L19.4934 12.883C21.0823 13.3184 22.25 14.7728 22.25 16.5C22.25 18.5711 20.5711 20.25 18.5 20.25C16.674 20.25 15.1528 18.9449 14.8184 17.2166L16.7821 16.8352C16.9384 17.6413 17.6481 18.25 18.5 18.25C19.4665 18.25 20.25 17.4665 20.25 16.5C20.25 15.5335 19.4665 14.75 18.5 14.75C18.214 14.75 17.944 14.8186 17.7056 14.9403L16.3992 13.3932L19.3484 10H15V8H22ZM4 4V11H11V4H13V20H11V13H4V20H2V4H4Z"},child:[]}]})(t)}function Xx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z"},child:[]}]})(t)}function Yx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z"},child:[]}]})(t)}function Qx(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 5H11V19H8V21H16V19H13V5H16V3H8V5ZM2 7C1.44772 7 1 7.44772 1 8V16C1 16.5523 1.44772 17 2 17H8V15H3V9H8V7H2ZM16 9H21V15H16V17H22C22.5523 17 23 16.5523 23 16V8C23 7.44772 22.5523 7 22 7H16V9Z"},child:[]}]})(t)}function tC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 17H22V19H19V22H17V17ZM7 7H2V5H5V2H7V7ZM18.364 15.5355L16.9497 14.1213L18.364 12.7071C20.3166 10.7545 20.3166 7.58866 18.364 5.63604C16.4113 3.68342 13.2455 3.68342 11.2929 5.63604L9.87868 7.05025L8.46447 5.63604L9.87868 4.22183C12.6123 1.48816 17.0445 1.48816 19.7782 4.22183C22.5118 6.9555 22.5118 11.3877 19.7782 14.1213L18.364 15.5355ZM15.5355 18.364L14.1213 19.7782C11.3877 22.5118 6.9555 22.5118 4.22183 19.7782C1.48816 17.0445 1.48816 12.6123 4.22183 9.87868L5.63604 8.46447L7.05025 9.87868L5.63604 11.2929C3.68342 13.2455 3.68342 16.4113 5.63604 18.364C7.58866 20.3166 10.7545 20.3166 12.7071 18.364L14.1213 16.9497L15.5355 18.364ZM14.8284 7.75736L16.2426 9.17157L9.17157 16.2426L7.75736 14.8284L14.8284 7.75736Z"},child:[]}]})(t)}function eC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M18.3638 15.5355L16.9496 14.1213L18.3638 12.7071C20.3164 10.7545 20.3164 7.58866 18.3638 5.63604C16.4112 3.68341 13.2453 3.68341 11.2927 5.63604L9.87849 7.05025L8.46428 5.63604L9.87849 4.22182C12.6122 1.48815 17.0443 1.48815 19.778 4.22182C22.5117 6.95549 22.5117 11.3876 19.778 14.1213L18.3638 15.5355ZM15.5353 18.364L14.1211 19.7782C11.3875 22.5118 6.95531 22.5118 4.22164 19.7782C1.48797 17.0445 1.48797 12.6123 4.22164 9.87868L5.63585 8.46446L7.05007 9.87868L5.63585 11.2929C3.68323 13.2455 3.68323 16.4113 5.63585 18.364C7.58847 20.3166 10.7543 20.3166 12.7069 18.364L14.1211 16.9497L15.5353 18.364ZM14.8282 7.75736L16.2425 9.17157L9.17139 16.2426L7.75717 14.8284L14.8282 7.75736Z"},child:[]}]})(t)}function nC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8.00008 6V9H5.00008V6H8.00008ZM3.00008 4V11H10.0001V4H3.00008ZM13.0001 4H21.0001V6H13.0001V4ZM13.0001 11H21.0001V13H13.0001V11ZM13.0001 18H21.0001V20H13.0001V18ZM10.7072 16.2071L9.29297 14.7929L6.00008 18.0858L4.20718 16.2929L2.79297 17.7071L6.00008 20.9142L10.7072 16.2071Z"},child:[]}]})(t)}function oC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 4H21V6H8V4ZM5 3V6H6V7H3V6H4V4H3V3H5ZM3 14V11.5H5V11H3V10H6V12.5H4V13H6V14H3ZM5 19.5H3V18.5H5V18H3V17H6V21H3V20H5V19.5ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"},child:[]}]})(t)}function rC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 4H21V6H8V4ZM4.5 6.5C3.67157 6.5 3 5.82843 3 5C3 4.17157 3.67157 3.5 4.5 3.5C5.32843 3.5 6 4.17157 6 5C6 5.82843 5.32843 6.5 4.5 6.5ZM4.5 13.5C3.67157 13.5 3 12.8284 3 12C3 11.1716 3.67157 10.5 4.5 10.5C5.32843 10.5 6 11.1716 6 12C6 12.8284 5.32843 13.5 4.5 13.5ZM4.5 20.4C3.67157 20.4 3 19.7284 3 18.9C3 18.0716 3.67157 17.4 4.5 17.4C5.32843 17.4 6 18.0716 6 18.9C6 19.7284 5.32843 20.4 4.5 20.4ZM8 11H21V13H8V11ZM8 18H21V20H8V18Z"},child:[]}]})(t)}function iC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 6V21H11V6H5V4H19V6H13Z"},child:[]}]})(t)}function sC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"},child:[]}]})(t)}function lC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M21 15V18H24V20H21V23H19V20H16V18H19V15H21ZM21.0082 3C21.556 3 22 3.44495 22 3.9934L22.0007 13.3417C21.3749 13.1204 20.7015 13 20 13V5H4L4.001 19L13.2929 9.70715C13.6528 9.34604 14.22 9.31823 14.6123 9.62322L14.7065 9.70772L18.2521 13.2586C15.791 14.0069 14 16.2943 14 19C14 19.7015 14.1204 20.3749 14.3417 21.0007L2.9918 21C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082ZM8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7Z"},child:[]}]})(t)}function aC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20 3C20.5523 3 21 3.44772 21 4V5.757L19 7.757V5H5V13.1L9 9.1005L13.328 13.429L12.0012 14.7562L11.995 18.995L16.2414 19.0012L17.571 17.671L18.8995 19H19V16.242L21 14.242V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3H20ZM21.7782 7.80761L23.1924 9.22183L15.4142 17L13.9979 16.9979L14 15.5858L21.7782 7.80761ZM15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7Z"},child:[]}]})(t)}function cC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 3.9934C3 3.44476 3.44495 3 3.9934 3H20.0066C20.5552 3 21 3.44495 21 3.9934V20.0066C21 20.5552 20.5551 21 20.0066 21H3.9934C3.44476 21 3 20.5551 3 20.0066V3.9934ZM10.6219 8.41459C10.5562 8.37078 10.479 8.34741 10.4 8.34741C10.1791 8.34741 10 8.52649 10 8.74741V15.2526C10 15.3316 10.0234 15.4088 10.0672 15.4745C10.1897 15.6583 10.4381 15.708 10.6219 15.5854L15.5008 12.3328C15.5447 12.3035 15.5824 12.2658 15.6117 12.2219C15.7343 12.0381 15.6846 11.7897 15.5008 11.6672L10.6219 8.41459Z"},child:[]}]})(t)}function dC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(t)}function hC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 4V6H15V4H9Z"},child:[]}]})(t)}function uC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 19H20V12H22V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V12H4V19ZM14 9H19L12 16L5 9H10V3H14V9Z"},child:[]}]})(t)}function pC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10 6V8H5V19H16V14H18V20C18 20.5523 17.5523 21 17 21H4C3.44772 21 3 20.5523 3 20V7C3 6.44772 3.44772 6 4 6H10ZM21 3V12L17.206 8.207L11.2071 14.2071L9.79289 12.7929L15.792 6.793L12 3H21Z"},child:[]}]})(t)}function fC(t){const n=xx();if(t||(t=null==n?void 0:n.editor),!t)throw new Error("'editor' is required, either from BlockNoteContext or as a function argument");const o=t,[r,i]=e.useState((()=>{var t;return(null==(t=o.getSelection())?void 0:t.blocks)||[o.getTextCursorPosition().block]}));return Nx((()=>{var t;return i((null==(t=o.getSelection())?void 0:t.blocks)||[o.getTextCursorPosition().block])}),o),r}function mC(){return xx().editor.dictionary}const gC={bold:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z"},child:[]}]})(t)},italic:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M15 20H7V18H9.92661L12.0425 6H9V4H17V6H14.0734L11.9575 18H15V20Z"},child:[]}]})(t)},underline:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M8 3V12C8 14.2091 9.79086 16 12 16C14.2091 16 16 14.2091 16 12V3H18V12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12V3H8ZM4 20H20V22H4V20Z"},child:[]}]})(t)},strike:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M17.1538 14C17.3846 14.5161 17.5 15.0893 17.5 15.7196C17.5 17.0625 16.9762 18.1116 15.9286 18.867C14.8809 19.6223 13.4335 20 11.5862 20C9.94674 20 8.32335 19.6185 6.71592 18.8555V16.6009C8.23538 17.4783 9.7908 17.917 11.3822 17.917C13.9333 17.917 15.2128 17.1846 15.2208 15.7196C15.2208 15.0939 15.0049 14.5598 14.5731 14.1173C14.5339 14.0772 14.4939 14.0381 14.4531 14H3V12H21V14H17.1538ZM13.076 11H7.62908C7.4566 10.8433 7.29616 10.6692 7.14776 10.4778C6.71592 9.92084 6.5 9.24559 6.5 8.45207C6.5 7.21602 6.96583 6.165 7.89749 5.299C8.82916 4.43299 10.2706 4 12.2219 4C13.6934 4 15.1009 4.32808 16.4444 4.98426V7.13591C15.2448 6.44921 13.9293 6.10587 12.4978 6.10587C10.0187 6.10587 8.77917 6.88793 8.77917 8.45207C8.77917 8.87172 8.99709 9.23796 9.43293 9.55079C9.86878 9.86362 10.4066 10.1135 11.0463 10.3004C11.6665 10.4816 12.3431 10.7148 13.076 11H13.076Z"},child:[]}]})(t)},code:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M23 12L15.9289 19.0711L14.5147 17.6569L20.1716 12L14.5147 6.34317L15.9289 4.92896L23 12ZM3.82843 12L9.48528 17.6569L8.07107 19.0711L1 12L8.07107 4.92896L9.48528 6.34317L3.82843 12Z"},child:[]}]})(t)}};const yC=t=>{const n=mC(),o=Rx(),r=Tx(),i=function(t,e){return t in e.schema.styleSchema&&e.schema.styleSchema[t].type===t&&"boolean"===e.schema.styleSchema[t].propSchema}(t.basicTextStyle,r),s=fC(r),[l,a]=e.useState(t.basicTextStyle in r.getActiveStyles());Nx((()=>{i&&a(t.basicTextStyle in r.getActiveStyles())}),r);if(!e.useMemo((()=>!!i&&!!s.find((t=>void 0!==t.content))),[i,s])||!r.isEditable)return null;const c=gC[t.basicTextStyle];return Ex.jsx(o.FormattingToolbar.Button,{className:"bn-button","data-test":t.basicTextStyle,onClick:()=>(t=>{if(r.focus(),i){if("boolean"!==r.schema.styleSchema[t].propSchema)throw new Error("can only toggle boolean styles");r.toggleStyles({[t]:!0})}})(t.basicTextStyle),isSelected:l,label:n.formatting_toolbar[t.basicTextStyle].tooltip,mainTooltip:n.formatting_toolbar[t.basicTextStyle].tooltip,secondaryTooltip:Gg(n.formatting_toolbar[t.basicTextStyle].secondary_tooltip,n.generic.ctrl_shortcut),icon:Ex.jsx(c,{})})},bC=t=>{const n=t.textColor||"default",o=t.backgroundColor||"default",r=t.size||16,i=e.useMemo((()=>({pointerEvents:"none",fontSize:(.75*r).toString()+"px",height:r.toString()+"px",lineHeight:r.toString()+"px",textAlign:"center",width:r.toString()+"px"})),[r]);return Ex.jsx("div",{className:"bn-color-icon","data-background-color":o,"data-text-color":n,style:i,children:"A"})},wC=["default","gray","brown","red","orange","yellow","green","blue","purple","pink"],vC=t=>{const e=Rx(),n=mC(),o=()=>t.text?Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(e.Generic.Menu.Label,{children:n.color_picker.text_title}),wC.map((o=>Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{t.onClick&&t.onClick(),t.text.setColor(o)},"data-test":"text-color-"+o,icon:Ex.jsx(bC,{textColor:o,size:t.iconSize}),checked:t.text.color===o,children:n.color_picker.colors[o]},"text-color-"+o)))]}):null,r=()=>t.background?Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(e.Generic.Menu.Label,{children:n.color_picker.background_title}),wC.map((o=>Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{t.onClick&&t.onClick(),t.background.setColor(o)},"data-test":"background-color-"+o,icon:Ex.jsx(bC,{backgroundColor:o,size:t.iconSize}),checked:t.background.color===o,children:n.color_picker.colors[o]},"background-color-"+o)))]}):null;return Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(o,{}),Ex.jsx(r,{})]})};function kC(t,e){return`${t}Color`in e.schema.styleSchema&&e.schema.styleSchema[`${t}Color`].type===`${t}Color`&&"string"===e.schema.styleSchema[`${t}Color`].propSchema}const xC=()=>{const t=Rx(),n=mC(),o=Tx(),r=kC("text",o),i=kC("background",o),s=fC(o),[l,a]=e.useState(r&&o.getActiveStyles().textColor||"default"),[c,d]=e.useState(i&&o.getActiveStyles().backgroundColor||"default");Nx((()=>{r&&a(o.getActiveStyles().textColor||"default"),i&&d(o.getActiveStyles().backgroundColor||"default")}),o);const h=e.useCallback((t=>{if(!r)throw Error("Tried to set text color, but style does not exist in editor schema.");"default"===t?o.removeStyles({textColor:t}):o.addStyles({textColor:t}),setTimeout((()=>{o.focus()}))}),[o,r]),u=e.useCallback((t=>{if(!i)throw Error("Tried to set background color, but style does not exist in editor schema.");"default"===t?o.removeStyles({backgroundColor:t}):o.addStyles({backgroundColor:t}),setTimeout((()=>{o.focus()}))}),[i,o]);return e.useMemo((()=>{if(!r&&!i)return!1;for(const t of s)if(void 0!==t.content)return!0;return!1}),[i,s,r])&&o.isEditable?Ex.jsxs(t.Generic.Menu.Root,{children:[Ex.jsx(t.Generic.Menu.Trigger,{children:Ex.jsx(t.FormattingToolbar.Button,{className:"bn-button","data-test":"colors",label:n.formatting_toolbar.colors.tooltip,mainTooltip:n.formatting_toolbar.colors.tooltip,icon:Ex.jsx(bC,{textColor:l,backgroundColor:c,size:20})})}),Ex.jsx(t.Generic.Menu.Dropdown,{className:"bn-menu-dropdown bn-color-picker-dropdown",children:Ex.jsx(vC,{text:r?{color:l,setColor:h}:void 0,background:i?{color:c,setColor:u}:void 0})})]}):null},CC=t=>{const n=Rx(),o=mC(),{url:r,text:i,editLink:s}=t,[l,a]=e.useState(r),[c,d]=e.useState(i);e.useEffect((()=>{a(r),d(i)}),[i,r]);const h=e.useCallback((t=>{"Enter"===t.key&&(t.preventDefault(),s(l,c))}),[s,l,c]),u=e.useCallback((t=>a(t.currentTarget.value)),[]),p=e.useCallback((t=>d(t.currentTarget.value)),[]),f=e.useCallback((()=>s(l,c)),[s,l,c]);return Ex.jsxs(n.Generic.Form.Root,{children:[Ex.jsx(n.Generic.Form.TextInput,{className:"bn-text-input",name:"url",icon:Ex.jsx(eC,{}),autoFocus:!0,placeholder:o.link_toolbar.form.url_placeholder,value:l,onKeyDown:h,onChange:u,onSubmit:f}),Ex.jsx(n.Generic.Form.TextInput,{className:"bn-text-input",name:"title",icon:Ex.jsx(iC,{}),placeholder:o.link_toolbar.form.title_placeholder,value:c,onKeyDown:h,onChange:p,onSubmit:f})]})};const SC=()=>{const t=Tx(),n=Rx(),o=mC(),r=function(t){return"link"in t.schema.inlineContentSchema&&"link"===t.schema.inlineContentSchema.link}(t),i=fC(t),[s,l]=e.useState(t.getSelectedLinkUrl()||""),[a,c]=e.useState(t.getSelectedText());Nx((()=>{c(t.getSelectedText()||""),l(t.getSelectedLinkUrl()||"")}),t);const d=e.useCallback(((e,n)=>{t.createLink(e,n),t.focus()}),[t]);return e.useMemo((()=>{if(!r)return!1;for(const t of i)if(void 0===t.content)return!1;return!0}),[r,i])&&"link"in t.schema.inlineContentSchema&&t.isEditable?Ex.jsxs(n.Generic.Popover.Root,{children:[Ex.jsx(n.Generic.Popover.Trigger,{children:Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button","data-test":"createLink",label:o.formatting_toolbar.link.tooltip,mainTooltip:o.formatting_toolbar.link.tooltip,secondaryTooltip:Gg(o.formatting_toolbar.link.secondary_tooltip,o.generic.ctrl_shortcut),icon:Ex.jsx(eC,{})})}),Ex.jsx(n.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:Ex.jsx(CC,{url:s,text:a,editLink:d})})]}):null},MC=()=>{const t=mC(),n=Rx(),o=Tx(),[r,i]=e.useState(),s=fC(o),l=e.useMemo((()=>{if(1!==s.length)return;const t=s[0];return fb(t,o)?(i(t.props.caption),t):void 0}),[o,s]),a=e.useCallback((t=>{l&&"Enter"===t.key&&(t.preventDefault(),o.updateBlock(l,{props:{caption:r}}))}),[r,o,l]),c=e.useCallback((t=>i(t.currentTarget.value)),[]);return l&&!mb(l,o)&&o.isEditable?Ex.jsxs(n.Generic.Popover.Root,{children:[Ex.jsx(n.Generic.Popover.Trigger,{children:Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",label:t.formatting_toolbar.file_caption.tooltip,mainTooltip:t.formatting_toolbar.file_caption.tooltip,icon:Ex.jsx(Qx,{}),isSelected:""!==l.props.caption})}),Ex.jsx(n.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:Ex.jsx(n.Generic.Form.Root,{children:Ex.jsx(n.Generic.Form.TextInput,{name:"file-caption",icon:Ex.jsx(Qx,{}),value:r||"",autoFocus:!0,placeholder:t.formatting_toolbar.file_caption.input_placeholder,onKeyDown:a,onChange:c})})})]}):null},EC=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),[i,s]=e.useState((()=>o.canNestBlock()));Nx((()=>{s(o.canNestBlock())}),o);const l=e.useCallback((()=>{o.focus(),o.nestBlock()}),[o]);return e.useMemo((()=>!r.find((t=>"inline"!==o.schema.blockSchema[t.type].content))),[o.schema.blockSchema,r])&&o.isEditable?Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button","data-test":"nestBlock",onClick:l,isDisabled:!i,label:t.formatting_toolbar.nest.tooltip,mainTooltip:t.formatting_toolbar.nest.tooltip,secondaryTooltip:Gg(t.formatting_toolbar.nest.secondary_tooltip,t.generic.ctrl_shortcut),icon:Ex.jsx(Yx,{})}):null},TC=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),[i,s]=e.useState((()=>o.canUnnestBlock()));Nx((()=>{s(o.canUnnestBlock())}),o);const l=e.useCallback((()=>{o.focus(),o.unnestBlock()}),[o]);return e.useMemo((()=>!r.find((t=>"inline"!==o.schema.blockSchema[t.type].content))),[o.schema.blockSchema,r])&&o.isEditable?Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button","data-test":"unnestBlock",onClick:l,isDisabled:!i,label:t.formatting_toolbar.unnest.tooltip,mainTooltip:t.formatting_toolbar.unnest.tooltip,secondaryTooltip:Gg(t.formatting_toolbar.unnest.secondary_tooltip,t.generic.ctrl_shortcut),icon:Ex.jsx(Xx,{})}):null},OC=t=>{const n=Rx(),o=mC(),{block:r}=t,i=Tx(),[s,l]=e.useState(""),a=e.useCallback((t=>{l(t.currentTarget.value)}),[]),c=e.useCallback((t=>{"Enter"===t.key&&(t.preventDefault(),i.updateBlock(r,{props:{name:ry(s),url:s}}))}),[i,r,s]),d=e.useCallback((()=>{i.updateBlock(r,{props:{name:ry(s),url:s}})}),[i,r,s]);return Ex.jsxs(n.FilePanel.TabPanel,{className:"bn-tab-panel",children:[Ex.jsx(n.FilePanel.TextInput,{className:"bn-text-input",placeholder:o.file_panel.embed.url_placeholder,value:s,onChange:a,onKeyDown:c,"data-test":"embed-input"}),Ex.jsx(n.FilePanel.Button,{className:"bn-button",onClick:d,"data-test":"embed-input-button",children:o.file_panel.embed.embed_button[r.type]||o.file_panel.embed.embed_button.file})]})},AC=t=>{var n;const o=Rx(),r=mC(),{block:i,setLoading:s}=t,l=Tx(),[a,c]=e.useState(!1);e.useEffect((()=>{a&&setTimeout((()=>{c(!1)}),3e3)}),[a]);const d=e.useCallback((t=>{null!==t&&async function(t){if(s(!0),void 0!==l.uploadFile)try{let e=await l.uploadFile(t);"string"==typeof e&&(e={props:{name:t.name,url:e}}),l.updateBlock(i,e)}catch{c(!0)}finally{s(!1)}}(t)}),[i,l,s]),h=l.schema.blockSchema[i.type],u=h.isFileBlock&&null!=(n=h.fileBlockAcceptMimeTypes)&&n.length?h.fileBlockAcceptMimeTypes.join(","):"*/*";return Ex.jsxs(o.FilePanel.TabPanel,{className:"bn-tab-panel",children:[Ex.jsx(o.FilePanel.FileInput,{className:"bn-file-input","data-test":"upload-input",accept:u,placeholder:r.file_panel.upload.file_placeholder[i.type]||r.file_panel.upload.file_placeholder.file,value:null,onChange:d}),a&&Ex.jsx("div",{className:"bn-error-text",children:r.file_panel.upload.upload_error})]})},NC=t=>{const n=Rx(),o=mC(),r=Tx(),[i,s]=e.useState(!1),l=t.tabs??[...void 0!==r.uploadFile?[{name:o.file_panel.upload.title,tabPanel:Ex.jsx(AC,{block:t.block,setLoading:s})}]:[],{name:o.file_panel.embed.title,tabPanel:Ex.jsx(OC,{block:t.block})}],[a,c]=e.useState(t.defaultOpenTab||l[0].name);return Ex.jsx(n.FilePanel.Root,{className:"bn-panel",defaultOpenTab:a,openTab:a,setOpenTab:c,tabs:l,loading:i})},_C=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),[i,s]=e.useState(!1);e.useEffect((()=>{s(!1)}),[r]);const l=1===r.length?r[0]:void 0;return void 0!==l&&fb(l,o)&&o.isEditable?Ex.jsxs(n.Generic.Popover.Root,{opened:i,position:"bottom",children:[Ex.jsx(n.Generic.Popover.Trigger,{children:Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",onClick:()=>s(!i),isSelected:i,mainTooltip:t.formatting_toolbar.file_replace.tooltip[l.type]||t.formatting_toolbar.file_replace.tooltip.file,label:t.formatting_toolbar.file_replace.tooltip[l.type]||t.formatting_toolbar.file_replace.tooltip.file,icon:Ex.jsx(aC,{})})}),Ex.jsx(n.Generic.Popover.Content,{className:"bn-popover-content bn-panel-popover",variant:"panel-popover",children:Ex.jsx(NC,{block:l})})]}):null},LC={left:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H17V21H3V19ZM3 14H21V16H3V14ZM3 9H17V11H3V9Z"},child:[]}]})(t)},center:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM5 19H19V21H5V19ZM3 14H21V16H3V14ZM5 9H19V11H5V9Z"},child:[]}]})(t)},right:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM7 19H21V21H7V19ZM3 14H21V16H3V14ZM7 9H21V11H7V9Z"},child:[]}]})(t)},justify:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM3 14H21V16H3V14ZM3 9H21V11H3V9Z"},child:[]}]})(t)}},DC=t=>{const n=Rx(),o=mC(),r=Tx(),i=fC(r),s=e.useMemo((()=>{const t=i[0];if(yb("textAlignment",t,r))return t.props.textAlignment}),[r,i]),l=e.useCallback((t=>{r.focus();for(const e of i)gb("textAlignment",e.type,r)&&r.updateBlock(e,{props:{textAlignment:t}})}),[r,i]);if(!e.useMemo((()=>!!i.find((t=>"textAlignment"in t.props))),[i])||!r.isEditable)return null;const a=LC[t.textAlignment];return Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button","data-test":`alignText${t.textAlignment.slice(0,1).toUpperCase()+t.textAlignment.slice(1)}`,onClick:()=>l(t.textAlignment),isSelected:s===t.textAlignment,label:o.formatting_toolbar[`align_${t.textAlignment}`].tooltip,mainTooltip:o.formatting_toolbar[`align_${t.textAlignment}`].tooltip,icon:Ex.jsx(a,{})})},RC=t=>{const n=Rx(),o=mC(),r=Tx(),i=fC(r),[s,l]=e.useState(r.getTextCursorPosition().block),a=e.useMemo((()=>(t.items||(t=>[{name:t.slash_menu.paragraph.title,type:"paragraph",icon:iC,isSelected:t=>"paragraph"===t.type},{name:t.slash_menu.heading.title,type:"heading",props:{level:1},icon:Kx,isSelected:t=>"heading"===t.type&&"level"in t.props&&1===t.props.level},{name:t.slash_menu.heading_2.title,type:"heading",props:{level:2},icon:Zx,isSelected:t=>"heading"===t.type&&"level"in t.props&&2===t.props.level},{name:t.slash_menu.heading_3.title,type:"heading",props:{level:3},icon:Gx,isSelected:t=>"heading"===t.type&&"level"in t.props&&3===t.props.level},{name:t.slash_menu.bullet_list.title,type:"bulletListItem",icon:rC,isSelected:t=>"bulletListItem"===t.type},{name:t.slash_menu.numbered_list.title,type:"numberedListItem",icon:oC,isSelected:t=>"numberedListItem"===t.type},{name:t.slash_menu.check_list.title,type:"checkListItem",icon:nC,isSelected:t=>"checkListItem"===t.type}])(o)).filter((t=>t.type in r.schema.blockSchema))),[r,o,t.items]),c=e.useMemo((()=>void 0!==a.find((t=>t.type===s.type))),[s.type,a]),d=e.useMemo((()=>a.map((t=>{const e=t.icon;return{text:t.name,icon:Ex.jsx(e,{size:16}),onClick:()=>(t=>{r.focus();for(const e of i)r.updateBlock(e,{type:t.type,props:t.props})})(t),isSelected:t.isSelected(s)}}))),[s,a,r,i]);return Nx((()=>{l(r.getTextCursorPosition().block)}),r),c&&r.isEditable?Ex.jsx(n.FormattingToolbar.Select,{className:"bn-select",items:d}):null},IC=()=>{const t=mC(),n=Rx(),o=Tx(),[r,i]=e.useState(),s=fC(o),l=e.useMemo((()=>{if(1!==s.length)return;const t=s[0];return fb(t,o)?(i(t.props.name),t):void 0}),[o,s]),a=e.useCallback((t=>{l&&"Enter"===t.key&&(t.preventDefault(),o.updateBlock(l,{props:{name:r}}))}),[r,o,l]),c=e.useCallback((t=>i(t.currentTarget.value)),[]);return l&&!mb(l,o)&&o.isEditable?Ex.jsxs(n.Generic.Popover.Root,{children:[Ex.jsx(n.Generic.Popover.Trigger,{children:Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",label:t.formatting_toolbar.file_rename.tooltip[l.type]||t.formatting_toolbar.file_rename.tooltip.file,mainTooltip:t.formatting_toolbar.file_rename.tooltip[l.type]||t.formatting_toolbar.file_rename.tooltip.file,icon:Ex.jsx(Jx,{})})}),Ex.jsx(n.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:Ex.jsx(n.Generic.Form.Root,{children:Ex.jsx(n.Generic.Form.TextInput,{name:"file-name",icon:Ex.jsx(Jx,{}),value:r||"",autoFocus:!0,placeholder:t.formatting_toolbar.file_rename.input_placeholder[l.type]||t.formatting_toolbar.file_rename.input_placeholder.file,onKeyDown:a,onChange:c})})})]}):null},PC=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),i=e.useMemo((()=>{if(1!==r.length)return;const t=r[0];return fb(t,o)?t:void 0}),[o,r]),s=e.useCallback((()=>{i&&i.props.url&&(o.focus(),o.resolveFileUrl(i.props.url).then((t=>window.open(t))))}),[o,i]);return!i||mb(i,o)?null:Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",label:t.formatting_toolbar.file_download.tooltip[i.type]||t.formatting_toolbar.file_download.tooltip.file,mainTooltip:t.formatting_toolbar.file_download.tooltip[i.type]||t.formatting_toolbar.file_download.tooltip.file,icon:Ex.jsx(uC,{}),onClick:s})},HC=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),i=e.useMemo((()=>{if(1!==r.length)return;const t=r[0];return function(t,e){return t.type in e.schema.blockSchema&&e.schema.blockSchema[t.type].isFileBlock&&"showPreview"in e.schema.blockSchema[t.type].propSchema||!1}(t,o)?t:void 0}),[o,r]),s=e.useCallback((()=>{i&&o.updateBlock(i,{props:{showPreview:!i.props.showPreview}})}),[o,i]);return i&&!mb(i,o)&&o.isEditable?Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",label:"Toggle preview",mainTooltip:t.formatting_toolbar.file_preview_toggle.tooltip,icon:Ex.jsx(lC,{}),isSelected:i.props.showPreview,onClick:s}):null},VC=()=>{const t=mC(),n=Rx(),o=Tx(),r=fC(o),i=e.useMemo((()=>{if(1!==r.length)return;const t=r[0];return fb(t,o)?t:void 0}),[o,r]),s=e.useCallback((()=>{o.focus(),o.removeBlocks([i])}),[o,i]);return i&&!mb(i,o)&&o.isEditable?Ex.jsx(n.FormattingToolbar.Button,{className:"bn-button",label:t.formatting_toolbar.file_delete.tooltip[i.type]||t.formatting_toolbar.file_delete.tooltip.file,mainTooltip:t.formatting_toolbar.file_delete.tooltip[i.type]||t.formatting_toolbar.file_delete.tooltip.file,icon:Ex.jsx(hC,{}),onClick:s}):null},BC=t=>[Ex.jsx(RC,{items:t},"blockTypeSelect"),Ex.jsx(MC,{},"fileCaptionButton"),Ex.jsx(_C,{},"replaceFileButton"),Ex.jsx(IC,{},"fileRenameButton"),Ex.jsx(VC,{},"fileDeleteButton"),Ex.jsx(PC,{},"fileDownloadButton"),Ex.jsx(HC,{},"filePreviewButton"),Ex.jsx(yC,{basicTextStyle:"bold"},"boldStyleButton"),Ex.jsx(yC,{basicTextStyle:"italic"},"italicStyleButton"),Ex.jsx(yC,{basicTextStyle:"underline"},"underlineStyleButton"),Ex.jsx(yC,{basicTextStyle:"strike"},"strikeStyleButton"),Ex.jsx(DC,{textAlignment:"left"},"textAlignLeftButton"),Ex.jsx(DC,{textAlignment:"center"},"textAlignCenterButton"),Ex.jsx(DC,{textAlignment:"right"},"textAlignRightButton"),Ex.jsx(xC,{},"colorStyleButton"),Ex.jsx(EC,{},"nestBlockButton"),Ex.jsx(TC,{},"unnestBlockButton"),Ex.jsx(SC,{},"createLinkButton")],jC=t=>{const e=Rx();return Ex.jsx(e.FormattingToolbar.Root,{className:"bn-toolbar bn-formatting-toolbar",children:t.children||BC(t.blockTypeSelectItems)})},zC=t=>{switch(t){case"left":default:return"top-start";case"center":return"top";case"right":return"top-end"}},FC=t=>{const n=e.useRef(null),o=Tx(),[r,i]=e.useState((()=>{const t=o.getTextCursorPosition().block;return"textAlignment"in t.props?zC(t.props.textAlignment):"top-start"}));Nx((()=>{const t=o.getTextCursorPosition().block;"textAlignment"in t.props?i(zC(t.props.textAlignment)):i("top-start")}),o);const s=Lx(o.formattingToolbar.onUpdate.bind(o.formattingToolbar)),{isMounted:l,ref:a,style:c,getFloatingProps:d}=_x((null==s?void 0:s.show)||!1,(null==s?void 0:s.referencePos)||null,3e3,{placement:r,middleware:[dk(10),pk()],onOpenChange:(t,e)=>{t||(o.formattingToolbar.closeMenu(),o.focus())}}),h=e.useMemo((()=>function(t){return e=>{t.forEach((t=>{"function"==typeof t?t(e):null!=t&&(t.current=e)}))}}([n,a])),[n,a]);if(!l||!s)return null;if(!s.show&&n.current)return Ex.jsx("div",{ref:h,style:c,dangerouslySetInnerHTML:{__html:n.current.innerHTML}});const u=t.formattingToolbar||jC;return Ex.jsx("div",{ref:h,style:c,...d(),children:Ex.jsx(u,{})})},$C=t=>{const e=Rx(),n=mC();return Ex.jsx(e.LinkToolbar.Button,{className:"bn-button",label:n.link_toolbar.delete.tooltip,mainTooltip:n.link_toolbar.delete.tooltip,isSelected:!1,onClick:t.deleteLink,icon:Ex.jsx(tC,{})})},UC=t=>{const e=Rx(),n=mC();return Ex.jsxs(e.Generic.Popover.Root,{children:[Ex.jsx(e.Generic.Popover.Trigger,{children:Ex.jsx(e.LinkToolbar.Button,{className:"bn-button",mainTooltip:n.link_toolbar.edit.tooltip,isSelected:!1,children:n.link_toolbar.edit.text})}),Ex.jsx(e.Generic.Popover.Content,{className:"bn-popover-content bn-form-popover",variant:"form-popover",children:Ex.jsx(CC,{...t})})]})},WC=t=>{const e=Rx(),n=mC();return Ex.jsx(e.LinkToolbar.Button,{className:"bn-button",mainTooltip:n.link_toolbar.open.tooltip,label:n.link_toolbar.open.tooltip,isSelected:!1,onClick:()=>{window.open(t.url,"_blank")},icon:Ex.jsx(pC,{})})},qC=t=>{const e=Rx();return t.children?Ex.jsx(e.LinkToolbar.Root,{className:"bn-toolbar bn-link-toolbar",children:t.children}):Ex.jsxs(e.LinkToolbar.Root,{className:"bn-toolbar bn-link-toolbar",onMouseEnter:t.stopHideTimer,onMouseLeave:t.startHideTimer,children:[Ex.jsx(UC,{url:t.url,text:t.text,editLink:t.editLink}),Ex.jsx(WC,{url:t.url}),Ex.jsx($C,{deleteLink:t.deleteLink})]})},JC=t=>{const e=Tx(),n={deleteLink:e.linkToolbar.deleteLink,editLink:e.linkToolbar.editLink,startHideTimer:e.linkToolbar.startHideTimer,stopHideTimer:e.linkToolbar.stopHideTimer},o=Lx(e.linkToolbar.onUpdate.bind(e.linkToolbar)),{isMounted:r,ref:i,style:s,getFloatingProps:l}=_x((null==o?void 0:o.show)||!1,(null==o?void 0:o.referencePos)||null,4e3,{placement:"top-start",middleware:[dk(10),pk()],onOpenChange:t=>{t||(e.linkToolbar.closeMenu(),e.focus())}});if(!r||!o)return null;const{show:a,referencePos:c,...d}=o,h=t.linkToolbar||qC;return Ex.jsx("div",{ref:i,style:s,...l(),children:Ex.jsx(h,{...d,...n})})},KC=t=>{const e=Tx();if(!e.filePanel)throw new Error("FileToolbarController can only be used when BlockNote editor schema contains file block");const n=Lx(e.filePanel.onUpdate.bind(e.filePanel)),{isMounted:o,ref:r,style:i,getFloatingProps:s}=_x((null==n?void 0:n.show)||!1,(null==n?void 0:n.referencePos)||null,5e3,{placement:"bottom",middleware:[dk(10),pk()],onOpenChange:t=>{t||(e.filePanel.closeMenu(),e.focus())}});if(!o||!n)return null;const{show:l,referencePos:a,...c}=n,d=t.filePanel||NC;return Ex.jsx("div",{ref:r,style:i,...s(),children:Ex.jsx(d,{...c})})};function ZC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8Z"},child:[]},{tag:"path",attr:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8Z"},child:[]}]})(t)}const GC=t=>{const e=Rx(),n=mC();return Ex.jsx(e.SideMenu.Button,{className:"bn-button",label:n.side_menu.add_block_label,icon:Ex.jsx(ZC,{size:24,onClick:t.addBlock,"data-test":"dragHandleAdd"})})};function XC(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}const YC=t=>{const e=Rx(),n=Tx();return gb("textColor",t.block.type,n)||gb("backgroundColor",t.block.type,n)?Ex.jsxs(e.Generic.Menu.Root,{position:"right",sub:!0,children:[Ex.jsx(e.Generic.Menu.Trigger,{sub:!0,children:Ex.jsx(e.Generic.Menu.Item,{className:"bn-menu-item",subTrigger:!0,children:t.children})}),Ex.jsx(e.Generic.Menu.Dropdown,{sub:!0,className:"bn-menu-dropdown bn-color-picker-dropdown",children:Ex.jsx(vC,{iconSize:18,text:gb("textColor",t.block.type,n)&&yb("textColor",t.block,n)?{color:t.block.props.textColor,setColor:e=>n.updateBlock(t.block,{type:t.block.type,props:{textColor:e}})}:void 0,background:gb("backgroundColor",t.block.type,n)&&yb("backgroundColor",t.block,n)?{color:t.block.props.backgroundColor,setColor:e=>n.updateBlock(t.block,{props:{backgroundColor:e}})}:void 0})})]}):null},QC=t=>{const e=Rx(),n=Tx();return Ex.jsx(e.Generic.Menu.Item,{className:"bn-menu-item",onClick:()=>n.removeBlocks([t.block]),children:t.children})},tS=t=>{const e=Rx(),n=mC();return Ex.jsx(e.Generic.Menu.Dropdown,{className:"bn-menu-dropdown bn-drag-handle-menu",children:t.children||Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(QC,{...t,children:n.drag_handle.delete_menuitem}),Ex.jsx(YC,{...t,children:n.drag_handle.colors_menuitem})]})})},eS=t=>{const e=Rx(),n=mC(),o=t.dragHandleMenu||tS;return Ex.jsxs(e.Generic.Menu.Root,{onOpenChange:e=>{e?t.freezeMenu():(t.unfreezeMenu(),t.editor.focus())},position:"left",children:[Ex.jsx(e.Generic.Menu.Trigger,{children:Ex.jsx(e.SideMenu.Button,{label:n.side_menu.drag_handle_label,draggable:!0,onDragStart:t.blockDragStart,onDragEnd:t.blockDragEnd,className:"bn-button",icon:Ex.jsx(XC,{size:24,"data-test":"dragHandle"})})}),Ex.jsx(o,{block:t.block})]})},nS=t=>{const n=Rx(),{addBlock:o,...r}=t,i=e.useMemo((()=>{const e={"data-block-type":t.block.type};return"heading"===t.block.type&&(e["data-level"]=t.block.props.level.toString()),t.editor.schema.blockSchema[t.block.type].isFileBlock&&(t.block.props.url?e["data-url"]="true":e["data-url"]="false"),e}),[t.block,t.editor.schema.blockSchema]);return Ex.jsx(n.SideMenu.Root,{className:"bn-side-menu",...i,children:t.children||Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(GC,{addBlock:o}),Ex.jsx(eS,{...r})]})})},oS=t=>{const e=Tx(),n={addBlock:e.sideMenu.addBlock,blockDragStart:e.sideMenu.blockDragStart,blockDragEnd:e.sideMenu.blockDragEnd,freezeMenu:e.sideMenu.freezeMenu,unfreezeMenu:e.sideMenu.unfreezeMenu},o=Lx(e.sideMenu.onUpdate.bind(e.sideMenu)),{isMounted:r,ref:i,style:s,getFloatingProps:l}=_x((null==o?void 0:o.show)||!1,(null==o?void 0:o.referencePos)||null,1e3,{placement:"left-start"});if(!r||!o)return null;const{show:a,referencePos:c,...d}=o,h=t.sideMenu||nS;return Ex.jsx("div",{ref:i,style:s,...l(),children:Ex.jsx(h,{...d,...n,editor:e})})};function rS(t){const n=Rx(),o=mC(),{items:r,loadingState:i,selectedIndex:s,onItemClick:l}=t,a="loading-initial"===i||"loading"===i?Ex.jsx(n.SuggestionMenu.Loader,{className:"bn-suggestion-menu-loader",children:o.suggestion_menu.loading}):null,c=e.useMemo((()=>{let t;const e=[];for(let o=0;o<r.length;o++){const i=r[o];i.group!==t&&(t=i.group,e.push(Ex.jsx(n.SuggestionMenu.Label,{className:"bn-suggestion-menu-label",children:t},t))),e.push(Ex.jsx(n.SuggestionMenu.Item,{className:"bn-suggestion-menu-item",item:i,id:`bn-suggestion-menu-item-${o}`,isSelected:o===s,onClick:()=>null==l?void 0:l(i)},i.title))}return e}),[n,r,l,s]);return Ex.jsxs(n.SuggestionMenu.Root,{id:"bn-suggestion-menu",className:"bn-suggestion-menu",children:[c,0===c.length&&("loading"===t.loadingState||"loaded"===t.loadingState)&&Ex.jsx(n.SuggestionMenu.EmptyItem,{className:"bn-suggestion-menu-item",children:o.suggestion_menu.no_items_title}),a]})}function iS(t,n,o,r=3){const i=e.useRef(0);e.useEffect((()=>{void 0!==n&&(t.length>0?i.current=n.length:n.length-i.current>r&&o())}),[o,r,t.length,n])}function sS(t,n){const[o,r]=e.useState([]),[i,s]=e.useState(!1),l=e.useRef(),a=e.useRef();return e.useEffect((()=>{const e=t;l.current=t,s(!0),n(t).then((t=>{l.current===e&&(r(t),s(!1),a.current=e)}))}),[t,n]),{items:o||[],usedQuery:a.current,loadingState:void 0===a.current?"loading-initial":i?"loading":"loaded"}}function lS(t){const n=xx().setContentEditableProps,o=Tx(),{getItems:r,suggestionMenuComponent:i,query:s,clearQuery:l,closeMenu:a,onItemClick:c}=t,d=e.useCallback((t=>{a(),l(),null==c||c(t)}),[c,a,l]),{items:h,usedQuery:u,loadingState:p}=sS(s,r);iS(h,u,a);const{selectedIndex:f}=function(t,n,o,r){const[i,s]=e.useState(0);return e.useEffect((()=>{const e=t=>"ArrowUp"===t.key?(t.preventDefault(),o.length&&s((i-1+o.length)%o.length),!0):"ArrowDown"===t.key?(t.preventDefault(),o.length&&s((i+1)%o.length),!0):"Enter"===t.key&&!t.isComposing&&(t.preventDefault(),o.length&&(null==r||r(o[i])),!0);return t.domElement.addEventListener("keydown",e,!0),()=>{t.domElement.removeEventListener("keydown",e,!0)}}),[t.domElement,o,i,r]),e.useEffect((()=>{s(0)}),[n]),{selectedIndex:0===o.length?void 0:i}}(o,s,h,d);e.useEffect((()=>(n((t=>({...t,"aria-expanded":!0,"aria-controls":"bn-suggestion-menu"}))),()=>{n((t=>({...t,"aria-expanded":!1,"aria-controls":void 0})))})),[n]),e.useEffect((()=>(n((t=>({...t,"aria-activedescendant":f?"bn-suggestion-menu-item-"+f:void 0}))),()=>{n((t=>({...t,"aria-activedescendant":void 0})))})),[n,f]);const m=i;return Ex.jsx(m,{items:h,onItemClick:d,loadingState:p,selectedIndex:f})}const aS={heading:Kx,heading_2:Zx,heading_3:Gx,numbered_list:oC,bullet_list:rC,check_list:nC,paragraph:iC,table:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M13 10V14H19V10H13ZM11 10H5V14H11V10ZM13 19H19V16H13V19ZM11 19V16H5V19H11ZM13 5V8H19V5H13ZM11 5H5V8H11V5ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3Z"},child:[]}]})(t)},image:sC,video:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM8 5V19H16V5H8ZM4 5V7H6V5H4ZM18 5V7H20V5H18ZM4 9V11H6V9H4ZM18 9V11H20V9H18ZM4 13V15H6V13H4ZM18 13V15H20V13H18ZM4 17V19H6V17H4ZM18 17V19H20V17H18Z"},child:[]}]})(t)},audio:dC,file:qx,emoji:function(t){return Ux({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM8 13C8 15.2091 9.79086 17 12 17C14.2091 17 16 15.2091 16 13H8ZM8 11C8.82843 11 9.5 10.3284 9.5 9.5C9.5 8.67157 8.82843 8 8 8C7.17157 8 6.5 8.67157 6.5 9.5C6.5 10.3284 7.17157 11 8 11ZM16 11C16.8284 11 17.5 10.3284 17.5 9.5C17.5 8.67157 16.8284 8 16 8C15.1716 8 14.5 8.67157 14.5 9.5C14.5 10.3284 15.1716 11 16 11Z"},child:[]}]})(t)}};function cS(t){return function(t){const e=[];return pb("heading",t)&&e.push({onItemClick:()=>{iw(t,{type:"heading",props:{level:1}})},badge:Gg("Mod-Alt-1"),key:"heading",...t.dictionary.slash_menu.heading},{onItemClick:()=>{iw(t,{type:"heading",props:{level:2}})},badge:Gg("Mod-Alt-2"),key:"heading_2",...t.dictionary.slash_menu.heading_2},{onItemClick:()=>{iw(t,{type:"heading",props:{level:3}})},badge:Gg("Mod-Alt-3"),key:"heading_3",...t.dictionary.slash_menu.heading_3}),pb("numberedListItem",t)&&e.push({onItemClick:()=>{iw(t,{type:"numberedListItem"})},badge:Gg("Mod-Shift-7"),key:"numbered_list",...t.dictionary.slash_menu.numbered_list}),pb("bulletListItem",t)&&e.push({onItemClick:()=>{iw(t,{type:"bulletListItem"})},badge:Gg("Mod-Shift-8"),key:"bullet_list",...t.dictionary.slash_menu.bullet_list}),pb("checkListItem",t)&&e.push({onItemClick:()=>{iw(t,{type:"checkListItem"})},badge:Gg("Mod-Shift-9"),key:"check_list",...t.dictionary.slash_menu.check_list}),pb("paragraph",t)&&e.push({onItemClick:()=>{iw(t,{type:"paragraph"})},badge:Gg("Mod-Alt-0"),key:"paragraph",...t.dictionary.slash_menu.paragraph}),pb("table",t)&&e.push({onItemClick:()=>{iw(t,{type:"table",content:{type:"tableContent",rows:[{cells:["","",""]},{cells:["","",""]}]}})},badge:void 0,key:"table",...t.dictionary.slash_menu.table}),pb("image",t)&&e.push({onItemClick:()=>{const e=iw(t,{type:"image"});t.dispatch(t._tiptapEditor.state.tr.setMeta(t.filePanel.plugin,{block:e}))},key:"image",...t.dictionary.slash_menu.image}),pb("video",t)&&e.push({onItemClick:()=>{const e=iw(t,{type:"video"});t.dispatch(t._tiptapEditor.state.tr.setMeta(t.filePanel.plugin,{block:e}))},key:"video",...t.dictionary.slash_menu.video}),pb("audio",t)&&e.push({onItemClick:()=>{const e=iw(t,{type:"audio"});t.dispatch(t._tiptapEditor.state.tr.setMeta(t.filePanel.plugin,{block:e}))},key:"audio",...t.dictionary.slash_menu.audio}),pb("file",t)&&e.push({onItemClick:()=>{const e=iw(t,{type:"file"});t.dispatch(t._tiptapEditor.state.tr.setMeta(t.filePanel.plugin,{block:e}))},key:"image",...t.dictionary.slash_menu.file}),e.push({onItemClick:()=>t.openSelectionMenu(":"),key:"emoji",...t.dictionary.slash_menu.emoji}),e}(t).map((t=>{const e=aS[t.key];return{...t,icon:Ex.jsx(e,{size:18})}}))}function dS(t){const n=Tx(),{triggerCharacter:o,suggestionMenuComponent:r,minQueryLength:i,onItemClick:s,getItems:l}=t,a=e.useMemo((()=>s||(t=>{t.onItemClick(n)})),[n,s]),c=e.useMemo((()=>l||(async t=>sw(cS(n),t))),[n,l]),d={closeMenu:n.suggestionMenus.closeMenu,clearQuery:n.suggestionMenus.clearQuery},h=Lx(e.useCallback((t=>n.suggestionMenus.onUpdate(o,t)),[n.suggestionMenus,o])),{isMounted:u,ref:p,style:f,getFloatingProps:m}=_x((null==h?void 0:h.show)||!1,(null==h?void 0:h.referencePos)||null,2e3,{placement:"bottom-start",middleware:[dk(10),pk({mainAxis:!0,crossAxis:!1}),hk(),fk({apply({availableHeight:t,elements:e}){Object.assign(e.floating.style,{maxHeight:t-10+"px"})}})],onOpenChange(t){t||n.suggestionMenus.closeMenu()}});return!u||!h||i&&(h.query.startsWith(" ")||h.query.length<i)?null:Ex.jsx("div",{ref:p,style:f,...m(),children:Ex.jsx(lS,{query:h.query,closeMenu:d.closeMenu,clearQuery:d.clearQuery,getItems:c,suggestionMenuComponent:r||rS,onItemClick:a})})}function hS(t){const n=Rx(),o=mC(),{items:r,loadingState:i,selectedIndex:s,onItemClick:l,columns:a}=t,c="loading-initial"===i||"loading"===i?Ex.jsx(n.GridSuggestionMenu.Loader,{className:"bn-grid-suggestion-menu-loader",columns:a,children:o.suggestion_menu.loading}):null,d=e.useMemo((()=>{const t=[];for(let e=0;e<r.length;e++){const o=r[e];t.push(Ex.jsx(n.GridSuggestionMenu.Item,{className:"bn-grid-suggestion-menu-item",item:o,id:`bn-grid-suggestion-menu-item-${e}`,isSelected:e===s,onClick:()=>null==l?void 0:l(o)},o.id))}return t}),[n,r,l,s]);return Ex.jsxs(n.GridSuggestionMenu.Root,{id:"bn-grid-suggestion-menu",columns:a,className:"bn-grid-suggestion-menu",children:[c,d,0===d.length&&"loaded"===t.loadingState&&Ex.jsx(n.GridSuggestionMenu.EmptyItem,{className:"bn-grid-suggestion-menu-empty-item",columns:a,children:o.suggestion_menu.no_items_title})]})}function uS(t){const n=xx().setContentEditableProps,o=Tx(),{getItems:r,gridSuggestionMenuComponent:i,query:s,clearQuery:l,closeMenu:a,onItemClick:c,columns:d}=t,h=e.useCallback((t=>{a(),l(),null==c||c(t)}),[c,a,l]),{items:u,usedQuery:p,loadingState:f}=sS(s,r);iS(u,p,a);const{selectedIndex:m}=function(t,n,o,r,i){const[s,l]=e.useState(0),a=void 0!==r&&r>1;return e.useEffect((()=>{const e=t=>("ArrowLeft"===t.key&&(t.preventDefault(),o.length&&l((s-1+o.length)%o.length)),"ArrowRight"===t.key&&(t.preventDefault(),o.length&&l((s+1+o.length)%o.length)),"ArrowUp"===t.key?(t.preventDefault(),o.length&&l((s-r+o.length)%o.length),!0):"ArrowDown"===t.key?(t.preventDefault(),o.length&&l((s+r)%o.length),!0):"Enter"===t.key&&!t.isComposing&&(t.preventDefault(),o.length&&(null==i||i(o[s])),!0));return t.domElement.addEventListener("keydown",e,!0),()=>{t.domElement.removeEventListener("keydown",e,!0)}}),[t.domElement,o,s,i,r,a]),e.useEffect((()=>{l(0)}),[n]),{selectedIndex:0===o.length?void 0:s}}(o,s,u,d,h);e.useEffect((()=>(n((t=>({...t,"aria-expanded":!0,"aria-controls":"bn-suggestion-menu"}))),()=>{n((t=>({...t,"aria-expanded":!1,"aria-controls":void 0})))})),[n]),e.useEffect((()=>(n((t=>({...t,"aria-activedescendant":m?"bn-suggestion-menu-item-"+m:void 0}))),()=>{n((t=>({...t,"aria-activedescendant":void 0})))})),[n,m]);const g=i;return Ex.jsx(g,{items:u,onItemClick:h,loadingState:f,selectedIndex:m,columns:d})}function pS(t){const n=Tx(),{triggerCharacter:o,gridSuggestionMenuComponent:r,columns:i,minQueryLength:s,onItemClick:l,getItems:a}=t,c=e.useMemo((()=>l||(t=>{t.onItemClick(n)})),[n,l]),d=e.useMemo((()=>a||(async t=>await async function(t,e){return(await Pw(t,e)).map((({id:t,onItemClick:e})=>({id:t,onItemClick:e,icon:t})))}(n,t))),[n,a]),h={closeMenu:n.suggestionMenus.closeMenu,clearQuery:n.suggestionMenus.clearQuery},u=Lx(e.useCallback((t=>n.suggestionMenus.onUpdate(o,t)),[n.suggestionMenus,o])),{isMounted:p,ref:f,style:m,getFloatingProps:g}=_x((null==u?void 0:u.show)||!1,(null==u?void 0:u.referencePos)||null,2e3,{placement:"bottom-start",middleware:[dk(10),pk(),fk({apply({availableHeight:t,elements:e}){Object.assign(e.floating.style,{maxHeight:t-10+"px"})}})],onOpenChange(t){t||n.suggestionMenus.closeMenu()}});return!p||!u||s&&(u.query.startsWith(" ")||u.query.length<s)?null:Ex.jsx("div",{ref:f,style:m,...g(),children:Ex.jsx(uS,{query:u.query,closeMenu:h.closeMenu,clearQuery:h.clearQuery,getItems:d,columns:i,gridSuggestionMenuComponent:r||hS,onItemClick:c})})}const fS=t=>{const e=Rx(),n=mC(),o=Tx();return Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{const e=t.block.content.rows[t.index].cells.map((()=>[])),n=[...t.block.content.rows];n.splice(t.index+("below"===t.side?1:0),0,{cells:e}),o.updateBlock(t.block,{type:"table",content:{type:"tableContent",rows:n}})},children:n.table_handle[`add_${t.side}_menuitem`]})},mS=t=>{const e=Rx(),n=mC(),o=Tx();return Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{const e={type:"tableContent",rows:t.block.content.rows.map((e=>{const n=[...e.cells];return n.splice(t.index+("right"===t.side?1:0),0,[]),{cells:n}}))};o.updateBlock(t.block,{type:"table",content:e})},children:n.table_handle[`add_${t.side}_menuitem`]})},gS=t=>"row"===t.orientation?Ex.jsx(fS,{...t,side:t.side}):Ex.jsx(mS,{...t,side:t.side}),yS=t=>{const e=Rx(),n=mC(),o=Tx();return Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{const e={type:"tableContent",rows:t.block.content.rows.filter(((e,n)=>n!==t.index))};o.updateBlock(t.block,{type:"table",content:e})},children:n.table_handle.delete_row_menuitem})},bS=t=>{const e=Rx(),n=mC(),o=Tx();return Ex.jsx(e.Generic.Menu.Item,{onClick:()=>{const e={type:"tableContent",rows:t.block.content.rows.map((e=>({cells:e.cells.filter(((e,n)=>n!==t.index))})))};o.updateBlock(t.block,{type:"table",content:e})},children:n.table_handle.delete_column_menuitem})},wS=t=>"row"===t.orientation?Ex.jsx(yS,{...t}):Ex.jsx(bS,{...t}),vS=t=>{const e=Rx();return Ex.jsx(e.Generic.Menu.Dropdown,{className:"bn-table-handle-menu",children:t.children||Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(wS,{orientation:t.orientation,block:t.block,index:t.index}),Ex.jsx(gS,{orientation:t.orientation,block:t.block,index:t.index,side:"row"===t.orientation?"above":"left"}),Ex.jsx(gS,{orientation:t.orientation,block:t.block,index:t.index,side:"row"===t.orientation?"below":"right"})]})})},kS=t=>{const n=Rx(),[o,r]=e.useState(!1),i=t.tableHandleMenu||vS;return Ex.jsxs(n.Generic.Menu.Root,{onOpenChange:e=>{e?(t.freezeHandles(),t.hideOtherSide()):(t.unfreezeHandles(),t.showOtherSide(),t.editor.focus())},position:"right",children:[Ex.jsx(n.Generic.Menu.Trigger,{children:Ex.jsx(n.TableHandle.Root,{className:Xg("bn-table-handle",o?"bn-table-handle-dragging":""),draggable:!0,onDragStart:e=>{r(!0),t.dragStart(e)},onDragEnd:()=>{t.dragEnd(),r(!1)},style:"column"===t.orientation?{transform:"rotate(0.25turn)"}:void 0,children:t.children||Ex.jsx(XC,{size:24,"data-test":"tableHandle"})})}),Ex.jsx(i,{orientation:t.orientation,block:t.block,index:t.index})]})};function xS(t,e,n){return n&&"row"===n.draggedCellOrientation?new DOMRect(e.x,n.mousePos,e.width,0):new DOMRect(e.x,t.y,e.width,t.height)}function CS(t,e,n){return n&&"col"===n.draggedCellOrientation?new DOMRect(n.mousePos,e.y,0,e.height):new DOMRect(t.x,e.y,t.width,e.height)}function SS(t,n,o,r,i){const{refs:s,update:l,context:a,floatingStyles:c}=qk({open:n,placement:"row"===t?"left":"top",middleware:[dk("row"===t?-10:-12)]}),{isMounted:d,styles:h}=ox(a);return e.useEffect((()=>{l()}),[o,r,l]),e.useEffect((()=>{null===o||null===r||s.setReference({getBoundingClientRect:()=>("row"===t?xS:CS)(o,r,i)})}),[i,t,o,r,s]),e.useMemo((()=>({isMounted:d,ref:s.setFloating,style:{display:"flex",...h,...c,zIndex:1e4}})),[c,d,s.setFloating,h])}const MS=t=>{var n,o;const r=Tx();if(!r.tableHandles)throw new Error("TableHandlesController can only be used when BlockNote editor schema contains table block");const i={rowDragStart:r.tableHandles.rowDragStart,colDragStart:r.tableHandles.colDragStart,dragEnd:r.tableHandles.dragEnd,freezeHandles:r.tableHandles.freezeHandles,unfreezeHandles:r.tableHandles.unfreezeHandles},s=Lx(r.tableHandles.onUpdate.bind(r.tableHandles)),l=e.useMemo((()=>{var t,e;return null!=s&&s.draggingState?{draggedCellOrientation:null==(t=null==s?void 0:s.draggingState)?void 0:t.draggedCellOrientation,mousePos:null==(e=null==s?void 0:s.draggingState)?void 0:e.mousePos}:void 0}),[null==s?void 0:s.draggingState,null==(n=null==s?void 0:s.draggingState)?void 0:n.draggedCellOrientation,null==(o=null==s?void 0:s.draggingState)?void 0:o.mousePos]),{rowHandle:a,colHandle:c}=function(t,n,o,r){const i=SS("row",t,n,o,r),s=SS("col",t,n,o,r);return e.useMemo((()=>({rowHandle:i,colHandle:s})),[s,i])}((null==s?void 0:s.show)||!1,(null==s?void 0:s.referencePosCell)||null,(null==s?void 0:s.referencePosTable)||null,l),[d,h]=e.useState(!1),[u,p]=e.useState(!1);if(!a.isMounted||!c.isMounted||!s)return null;const f=t.tableHandle||kS;return Ex.jsxs(Ex.Fragment,{children:[!d&&Ex.jsx("div",{ref:a.ref,style:a.style,children:Ex.jsx(f,{editor:r,orientation:"row",showOtherSide:()=>p(!1),hideOtherSide:()=>p(!0),index:s.rowIndex,block:s.block,dragStart:i.rowDragStart,dragEnd:i.dragEnd,freezeHandles:i.freezeHandles,unfreezeHandles:i.unfreezeHandles})}),!u&&Ex.jsx("div",{ref:c.ref,style:c.style,children:Ex.jsx(f,{editor:r,orientation:"column",showOtherSide:()=>h(!1),hideOtherSide:()=>h(!0),index:s.colIndex,block:s.block,dragStart:i.colDragStart,dragEnd:i.dragEnd,freezeHandles:i.freezeHandles,unfreezeHandles:i.unfreezeHandles})})]})};function ES(t){const e=Tx();if(!e)throw new Error("BlockNoteDefaultUI must be used within a BlockNoteContext.Provider");return Ex.jsxs(Ex.Fragment,{children:[!1!==t.formattingToolbar&&Ex.jsx(FC,{}),!1!==t.linkToolbar&&Ex.jsx(JC,{}),!1!==t.slashMenu&&Ex.jsx(dS,{triggerCharacter:"/"}),!1!==t.emojiPicker&&Ex.jsx(pS,{triggerCharacter:":",columns:10,minQueryLength:2}),!1!==t.sideMenu&&Ex.jsx(oS,{}),e.filePanel&&!1!==t.filePanel&&Ex.jsx(KC,{}),e.tableHandles&&!1!==t.tableHandles&&Ex.jsx(MS,{})]})}const TS=()=>{const t=e.useMemo((()=>{var t;return null==(t=window.matchMedia)?void 0:t.call(window,"(prefers-color-scheme: dark)")}),[]),n=e.useMemo((()=>{var t;return null==(t=window.matchMedia)?void 0:t.call(window,"(prefers-color-scheme: light)")}),[]),o=null==t?void 0:t.matches,r=null==n?void 0:n.matches,[i,s]=e.useState(o?"dark":r?"light":"no-preference");return e.useEffect((()=>{s(o?"dark":r?"light":"no-preference")}),[o,r]),e.useEffect((()=>{if("function"==typeof(null==t?void 0:t.addEventListener)){const e=({matches:t})=>t&&s("dark"),o=({matches:t})=>t&&s("light");return null==t||t.addEventListener("change",e),null==n||n.addEventListener("change",o),()=>{null==t||t.removeEventListener("change",e),null==n||n.removeEventListener("change",o)}}{const e=()=>s(t.matches?"dark":n.matches?"light":"no-preference");return null==t||t.addEventListener("change",e),null==n||n.addEventListener("change",e),()=>{null==t||t.removeEventListener("change",e),null==n||n.removeEventListener("change",e)}}}),[t,n]),i},OS=({renderers:t})=>Ex.jsx(Ex.Fragment,{children:Object.entries(t).map((([t,e])=>n.createPortal(e.reactElement,e.element,t)))});function AS(t){const[n,o]=e.useState({});return e.useEffect((()=>(t.editor._tiptapEditor.contentComponent={setRenderer(t,e){o((n=>({...n,[t]:e})))},removeRenderer(t){o((e=>{const n={...e};return delete n[t],n}))}},queueMicrotask((()=>{t.editor._tiptapEditor.createNodeViews()})),()=>{t.editor._tiptapEditor.contentComponent=null})),[t.editor._tiptapEditor]),Ex.jsxs(Ex.Fragment,{children:[Ex.jsx(OS,{renderers:n}),t.children]})}const NS=e.forwardRef(((t,o)=>{const[r,i]=e.useState();return e.useImperativeHandle(o,(()=>(t,e)=>{n.flushSync((()=>{i({node:t,container:e})})),i(void 0)}),[]),Ex.jsx(Ex.Fragment,{children:r&&n.createPortal(r.node,r.container)})})),_S=()=>{};const LS=r.forwardRef((function(t,n){const{editor:o,className:r,theme:i,children:s,editable:l,onSelectionChange:a,onChange:c,formattingToolbar:d,linkToolbar:h,slashMenu:u,emojiPicker:p,sideMenu:f,filePanel:m,tableHandles:g,...y}=t,[b,w]=e.useState(),v=xx(),k=TS(),x=(null==v?void 0:v.colorSchemePreference)||k,C=i||("dark"===x?"dark":"light");Ox(c||_S,o),Ax(a||_S,o),e.useEffect((()=>{o.isEditable=!1!==l}),[l,o]);const S=e.useMemo((()=>Ex.jsxs(Ex.Fragment,{children:[s,Ex.jsx(ES,{formattingToolbar:d,linkToolbar:h,slashMenu:u,emojiPicker:p,sideMenu:f,filePanel:m,tableHandles:g})]})),[s,d,h,u,p,f,m,g]),M=e.useMemo((()=>({...v,editor:o,setContentEditableProps:w})),[v,o]),E=e.useCallback((t=>{o.elementRenderer=t}),[o]);return Ex.jsxs(kx.Provider,{value:M,children:[Ex.jsx(NS,{ref:E}),!o.headless&&Ex.jsx(AS,{editor:o,children:Ex.jsxs("div",{className:Xg("bn-container",C||"",r||""),"data-color-scheme":C,...y,ref:n,children:[Ex.jsx("div",{"aria-autocomplete":"list","aria-haspopup":"listbox",ref:o.mount,...b}),S]})})]})}));var DS,RS=i;function IS(t,e){let o;const r=document.createElement("div");let i;if(null!=e&&e.elementRenderer?e.elementRenderer(t((t=>o=t||void 0)),r):(i=DS(r),n.flushSync((()=>{i.render(t((t=>o=t||void 0)))}))),!r.childElementCount)return{dom:document.createElement("span")};null==o||o.setAttribute("data-tmp-find","true");const s=r.cloneNode(!0),l=s.firstElementChild,a=s.querySelector("[data-tmp-find]");return null==a||a.removeAttribute("data-tmp-find"),null==i||i.unmount(),{dom:l,contentDOM:a||void 0}}function PS(t){var e;return Ex.jsx(yx,{...Object.fromEntries(Object.entries(t.domAttributes||{}).filter((([t])=>"class"!==t))),className:Xg("bn-block-content",(null==(e=t.domAttributes)?void 0:e.class)||""),"data-content-type":t.blockType,...Object.fromEntries(Object.entries(t.blockProps).filter((([e,n])=>!ny.includes(e)&&n!==t.propSchema[e].default)).map((([t,e])=>[oy(t),e]))),"data-file-block":!0===t.isFileBlock||void 0,children:t.children})}function HS(t,e){const n=ay({name:t.type,content:"inline"===t.content?"inline*":"",group:"blockContent",selectable:!0,addAttributes:()=>iy(t.propSchema),parseHTML:()=>uy(t,e.parse),renderHTML(){const t=document.createElement("div");return t.setAttribute("data-tmp-placeholder","true"),{dom:t}},addNodeView(){return n=>vx((n=>{var o;const r=this.options.editor,i=sy(n.getPos,r,this.editor,t.type),s=(null==(o=this.options.domAttributes)?void 0:o.blockContent)||{},l=gx({}).ref,a=e.render;return Ex.jsx(PS,{blockType:i.type,blockProps:i.props,propSchema:t.propSchema,isFileBlock:t.isFileBlock,domAttributes:s,children:Ex.jsx(a,{block:i,editor:r,contentRef:l})})}),{className:"bn-react-node-view-renderer"})(n)}});return cy(t,{node:n,toInternalHTML:(o,r)=>{var i,s;const l=(null==(i=n.options.domAttributes)?void 0:i.blockContent)||{},a=e.render,c=IS((e=>Ex.jsx(PS,{blockType:o.type,blockProps:o.props,propSchema:t.propSchema,domAttributes:l,children:Ex.jsx(a,{block:o,editor:r,contentRef:e})})),r);return null==(s=c.contentDOM)||s.setAttribute("data-editable",""),c},toExternalHTML:(o,r)=>{var i,s;const l=(null==(i=n.options.domAttributes)?void 0:i.blockContent)||{},a=e.toExternalHTML||e.render,c=IS((e=>Ex.jsx(PS,{blockType:o.type,blockProps:o.props,propSchema:t.propSchema,domAttributes:l,children:Ex.jsx(a,{block:o,editor:r,contentRef:e})})),r);return null==(s=c.contentDOM)||s.setAttribute("data-editable",""),c}})}DS=RS.createRoot,RS.hydrateRoot;const VS=t=>Ex.jsxs("div",{className:"bn-file-default-preview",contentEditable:!1,draggable:!1,children:[Ex.jsx("div",{className:"bn-file-default-preview-icon",children:Ex.jsx(qx,{size:24})}),Ex.jsx("p",{className:"bn-file-default-preview-name",children:t.block.props.name})]}),BS=t=>Ex.jsxs("div",{className:"bn-file-and-caption-wrapper",children:[t.children,t.block.props.caption&&Ex.jsx("p",{className:"bn-file-caption",children:t.block.props.caption})]}),jS=t=>{const n=e.useCallback((t=>{t.preventDefault()}),[]),o=e.useCallback((()=>{t.editor.dispatch(t.editor._tiptapEditor.state.tr.setMeta(t.editor.filePanel.plugin,{block:t.block}))}),[t.block,t.editor]);return Ex.jsxs("div",{className:"bn-add-file-button",onMouseDown:n,onClick:o,children:[Ex.jsx("div",{className:"bn-add-file-button-icon",children:t.buttonIcon||Ex.jsx(qx,{size:24})}),Ex.jsx("div",{className:"bn-add-file-button-text",children:t.buttonText})]})},zS=t=>Ex.jsxs("div",{children:[t.children,Ex.jsx("p",{children:t.caption})]}),FS=t=>Ex.jsxs("figure",{children:[t.children,Ex.jsx("figcaption",{children:t.caption})]}),$S=t=>{const[n,o]=e.useState(!1),[r,i]=e.useState(void 0);e.useEffect((()=>{const e=e=>{let n;n="center"===t.block.props.textAlignment?"left"===r.handleUsed?r.initialWidth+2*(r.initialClientX-e.clientX):r.initialWidth+2*(e.clientX-r.initialClientX):"left"===r.handleUsed?r.initialWidth+r.initialClientX-e.clientX:r.initialWidth+e.clientX-r.initialClientX;n<64?t.setWidth(64):n>t.editor.domElement.firstElementChild.clientWidth?t.setWidth(t.editor.domElement.firstElementChild.clientWidth):t.setWidth(n)},n=()=>{i(void 0),t.editor.updateBlock(t.block,{props:{previewWidth:t.width}})};return r&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",n)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}}),[t,r]);const s=e.useCallback((()=>{t.editor.isEditable&&o(!0)}),[t.editor.isEditable]),l=e.useCallback((()=>{o(!1)}),[]),a=e.useCallback((e=>{e.preventDefault(),i({handleUsed:"left",initialWidth:t.width,initialClientX:e.clientX})}),[t.width]),c=e.useCallback((e=>{e.preventDefault(),i({handleUsed:"right",initialWidth:t.width,initialClientX:e.clientX})}),[t.width]);return Ex.jsxs("div",{className:"bn-visual-media-wrapper",onMouseEnter:s,onMouseLeave:l,children:[t.children,(n||r)&&Ex.jsxs(Ex.Fragment,{children:[Ex.jsx("div",{className:"bn-visual-media-resize-handle",style:{left:"4px"},onMouseDown:a}),Ex.jsx("div",{className:"bn-visual-media-resize-handle",style:{right:"4px"},onMouseDown:c})]})]})};function US(t){const n=Tx(),[o,r]=e.useState("loading"),[i,s]=e.useState();if(e.useEffect((()=>{let e=!0;return(async()=>{let o="";r("loading");try{o=await n.resolveFileUrl(t)}catch{return void r("error")}e&&(r("loaded"),s(o))})(),()=>{e=!1}}),[n,t]),"loaded"!==o)return{loadingState:o};if(!i)throw new Error("Finished fetching file but did not get download URL.");return{loadingState:o,downloadUrl:i}}const WS=t=>{const e=US(t.block.props.url);return"loading"===e.loadingState?null:Ex.jsx("audio",{className:"bn-audio",src:e.downloadUrl,controls:!0,contentEditable:!1,draggable:!1})},qS=t=>{if(!t.block.props.url)return Ex.jsx("p",{children:"Add audio"});const e=t.block.props.showPreview?Ex.jsx("audio",{src:t.block.props.url}):Ex.jsx("a",{href:t.block.props.url,children:t.block.props.name||t.block.props.url});return t.block.props.caption?t.block.props.showPreview?Ex.jsx(FS,{caption:t.block.props.caption,children:e}):Ex.jsx(zS,{caption:t.block.props.caption,children:e}):e};HS(Ey,{render:t=>Ex.jsx("div",{className:"bn-file-block-content-wrapper",children:""===t.block.props.url?Ex.jsx(jS,{...t,editor:t.editor,buttonText:t.editor.dictionary.file_blocks.audio.add_button_text,buttonIcon:Ex.jsx(dC,{size:24})}):t.block.props.showPreview?Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(WS,{block:t.block,editor:t.editor})}):Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(VS,{block:t.block,editor:t.editor})})}),parse:Ty,toExternalHTML:t=>Ex.jsx(qS,{...t})});const JS=t=>{if(!t.block.props.url)return Ex.jsx("p",{children:"Add file"});const e=Ex.jsx("a",{href:t.block.props.url,children:t.block.props.name||t.block.props.url});return t.block.props.caption?Ex.jsx(zS,{caption:t.block.props.caption,children:e}):e};HS(Ay,{render:t=>Ex.jsx("div",{className:"bn-file-block-content-wrapper",children:""===t.block.props.url?Ex.jsx(jS,{block:t.block,editor:t.editor,buttonIcon:Ex.jsx(qx,{size:24}),buttonText:t.editor.dictionary.file_blocks.file.add_button_text}):Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(VS,{block:t.block,editor:t.editor})})}),parse:Ny,toExternalHTML:t=>Ex.jsx(JS,{...t})});const KS=t=>{const[n,o]=e.useState(Math.min(t.block.props.previewWidth,t.editor.domElement.firstElementChild.clientWidth)),r=US(t.block.props.url);return"loading"===r.loadingState?null:Ex.jsx($S,{...t,width:n,setWidth:o,children:Ex.jsx("img",{className:"bn-visual-media",src:r.downloadUrl,alt:t.block.props.caption||"BlockNote image",contentEditable:!1,draggable:!1,width:n})})},ZS=t=>{if(!t.block.props.url)return Ex.jsx("p",{children:"Add image"});const e=t.block.props.showPreview?Ex.jsx("img",{src:t.block.props.url,alt:t.block.props.name||t.block.props.caption||"BlockNote image",width:t.block.props.previewWidth}):Ex.jsx("a",{href:t.block.props.url,children:t.block.props.name||t.block.props.url});return t.block.props.caption?t.block.props.showPreview?Ex.jsx(FS,{caption:t.block.props.caption,children:e}):Ex.jsx(zS,{caption:t.block.props.caption,children:e}):e};HS(Dy,{render:t=>Ex.jsx("div",{className:"bn-file-block-content-wrapper",children:""===t.block.props.url?Ex.jsx(jS,{...t,editor:t.editor,buttonText:t.editor.dictionary.file_blocks.image.add_button_text,buttonIcon:Ex.jsx(sC,{size:24})}):t.block.props.showPreview?Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(KS,{block:t.block,editor:t.editor})}):Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(VS,{block:t.block,editor:t.editor})})}),parse:Ry,toExternalHTML:t=>Ex.jsx(ZS,{...t})});const GS=t=>{const[n,o]=e.useState(Math.min(t.block.props.previewWidth,t.editor.domElement.firstElementChild.clientWidth)),r=US(t.block.props.url);return"loading"===r.loadingState?null:Ex.jsx($S,{...t,width:n,setWidth:o,children:Ex.jsx("video",{className:"bn-visual-media",src:r.downloadUrl,controls:!0,contentEditable:!1,draggable:!1,width:n})})},XS=t=>{if(!t.block.props.url)return Ex.jsx("p",{children:"Add video"});const e=t.block.props.showPreview?Ex.jsx("video",{src:t.block.props.url}):Ex.jsx("a",{href:t.block.props.url,children:t.block.props.name||t.block.props.url});return t.block.props.caption?t.block.props.showPreview?Ex.jsx(FS,{caption:t.block.props.caption,children:e}):Ex.jsx(zS,{caption:t.block.props.caption,children:e}):e};function YS(t){return Ex.jsx(yx,{as:"span",className:"bn-inline-content-section","data-inline-content-type":t.inlineContentType,...Object.fromEntries(Object.entries(t.inlineContentProps).filter((([e,n])=>n!==t.propSchema[e].default)).map((([t,e])=>[oy(t),e]))),children:t.children})}function QS(t,e){const n=ay({name:t.type,inline:!0,group:"inline",selectable:"styled"===t.content,atom:"none"===t.content,content:"styled"===t.content?"inline*":"",addAttributes:()=>iy(t.propSchema),addKeyboardShortcuts:()=>function(t){return{Backspace:({editor:e})=>{const n=e.state.selection.$from;return e.state.selection.empty&&n.node().type.name===t.type&&0===n.parentOffset}}}(t),parseHTML:()=>function(t){return[{tag:`[data-inline-content-type="${t.type}"]`,contentElement:t=>{const e=t;return e.matches("[data-editable]")?e:e.querySelector("[data-editable]")||e}}]}(t),renderHTML({node:n}){const o=this.options.editor,r=zg(n,o.schema.inlineContentSchema,o.schema.styleSchema),i=e.render;return function(t,e,n,o){return t.dom.setAttribute("data-inline-content-type",e),Object.entries(n).filter((([t,e])=>e!==o[t].default)).map((([t,e])=>[oy(t),e])).forEach((([e,n])=>t.dom.setAttribute(e,n))),void 0!==t.contentDOM&&t.contentDOM.setAttribute("data-editable",""),t}(IS((t=>Ex.jsx(i,{inlineContent:r,contentRef:t})),o),t.type,n.attrs,t.propSchema)},addNodeView(){const n=this.options.editor;return o=>vx((o=>{const r=gx({}).ref,i=e.render;return Ex.jsx(YS,{inlineContentProps:o.node.attrs,inlineContentType:t.type,propSchema:t.propSchema,children:Ex.jsx(i,{contentRef:r,inlineContent:zg(o.node,n.schema.inlineContentSchema,n.schema.styleSchema)})})}),{className:"bn-ic-react-node-view-renderer",as:"span"})(o)}});return function(t,e){return{config:t,implementation:e}}(t,{node:n})}function tM(t,e){const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=n.top<o.top,i=n.bottom>o.bottom;return r&&i?"both":r?"top":i?"bottom":"none"}HS(Hy,{render:t=>Ex.jsx("div",{className:"bn-file-block-content-wrapper",children:""===t.block.props.url?Ex.jsx(jS,{...t,editor:t.editor,buttonText:t.editor.dictionary.file_blocks.video.add_button_text,buttonIcon:Ex.jsx(cC,{size:24})}):t.block.props.showPreview?Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(GS,{block:t.block,editor:t.editor})}):Ex.jsx(BS,{block:t.block,editor:t.editor,children:Ex.jsx(VS,{block:t.block,editor:t.editor})})}),parse:Vy,toExternalHTML:t=>Ex.jsx(XS,{...t})});export{cS as A,QS as B,Yg as E,Hk as F,Dx as M,Ow as N,tM as O,LS as S,sw as U,dS as Z,Zv as a,gk as b,fk as c,Pk as d,Xk as e,pk as f,tv as g,Dk as h,mk as i,Jk as j,ey as k,uk as l,Qk as m,Uk as n,dk as o,Vk as p,TS as q,Xg as r,hk as s,ab as t,qk as u,Dw as v,HS as w,Lg as x,hb as y,xx as z};
