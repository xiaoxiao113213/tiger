import{r as e,F as a,j as s,X as l,I as r,O as t,R as i,S as d,ab as n,aL as o,a7 as m,B as c,K as p,c as u,b5 as j,Y as x,b6 as h,b7 as f,m as b}from"./index-f2321b57.js";import w from"./menuComponent-cf7a3f66.js";import{d as C}from"./Password-38003184.js";import{menuApplicationTreeApi as I}from"./api-6523b4c3.js";import{roleAllApi as y}from"./api-5c5bfeed.js";import{deptPageApi as g}from"./api-df708061.js";import{M as v}from"./MinusCircleOutlined-ede52421.js";import{P as q}from"./PlusOutlined-0e19b652.js";import"./Input-f009b856.js";import"./MinusCircleOutlined-47af1d51.js";const A=A=>{const[k,F]=e.useState(!1),[S]=a.useForm(),[L,O]=e.useState([]),[E,M]=e.useState([]),[N,P]=e.useState([]),[T,K]=e.useState([]),[z,D]=e.useState({applicationList:[],menu:[]});e.useEffect((()=>((async()=>{if(I({}).then((e=>{if(u(e))return;let a=e.data;O(a)})),y({}).then((e=>{P(e.data)})),g({}).then((e=>{M(e.data)})),A.operateEnum===t.add)return;F(!0);const e=await j({id:A.detailId});e.data.roleIds=e.data.roleList.map((e=>e.id)),K(e.data.roleList),D(e.data),S.setFieldsValue(e.data),F(!1)})(),()=>{})),[]);return s.jsx("div",{children:s.jsx(l,{spinning:k,children:s.jsxs(a,{form:S,labelCol:{flex:"10%"},wrapperCol:{flex:"90%"},children:[s.jsx(a.Item,{label:"账号",name:"account",rules:[{required:!0}],children:s.jsx(r,{placeholder:"请输入",autoComplete:"new-password",disabled:A.operateEnum===t.edit})}),s.jsx(a.Item,{label:"昵称",name:"nickName",rules:[{required:!0}],children:s.jsx(r,{placeholder:"请输入",autoComplete:"new-password"})}),s.jsx(a.Item,{label:"手机号",name:"phone",rules:[{required:!0}],children:s.jsx(r,{placeholder:"请输入",autoComplete:"new-password"})}),A.operateEnum===t.add&&s.jsx(a.Item,{label:"密码",name:"password",rules:[{required:!0}],children:s.jsx(C,{placeholder:"请输入",autoComplete:"new-password"})}),s.jsx(a.Item,{label:"状态",name:"disabled",rules:[{required:!0}],children:s.jsxs(i.Group,{children:[s.jsx(i,{value:0,children:" 启用 "}),s.jsx(i,{value:1,children:" 禁用 "})]})}),s.jsx(a.Item,{label:"角色",name:"roleIds",rules:[{required:!0}],children:s.jsx(d,{mode:"multiple",options:N,fieldNames:{label:"name",value:"id"},onChange:async e=>{const a=[];N.filter((s=>{e.includes(s.id)&&a.push(s)})),K(a)}})}),s.jsx(a.Item,{label:"邮箱",name:"email",rules:[{required:!0}],children:s.jsx(r,{placeholder:"请输入",autoComplete:"new-password"})}),s.jsx(n,{children:"所属部门"}),s.jsx(a.List,{name:"deptList",children:(e,{add:l,remove:r})=>s.jsxs(s.Fragment,{children:[e.map((({key:e,name:l,...t})=>s.jsx("div",{className:"mySpace",children:s.jsxs(o,{align:"baseline",children:[s.jsx(a.Item,{...t,name:[l,"deptId"],rules:[{required:!0,message:"请选择部门"}],children:s.jsx(m,{placeholder:"请选择部门",treeDefaultExpandAll:!0,fieldNames:{label:"name",value:"id"},treeData:E})}),s.jsx(a.Item,{...t,name:[l,"owner"],rules:[{required:!0,message:"请选择关系"}],children:s.jsx(d,{placeholder:"请选择关系",options:[{value:0,label:"员工"},{value:1,label:"负责人"}]})}),s.jsx("div",{className:"myCenter",children:s.jsx(v,{style:{textAlign:"right"},onClick:()=>r(l)})})]},e)},e))),s.jsx(a.Item,{children:s.jsx(c,{type:"dashed",onClick:()=>l(),block:!0,icon:s.jsx(q,{}),children:"Add field"})})]})}),s.jsx(n,{}),s.jsx(a.Item,{label:"个人简介",name:"remarks",children:s.jsx(r.TextArea,{allowClear:!0})}),s.jsx(p,{defaultActiveKey:"0",type:"card",size:"large",children:T.map(((e,a)=>s.jsx(p.TabPane,{tab:e.name,children:s.jsx(p,{defaultActiveKey:"0",type:"card",size:"large",children:L.map(((a,l)=>s.jsx(p.TabPane,{tab:a.name,children:s.jsx(w,{application:a,roleId:e.id})},l)))},"application")},a)))},"role"),s.jsxs(a.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[s.jsx(c,{type:"default",onClick:()=>{A.setAddOrUpdateModalFn(t.close)},style:{marginRight:20},children:"取消"}),s.jsx(c,{type:"primary",onClick:async()=>{if(!(await S.validateFields().catch((()=>!1))))return;const e=await(S?.getFieldsValue());let a;if(x(e),z?.id)a=await h({...e,id:z?.id});else{let s=e.password;a=await f({...e,password:s,type:1})}1e3===a?.code&&(b.success(a?.msg),A.reloadTable(),A.setAddOrUpdateModalFn(t.close),F(!1))},children:"确定"})]})]})})})};export{A as default};
