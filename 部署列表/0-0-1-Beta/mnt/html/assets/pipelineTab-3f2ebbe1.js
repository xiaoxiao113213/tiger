import{F as t,r as e,j as i,O as s,B as o,al as a,K as r,Y as p,m,aj as l}from"./index-10719960.js";import n from"./pipelineMainAdd-0371e0db.js";import{pipelineNodeAllApi as d}from"./api-8371e36c.js";import{otherAccountAllApi as j}from"./api-7031d208.js";import{clientToServerValueItem as u,serverToClientValue as c,FormFieldTypeEnum as y}from"./Bo-bcadefc8.js";import{pipelineUpdateApi as f,pipelineSaveApi as x,pipelineGetOneApi as S}from"./pipeline-be6907e2.js";import"./index-7ad95df9.js";import"./stageComponent-b0f799c8.js";import"./context-c276b1a2.js";import"./stepComponent-620b8d99.js";import"./api-94733e85.js";import"./index-0e948b02.js";import"./submitNowform-3ec5b855.js";import"./textSubmit-5aad76e3.js";import"./textAreaSubmit-e3064045.js";import"./SelectSubmit-fba154f7.js";import"./MutSelectSubmit-7d2986fa.js";import"./DateSubmit-7b5457eb.js";import"./NumberSubmit-61c4b5e2.js";import"./FileUploadSubmit-b86f5e72.js";import"./PlusOutlined-cc4f568a.js";import"./index-30b704bf.js";import"./PipelineFlow-0c7a4917.js";import"./index-937e9b10.js";/* empty css              */import"./uilts-00b5353e.js";import"./StartNode-2feb9deb.js";/* empty css             */import"./dataUtil-c2f8121e.js";import"./StageNode-4ee0bf33.js";import"./StepNode-89f08ed0.js";import"./CustomEdge-98f3759d.js";import"./index-fb93998c.js";import"./FileSubmit-52898802.js";import"./formComponent-402c7b18.js";import"./Title-5ea514a5.js";import"./Input-f4f01092.js";import"./TextArea-8948f20d.js";import"./customerFieldNew-bd52e5d5.js";import"./customerText-ab37e497.js";import"./customerTextArea-fdf43c64.js";import"./customerSelect-0b789148.js";import"./MinusCircleOutlined-f32dd4d0.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-2ed19145.js";import"./CustomerFile-b6b47294.js";import"./CustomerDate-c212afd9.js";import"./customerNumber-f42eabd0.js";import"./DeleteOutlined-91444ec2.js";const b=b=>{const[F]=t.useForm(),[h,v]=e.useState(),[T,g]=e.useState([]),[C,L]=e.useState([]),[w,A]=e.useState([]),[E]=t.useForm(),[N,O]=e.useState([]),P=[{key:"1",label:"主配置",children:i.jsx("div",{children:void 0!==h&&i.jsx(n,{detail:h,setDetailFn:v,pipelineNodeList:T,detailFormRef:F,openType:b.openType,softList:C,otherAccountList:w,globalFieldList:N,setGlobalFieldList:O})})}],k=t=>{t.globalParamList?.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(",")),t.type,y.password})),l(t.pipelineStageList??[]).forEach((t=>{t?.paramList.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(","))}))}))},D=i.jsxs("div",{children:[b.openType!==s.detail&&i.jsx(o,{type:"primary",onClick:async()=>{if(b.openType===s.detail)return void b.setOpenTypeFn(s.close);if(!(await F.validateFields().catch((()=>!1))))return;const t=await(F?.getFieldsValue());p(t);if(!(await E.validateFields().catch((()=>!1))))return void m.warning("有必填项未填");const e=N.map((t=>{const e={...t};return u(e),e}));let i;if(h?.id){let t={...h,globalParamList:e};k(a(t)),i=await f(a(t))}else{let s={...h,...t,globalParamList:e};k(a(s)),i=await x(a(s))}1e3===i?.code&&(m.success(i?.msg),b.reloadTable(),b.setOpenTypeFn(s.close))},children:"确认"}),i.jsx(o,{type:"default",style:{marginLeft:10},onClick:()=>b.setOpenTypeFn(s.close),children:"取消"})]});return e.useEffect((()=>((async()=>{d({}).then((t=>{g(t.data)})),L([{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}]),j({}).then((t=>{t.data.forEach((t=>t.id=t.id+"")),A(t.data)}))})(),b.openType===s.add?v(a({parallel:0,timer:0,timerCron:0,email:0,pipelineStageList:[]})):b.openType!==s.edit&&b.openType!==s.detail||(async t=>{const e=await S({id:t});if(1e3!==e?.code)return;v({...e.data});const i=e.data.globalParamList??[];i.forEach((t=>{c(t)})),O(i),F?.setFieldsValue({...e.data}),e.data.permissionList})(b.detailId),()=>{})),[b.openType]),i.jsx("div",{children:i.jsx(r,{defaultActiveKey:"1",items:P,onChange:t=>{},tabBarExtraContent:D})})};export{b as default};
