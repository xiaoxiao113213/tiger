import{F as e,r as t,d as a,j as s,S as r,O as i,I as l,ac as d,B as o,a8 as n,a9 as m,Y as p,m as u}from"./index-52537ad8.js";import{projectIssueGetOneApi as c,projectIssueUpdateApi as j,projectIssueSaveApi as h}from"./api-2b18985a.js";import{F as x}from"./FileUploadCom-4d839597.js";import{p as f}from"./ProjectDic-3e15bdd8.js";import{I}from"./IssueTypeDic-2581ac45.js";import{serverToClientValue as b,serverToClientValue1 as S,clientToServerValue1 as D}from"./Bo-cc27e439.js";import{f as F,a as w}from"./utils-490c67f2.js";import{projectCustomFieldAllApi as v}from"./api-85a9c682.js";import y from"./submitNowform-370ac6e7.js";import{projectReleaseAllApi as q}from"./api-4e3a6b26.js";import"./PlusOutlined-0403edcb.js";import"./dicApi-f974ede5.js";import"./textSubmit-f698ce92.js";import"./textAreaSubmit-9cc0fcd3.js";import"./SelectSubmit-a0546f42.js";import"./MutSelectSubmit-978c5f1c.js";import"./DateSubmit-7515399a.js";import"./NumberSubmit-d54ed6cf.js";import"./FileUploadSubmit-1e28b47f.js";const g=g=>{const[C]=e.useForm(),[U,E]=t.useState(a),[O,L]=t.useState(),{ProjectList:P}=f(),{IssueTypeList:V}=I(),[A,R]=t.useState(),[T,_]=t.useState([]);if(t.useEffect((()=>((async()=>{q({projectId:g.defaultProjectId}).then((e=>{_(e.data)}));const e=(await v({bizType:"2"})).data;e.forEach((e=>{const t=e.projectCustomFieldId,a=e;b(a),a.id=t+"_customField"})),R(e);const t=await n();if(t.data.forEach((e=>e.value=e.value.toString())),L(t.data),g.operateEnum===i.edit){let t=await c({projectIssueId:g.detailId});t.data.planEndDate=t.data.planEndDate?m(t.data.planEndDate):void 0,t.data.planStartDate=t.data.planStartDate?m(t.data.planStartDate):void 0,t.data.startDate=t.data.startDate?m(t.data.startDate):void 0,t.data.endDate=t.data.endDate?m(t.data.endDate):void 0,t.data.headUserId=0==t.data.headUserId?void 0:t.data.headUserId,t.data.reporterUserId=0==t.data.reporterUserId?void 0:t.data.reporterUserId,t.data.fileList=F(t.data.fileList),E(t.data);for(let a in t.data.customValues)if(t.data.customValues.hasOwnProperty(a)){const s=a.split("_");if(2===s.length){const r=s[0];t.data.customValues[a]=S(e.find((e=>e.projectCustomFieldId==r)),t.data.customValues[a])}}C.setFieldsValue({...t.data,...t.data.customValues})}else C.setFieldsValue({projectId:g.defaultProjectId})})(),()=>{})),[]),void 0===A)return s.jsx("div",{});return s.jsx("div",{children:s.jsxs(e,{form:C,labelCol:{flex:"120px"},children:[s.jsx(e.Item,{label:"所属项目",name:"projectId",rules:[{required:!0}],children:s.jsx(r,{options:P,disabled:!0})}),s.jsx(e.Item,{label:"所属版本",name:"projectReleaseId",rules:[{required:!1}],children:s.jsx(r,{allowClear:!0,options:T})}),s.jsx(e.Item,{label:"类型",name:"type",rules:[{required:!0}],children:s.jsx(r,{options:V,disabled:g.operateEnum==i.edit})}),s.jsx(e.Item,{label:"标题",name:"name",rules:[{required:!0}],children:s.jsx(l,{placeholder:"请输入",maxLength:200,showCount:!0})}),s.jsx(e.Item,{label:"计划开始时间",name:"planStartDate",rules:[{required:!0}],children:s.jsx(d,{placeholder:"请选择"})}),s.jsx(e.Item,{label:"计划结束时间",name:"planEndDate",rules:[{required:!0}],children:s.jsx(d,{placeholder:"请选择"})}),s.jsx(e.Item,{label:"开始时间",name:"startDate",rules:[{required:!1}],children:s.jsx(d,{placeholder:"请选择"})}),s.jsx(e.Item,{label:"结束时间",name:"endDate",rules:[{required:!1}],children:s.jsx(d,{placeholder:"请选择",onChange:e=>{}})}),s.jsx(e.Item,{label:"描述",name:"remarks",rules:[{required:!1}],children:s.jsx(l.TextArea,{placeholder:"请输入",maxLength:1900,showCount:!0,autoSize:{minRows:2,maxRows:5}})}),s.jsx(e.Item,{label:"优先级",name:"priority",rules:[{required:!0}],initialValue:0,children:s.jsxs(r,{defaultActiveFirstOption:!0,children:[s.jsx(r.Option,{value:0,children:"一般"}),s.jsx(r.Option,{value:1,children:"重要"}),s.jsx(r.Option,{value:2,children:"紧急"})]})}),s.jsx(e.Item,{label:"负责人",name:"headUserId",rules:[{required:!0}],children:s.jsx(r,{placeholder:"请选择",options:O,optionFilterProp:"label",showSearch:!0})}),s.jsx(e.Item,{label:"报告人",name:"reporterUserId",rules:[{required:!1}],children:s.jsx(r,{placeholder:"请选择",options:O,optionFilterProp:"label",showSearch:!0})}),s.jsx(x,{name:"fileList",label:"附件",required:!1}),A.map((e=>s.jsx(y,{initFieldBo:e},e.id))),s.jsxs(e.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[s.jsx(o,{type:"default",onClick:()=>{g.setAddOrUpdateModalFn(i.close)},style:{marginRight:20},children:"取消"}),s.jsx(o,{type:"primary",onClick:async()=>{if(!(await C.validateFields().catch((()=>!1))))return;const e=await(C?.getFieldsValue());p(e);for(let a in e)if(e.hasOwnProperty(a)){const t=a.split("_");if(2===t.length){const s=t[0];e[t[0]]=D(A.find((e=>e.projectCustomFieldId==s)),e[a]),delete e[a]}}let t;e.fileList=w(e.fileList),t=g.operateEnum===i.edit?await j({...e,projectIssueId:g.detailId}):await h({...e}),1e3===t.code&&(u.success(t.msg),g.reloadTable(),g.setAddOrUpdateModalFn(i.close))},children:"确定"})]})]})})};export{g as default};
