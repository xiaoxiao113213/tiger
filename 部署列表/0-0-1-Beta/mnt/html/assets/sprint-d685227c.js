import{F as e,r as s,j as t,S as r,Q as i,ay as a,V as d,W as o,O as l,B as p,T as n,ax as c,D as u}from"./index-10719960.js";import{d as j}from"./Title-5ea514a5.js";import{p as m}from"./ProjectDic-9dcf0c8c.js";import{projectReleaseAllApi as x}from"./api-eca3f0b9.js";import{projectIssueHeadUserListApi as I,projectIssueListForReleaseApi as h,projectIssueGetOneApi as f,projectIssueUpdateStatusSortApi as b}from"./api-edca4be6.js";import{I as y}from"./IssueTypeDic-d753241c.js";import g from"./detail-7f60a31d.js";import v from"./addOrUpdate-2349da75.js";import{C as w}from"./index-30b704bf.js";import{E as S}from"./EditOutlined-34dfcda0.js";import"./Input-f4f01092.js";import"./TextArea-8948f20d.js";import"./api-20821f6a.js";import"./dicApi-19a4777b.js";import"./FileView-2fed186d.js";import"./index-24e8ffcd.js";import"./Bo-bcadefc8.js";import"./index-be16395f.js";import"./index-4b23e8f2.js";import"./FileUploadCom-c3fb6dc0.js";import"./PlusOutlined-cc4f568a.js";import"./utils-452b7114.js";import"./submitNowform-3ec5b855.js";import"./textSubmit-5aad76e3.js";import"./textAreaSubmit-e3064045.js";import"./SelectSubmit-fba154f7.js";import"./MutSelectSubmit-7d2986fa.js";import"./DateSubmit-7b5457eb.js";import"./NumberSubmit-61c4b5e2.js";import"./FileUploadSubmit-b86f5e72.js";const k=d=>{const[o]=e.useForm(),{IssueTypeMap:l}=y(),[p,n]=s.useState([]),[c,u]=s.useState([]),[j,g]=s.useState([]),[v,S]=s.useState([]),{ProjectList:k,ProjectMap:M,ProjectValueEnum:P,refreshData:F}=m(),[T,D]=s.useState(),[E,R]=s.useState(),[L,U]=s.useState(),[V,O]=s.useState(),A=()=>{n([]),u([]),g([]),S([]),R([])};s.useEffect((()=>{k.length>0?(U(k[0].value),o.setFieldsValue({projectId:k[0].value})):(U(void 0),o.setFieldsValue({projectId:void 0}),A())}),[k]),s.useEffect((()=>{L?x({projectId:L,status:"1"}).then((e=>{D(e.data)})):D([])}),[L]),s.useEffect((()=>{T&&T.length>0?(O(T[0].value),o.setFieldsValue({projectReleaseId:T[0].value})):(O(void 0),o.setFieldsValue({projectReleaseId:void 0}))}),[T]);const B=e=>{h({projectId:L,projectReleaseId:V,headUserId:e}).then((e=>{const s=e.data;n(s.filter((e=>"0"===e.status))),u(s.filter((e=>"1"===e.status))),g(s.filter((e=>"2"===e.status))),S(s.filter((e=>"3"===e.status)))}))};if(s.useEffect((()=>{"1"==d.tab&&(V?(o.setFieldsValue({headUserId:void 0}),B(),I({projectReleaseId:V}).then((e=>{R(e.data)}))):A())}),[V,d.tab]),k.length<1)return t.jsx("div",{});const N=async e=>{const s=(await f({projectIssueId:e})).data;n((t=>t.map((t=>t.projectIssueId===e?s:t)))),u((t=>t.map((t=>t.projectIssueId===e?s:t)))),g((t=>t.map((t=>t.projectIssueId===e?s:t)))),S((t=>t.map((t=>t.projectIssueId===e?s:t))))};return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflowY:"hidden"},children:[t.jsx(w,{style:{marginBottom:"20px"},children:t.jsxs(e,{layout:"inline",form:o,style:{gap:"10px"},children:[t.jsx(e.Item,{label:"项目",name:"projectId",required:!0,children:t.jsx(r,{style:{width:200},placeholder:"请选择项目",options:k,onChange:e=>U(e)})}),t.jsx(e.Item,{label:"版本",name:"projectReleaseId",required:!0,children:t.jsx(r,{style:{width:200},placeholder:"请选择版本",options:T,onChange:e=>O(e)})}),t.jsx(e.Item,{label:"责任人",name:"headUserId",children:t.jsx(r,{allowClear:!0,style:{width:200},placeholder:"请选择版本",options:E,onChange:e=>{B(e)}})})]})}),t.jsx("div",{style:{flexGrow:1,display:"flex",gap:"10px",overflowY:"auto"},children:t.jsxs(i,{onDragEnd:async e=>{const{source:s,destination:t}=e;if(!t)return;if(s.droppableId===t.droppableId&&s.index===t.index)return;let r,i,a,d;switch(s.droppableId){case"wait":r=[...p],a=n;break;case"sprint":r=[...c],a=u;break;case"complete":r=[...j],a=g;break;case"close":r=[...v],a=S;break;default:return}if(s.droppableId===t.droppableId){const[e]=r.splice(s.index,1);r.splice(t.index,0,e),await a(r);const i=0===t.index?null:r[t.index-1]?.projectIssueId;return await b({projectIssueId:e.projectIssueId,status:e.status,preProjectIssueId:i}),void(await N(e.projectIssueId))}switch(t.droppableId){case"wait":i=[...p],d=n;break;case"sprint":i=[...c],d=u;break;case"complete":i=[...j],d=g;break;case"close":i=[...v],d=S;break;default:return}const[o]=r.splice(s.index,1);i.splice(t.index,0,o),await a(r),await d(i);const l="wait"===t.droppableId?"0":"sprint"===t.droppableId?"1":"complete"===t.droppableId?"2":"3",m=0===t.index?null:i[t.index-1]?.projectIssueId;await b({projectIssueId:o.projectIssueId,status:l,preProjectIssueId:m}),await N(o.projectIssueId)},children:[t.jsx(C,{title:t.jsxs("span",{children:["待处理 ",t.jsx(a,{status:"default"})]}),list:p,droppableId:"wait",IssueTypeMap:l,updateList:N}),t.jsx(C,{title:t.jsxs("span",{children:["进行中 ",t.jsx(a,{status:"processing"})]}),list:c,droppableId:"sprint",IssueTypeMap:l,updateList:N}),t.jsx(C,{title:t.jsxs("span",{children:["已完成 ",t.jsx(a,{status:"success"})]}),list:j,droppableId:"complete",IssueTypeMap:l,updateList:N}),t.jsx(C,{title:t.jsxs("span",{children:["已关闭 ",t.jsx(a,{status:"error"})]}),list:v,droppableId:"close",IssueTypeMap:l,updateList:N})]})})]})},C=e=>{const{title:s,list:r,droppableId:i,IssueTypeMap:a,updateList:l}=e;return t.jsx(w,{style:{width:"25%",padding:"0 10px"},children:t.jsx(d,{droppableId:i,children:e=>t.jsxs("div",{...e.droppableProps,ref:e.innerRef,style:{minHeight:"300px"},children:[t.jsx(j,{level:4,style:{textAlign:"center",marginBottom:"20px"},children:s}),r.map(((e,s)=>t.jsx(o,{draggableId:e.projectIssueId.toString(),index:s,children:s=>t.jsx("div",{ref:s.innerRef,...s.draggableProps,...s.dragHandleProps,style:{...s.draggableProps.style,marginBottom:"10px",backgroundColor:"#f9f9f9",padding:"10px",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:t.jsx(M,{item:e,typeMap:a,updateList:l},e.projectIssueId)})},e.projectIssueId))),e.placeholder]})})})},M=e=>{const{item:r,updateList:i}=e,[a,d]=s.useState(l.close),[o,j]=s.useState(l.close);return t.jsxs("div",{children:[t.jsxs(w,{title:t.jsx(p,{type:"link",onClick:()=>d(l.edit),children:e.item.name}),size:"small",extra:t.jsx(p,{type:"link",icon:t.jsx(S,{}),onClick:()=>j(l.edit)}),children:[t.jsxs("div",{children:["类型：",t.jsx(n,{color:e.typeMap[e.item.type]?.color,children:e.typeMap[e.item.type]?.label})]}),t.jsxs("div",{children:["描述：",e.item.remarks]}),t.jsxs("div",{children:["负责人：",e.item.headUserInfo?.nickName]}),t.jsxs("div",{children:["开始时间：",c(e.item.startDate)]}),t.jsxs("div",{children:["结束时间：",c(e.item.endDate)]}),t.jsxs("div",{children:["优先级：",P(e.item.priority)]})]}),t.jsx(u,{title:"配置详情",open:a!==l.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>d(l.close),footer:null,children:t.jsx("div",{children:t.jsx(g,{detailId:r.projectIssueId})})}),t.jsx(u,{title:o==l.edit?"配置编辑":"配置新增",open:o!==l.close,width:"50%",destroyOnClose:!0,maskClosable:!1,onClose:()=>j(l.close),footer:null,children:t.jsx("div",{children:t.jsx(v,{detailId:r.projectIssueId??0,operateEnum:o,setAddOrUpdateModalFn:j,reloadTable:()=>{j(l.close),i(r.projectIssueId)},defaultProjectId:r.projectId})})})]})},P=e=>{switch(e.toString()){case"0":return t.jsxs("span",{children:["一般 ",t.jsx(a,{status:"success"})]});case"1":return t.jsxs("span",{children:["重要 ",t.jsx(a,{status:"processing"})]});case"2":return t.jsxs("span",{children:["紧急 ",t.jsx(a,{status:"error"})]});default:return""}};export{k as default};
