import{r as e,d as t,ad as s,O as o,j as i,T as l,ab as n,B as a,D as r}from"./index-f2321b57.js";import{processInstanceGetOneApi as c}from"./processInstanceApi-9883ba95.js";import{G as d}from"./ProcessInstanceStatusDic-a003601b.js";import{F as p}from"./uilts-e16e3ac3.js";import m from"./index-26718f3e.js";import j from"./Approval-1aa18ed2.js";import x from"./Handler-16426a33.js";import h from"./pointList-358aeebe.js";import{P as u}from"./index-55f4da4c.js";import"./dicApi-6905b9c5.js";import"./Bo-900708b2.js";import"./index-d54aef2b.js";import"./Timeline-170fea38.js";import"./index-b46dae5a.js";import"./index-e51db6e5.js";import"./EditOutlined-1e526840.js";const I=I=>{const[f,y]=e.useState(t),[v,P]=e.useState(),[b,C]=e.useState(),[S,T]=e.useState([]),{processInstanceStatusMap:g}=d(),A=s(),[L,F]=e.useState(o.close),[N,k]=e.useState(o.close),w=async()=>{C(void 0);let e=await c({processInstanceId:I.detailId});y(e.data);const t=e.data.pointList.find((e=>"1"===e.status));if(t&&(t.children=e.data.approvalPeopleList.filter((e=>e.processInstancePointId===t.processInstancePointId)),t.children.length>0)){const e=t.children.find((e=>e.accountId.toString()==A.accountId));e&&C(e.processInstanceApprovalPeopleId)}P(t);const s=e.data.pointList.find((e=>e.type===p.startNode));if(!s)return;const o=e.data.pointFormList.find((e=>e.processInstancePointId===s.processInstancePointId));if(!o)return;const i=e.data.pointFieldList.filter((e=>e.processInstancePointFormId===o.processInstancePointFormId));T(i)};return e.useEffect((()=>(w(),()=>{})),[]),i.jsxs("div",{className:"mmm-height",children:[i.jsxs("div",{style:{display:"flex",height:"calc(100% - 48px)"},children:[i.jsxs("div",{style:{flexGrow:1,minWidth:0},children:[i.jsxs(u,{column:2,title:"",tooltip:"",children:[i.jsx(u.Item,{label:"标题",tooltip:"",valueType:"text",children:f.title},"title"),i.jsx(u.Item,{label:"状态",tooltip:"",children:(()=>{let e=g[f.status];return i.jsx(l,{color:e?.color??"green",children:e?.label})})()},"status"),i.jsx(u.Item,{label:"申请人",tooltip:"",valueType:"text",children:f?.createByAccount?.account},"createBy"),i.jsx(u.Item,{label:"申请时间",tooltip:"",valueType:"text",children:f.createTime},"createTime"),i.jsx(u.Item,{label:"结束时间",tooltip:"",valueType:"text",children:f.endTime},"endTime")]}),i.jsx(n,{children:"表单"}),i.jsx(m,{initFieldBoList:S})]}),i.jsx("div",{style:{width:"300px",flexShrink:0},children:i.jsx(h,{instanceDetail:f})})]}),b&&i.jsx("div",{className:"mmm-bgcolor",style:{height:"48px",display:"flex",justifyContent:"end"},children:i.jsx(a,{type:"primary",onClick:()=>{v?.type===p.approvalNode?F(o.add):v?.type===p.handleNode&&k(o.add)},children:"处理"})}),i.jsx(r,{title:"审批",open:L!==o.close,width:"45%",destroyOnClose:!0,maskClosable:!1,onClose:()=>F(o.close),footer:null,children:i.jsx("div",{children:i.jsx(j,{onClose:()=>{F(o.close),w()},processInstanceApprovalPeopleId:b})})}),i.jsx(r,{title:"办理",open:N!==o.close,width:"45%",destroyOnClose:!0,maskClosable:!1,onClose:()=>k(o.close),footer:null,children:i.jsx("div",{children:i.jsx(x,{onClose:()=>{k(o.close),w()},processInstanceApprovalPeopleId:b})})})]})};export{I as default};
