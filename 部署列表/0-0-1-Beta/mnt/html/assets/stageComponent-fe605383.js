import{r as e,F as a,O as l,j as s,I as i,R as t,S as n,B as d,Y as r,am as o}from"./index-52537ad8.js";import{getStage as p}from"./index-7ad95df9.js";import{usePipelineContext as m}from"./context-96d01b3e.js";const c=c=>{const[u,h]=e.useState(0),[x,j]=e.useState(0),[g]=a.useForm(),{pipelineOpenType:f}=m();return e.useEffect((()=>{if(c.stageComponentOpenType===l.edit||c.stageComponentOpenType===l.detail){let e=p(c.id,c.detail.pipelineStageList);g.setFieldsValue(e),h(e?.dockerFlag??0)}else c.stageComponentOpenType===l.add&&g.setFieldsValue({disabled:0,dockerFlag:0,nodeDefault:1});return()=>{}}),[]),s.jsx("div",{children:s.jsx("div",{className:"mySpace",children:s.jsxs(a,{form:g,autoComplete:"off",disabled:f===l.detail,children:[s.jsxs("div",{className:"myLine",children:[s.jsx(a.Item,{label:"阶段名称",name:"name",rules:[{required:!0}],children:s.jsx(i,{placeholder:"请输入"})}),s.jsx(a.Item,{label:"是否禁用",name:"disabled",rules:[{required:!0}],children:s.jsxs(t.Group,{children:[s.jsx(t,{value:0,children:" 启用 "}),s.jsx(t,{value:1,children:" 禁用 "})]})})]}),s.jsxs("div",{className:"myLine",children:[s.jsx(a.Item,{label:"是否使用默认执行机",name:"nodeDefault",rules:[{required:!0}],tooltip:"当不使用默认执行机的时候 要从新选择执行机",children:s.jsxs(t.Group,{onChange:e=>{j(parseInt(e.target.value))},children:[s.jsx(t,{value:1,children:" 使用 "}),s.jsx(t,{value:0,children:" 不使用 "})]})}),0===g?.getFieldValue("nodeDefault")&&s.jsx(a.Item,{label:"执行机标签",name:"nodeLabel",rules:[{required:!0}],children:s.jsx(n,{options:c.pipelineNodeList,fieldNames:{label:"label",value:"label"}})})]}),s.jsxs("div",{className:"myLine",children:[s.jsx(a.Item,{label:"是否使用镜像",name:"dockerFlag",rules:[{required:!0}],children:s.jsxs(t.Group,{onChange:e=>{h(parseInt(e.target.value))},children:[s.jsx(t,{value:0,children:" 不用 "}),s.jsx(t,{value:1,children:" 使用 "})]})}),1===u&&s.jsx(a.Item,{label:"镜像名称",name:"dockerName",rules:[{required:!0}],children:s.jsx(i,{placeholder:"请输入"})})]}),s.jsx("div",{className:"myLine",children:1===u&&s.jsx(a.Item,{label:"镜像参数",name:"dockerParam",rules:[{required:!1}],children:s.jsx(i.TextArea,{placeholder:"请输入",autoComplete:"new-password",autoSize:{minRows:2}})})}),f!==l.detail&&s.jsx(a.Item,{wrapperCol:{offset:12,span:12},children:s.jsx(d,{type:"primary",htmlType:"submit",onClick:async()=>{if(!(await g.validateFields().catch((()=>!1))))return;const e=await(g?.getFieldsValue());if(r(e),c.stageComponentOpenType===l.edit){let a=p(c.id,c.detail.pipelineStageList);a.name=e.name,a.disabled=e.disabled,a.nodeDefault=e.nodeDefault,a.nodeLabel=e.nodeLabel,a.dockerFlag=e.dockerFlag,a.dockerName=e.dockerName,a.dockerParam=e.dockerParam,c.setDetailFn(JSON.parse(JSON.stringify(c.detail))),c.setStageComponentOpenTypeFn(l.close)}if(c.stageComponentOpenType===l.add){let a={...e,id:o()};if(0===c.id)c.detail.pipelineStageList.push(a);else{let e=p(c.id,c.detail.pipelineStageList);e.sonStageList?e.sonStageList.push(a):e.sonStageList=[a]}c.setDetailFn(JSON.parse(JSON.stringify(c.detail))),c.setStageComponentOpenTypeFn(l.close)}},children:"确认"})})]})})})};export{c as default};
