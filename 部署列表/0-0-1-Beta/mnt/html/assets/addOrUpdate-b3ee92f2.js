import{F as e,r as t,O as s,i as r,j as i,I as a,S as l,ab as o,B as n,D as m,d,Y as p,m as c}from"./index-f2321b57.js";import{pipeline_pluginGetOneApi as u,pipeline_pluginUpdateApi as j,pipeline_pluginSaveApi as h}from"./api-cbd9b73e.js";import{otherAccountAllApi as x}from"./api-557990cc.js";import{C as f}from"./index-b1386cd3.js";import{serverToClientValue as y,clientToServerValueItem as C}from"./Bo-900708b2.js";import S from"./formComponent-e31b7955.js";import b from"./index-1e1c35a0.js";import{C as g}from"./index-e51db6e5.js";import"./Title-c989167c.js";import"./Input-f009b856.js";import"./TextArea-47627076.js";import"./customerFieldNew-4b477ff0.js";import"./customerText-29c51ee6.js";import"./customerTextArea-c929063a.js";import"./customerSelect-e147971d.js";import"./MinusCircleOutlined-ede52421.js";import"./MinusCircleOutlined-47af1d51.js";import"./PlusOutlined-0e19b652.js";import"./customerMutSelect-b7b09c88.js";import"./CustomerFile-0ba717f3.js";import"./CustomerDate-a09fb913.js";import"./customerNumber-e3e13da1.js";import"./DeleteOutlined-10e7bcc5.js";import"./textSubmit-4229c5b2.js";import"./textAreaSubmit-14d30dcb.js";import"./SelectSubmit-d0c3571a.js";import"./MutSelectSubmit-d4556965.js";import"./FileSubmit-975998bf.js";import"./DateSubmit-41050df2.js";import"./NumberSubmit-9c6b3724.js";const w=w=>{const[F]=e.useForm(),[k,O]=t.useState({params:[]}),[v,E]=t.useState([]),[N,T]=t.useState(),[A,I]=t.useState(s.close),[q,D]=t.useState(),[M,V]=t.useState([]),[B,L]=t.useState(!1),R=r.useRef(null),[z]=e.useForm(),J=e=>{T(e)};t.useEffect((()=>((async()=>{if(x({}).then((e=>{e.data.forEach((e=>e.id=e.id+"")),E(e.data)})),w.operateEnum===s.edit){let e=await u({id:w.detailId});O(e.data),e.data.params&&(e.data.params.forEach((e=>{y(e)})),V(e.data.params)),F.setFieldsValue(e.data),T(e.data.script)}else F.setFieldsValue(d()),T("")})(),()=>{})),[]);return i.jsxs("div",{children:[i.jsxs(e,{form:F,children:[i.jsx(e.Item,{label:"名称",name:"name",rules:[{required:!0}],children:i.jsx(a,{placeholder:"请输入"})}),i.jsx(e.Item,{label:"脚本类型",name:"scriptType",rules:[{required:!0}],children:i.jsx(l,{options:w.scriptTypeList})}),i.jsx(e.Item,{label:"资源类型",name:"type",rules:[{required:!0}],children:i.jsx(l,{options:w.typeList})}),i.jsx(e.Item,{label:"备注",name:"desc",children:i.jsx(a.TextArea,{allowClear:!0,autoSize:{minRows:2}})}),i.jsxs(o,{children:["脚本 ",i.jsx(n,{type:"link",onClick:()=>I(s.detail),children:"全屏"})]}),void 0!==N&&i.jsx(f,{value:N,language:"shell",onChange:J,reloadValue:q})]}),i.jsx(g,{title:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsx("span",{children:"表单设计"}),i.jsx(n,{type:"link",onClick:()=>L(!0),children:"设计表单"})]}),children:i.jsx(e,{form:z,validateTrigger:"false",onValuesChange:(e,t)=>{M.forEach((t=>{e.hasOwnProperty(t.id)&&(t.value=e[t.id])})),V(M)},children:M.map((e=>i.jsx(b,{initFieldBo:e},e.id)))})}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx(n,{type:"default",onClick:()=>{w.setAddOrUpdateModalFn(s.close)},style:{marginRight:20},children:"取消"}),i.jsx(n,{type:"primary",onClick:async()=>{if(!(await F.validateFields().catch((()=>!1))))return;const e=await(F?.getFieldsValue());p(e);const t=JSON.parse(JSON.stringify(M));let r;t.forEach((e=>{C(e)})),r=w.operateEnum===s.edit?await j({...e,id:w.detailId,params:t,script:N}):await h({...e,params:t,script:N}),1e3===r.code&&(c.success(r.msg),w.reloadTable(),w.setAddOrUpdateModalFn(s.close))},children:"确定"})]}),i.jsx(m,{title:"脚本",open:A!==s.close,width:"100%",destroyOnClose:!0,maskClosable:!1,onClose:()=>{I(s.close),D((e=>(e??0)+1))},footer:null,children:void 0!==N&&i.jsx(f,{value:N,language:"shell",onChange:J,readOnly:!1})}),i.jsx(m,{title:"表单设计",open:B,onClose:()=>L(!1),extra:i.jsx(n,{onClick:()=>{const e=R.current?.getFieldList();if(!e)return;e.forEach((t=>{if(""===t.keyName)throw c.error("有字段的唯一标识为空"),new Error("有字段的唯一标识为空");const s=e.filter((e=>e.keyName===t.keyName));if(s.length>1)throw c.error(`有重复的唯一标识【${s[0].keyName}】`),new Error(`有重复的唯一标识【${s[0].keyName}】`)})),V(e);const t={};e.forEach((e=>{t[e.id]=e.value})),z.setFieldsValue(t),L(!1)},type:"primary",children:"确定"}),width:"100%",destroyOnClose:!0,keyboard:!1,children:i.jsx(S,{ref:R,initFormDesign:M,showScope:!0})})]})};export{w as default};
