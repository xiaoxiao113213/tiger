import{r as e,d as t,ad as s,O as o,j as i,T as l,ab as n,B as a,D as r}from"./index-03adb9ee.js";import{processInstanceGetOneApi as c}from"./processInstanceApi-c6750744.js";import{G as d}from"./ProcessInstanceStatusDic-d3db62f2.js";import{F as p}from"./uilts-8b8185ea.js";import m from"./index-5c9d858f.js";import j from"./Approval-b1d83b74.js";import x from"./Handler-c46b202d.js";import h from"./pointList-ac4e12a3.js";import{P as u}from"./index-88ad5331.js";import"./dicApi-3ecc5ba9.js";import"./Bo-c1a8a5bb.js";import"./index-a2b78009.js";import"./Timeline-17fa9b43.js";import"./index-405e7360.js";import"./index-3585a1a3.js";import"./EditOutlined-d7a61630.js";const I=I=>{const[f,y]=e.useState(t),[v,P]=e.useState(),[b,C]=e.useState(),[S,T]=e.useState([]),{processInstanceStatusMap:L}=d(),g=s(),[A,F]=e.useState(o.close),[N,w]=e.useState(o.close),B=async()=>{C(void 0);let e=await c({processInstanceId:I.detailId});y(e.data);const t=e.data.pointList.find((e=>"1"===e.status));if(t&&(t.children=e.data.approvalPeopleList.filter((e=>e.processInstancePointId===t.processInstancePointId)),t.children.length>0)){const e=t.children.find((e=>e.accountId.toString()==g.accountId));e&&C(e.processInstanceApprovalPeopleId)}P(t);const s=e.data.pointList.find((e=>e.type===p.startNode));if(!s)return;const o=e.data.pointFormList.find((e=>e.processInstancePointId===s.processInstancePointId));if(!o)return;const i=e.data.pointFieldList.filter((e=>e.processInstancePointFormId===o.processInstancePointFormId));T(i)};return e.useEffect((()=>(B(),()=>{})),[]),i.jsxs("div",{className:"mmm-height",children:[i.jsxs("div",{style:{display:"flex",height:"calc(100% - 48px)"},children:[i.jsxs("div",{style:{flexGrow:1,minWidth:0},children:[i.jsxs(u,{column:2,title:"",tooltip:"",children:[i.jsx(u.Item,{label:"标题",tooltip:"",valueType:"text",children:f.title},"title"),i.jsx(u.Item,{label:"状态",tooltip:"",children:(()=>{let e=L[f.status];return i.jsx(l,{color:e?.color??"green",children:e?.label})})()},"status"),i.jsx(u.Item,{label:"申请人",tooltip:"",valueType:"text",children:f?.createByAccount?.account},"createBy"),i.jsx(u.Item,{label:"申请时间",tooltip:"",valueType:"text",children:f.createTime},"createTime"),i.jsx(u.Item,{label:"结束时间",tooltip:"",valueType:"text",children:f.endTime},"endTime")]}),i.jsx(n,{children:"表单"}),i.jsx(m,{initFieldBoList:S})]}),i.jsx("div",{style:{width:"300px",flexShrink:0},children:i.jsx(h,{instanceDetail:f})})]}),b&&i.jsx("div",{className:"mmm-bgcolor",style:{height:"48px",display:"flex",justifyContent:"end"},children:i.jsx(a,{type:"primary",onClick:()=>{v?.type===p.approvalNode?F(o.add):v?.type===p.handleNode&&w(o.add)},children:"处理"})}),i.jsx(r,{title:"审批",open:A!==o.close,width:"45%",destroyOnClose:!0,maskClosable:!1,onClose:()=>F(o.close),footer:null,children:i.jsx("div",{children:i.jsx(j,{onClose:()=>{F(o.close),B()},processInstanceApprovalPeopleId:b})})}),i.jsx(r,{title:"办理",open:N!==o.close,width:"45%",destroyOnClose:!0,maskClosable:!1,onClose:()=>w(o.close),footer:null,children:i.jsx("div",{children:i.jsx(x,{onClose:()=>{w(o.close),B()},processInstanceApprovalPeopleId:b})})})]})};export{I as default};
