import{j as e,r as a,F as t,I as d,B as i,K as s,N as l,m as r}from"./index-52537ad8.js";import{tableGetOneApi as o,tableDDlApi as n,tableUpdateApi as c,tableSaveApi as u}from"./api-ba92b399.js";import f from"./AddOrUpdateTable-77121ca2.js";import m from"./AddOrUpdateTableField-326ed00e.js";import p from"./AddOrUpdateIndex-314eb81a.js";import"./dicApi-f974ede5.js";import"./MysqlTypeDic-ba97f24c.js";/* empty css                 */import"./fieldRow-aa8b1712.js";import"./DeleteOutlined-104cbf00.js";import"./PlusOutlined-0403edcb.js";import"./indexRow-777e0e53.js";const b=b=>{if(!b.tableId)return e.jsx("div",{});const[y,g]=a.useState(),[h,j]=a.useState(""),[x,w]=a.useState("5"),[I]=t.useForm(),[F,N]=a.useState([]),[v]=t.useForm(),[A,E]=a.useState([]),[L,T]=a.useState(!1);if(a.useEffect((()=>{(async()=>{let e=await o({tableId:b.tableId});e.data?.indexList.forEach((e=>{e.id=l(9)})),g(e.data),N(e.data.fieldList),E(e.data.indexList.map((e=>({...e,id:l(9)}))))})()}),[]),!y)return e.jsx("div",{});const k=async()=>{if(!(await I.validateFields().catch((()=>!1))))throw r.error("必填项不能为空"),new Error("必填项不能为空");const e=await I.getFieldsValue(),a=[];e&&Object.keys(e).forEach((t=>{const[d,i]=t.split("-"),s=parseInt(i),l=a.find((e=>e.tableFieldId==s));l?l[d]=e[t]:a.push({tableFieldId:s,[d]:e[t]})}));const t=[];return F.forEach((e=>{const d=a.find((a=>a.tableFieldId==e.tableFieldId));d&&(t.push(d),d.defaultValue&&Array.isArray(d.defaultValue)&&(d.defaultValue.length>0?d.defaultValue=d.defaultValue[0]:d.defaultValue=void 0),void 0!==d.flagKey&&(d.flagKey=Number(!!d.flagKey)),void 0!==d.flagNotNull&&(d.flagNotNull=Number(!!d.flagNotNull)),void 0!==d.flagAutoIncrement&&(d.flagAutoIncrement=Number(!!d.flagAutoIncrement)),void 0!==d.flagUnsigned&&(d.flagUnsigned=Number(!!d.flagUnsigned)))})),t},B=async()=>{if(!(await v.validateFields().catch((()=>!1))))throw r.error("必填项不能为空"),new Error("必填项不能为空");const e=await v.getFieldsValue(),a=[];e&&Object.keys(e).forEach((t=>{const[d,i]=t.split("-"),s=i,l=a.find((e=>e.id==s));l?l[d]=e[t]:a.push({id:s,[d]:e[t]})}));const t=[];return A.forEach((e=>{const d=a.find((a=>a.id==e.id));d&&t.push(d)})),t},O=[{key:"5",label:"字段",children:e.jsx(m,{form:I,data:F,setData:N,tagNum:x})},{key:"0",label:"表",children:e.jsx(f,{table:y,setTable:g})},{key:"6",label:"索引",children:e.jsx(p,{form:v,data:A,setData:E,tableCode:y.code,getFieldList:k,tagNum:x})},{key:"3",label:"结构预览",children:e.jsx(d.TextArea,{readOnly:!0,value:h,autoSize:!0,style:{fontSize:20,fontWeight:"bold"}})}],S=e.jsxs("div",{children:[e.jsx("span",{style:{marginRight:"10px"},children:y.code}),e.jsx(i,{type:"primary",onClick:async()=>{let e;y.fieldList=await k(),L&&(y.indexList=await B()),e=y.tableId?await c(y):await u({...y,databaseBoardId:b.databaseBoardId,x:"0",y:"0",shapeType:"0"}),1e3===e.code&&r.success(e.msg)},style:{marginRight:"10px"},children:"保存"}),e.jsx(i,{type:"primary",onClick:async()=>{let e;y.fieldList=await k(),L&&(y.indexList=await B()),e=y.tableId?await c(y):await u({...y,databaseBoardId:b.databaseBoardId,x:"0",y:"0",shapeType:"0"}),1e3===e.code&&(r.success(e.msg),b.closeTableTagModal())},children:"保存并返回"})]});return e.jsx("div",{children:e.jsx(s,{onChange:async e=>{if(w(e),"6"!==e||L||T(!0),"3"!==e)return;if(!y.code)return;const a=await k();let t=await n({...y,databaseBoardId:b.databaseBoardId,fieldList:a});1e3===t.code&&j(t.data)},type:"card",items:O,tabBarExtraContent:S})})};export{b as default};
