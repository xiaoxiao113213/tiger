import{r as e,O as t,j as i,P as s,B as o,a3 as a,D as l,ak as r,aE as n,M as d,m as p}from"./index-10719960.js";import m from"./BuildModal-b45ede6a.js";import{pipelinePageApi as c,pipelineUpdateDisabledApi as u,pipelineDeleteApi as j}from"./pipeline-be6907e2.js";import{dicValueApi as h}from"./dicApi-19a4777b.js";import x from"./accountSetting-1fc58051.js";import S from"./pipelineOtherAdd-1fe1fd50.js";import y from"./pipelineMainAdd-0371e0db.js";import{T as b}from"./index-73b80c18.js";import{P as C}from"./PlusOutlined-cc4f568a.js";import"./api-7031d208.js";import"./Bo-bcadefc8.js";import"./pipelineBuildApi-80d6901c.js";import"./submitNowform-3ec5b855.js";import"./textSubmit-5aad76e3.js";import"./textAreaSubmit-e3064045.js";import"./SelectSubmit-fba154f7.js";import"./MutSelectSubmit-7d2986fa.js";import"./DateSubmit-7b5457eb.js";import"./NumberSubmit-61c4b5e2.js";import"./FileUploadSubmit-b86f5e72.js";import"./index-30b704bf.js";import"./index-c05d5723.js";import"./Title-5ea514a5.js";import"./Input-f4f01092.js";import"./TextArea-8948f20d.js";import"./Password-88bd354d.js";import"./QRCodeSVG-ffc224cf.js";import"./TaobaoOutlined-8cd58809.js";import"./FileZipFilled-2a2025c5.js";import"./BranchesOutlined-c52fb168.js";import"./RightSquareTwoTone-e5897024.js";import"./FileUnknownTwoTone-791de7ab.js";import"./MinusCircleOutlined-47af1d51.js";import"./MoreOutlined-49b0b054.js";import"./PlusCircleOutlined-a72eecfb.js";import"./PlusSquareTwoTone-f51424a0.js";import"./RetweetOutlined-9d2a328f.js";import"./SendOutlined-86da6479.js";import"./TableOutlined-67e609f9.js";import"./api-5bb72ee6.js";import"./api-990bd395.js";import"./index-7ad95df9.js";import"./stageComponent-b0f799c8.js";import"./context-c276b1a2.js";import"./stepComponent-620b8d99.js";import"./api-94733e85.js";import"./index-0e948b02.js";import"./PipelineFlow-0c7a4917.js";import"./index-937e9b10.js";/* empty css              */import"./uilts-00b5353e.js";import"./StartNode-2feb9deb.js";/* empty css             */import"./dataUtil-c2f8121e.js";import"./StageNode-4ee0bf33.js";import"./StepNode-89f08ed0.js";import"./CustomEdge-98f3759d.js";import"./index-fb93998c.js";import"./FileSubmit-52898802.js";import"./formComponent-402c7b18.js";import"./customerFieldNew-bd52e5d5.js";import"./customerText-ab37e497.js";import"./customerTextArea-fdf43c64.js";import"./customerSelect-0b789148.js";import"./MinusCircleOutlined-f32dd4d0.js";import"./customerMutSelect-2ed19145.js";import"./CustomerFile-b6b47294.js";import"./CustomerDate-c212afd9.js";import"./customerNumber-f42eabd0.js";import"./DeleteOutlined-91444ec2.js";import"./api-8371e36c.js";const w=()=>{const[t,i]=e.useState([]),[s,o]=e.useState(new Map),[a,l]=e.useState({});return e.useEffect((()=>{(async()=>{let e=await h({code:"pipeline_use_status"});e.data.forEach((e=>e.value=parseInt(e.value))),i(e.data);let t={},s=new Map;e.data.forEach((e=>{t[e.value]={text:e.label},s.set(e.value,e)})),o(s),l(t)})()}),[]),{PipelineUseStatusList:t,PipelineUseStatusMap:s,PipelineUseStatusValueEnum:a}},T=()=>{const h=e.useRef(),[T,f]=e.useState(t.close),[k,g]=e.useState(),[O,I]=e.useState(t.close);let{PipelineUseStatusValueEnum:B}=w();const[F,M]=e.useState(t.close),[P,v]=e.useState(t.close),E=(e,i)=>{switch(e){case"other":g(i.id),v(t.add);break;case"delete":(async e=>{d?.confirm({title:"是否删除该条数据",content:e.name,icon:null,onOk:async()=>{const t=await j({id:e?.id});1e3===t?.code&&(p.success(t?.msg),h?.current?.reload())}})})(i);break;case"permission":g(i.id),M(t.add)}},z=[{title:"ID",dataIndex:"id",width:"80px",valueType:"text",search:!1},{title:"名称",dataIndex:"name",render:(e,s)=>i.jsx("a",{style:{color:"#1668dc"},onClick:()=>(async e=>{g(e.id),f(t.detail)})(s),children:s.name})},{title:"状态",dataIndex:"disabled",search:!1,render:(e,{disabled:t,id:s})=>i.jsx(n,{defaultValue:0===t,onChange:e=>{((e,t)=>{u({id:e,disabled:t?0:1}).then((e=>{e.code}))})(s,e)}})},{title:"使用状态",search:!1,dataIndex:"useStatus",valueEnum:B},{title:"最后构建时长",search:!1,dataIndex:"lastBuildTotalTime"},{title:"最后构建结果",search:!1,dataIndex:"lastBuildStatus"},{title:"创建人",search:!1,dataIndex:"updateBy"},{title:"创建时间",search:!1,dataIndex:"createTime"},{title:"操作",valueType:"option",width:170,key:"operation",render:(e,s)=>[i.jsx(o,{onClick:()=>(async e=>{window.open("/#/pipelineBuild?pipelineId="+e.id,"_blank")})(s),size:"small",type:"link",children:"构建列表"},"buildList"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),I(t.add)})(s),size:"small",type:"link",children:"构建"},"build"),i.jsx(o,{onClick:()=>(async e=>{g(e.id),f(t.edit)})(s),size:"small",type:"link",hidden:a("pipeline:edit"),children:"编辑"},"edit"),i.jsx(b,{onSelect:e=>E(e,s),menus:[{key:"permission",name:"权限",hidden:a("pipeline:permission")},{key:"other",name:"其他配置",hidden:a("pipeline:edit")},{key:"delete",name:"删除",danger:!0,hidden:a("pipeline:del")}]},"actionGroup")]}];return i.jsxs("div",{children:[i.jsx(s,{columns:z,actionRef:h,cardBordered:!0,params:{},request:async(e={},t,i)=>{let s={pageNum:e.current,pageSize:e.pageSize,pageSort:t},o=await c({...e,...s});return{data:o.data.list,success:1e3===o.code,total:o.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pipeline-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:{labelWidth:"auto"},options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[i.jsx(o,{icon:i.jsx(C,{}),onClick:()=>{(async()=>{g(void 0),f(t.add)})()},type:"primary",hidden:a("pipeline:add"),children:"新建"},"button")]}),i.jsx(l,{title:r(T),open:T!==t.close,width:"100%",destroyOnClose:!0,maskClosable:!1,onClose:()=>f(t.close),footer:null,keyboard:!1,children:i.jsx(y,{openType:T,pipelineId:k,reloadTable:()=>{f(t.close),h?.current?.reload()}})},"pipelineTab"),i.jsx(l,{title:"构建流水线",open:O!==t.close,footer:!1,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>I(t.close),children:i.jsx(m,{setBuildModalFn:I,detailId:k,reloadTable:()=>{h?.current?.reload(),I(t.close)}})}),i.jsx(l,{title:"项目人员",open:F!==t.close,onClose:()=>M(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(x,{pipelineId:k,closeFn:()=>M(t.close)})},"accountSetting"),i.jsx(l,{title:"其他配置",open:P!==t.close,onClose:()=>v(t.close),width:"80%",destroyOnClose:!0,children:i.jsx(S,{pipelineId:k,closeFn:()=>v(t.close)})},"otherSetting")]})};export{T as default};
