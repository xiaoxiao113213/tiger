import{j as e,r as i,O as t,B as o,D as a}from"./index-03adb9ee.js";import{R as s,u as r,a as n,b as l,c as p,i as d,C as c,B as m,M as j,P as u}from"./index-19b1aa5f.js";import{getPointAndEdgeApi as f,delEdgeApi as x}from"./api-c504507c.js";import{A as g}from"./ApiBo-93eb9889.js";import{aiPipelinePointSaveApi as P,aiPipelinePointGetOneApi as y,updatePositionApi as h}from"./pointApi-21c19a8e.js";/* empty css              */import C from"./StartNode-acf4a06d.js";import I from"./EndNode-5683c7bb.js";import{aiPipelineEdgeSaveApi as T}from"./edgeApi-cf406580.js";import D from"./AiTextNode-5651799c.js";import S from"./TextAi1Test-45fe79d2.js";import k from"./AiTextToPicNode-1b391734.js";import"./Title-06decefc.js";import"./Input-51214805.js";import"./TextArea-24b2fc1a.js";import"./varApi-5886e459.js";import"./DeleteOutlined-2f949a39.js";import"./endOutputForm-90f2041b.js";import"./dicApi-3ecc5ba9.js";import"./inputForm-755124a4.js";import"./outputForm-f938503e.js";import"./index-f348ab1d.js";import"./FileUploadCom-56501644.js";import"./PlusOutlined-b4032aa8.js";import"./utils-20c57c3a.js";import"./RightSquareTwoTone-e5897024.js";import"./Timeline-17fa9b43.js";import"./inputForm-17ead92b.js";import"./outputForm-e79fd21f.js";import"./ChatModelDic-73623f28.js";import"./api-cc9758ae.js";const v={start:C,end:I,aiText:D,aiTextToPic:k},A=s=>{const{screenToFlowPosition:C}=r(),[I,D]=i.useState([]),[k,A]=i.useState([]),[b,w]=i.useState(!1),[O,E]=i.useState(t.close),F=e=>({id:e.aiPipelinePointId.toString(),data:{aiPipelineId:e.aiPipelineId,label:"213",point:e,schemaColor:"#91C4F2"},position:{x:e.x,y:e.y},type:e.type});i.useEffect((()=>{(async()=>{let e=await f({aiPipelineId:s.aiPipelineId}),i=e.data.points.map((e=>F(e)));D(i),A(e.data.edges.map((e=>({id:e.aiPipelineEdgeId.toString(),source:e.source.toString(),target:e.target.toString()}))))})()}),[]),i.useEffect((()=>{}),[I]);const N=(e,i)=>{e.dataTransfer.setData("application/reactflow",i),e.dataTransfer.effectAllowed="move"},B=i.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),z=i.useCallback((async e=>{e.preventDefault();const i=e.dataTransfer.getData("application/reactflow");if(void 0===i||!i)return;const t=C({x:e.clientX,y:e.clientY}),o=await P({aiPipelineId:s.aiPipelineId,x:t.x.toString(),y:t.y.toString(),type:i});if(1e3!==o.code)return;const a=o.data,r=F(a);D((e=>[...e,r]))}),[C]),M=i.useCallback((e=>{T({aiPipelineId:s.aiPipelineId,source:parseInt(e.source),target:parseInt(e.target)}).then((i=>{A((i=>n(e,i)))}))}),[]),q=i.useCallback((e=>{D((i=>l(e,i)))}),[]),G=i.useCallback((e=>{A((i=>p(e,i)))}),[]);return e.jsxs(g.Provider,{value:{reloadData:async e=>{const{data:i}=await y({aiPipelinePointId:e}),t=F(i);D((i=>i.filter((i=>i.id!==e.toString())).concat(t)))},setOpenDrawer:w,deleteNode:e=>{D((i=>i.filter((i=>i.id!=e))))}},children:[e.jsxs(d,{nodes:I,edges:k,onConnect:M,onNodesChange:q,onEdgesChange:G,onNodeDragStop:async(e,i,t)=>{b||h({x:i.position.x,y:i.position.y,aiPipelinePointId:i.id})},deleteKeyCode:["Backspace","Delete"],onBeforeDelete:async e=>(A((i=>i.filter((i=>!e.edges.find((e=>e.id===i.id)))))),e.edges.length>0&&e.edges.forEach((e=>{x({...e,aiPipelineId:s.aiPipelineId})})),!1),defaultEdgeOptions:{animated:!0},fitView:!0,snapGrid:[16,16],nodeTypes:v,minZoom:.01,maxZoom:6,preventScrolling:!0,zoomOnScroll:!0,zoomOnPinch:!0,zoomOnDoubleClick:!1,onDrop:z,onDragOver:B,children:[e.jsx(c,{}),e.jsx(m,{color:"#aaa",gap:16}),e.jsx(j,{pannable:!0,nodeColor:"#151414"}),e.jsxs(u,{position:"top-left",children:[e.jsx(o,{type:"link",onClick:()=>{},onDragStart:e=>N(e,"aiText"),draggable:!0,children:"文本Ai"}),e.jsx(o,{type:"link",onClick:()=>{},onDragStart:e=>N(e,"aiTextToPic"),draggable:!0,children:"文生图Ai"})]}),e.jsx(u,{position:"top-right",children:e.jsx(o,{type:"primary",style:{display:"block"},onClick:()=>{E(t.add)},children:"单次测试"})})]}),e.jsx(a,{title:"单测",open:O!==t.close,width:"70%",destroyOnClose:!0,maskClosable:!0,onClose:()=>E(t.close),footer:null,children:e.jsx("div",{children:e.jsx(S,{aiPipelineId:s.aiPipelineId})})})]})},b=i=>e.jsx("div",{style:{width:"100%",height:"calc(100vh - 110px)"},children:e.jsx(s,{children:e.jsx(A,{aiPipelineId:i.aiPipelineId,closeModal:i.closeModal})})});export{b as default};
