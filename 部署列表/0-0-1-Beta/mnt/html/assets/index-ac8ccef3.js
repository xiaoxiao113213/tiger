import{r as e,O as t,i as s,j as a,P as r,B as o,D as i,m as l,T as n,aw as c,M as d,c as p}from"./index-52537ad8.js";import u from"./detail-31e1b5bd.js";import m from"./addOrUpdate-44a58376.js";import{projectIssuePageApi as j,projectIssueUpdateStatusApi as y,projectIssueDeleteApi as x}from"./api-2b18985a.js";import{projectCustomFieldAllApi as I,projectCustomFieldSaveApi as h}from"./api-85a9c682.js";import{serverToClientValue as f,clientToServerValueItem as b}from"./Bo-cc27e439.js";import{p as T}from"./ProjectDic-3e15bdd8.js";import S from"./formComponent-546559ea.js";import{I as v}from"./IssueTypeDic-2581ac45.js";import{projectReleaseAllApi as g}from"./api-4e3a6b26.js";import{P as C}from"./PlusOutlined-0403edcb.js";import{T as E}from"./index-d6118671.js";import"./FileView-473dc538.js";import"./index-26e83972.js";import"./index-ec1d06fe.js";import"./index-a5ca1b9c.js";import"./index-8d66853c.js";import"./EditOutlined-4076ffe0.js";import"./dicApi-f974ede5.js";import"./FileUploadCom-4d839597.js";import"./utils-490c67f2.js";import"./submitNowform-370ac6e7.js";import"./textSubmit-f698ce92.js";import"./textAreaSubmit-9cc0fcd3.js";import"./SelectSubmit-a0546f42.js";import"./MutSelectSubmit-978c5f1c.js";import"./DateSubmit-7515399a.js";import"./NumberSubmit-d54ed6cf.js";import"./FileUploadSubmit-1e28b47f.js";import"./Title-0f7b284b.js";import"./Input-33d09d13.js";import"./TextArea-0027e4e6.js";import"./index-f6caee0f.js";import"./FileSubmit-f1303890.js";import"./customerFieldNew-1985dcb7.js";import"./customerText-7f38fb85.js";import"./customerTextArea-84d38379.js";import"./customerSelect-aabfe871.js";import"./MinusCircleOutlined-37395b9b.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-c1e3cf9e.js";import"./CustomerFile-7877d17f.js";import"./CustomerDate-9ed3e0ba.js";import"./customerNumber-33ced8f3.js";import"./DeleteOutlined-104cbf00.js";const k=()=>{const k=e.useRef(),[w,D]=e.useState(t.close),[N,O]=e.useState(),[F,P]=e.useState(t.close),{ProjectList:z,ProjectMap:M,ProjectValueEnum:A}=T(),{IssueTypeMap:B,IssueTypeValueEnum:U}=v(),[R,V]=e.useState(),[q,K]=e.useState(!1),$=s.useRef(null),[G,H]=e.useState([]),[L,W]=e.useState(void 0);if(e.useEffect((()=>{z.length>0&&W(z[0].value)}),[z]),e.useEffect((()=>{L&&g({projectId:L}).then((e=>{let t={};e.data.forEach((e=>{t[e.value]={text:e.label}})),V(t)}))}),[L]),0===z.length||!L)return a.jsx("div",{children:"loading"});const X=e=>{O(e?.projectIssueId),P(e?t.edit:t.add)},Y=async(e,t)=>{"start"===e?(await y({projectIssueId:t.projectIssueId,status:"1"}),k.current?.reload()):"success"===e?d?.confirm({title:"确认完成任务",icon:null,onOk:async()=>{let e=await y({projectIssueId:t.projectIssueId,status:"2"});p(e)||(l.success(e.msg),k.current?.reload())}}):"close"===e?d?.confirm({title:"确认关闭任务",icon:null,onOk:async()=>{let e=await y({projectIssueId:t.projectIssueId,status:"3"});p(e)||(l.success(e.msg),k.current?.reload())}}):"del"===e&&(async e=>{d?.confirm({title:"是否确认删除",icon:null,onOk:async()=>{let t=await x({projectIssueId:e.projectIssueId});p(t)||(l.success(t.msg),k.current?.reload())}})})(t)},Z=[{title:"ID",dataIndex:"projectIssueId",valueType:"text",copyable:!1,search:!1},{title:"项目",dataIndex:"projectId",valueType:"text",copyable:!1,search:!0,hideInTable:!0,valueEnum:A,ellipsis:!0,formItemProps:{rules:[{required:!0,message:"项目是必填项"}]},initialValue:L},{title:"版本",dataIndex:"projectReleaseId",valueType:"text",copyable:!1,search:!0,ellipsis:!0,valueEnum:R},{title:"类型",dataIndex:"type",valueType:"text",copyable:!1,search:!0,valueEnum:U,render:(e,{type:t})=>a.jsx(n,{color:B[t].color,children:B[t].label})},{title:"标题",dataIndex:"name",valueType:"text",copyable:!1,search:!0,ellipsis:!0},{title:"状态",dataIndex:"status",valueType:"text",copyable:!1,search:!0,valueEnum:{0:{text:"未开始",status:"Default"},1:{text:"进行中",status:"Processing"},2:{text:"已完成",status:"Success"},3:{text:"已关闭",status:"Error"}}},{title:"计划开始时间",dataIndex:"planStartDate",valueType:"text",copyable:!1,search:!1,render:(e,{planStartDate:t})=>c(t)},{title:"计划结束时间",dataIndex:"planEndDate",valueType:"text",copyable:!1,search:!1,render:(e,{planEndDate:t})=>c(t)},{title:"开始时间",dataIndex:"startDate",valueType:"text",copyable:!1,search:!1,render:(e,{startDate:t})=>c(t)},{title:"结束时间",dataIndex:"endDate",valueType:"text",copyable:!1,search:!1,render:(e,{endDate:t})=>c(t)},{title:"备注",dataIndex:"remarks",valueType:"text",copyable:!1,search:!1},{title:"责任人",dataIndex:"headUserId",valueType:"text",copyable:!1,search:!1,render:(e,{headUserInfo:t})=>t?.nickName},{title:"优先级",dataIndex:"priority",valueType:"text",copyable:!1,search:!1,valueEnum:{0:{text:"一般",status:"Success"},1:{text:"重要",status:"Processing"},2:{text:"紧急",status:"Error"}}},{title:"创建人",dataIndex:"createBy",valueType:"text",copyable:!1,search:!1,render:(e,{createByAccount:t})=>t?.nickName},{title:"创建时间",dataIndex:"createTime",valueType:"text",copyable:!1,search:!1},{title:"操作",valueType:"option",key:"option",width:120,render:(e,s,r,o)=>[a.jsx("a",{onClick:()=>(e=>{O(e.projectIssueId),D(t.detail)})(s),children:"详情"},"detail"),a.jsx("a",{onClick:()=>X(s),children:"编辑"},"edit"),a.jsx(E,{onSelect:e=>Y(e,s),menus:[{key:"start",name:"进行任务",style:{color:"rgb(76, 157, 255)"},hidden:"0"!=s.status},{key:"success",name:"完成任务",style:{color:"rgb(76, 157, 255)"},hidden:"1"!=s.status},{key:"close",name:"关闭任务",danger:!0,hidden:"2"==s.status||"3"==s.status},{key:"del",name:"删除",danger:!0}]},"actionGroup")]}];return a.jsxs("div",{children:[a.jsx("div",{children:a.jsx(r,{columns:Z,actionRef:k,cardBordered:!0,defaultSize:"small",params:{},request:async(e={},t,s)=>{let a={pageNum:e.current,pageSize:e.pageSize,pageSort:t},r=await j({...e,...a});return{data:r.data.list,success:1e3===r.code,total:r.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"projectIssue-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"projectIssueId",search:{labelWidth:"auto",defaultCollapsed:!1},options:{setting:{listsHeight:400}},form:{syncToUrl:!1,onValuesChange:(e,t)=>{e.projectId&&W(e.projectId)}},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[a.jsx(o,{icon:a.jsx(C,{}),onClick:()=>{X()},type:"primary",children:"新建"},"button"),a.jsx(o,{onClick:async()=>{const e=await I({bizType:"2"});e.data.forEach((e=>{e.id=e.projectCustomFieldId+"";const t=e;t.notEditKeyName=!0,f(t)})),H(e.data),K(!0)},type:"primary",children:"定义表单"},"button1")]})}),a.jsx(i,{title:"配置详情",open:w!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>D(t.close),footer:null,children:a.jsx("div",{children:a.jsx(u,{detailId:N})})}),a.jsx(i,{title:F==t.edit?"配置编辑":"配置新增",open:F!==t.close,width:"50%",destroyOnClose:!0,maskClosable:!1,onClose:()=>P(t.close),footer:null,children:a.jsx("div",{children:a.jsx(m,{detailId:N??0,operateEnum:F,setAddOrUpdateModalFn:P,reloadTable:()=>{k.current?.reload()},defaultProjectId:L})})}),a.jsx(i,{title:"表单设计",open:q,onClose:()=>K(!1),extra:a.jsx(o,{onClick:async()=>{const e=$.current?.getFieldList();e&&(e.forEach((t=>{if(""===t.keyName)throw l.error("有字段的唯一标识为空"),new Error("有字段的唯一标识为空");const s=e.filter((e=>e.keyName===t.keyName));if(s.length>1)throw l.error(`有重复的唯一标识【${s[0].keyName}】`),new Error(`有重复的唯一标识【${s[0].keyName}】`);t.bizType="2"})),e.forEach((e=>{b(e)})),await h({bizType:"2",list:e}),K(!1))},type:"primary",children:"确定"}),width:"100%",destroyOnClose:!0,children:a.jsx(S,{ref:$,initFormDesign:G})})]})};export{k as default};
