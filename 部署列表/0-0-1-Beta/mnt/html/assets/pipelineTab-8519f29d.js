import{F as t,r as e,j as i,O as s,B as o,al as a,K as r,Y as p,m,aj as l}from"./index-1fe6dff8.js";import n from"./pipelineMainAdd-1b7f2958.js";import{pipelineNodeAllApi as d}from"./api-de7774c8.js";import{otherAccountAllApi as j}from"./api-f6cf4490.js";import{clientToServerValueItem as u,serverToClientValue as c,FormFieldTypeEnum as y}from"./Bo-9e2098a1.js";import{pipelineUpdateApi as f,pipelineSaveApi as x,pipelineGetOneApi as S}from"./pipeline-b29714ee.js";import"./index-7ad95df9.js";import"./stageComponent-c6290ef3.js";import"./context-cf6d3647.js";import"./stepComponent-c924f288.js";import"./api-5149c00d.js";import"./index-05ffbfcb.js";import"./submitNowform-3c073972.js";import"./textSubmit-0f3171ae.js";import"./textAreaSubmit-d1dfc909.js";import"./SelectSubmit-9d579393.js";import"./MutSelectSubmit-5dc3359d.js";import"./DateSubmit-c557ba41.js";import"./NumberSubmit-de5567a9.js";import"./FileUploadSubmit-add66fc2.js";import"./PlusOutlined-73232e7a.js";import"./index-80d88ab0.js";import"./PipelineFlow-d817273c.js";import"./index-9cc62199.js";/* empty css              */import"./uilts-d0a0e0a8.js";import"./StartNode-05ba3179.js";/* empty css             */import"./dataUtil-0d1579d9.js";import"./StageNode-796bf915.js";import"./StepNode-3983fa5c.js";import"./CustomEdge-26faa487.js";import"./index-b78e92bd.js";import"./FileSubmit-0542b294.js";import"./formComponent-27c8784f.js";import"./Title-952b03be.js";import"./Input-f98aea5e.js";import"./TextArea-08e23fd4.js";import"./customerFieldNew-8ebcd271.js";import"./customerText-9afb4922.js";import"./customerTextArea-67b7b62e.js";import"./customerSelect-14199e01.js";import"./MinusCircleOutlined-7f40363e.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-773b4206.js";import"./CustomerFile-4ea8258f.js";import"./CustomerDate-7ed6f47b.js";import"./customerNumber-a25d7bcc.js";import"./DeleteOutlined-916130f1.js";const b=b=>{const[F]=t.useForm(),[h,v]=e.useState(),[T,g]=e.useState([]),[C,L]=e.useState([]),[w,A]=e.useState([]),[E]=t.useForm(),[N,O]=e.useState([]),P=[{key:"1",label:"主配置",children:i.jsx("div",{children:void 0!==h&&i.jsx(n,{detail:h,setDetailFn:v,pipelineNodeList:T,detailFormRef:F,openType:b.openType,softList:C,otherAccountList:w,globalFieldList:N,setGlobalFieldList:O})})}],k=t=>{t.globalParamList?.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(",")),t.type,y.password})),l(t.pipelineStageList??[]).forEach((t=>{t?.paramList.forEach((t=>{Array.isArray(t.value)&&(t.value=t.value.join(","))}))}))},D=i.jsxs("div",{children:[b.openType!==s.detail&&i.jsx(o,{type:"primary",onClick:async()=>{if(b.openType===s.detail)return void b.setOpenTypeFn(s.close);if(!(await F.validateFields().catch((()=>!1))))return;const t=await(F?.getFieldsValue());p(t);if(!(await E.validateFields().catch((()=>!1))))return void m.warning("有必填项未填");const e=N.map((t=>{const e={...t};return u(e),e}));let i;if(h?.id){let t={...h,globalParamList:e};k(a(t)),i=await f(a(t))}else{let s={...h,...t,globalParamList:e};k(a(s)),i=await x(a(s))}1e3===i?.code&&(m.success(i?.msg),b.reloadTable(),b.setOpenTypeFn(s.close))},children:"确认"}),i.jsx(o,{type:"default",style:{marginLeft:10},onClick:()=>b.setOpenTypeFn(s.close),children:"取消"})]});return e.useEffect((()=>((async()=>{d({}).then((t=>{g(t.data)})),L([{id:1,name:"软件1"},{id:3,name:"软件2"},{id:2,name:"软件3"}]),j({}).then((t=>{t.data.forEach((t=>t.id=t.id+"")),A(t.data)}))})(),b.openType===s.add?v(a({parallel:0,timer:0,timerCron:0,email:0,pipelineStageList:[]})):b.openType!==s.edit&&b.openType!==s.detail||(async t=>{const e=await S({id:t});if(1e3!==e?.code)return;v({...e.data});const i=e.data.globalParamList??[];i.forEach((t=>{c(t)})),O(i),F?.setFieldsValue({...e.data}),e.data.permissionList})(b.detailId),()=>{})),[b.openType]),i.jsx("div",{children:i.jsx(r,{defaultActiveKey:"1",items:P,onChange:t=>{},tabBarExtraContent:D})})};export{b as default};
