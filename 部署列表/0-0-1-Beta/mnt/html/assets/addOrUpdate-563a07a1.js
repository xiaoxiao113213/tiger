import{F as e,r as t,d as s,j as a,S as i,I as o,B as r,O as l,Y as d,m}from"./index-10719960.js";import{projectReleaseGetOneApi as u,projectReleaseUpdateApi as n,projectReleaseSaveApi as c}from"./api-eca3f0b9.js";import{F as p}from"./FileUploadCom-c3fb6dc0.js";import j from"./submitNowform-3ec5b855.js";import{p as f}from"./ProjectDic-9dcf0c8c.js";import{serverToClientValue as x,serverToClientValue1 as h,clientToServerValue1 as b}from"./Bo-bcadefc8.js";import{projectCustomFieldAllApi as F}from"./api-20821f6a.js";import{f as I,a as w}from"./utils-452b7114.js";import"./PlusOutlined-cc4f568a.js";import"./textSubmit-5aad76e3.js";import"./textAreaSubmit-e3064045.js";import"./SelectSubmit-fba154f7.js";import"./MutSelectSubmit-7d2986fa.js";import"./DateSubmit-7b5457eb.js";import"./NumberSubmit-61c4b5e2.js";import"./FileUploadSubmit-b86f5e72.js";const S=S=>{const[y]=e.useForm(),[g,C]=t.useState(s),{ProjectList:L}=f(),[V,v]=t.useState();if(t.useEffect((()=>((async()=>{const e=(await F({bizType:"1"})).data;if(e.forEach((e=>{const t=e.projectCustomFieldId,s=e;x(s),s.id=t+"_customField"})),v(e),S.operateEnum===l.edit){let t=await u({projectReleaseId:S.detailId});t.data.fileList=I(t.data.fileList);for(let s in t.data.customValues)if(t.data.customValues.hasOwnProperty(s)){const a=s.split("_");if(2===a.length){const i=a[0];t.data.customValues[s]=h(e.find((e=>e.projectCustomFieldId==i)),t.data.customValues[s])}}C(t.data),y.setFieldsValue({...t.data,...t.data.customValues})}else y.setFieldsValue({projectId:S.defaultProjectId})})(),()=>{})),[]),void 0===V)return a.jsx("div",{});return a.jsx("div",{children:a.jsxs(e,{form:y,labelCol:{flex:"120px"},children:[a.jsx(e.Item,{label:"项目",name:"projectId",rules:[{required:!0}],children:a.jsx(i,{options:L,disabled:!0})}),a.jsx(e.Item,{label:"版本",name:"version",rules:[{required:!0}],children:a.jsx(o,{placeholder:"请输入",maxLength:200,showCount:!0})}),a.jsx(e.Item,{label:"remarks",name:"remarks",rules:[{required:!1}],children:a.jsx(o.TextArea,{placeholder:"请输入",maxLength:1900,showCount:!0,autoSize:{minRows:2,maxRows:5}})}),a.jsx(p,{name:"fileList",label:"附件",required:!1}),V.map((e=>a.jsx(j,{initFieldBo:e},e.id))),a.jsxs(e.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[a.jsx(r,{type:"default",onClick:()=>{S.setAddOrUpdateModalFn(l.close)},style:{marginRight:20},children:"取消"}),a.jsx(r,{type:"primary",onClick:async()=>{if(!(await y.validateFields().catch((()=>!1))))return;const e=await(y?.getFieldsValue());d(e);for(let s in e)if(e.hasOwnProperty(s)){const t=s.split("_");if(2===t.length){const a=t[0];e[t[0]]=b(V.find((e=>e.projectCustomFieldId==a)),e[s]),delete e[s]}}let t;e.fileList=w(e.fileList),t=S.operateEnum===l.edit?await n({...e,projectReleaseId:S.detailId}):await c({...e}),1e3===t.code&&(m.success(t.msg),S.reloadTable(),S.setAddOrUpdateModalFn(l.close))},children:"确定"})]})]})})};export{S as default};
