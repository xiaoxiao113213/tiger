import{r as e,j as t,P as a,T as i,M as l,c as r,m as s}from"./index-1fe6dff8.js";import{pipelineBuildPageApi as n,pipelineBuildStopApi as d}from"./pipelineBuildApi-244cc49e.js";import{a as o,P as c,g as p}from"./PipelineBuildStatus-7922b5e5.js";const u=u=>{const m=e.useRef(),h=e=>{let t=p(e.buildStatus),a=!0;return t!==o.stop&&t!==o.success&&t!==o.fail&&t!==o.fail_skip||(a=!1),a};e.useEffect((()=>{const e=setInterval((()=>{m.current?.reload()}),2e3);return()=>{clearInterval(e)}}),[u.pipelineId]);const I=[{title:"ID",dataIndex:"id",valueType:"text",width:48},{title:"NO",dataIndex:"buildNo",valueType:"text",width:48},{disable:!0,title:"状态",dataIndex:"buildStatus",search:!1,renderFormItem:(e,{defaultRender:t})=>t(e),render:(e,{buildStatus:a})=>{const l=p(a);return l===o.fail||l===o.fail_skip||l===o.stop?t.jsx(i,{color:"red",children:c.get(a)}):t.jsx(i,{color:"green",children:c.get(a)})}},{title:"构建人",dataIndex:"createBy",ellipsis:!0},{title:"创建时间",key:"showTime",dataIndex:"createTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"开始构建时间",dataIndex:"buildStartTime",valueType:"dateTime",sorter:!0,hideInTable:!1},{hideInTable:!1,title:"构建时长",sorter:!0,dataIndex:"updateBy"},{title:"操作",valueType:"option",key:"option",render:(e,a,i,n)=>[t.jsx("a",{onClick:()=>{},children:"详情"},"detail"),t.jsx("div",{children:h(a)&&t.jsx("a",{onClick:()=>(async e=>{l?.confirm({title:"是否确认终止构建",icon:null,onOk:async()=>{let t=await d({id:e.id});r(t)||(s.success(t.msg),m.current?.reload())}})})(a),style:{color:"red"},children:"终止构建"},"stop")},"stop"),t.jsx("a",{onClick:()=>{},children:"日志"},"log"),t.jsx("a",{onClick:()=>{},children:"再次构建"},"rebuild")]}];return t.jsx(a,{columns:I,actionRef:m,cardBordered:!0,params:{pipelineId:u.pipelineId},request:async(e={},t,a)=>{let i={pipelineId:u.pipelineId,pageNum:e.current,pageSize:e.pageSize,pageSort:t},l=await n(i);return{data:l.data.list,success:1e3===l.code,total:l.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage",onChange(e){}},rowKey:"id",search:!1,options:{setting:{listsHeight:400}},form:{syncToUrl:!1},pagination:{pageSize:10,onChange:e=>{}},dateFormatter:"string",headerTitle:"构建列表",toolBarRender:()=>[]})};export{u as default};
