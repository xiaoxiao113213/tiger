import{F as e,r as a,j as t,I as r,S as s,O as l,ac as d,B as i,a8 as o,a9 as n,Y as m,m as p}from"./index-03adb9ee.js";import{p as u,a as c}from"./projectTypeDic-b589226f.js";import{projectCustomFieldAllApi as j,projectGetOneApi as h,projectUpdateApi as x,projectSaveApi as f}from"./api-ad49bbe8.js";import{F as I}from"./FileUploadCom-56501644.js";import b from"./submitNowform-fbdcf9ab.js";import{serverToClientValue as S,serverToClientValue1 as D,clientToServerValue1 as w}from"./Bo-c1a8a5bb.js";import{f as F,a as y}from"./utils-20c57c3a.js";import"./dicApi-3ecc5ba9.js";import"./PlusOutlined-b4032aa8.js";import"./textSubmit-bd6c5b40.js";import"./textAreaSubmit-3b52d66b.js";import"./SelectSubmit-4c180fb2.js";import"./MutSelectSubmit-064a257d.js";import"./DateSubmit-95284b79.js";import"./NumberSubmit-77884c9b.js";import"./FileUploadSubmit-e8f92bb2.js";const g=g=>{const[q]=e.useForm(),[U,v]=a.useState(),{projectTypeList:C}=u(),[E,L]=a.useState(),[V,A]=a.useState();if(a.useEffect((()=>((async()=>{const e=(await j({bizType:"0"})).data;e.forEach((e=>{const a=e.projectCustomFieldId,t=e;S(t),t.id=a+"_customField"})),A(e);const a=await o();if(a.data.forEach((e=>e.value=e.value.toString())),L(a.data),g.operateEnum===l.edit){let a=await h({projectId:g.detailId});a.data.planEndDate=a.data.planEndDate?n(a.data.planEndDate):void 0,a.data.planStartDate=a.data.planStartDate?n(a.data.planStartDate):void 0,a.data.startDate=a.data.startDate?n(a.data.startDate):void 0,a.data.endDate=a.data.endDate?n(a.data.endDate):void 0,a.data.headUserId=0==a.data.headUserId?void 0:a.data.headUserId,a.data.reporterUserId=0==a.data.reporterUserId?void 0:a.data.reporterUserId,a.data.fileList=F(a.data.fileList),v(a.data);for(let t in a.data.customValues)if(a.data.customValues.hasOwnProperty(t)){const r=t.split("_");if(2===r.length){const s=r[0];a.data.customValues[t]=D(e.find((e=>e.projectCustomFieldId==s)),a.data.customValues[t])}}q.setFieldsValue({...a.data,...a.data.customValues})}else v({})})(),()=>{})),[]),!U)return null;if(!V)return null;return t.jsx("div",{children:t.jsxs(e,{form:q,labelCol:{flex:"100px"},children:[t.jsx(e.Item,{label:"名称",name:"name",rules:[{required:!0}],children:t.jsx(r,{placeholder:"请输入",maxLength:200,showCount:!0})}),t.jsx(e.Item,{label:"类型",name:"type",rules:[{required:!0}],children:t.jsx(s,{placeholder:"请选择",options:C})}),t.jsx(e.Item,{label:"编码",name:"code",rules:[{required:!0}],children:t.jsx(r,{placeholder:"请输入",maxLength:200,showCount:!0,disabled:g.operateEnum!=l.add})}),t.jsx(e.Item,{label:"状态",name:"status",rules:[{required:!0}],children:t.jsx(s,{placeholder:"请选择",options:c})}),t.jsx(e.Item,{label:"计划开始日期",name:"planStartDate",rules:[{required:!1}],children:t.jsx(d,{placeholder:"请选择"})}),t.jsx(e.Item,{label:"计划结束日期",name:"planEndDate",rules:[{required:!1}],children:t.jsx(d,{placeholder:"请选择"})}),t.jsx(e.Item,{label:"实际开始日期",name:"startDate",rules:[{required:!1}],children:t.jsx(d,{placeholder:"请选择"})}),t.jsx(e.Item,{label:"实际结束日期",name:"endDate",rules:[{required:!1}],children:t.jsx(d,{placeholder:"请选择"})}),t.jsx(e.Item,{label:"描述",name:"remarks",rules:[{required:!1}],children:t.jsx(r.TextArea,{placeholder:"请输入",showCount:!0,maxLength:2e3,autoSize:{minRows:3,maxRows:5}})}),t.jsx(e.Item,{label:"负责人",name:"headUserId",rules:[{required:!0}],children:t.jsx(s,{placeholder:"请选择",options:E,optionFilterProp:"label",showSearch:!0})}),t.jsx(e.Item,{label:"报告人",name:"reporterUserId",rules:[{required:!1}],children:t.jsx(s,{placeholder:"请选择",options:E,optionFilterProp:"label",showSearch:!0})}),t.jsx(I,{name:"fileList",label:"附件",required:!1}),V.map((e=>t.jsx(b,{initFieldBo:e},e.id))),t.jsxs(e.Item,{wrapperCol:{offset:8,span:16},style:{textAlign:"right"},children:[t.jsx(i,{type:"default",onClick:()=>{g.setAddOrUpdateModalFn(l.close)},style:{marginRight:20},children:"取消"}),t.jsx(i,{type:"primary",onClick:async()=>{if(!(await q.validateFields().catch((()=>!1))))return;const e=await(q?.getFieldsValue());m(e);for(let t in e)if(e.hasOwnProperty(t)){const a=t.split("_");if(2===a.length){const r=a[0];e[a[0]]=w(V.find((e=>e.projectCustomFieldId==r)),e[t]),delete e[t]}}let a;e.fileList=y(e.fileList),a=g.operateEnum===l.edit?await x({...e,projectId:g.detailId}):await f({...e}),1e3===a.code&&(p.success(a.msg),g.reloadTable(),g.setAddOrUpdateModalFn(l.close))},children:"确定"})]})]})})};export{g as default};
