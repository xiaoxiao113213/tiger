import{r as e,O as t,i as s,j as a,P as r,B as o,D as i,m as l,T as n,aw as c,M as d,c as p}from"./index-1fe6dff8.js";import u from"./detail-2c981a92.js";import m from"./addOrUpdate-9e1f4fa3.js";import{projectIssuePageApi as j,projectIssueUpdateStatusApi as y,projectIssueDeleteApi as x}from"./api-7155bd2e.js";import{projectCustomFieldAllApi as I,projectCustomFieldSaveApi as h}from"./api-7922a999.js";import{serverToClientValue as f,clientToServerValueItem as b}from"./Bo-9e2098a1.js";import{p as T}from"./ProjectDic-4254ddc1.js";import S from"./formComponent-27c8784f.js";import{I as v}from"./IssueTypeDic-fa9ba1f5.js";import{projectReleaseAllApi as g}from"./api-12ed6815.js";import{P as C}from"./PlusOutlined-73232e7a.js";import{T as k}from"./index-85d047c3.js";import"./FileView-40a1835a.js";import"./index-ad901ab1.js";import"./index-adfb8488.js";import"./index-262ec5ed.js";import"./index-80d88ab0.js";import"./EditOutlined-fbc989f8.js";import"./dicApi-b68549fb.js";import"./FileUploadCom-a72168c5.js";import"./utils-b346c468.js";import"./submitNowform-3c073972.js";import"./textSubmit-0f3171ae.js";import"./textAreaSubmit-d1dfc909.js";import"./SelectSubmit-9d579393.js";import"./MutSelectSubmit-5dc3359d.js";import"./DateSubmit-c557ba41.js";import"./NumberSubmit-de5567a9.js";import"./FileUploadSubmit-add66fc2.js";import"./Title-952b03be.js";import"./Input-f98aea5e.js";import"./TextArea-08e23fd4.js";import"./index-b78e92bd.js";import"./FileSubmit-0542b294.js";import"./customerFieldNew-8ebcd271.js";import"./customerText-9afb4922.js";import"./customerTextArea-67b7b62e.js";import"./customerSelect-14199e01.js";import"./MinusCircleOutlined-7f40363e.js";import"./MinusCircleOutlined-47af1d51.js";import"./customerMutSelect-773b4206.js";import"./CustomerFile-4ea8258f.js";import"./CustomerDate-7ed6f47b.js";import"./customerNumber-a25d7bcc.js";import"./DeleteOutlined-916130f1.js";const E=()=>{const E=e.useRef(),[w,D]=e.useState(t.close),[O,N]=e.useState(),[F,P]=e.useState(t.close),{ProjectList:z,ProjectMap:M,ProjectValueEnum:A}=T(),{IssueTypeMap:B,IssueTypeValueEnum:U}=v(),[R,V]=e.useState(),[q,K]=e.useState(!1),$=s.useRef(null),[G,L]=e.useState([]),[W,H]=e.useState(void 0);if(e.useEffect((()=>{z.length>0&&H(z[0].value)}),[z]),e.useEffect((()=>{W&&g({projectId:W}).then((e=>{let t={};e.data.forEach((e=>{t[e.value]={text:e.label}})),V(t)}))}),[W]),0===z.length||!W)return a.jsx("div",{children:"loading"});const Q=e=>{N(e?.projectIssueId),P(e?t.edit:t.add)},X=async(e,t)=>{"start"===e?(await y({projectIssueId:t.projectIssueId,status:"1"}),E.current?.reload()):"success"===e?d?.confirm({title:"确认完成任务",icon:null,onOk:async()=>{let e=await y({projectIssueId:t.projectIssueId,status:"2"});p(e)||(l.success(e.msg),E.current?.reload())}}):"close"===e?d?.confirm({title:"确认关闭任务",icon:null,onOk:async()=>{let e=await y({projectIssueId:t.projectIssueId,status:"3"});p(e)||(l.success(e.msg),E.current?.reload())}}):"del"===e&&(async e=>{d?.confirm({title:"是否确认删除",icon:null,onOk:async()=>{let t=await x({projectIssueId:e.projectIssueId});p(t)||(l.success(t.msg),E.current?.reload())}})})(t)},Y=[{title:"ID",dataIndex:"projectIssueId",valueType:"text",copyable:!1,search:!1},{title:"项目",dataIndex:"projectId",valueType:"text",copyable:!1,search:!0,hideInTable:!0,valueEnum:A,ellipsis:!0,formItemProps:{rules:[{required:!0,message:"项目是必填项"}]},initialValue:W},{title:"版本",dataIndex:"projectReleaseId",valueType:"text",copyable:!1,search:!0,ellipsis:!0,valueEnum:R},{title:"类型",dataIndex:"type",valueType:"text",copyable:!1,search:!0,valueEnum:U,render:(e,{type:t})=>a.jsx(n,{color:B[t].color,children:B[t].label})},{title:"标题",dataIndex:"name",valueType:"text",copyable:!1,search:!0,ellipsis:!0},{title:"状态",dataIndex:"status",valueType:"text",copyable:!1,search:!0,valueEnum:{0:{text:"未开始",status:"Default"},1:{text:"进行中",status:"Processing"},2:{text:"已完成",status:"Success"},3:{text:"已关闭",status:"Error"}}},{title:"计划开始时间",dataIndex:"planStartDate",valueType:"text",copyable:!1,search:!1,render:(e,{planStartDate:t})=>c(t)},{title:"计划结束时间",dataIndex:"planEndDate",valueType:"text",copyable:!1,search:!1,render:(e,{planEndDate:t})=>c(t)},{title:"开始时间",dataIndex:"startDate",valueType:"text",copyable:!1,search:!1,render:(e,{startDate:t})=>c(t)},{title:"结束时间",dataIndex:"endDate",valueType:"text",copyable:!1,search:!1,render:(e,{endDate:t})=>c(t)},{title:"备注",dataIndex:"remarks",valueType:"text",copyable:!1,search:!1},{title:"责任人",dataIndex:"headUserId",valueType:"text",copyable:!1,search:!1,render:(e,{headUserInfo:t})=>t?.nickName},{title:"优先级",dataIndex:"priority",valueType:"text",copyable:!1,search:!1,valueEnum:{0:{text:"一般",status:"Success"},1:{text:"重要",status:"Processing"},2:{text:"紧急",status:"Error"}}},{title:"创建人",dataIndex:"createBy",valueType:"text",copyable:!1,search:!1,render:(e,{createByAccount:t})=>t?.nickName},{title:"创建时间",dataIndex:"createTime",valueType:"text",copyable:!1,search:!1},{title:"操作",valueType:"option",key:"option",width:120,render:(e,s,r,o)=>[a.jsx("a",{onClick:()=>(e=>{N(e.projectIssueId),D(t.detail)})(s),children:"详情"},"detail"),a.jsx("a",{onClick:()=>Q(s),children:"编辑"},"edit"),a.jsx(k,{onSelect:e=>X(e,s),menus:[{key:"start",name:"进行任务",style:{color:"rgb(76, 157, 255)"},hidden:"0"!=s.status},{key:"success",name:"完成任务",style:{color:"rgb(76, 157, 255)"},hidden:"1"!=s.status},{key:"close",name:"关闭任务",danger:!0,hidden:"2"==s.status||"3"==s.status},{key:"del",name:"删除",danger:!0}]},"actionGroup")]}];return a.jsxs("div",{children:[a.jsx("div",{children:a.jsx(r,{columns:Y,actionRef:E,cardBordered:!0,defaultSize:"small",params:{},request:async(e={},t,s)=>{let a={pageNum:e.current,pageSize:e.pageSize,pageSort:t},r=await j({...e,...a});return{data:r.data.list,success:1e3===r.code,total:r.data.total}},editable:{type:"multiple"},columnsState:{persistenceKey:"projectIssue-pro-table",persistenceType:"localStorage",onChange(e){}},rowKey:"projectIssueId",search:{labelWidth:"auto",defaultCollapsed:!1},options:{setting:{listsHeight:400}},form:{syncToUrl:!1,onValuesChange:(e,t)=>{e.projectId&&H(e.projectId)}},pagination:{defaultPageSize:10,showSizeChanger:!0},dateFormatter:"string",headerTitle:"配置列表",toolBarRender:()=>[a.jsx(o,{icon:a.jsx(C,{}),onClick:()=>{Q()},type:"primary",children:"新建"},"button"),a.jsx(o,{onClick:async()=>{const e=await I({bizType:"2"});e.data.forEach((e=>{e.id=e.projectCustomFieldId+"";const t=e;t.notEditKeyName=!0,f(t)})),L(e.data),K(!0)},type:"primary",children:"定义表单"},"button1")]})}),a.jsx(i,{title:"配置详情",open:w!==t.close,width:"75%",destroyOnClose:!0,maskClosable:!1,onClose:()=>D(t.close),footer:null,children:a.jsx("div",{children:a.jsx(u,{detailId:O})})}),a.jsx(i,{title:F==t.edit?"配置编辑":"配置新增",open:F!==t.close,width:"50%",destroyOnClose:!0,maskClosable:!1,onClose:()=>P(t.close),footer:null,children:a.jsx("div",{children:a.jsx(m,{detailId:O??0,operateEnum:F,setAddOrUpdateModalFn:P,reloadTable:()=>{E.current?.reload()},defaultProjectId:W})})}),a.jsx(i,{title:"表单设计",open:q,onClose:()=>K(!1),extra:a.jsx(o,{onClick:async()=>{const e=$.current?.getFieldList();e&&(e.forEach((t=>{if(""===t.keyName)throw l.error("有字段的唯一标识为空"),new Error("有字段的唯一标识为空");const s=e.filter((e=>e.keyName===t.keyName));if(s.length>1)throw l.error(`有重复的唯一标识【${s[0].keyName}】`),new Error(`有重复的唯一标识【${s[0].keyName}】`);t.bizType="2"})),e.forEach((e=>{b(e)})),await h({bizType:"2",list:e}),K(!1))},type:"primary",children:"确定"}),width:"100%",destroyOnClose:!0,children:a.jsx(S,{ref:$,initFormDesign:G})})]})};export{E as default};
